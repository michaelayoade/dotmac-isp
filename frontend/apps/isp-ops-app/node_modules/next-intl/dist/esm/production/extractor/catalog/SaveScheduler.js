class e{isSaving=!1;pendingResolvers=[];constructor(e=50){this.delayMs=e}async schedule(e){return new Promise(((s,i)=>{this.pendingResolvers.push({resolve:s,reject:i}),1!==this.pendingResolvers.length||this.isSaving?this.pendingResolvers.length>1&&this.scheduleSave(e):this.executeSave(e)}))}scheduleSave(e){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout((()=>{this.executeSave(e)}),this.delayMs)}async executeSave(e){if(!this.isSaving){this.isSaving=!0;try{const s=await e();this.pendingResolvers.forEach((({resolve:e})=>e(s)))}catch(e){this.pendingResolvers.forEach((({reject:s})=>s(e)))}finally{this.pendingResolvers=[],this.isSaving=!1}}}destroy(){this.saveTimeout&&(clearTimeout(this.saveTimeout),this.saveTimeout=void 0),this.pendingResolvers=[],this.isSaving=!1}}export{e as default};
