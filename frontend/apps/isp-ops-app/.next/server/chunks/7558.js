exports.id=7558,exports.ids=[7558],exports.modules={27246:(e,t,a)=>{Promise.resolve().then(a.bind(a,28538))},28538:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var r=a(10326),s=a(90434),c=a(35047),i=a(17577),n=a(24319),l=a(24061),o=a(36283),d=a(6021),u=a(86645),p=a(20892),m=a(48723),h=a(77863);let y=[{href:"/dashboard/crm",label:"Overview",description:"Pipeline health, KPIs, and quick actions",icon:n.Z},{href:"/dashboard/crm/leads",label:"Leads",description:"Capture, qualify, and assign prospective customers",icon:l.Z},{href:"/dashboard/crm/quotes",label:"Quotes",description:"Proposals, pricing, and acceptance tracking",icon:o.Z},{href:"/dashboard/crm/site-surveys",label:"Site Surveys",description:"Schedule field visits and track serviceability",icon:d.Z}];function f({children:e}){return(0,r.jsx)(p.eu,{permission:"customers.read",children:(0,r.jsx)(x,{children:e})})}function x({children:e}){let t=(0,c.usePathname)(),a=(0,i.useMemo)(()=>{if(!t)return"/dashboard/crm";let e=y.find(e=>t===e.href||t.startsWith(`${e.href}/`));return e?.href??"/dashboard/crm"},[t]);return(0,r.jsxs)("div",{className:"container mx-auto space-y-6 px-4 py-8 sm:px-6 lg:px-8",children:[(0,r.jsxs)("header",{className:"flex flex-col gap-4 border-b border-border pb-6 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 text-2xl font-semibold",children:[(0,r.jsx)(u.Z,{className:"h-7 w-7 text-primary","aria-hidden":"true"}),(0,r.jsx)("span",{children:"Customer Relationship Management"})]}),(0,r.jsx)("p",{className:"max-w-2xl text-sm text-muted-foreground",children:"Guide prospects through the FTTH sales pipeline — manage leads, generate quotes, and verify serviceability to convert opportunities into paying subscribers."})]}),(0,r.jsx)(m.Badge,{variant:"outline",className:"self-start",children:"BSS Journey • Lead → Customer"})]}),(0,r.jsx)(m.Card,{children:(0,r.jsx)(m.CardContent,{className:"p-0",children:(0,r.jsx)("nav",{className:"flex flex-col divide-y divide-border md:grid md:grid-cols-4 md:divide-y-0","aria-label":"CRM navigation",children:y.map(e=>{let t=a===e.href,c=e.icon;return(0,r.jsxs)(s.default,{href:e.href,className:(0,h.cn)("flex flex-1 flex-col gap-2 p-4 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",t?"bg-primary/10 text-primary":"hover:bg-accent hover:text-foreground"),"aria-current":t?"page":void 0,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c,{className:"h-5 w-5","aria-hidden":"true"}),(0,r.jsx)("span",{className:"font-medium",children:e.label})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]},e.href)})})})}),(0,r.jsx)("section",{children:e})]})}},97505:(e,t,a)=>{"use strict";a.d(t,{Dv:()=>n,vD:()=>c,vR:()=>i});var r=a(17577),s=a(59341);function c(e={}){let[t,a]=(0,r.useState)([]),[c,i]=(0,r.useState)(!0),[n,l]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{i(!0),l(null);let t=new URLSearchParams;e.status&&t.append("status",e.status),e.source&&t.append("source",e.source),e.assignedToId&&t.append("assigned_to_id",e.assignedToId),e.partnerId&&t.append("partner_id",e.partnerId);let r=await s.x1.get(`/crm/leads${t.toString()?`?${t.toString()}`:""}`);r.data&&a(r.data)}catch(e){l(e instanceof Error?e:Error("Failed to fetch leads"))}finally{i(!1)}},[e.status,e.source,e.assignedToId,e.partnerId]),d=(0,r.useCallback)(async e=>{try{let t=await s.x1.post("/crm/leads",e);if(t.data)return a(e=>[t.data,...e]),t.data;return null}catch(e){throw console.error("Failed to create lead:",e),e}},[]),u=(0,r.useCallback)(async(e,t)=>{try{let r=await s.x1.patch(`/crm/leads/${e}`,t);if(r.data)return a(t=>t.map(t=>t.id===e?r.data:t)),r.data;return null}catch(e){throw console.error("Failed to update lead:",e),e}},[]),p=(0,r.useCallback)(async(e,t)=>{try{return await s.x1.patch(`/crm/leads/${e}/status`,{status:t}),a(a=>a.map(a=>a.id===e?{...a,status:t}:a)),!0}catch(e){return console.error("Failed to update lead status:",e),!1}},[]),m=(0,r.useCallback)(async e=>{try{return await s.x1.post(`/crm/leads/${e}/qualify`,{}),a(t=>t.map(t=>t.id===e?{...t,status:"qualified",qualified_at:new Date().toISOString()}:t)),!0}catch(e){return console.error("Failed to qualify lead:",e),!1}},[]),h=(0,r.useCallback)(async(e,t)=>{try{return await s.x1.post(`/crm/leads/${e}/disqualify`,{reason:t}),a(a=>a.map(a=>a.id===e?{...a,status:"disqualified",disqualified_at:new Date().toISOString(),disqualification_reason:t}:a)),!0}catch(e){return console.error("Failed to disqualify lead:",e),!1}},[]);return{leads:t,isLoading:c,error:n,refetch:o,createLead:d,updateLead:u,updateLeadStatus:p,qualifyLead:m,disqualifyLead:h,assignLead:(0,r.useCallback)(async(e,t)=>{try{return await s.x1.post(`/crm/leads/${e}/assign`,{user_id:t}),a(a=>a.map(a=>a.id===e?{...a,assigned_to_id:t}:a)),!0}catch(e){return console.error("Failed to assign lead:",e),!1}},[]),updateServiceability:(0,r.useCallback)(async(e,t,r)=>{try{return await s.x1.patch(`/crm/leads/${e}/serviceability`,{serviceability:t,notes:r}),a(a=>a.map(a=>a.id===e?{...a,is_serviceable:t,serviceability_checked_at:new Date().toISOString(),serviceability_notes:r||void 0}:a)),!0}catch(e){return console.error("Failed to update serviceability:",e),!1}},[]),convertToCustomer:(0,r.useCallback)(async(e,t)=>{try{let r=await s.x1.post(`/crm/leads/${e}/convert-to-customer`,t||{});if(r.data)return a(t=>t.map(t=>t.id===e?{...t,status:"won",converted_at:r.data.converted_at||new Date().toISOString(),converted_to_customer_id:r.data.converted_to_customer_id}:t)),r.data;return null}catch(e){throw console.error("Failed to convert lead to customer:",e),e}},[])}}function i(e={}){let[t,a]=(0,r.useState)([]),[c,i]=(0,r.useState)(!0),[n,l]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{i(!0),l(null);let t=new URLSearchParams;e.leadId&&t.append("lead_id",e.leadId),e.status&&t.append("status",e.status);let r=await s.x1.get(`/crm/quotes${t.toString()?`?${t.toString()}`:""}`);r.data&&a(r.data)}catch(e){l(e instanceof Error?e:Error("Failed to fetch quotes"))}finally{i(!1)}},[e.leadId,e.status]),d=(0,r.useCallback)(async e=>{try{let t=await s.x1.post("/crm/quotes",e);if(t.data)return a(e=>[t.data,...e]),t.data;return null}catch(e){throw console.error("Failed to create quote:",e),e}},[]),u=(0,r.useCallback)(async e=>{try{return await s.x1.post(`/crm/quotes/${e}/send`,{}),a(t=>t.map(t=>t.id===e?{...t,status:"sent",sent_at:new Date().toISOString()}:t)),!0}catch(e){return console.error("Failed to send quote:",e),!1}},[]);return{quotes:t,isLoading:c,error:n,refetch:o,createQuote:d,sendQuote:u,acceptQuote:(0,r.useCallback)(async(e,t)=>{try{return await s.x1.post(`/crm/quotes/${e}/accept`,{signature_data:t}),a(a=>a.map(a=>a.id===e?{...a,status:"accepted",accepted_at:new Date().toISOString(),signature_data:t||void 0}:a)),!0}catch(e){return console.error("Failed to accept quote:",e),!1}},[]),rejectQuote:(0,r.useCallback)(async(e,t)=>{try{return await s.x1.post(`/crm/quotes/${e}/reject`,{reason:t}),a(a=>a.map(a=>a.id===e?{...a,status:"rejected",rejected_at:new Date().toISOString(),rejection_reason:t}:a)),!0}catch(e){return console.error("Failed to reject quote:",e),!1}},[]),deleteQuote:(0,r.useCallback)(async e=>{try{return await s.x1.delete(`/crm/quotes/${e}`),a(t=>t.filter(t=>t.id!==e)),!0}catch(e){return console.error("Failed to delete quote:",e),!1}},[])}}function n(e={}){let[t,a]=(0,r.useState)([]),[c,i]=(0,r.useState)(!0),[n,l]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{try{i(!0),l(null);let t=new URLSearchParams;e.leadId&&t.append("lead_id",e.leadId),e.status&&t.append("status",e.status),e.technicianId&&t.append("technician_id",e.technicianId);let r=await s.x1.get(`/crm/site-surveys${t.toString()?`?${t.toString()}`:""}`);r.data&&a(r.data)}catch(e){l(e instanceof Error?e:Error("Failed to fetch site surveys"))}finally{i(!1)}},[e.leadId,e.status,e.technicianId]),d=(0,r.useCallback)(async e=>{try{let t=await s.x1.post("/crm/site-surveys",e);if(t.data)return a(e=>[t.data,...e]),t.data;return null}catch(e){throw console.error("Failed to schedule survey:",e),e}},[]);return{surveys:t,isLoading:c,error:n,refetch:o,scheduleSurvey:d,startSurvey:(0,r.useCallback)(async e=>{try{return await s.x1.post(`/crm/site-surveys/${e}/start`,{}),a(t=>t.map(t=>t.id===e?{...t,status:"in_progress"}:t)),!0}catch(e){return console.error("Failed to start survey:",e),!1}},[]),completeSurvey:(0,r.useCallback)(async(e,t)=>{try{return await s.x1.post(`/crm/site-surveys/${e}/complete`,t),a(a=>a.map(a=>a.id===e?{...a,status:"completed",completed_date:new Date().toISOString(),...t}:a)),!0}catch(e){return console.error("Failed to complete survey:",e),!1}},[]),cancelSurvey:(0,r.useCallback)(async(e,t)=>{try{return await s.x1.post(`/crm/site-surveys/${e}/cancel`,{reason:t}),a(t=>t.map(t=>t.id===e?{...t,status:"canceled"}:t)),!0}catch(e){return console.error("Failed to cancel survey:",e),!1}},[])}}},67486:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/crm/layout.tsx#default`)}};