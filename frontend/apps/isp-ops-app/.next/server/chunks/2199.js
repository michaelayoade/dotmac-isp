"use strict";exports.id=2199,exports.ids=[2199],exports.modules={42198:(e,t,s)=>{s.d(t,{z:()=>r});var i=s(10326),l=s(17577),a=s(5839),d=s(97505),n=s(59341),c=s(48723);function r({open:e,onOpenChange:t,survey:s,onSuccess:r}){let{toast:o}=(0,c.useToast)(),{completeSurvey:h}=(0,d.Dv)({}),[u,m]=(0,l.useState)(!1),x=async e=>{let t=new FormData;t.append("file",e.file),t.append("description",e.description),t.append("category","site_survey");try{let e=await n.x1.post("/storage/upload",t,{headers:{"Content-Type":"multipart/form-data"}});return e.data?.url||e.data?.file_url||""}catch(e){throw console.error("Failed to upload photo:",e),e}},p=async(e,t)=>{m(!0);try{if(t.photos.length>0&&o({title:"Uploading Photos",description:`Uploading ${t.photos.length} photo(s)...`}),await h(e,t))return o({title:"Survey Completed",description:`Survey ${s?.survey_number} has been completed successfully`}),!0;return!1}catch(e){throw console.error("Failed to complete survey:",e),o({title:"Error",description:e.message||"Failed to complete survey",variant:"destructive"}),e}finally{m(!1)}};return(0,i.jsx)(a.CompleteSurveyModal,{open:e,onOpenChange:t,survey:s,onSuccess:r,onCompleteSurvey:p,onUploadPhoto:x,isSubmitting:u})}},33570:(e,t,s)=>{s.d(t,{D:()=>h});var i=s(10326),l=s(17577),a=s(77636),d=s(36283),n=s(77506),c=s(37358),r=s(97505),o=s(48723);function h({open:e,onOpenChange:t,leadId:s,onSuccess:h}){let{toast:u}=(0,o.useToast)(),{leads:m}=(0,r.vD)({}),{scheduleSurvey:x}=(0,r.Dv)({}),[p,v]=(0,l.useState)(!1),[j,_]=(0,l.useState)({lead_id:s||"",scheduled_date:"",scheduled_time:"",technician_id:"",notes:""}),g=m.filter(e=>"qualified"===e.status||"contacted"===e.status),y=m.find(e=>e.id===j.lead_id),S=async e=>{if(e.preventDefault(),!j.lead_id){u({title:"Validation Error",description:"Please select a lead",variant:"destructive"});return}if(!j.scheduled_date||!j.scheduled_time){u({title:"Validation Error",description:"Please select date and time",variant:"destructive"});return}v(!0);try{let e=new Date(`${j.scheduled_date}T${j.scheduled_time}`).toISOString(),t={lead_id:j.lead_id,scheduled_date:e};j.technician_id&&(t.technician_id=j.technician_id),j.notes.trim()&&(t.notes=j.notes.trim());let i=await x(t);i&&(u({title:"Survey Scheduled",description:`Survey ${i.survey_number} has been scheduled successfully`}),_({lead_id:s||"",scheduled_date:"",scheduled_time:"",technician_id:"",notes:""}),h?.())}catch(e){u({title:"Error",description:e.message||"Failed to schedule survey",variant:"destructive"})}finally{v(!1)}};return(0,i.jsx)(o.Dialog,{open:e,onOpenChange:t,children:(0,i.jsxs)(o.DialogContent,{className:"max-w-2xl",children:[(0,i.jsxs)(o.DialogHeader,{children:[(0,i.jsx)(o.DialogTitle,{children:"Schedule Site Survey"}),(0,i.jsx)(o.DialogDescription,{children:"Schedule a technical assessment for a lead's service location"})]}),(0,i.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(o.Label,{htmlFor:"lead_id",children:["Lead ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),s?(0,i.jsxs)("div",{className:"p-3 border rounded-md bg-muted",children:[(0,i.jsxs)("p",{className:"font-medium",children:[y?.first_name," ",y?.last_name]}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:y?.email})]}):(0,i.jsxs)(o.Select,{value:j.lead_id,onValueChange:e=>_({...j,lead_id:e}),children:[(0,i.jsx)(o.SelectTrigger,{id:"lead_id",children:(0,i.jsx)(o.SelectValue,{placeholder:"Select a lead"})}),(0,i.jsx)(o.SelectContent,{children:0===g.length?(0,i.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:"No qualified leads available"}):g.map(e=>(0,i.jsxs)(o.SelectItem,{value:e.id,children:[e.first_name," ",e.last_name," - ",e.email]},e.id))})]})]}),y&&(0,i.jsxs)(o.Alert,{children:[(0,i.jsx)(a.Z,{className:"h-4 w-4"}),(0,i.jsx)(o.AlertTitle,{children:"Service Location"}),(0,i.jsxs)(o.AlertDescription,{className:"mt-2 text-sm",children:[(0,i.jsxs)("div",{children:[y.service_address_line1,y.service_address_line2&&`, ${y.service_address_line2}`]}),(0,i.jsxs)("div",{children:[y.service_city,", ",y.service_state_province," ",y.service_postal_code]}),(0,i.jsx)("div",{children:y.service_country})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(o.Label,{htmlFor:"scheduled_date",children:["Date ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)(o.Input,{id:"scheduled_date",type:"date",value:j.scheduled_date,onChange:e=>_({...j,scheduled_date:e.target.value}),min:new Date().toISOString().split("T")[0],required:!0})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(o.Label,{htmlFor:"scheduled_time",children:["Time ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)(o.Input,{id:"scheduled_time",type:"time",value:j.scheduled_time,onChange:e=>_({...j,scheduled_time:e.target.value}),required:!0})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"technician_id",children:"Assign Technician"}),(0,i.jsxs)(o.Select,{value:j.technician_id,onValueChange:e=>_({...j,technician_id:e}),children:[(0,i.jsx)(o.SelectTrigger,{id:"technician_id",children:(0,i.jsx)(o.SelectValue,{placeholder:"Select a technician (optional)"})}),(0,i.jsxs)(o.SelectContent,{children:[(0,i.jsx)(o.SelectItem,{value:"tech-1",children:"John Smith"}),(0,i.jsx)(o.SelectItem,{value:"tech-2",children:"Sarah Johnson"}),(0,i.jsx)(o.SelectItem,{value:"tech-3",children:"Mike Davis"}),(0,i.jsx)(o.SelectItem,{value:"tech-4",children:"Emily Brown"})]})]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"Optionally assign a technician now, or assign later"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"notes",children:"Instructions for Technician"}),(0,i.jsx)(o.Textarea,{id:"notes",value:j.notes,onChange:e=>_({...j,notes:e.target.value}),placeholder:"Add any special instructions, access codes, contact information, or equipment requirements...",rows:4}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"Examples: gate codes, contact person on-site, special equipment needed, access restrictions, etc."})]}),(0,i.jsxs)(o.Alert,{children:[(0,i.jsx)(d.Z,{className:"h-4 w-4"}),(0,i.jsx)(o.AlertTitle,{children:"What Happens Next"}),(0,i.jsx)(o.AlertDescription,{className:"text-xs mt-2 space-y-1",children:(0,i.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,i.jsx)("li",{children:'Survey will be created with status "Scheduled"'}),(0,i.jsx)("li",{children:"Assigned technician will receive notification"}),(0,i.jsx)("li",{children:'Lead status will update to "Site Survey Scheduled"'}),(0,i.jsx)("li",{children:"Technician can start survey when arriving on-site"}),(0,i.jsx)("li",{children:"After completion, lead serviceability will be updated"})]})})]}),(0,i.jsxs)(o.DialogFooter,{children:[(0,i.jsx)(o.Button,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:p,children:"Cancel"}),(0,i.jsx)(o.Button,{type:"submit",disabled:p,children:p?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Scheduling..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"Schedule Survey"]})})]})]})]})})}}};