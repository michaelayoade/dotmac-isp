"use strict";exports.id=4704,exports.ids=[4704],exports.modules={24704:(e,t,r)=>{r.d(t,{$p:()=>p,H6:()=>P,UR:()=>g,Zo:()=>f,_6:()=>k,h8:()=>w,q8:()=>h,x3:()=>v});var o=r(17577),a=r(44976),n=r(48324),i=r(17010);!function(){var e=Error("Cannot find module '../../../shared/utils/operatorAuth'");throw e.code="MODULE_NOT_FOUND",e}();var s=r(29771),u=r(93158);let c=Object(function(){var e=Error("Cannot find module '../../../shared/utils/operatorAuth'");throw e.code="MODULE_NOT_FOUND",e}())(Object(function(){var e=Error("Cannot find module '../../../shared/utils/operatorAuth'");throw e.code="MODULE_NOT_FOUND",e}())),d=e=>e instanceof Error?e:Error("string"==typeof e?e:String(e)),l=(e,t)=>e instanceof Object(function(){var e=Error("Cannot find module '../../../shared/utils/operatorAuth'");throw e.code="MODULE_NOT_FOUND",e}())?e.message:e instanceof Error?e.message:t,y={all:["customerPortal"],profile:()=>[...y.all,"profile"],service:()=>[...y.all,"service"],invoices:()=>[...y.all,"invoices"],payments:()=>[...y.all,"payments"],paymentMethods:()=>[...y.all,"paymentMethods"],usage:()=>[...y.all,"usage"],tickets:()=>[...y.all,"tickets"],settings:()=>[...y.all,"settings"]};function m(){let{api:e}=(0,u.M)();return{portalApi:(0,o.useMemo)(()=>{var t;return t=e.buildUrl,{fetchProfile:async()=>{let e=await c(t("/customer/profile"));if(!e.ok)throw Error("Failed to fetch profile");return e.json()},updateProfile:async e=>{let r=await c(t("/customer/profile"),{method:"PUT",body:JSON.stringify(e)});if(!r.ok)throw Error("Failed to update profile");return r.json()},fetchService:async()=>{let e=await c(t("/customer/service"));if(!e.ok)throw Error("Failed to fetch service");return e.json()},upgradePlan:async e=>{let r=await c(t("/customer/service/upgrade"),{method:"POST",body:JSON.stringify({plan_id:e})});if(!r.ok)throw Error("Failed to upgrade plan");return r.json()},fetchInvoices:async()=>{let e=await c(t("/customer/invoices"));if(!e.ok)throw Error("Failed to fetch invoices");return e.json()},fetchPayments:async()=>{let e=await c(t("/customer/payments"));if(!e.ok)throw Error("Failed to fetch payments");return e.json()},makePayment:async(e,r,o)=>{let a=await c(t("/customer/payments"),{method:"POST",body:JSON.stringify({invoice_id:e,amount:r,payment_method_id:o})});if(!a.ok)throw Error("Failed to process payment");return a.json()},fetchUsage:async()=>{let e=await c(t("/customer/usage"));if(!e.ok)throw Error("Failed to fetch usage");return e.json()},fetchTickets:async()=>{let e=await c(t("/customer/tickets"));if(!e.ok)throw Error("Failed to fetch tickets");return e.json()},createTicket:async e=>{let r=await c(t("/customer/tickets"),{method:"POST",body:JSON.stringify(e)});if(!r.ok)throw Error("Failed to create ticket");return r.json()},fetchSettings:async()=>{let e=await c(t("/customer/settings"));if(!e.ok)throw Error("Failed to fetch settings");return e.json()},updateSettings:async e=>{let r=await c(t("/customer/settings"),{method:"PUT",body:JSON.stringify(e)});if(!r.ok)throw Error("Failed to update settings");return r.json()},changePassword:async(e,r)=>{let o=await c(t("/customer/change-password"),{method:"POST",body:JSON.stringify({current_password:e,new_password:r})});if(!o.ok)throw Error("Failed to change password");return o.json()},fetchPaymentMethods:async()=>{let e=await c(t("/customer/payment-methods"));if(!e.ok)throw Error("Failed to fetch payment methods");return e.json()},addPaymentMethod:async e=>{let r=await c(t("/customer/payment-methods"),{method:"POST",body:JSON.stringify(e)});if(!r.ok)throw Error("Failed to add payment method");return r.json()},setDefaultPaymentMethod:async e=>{let r=await c(t(`/customer/payment-methods/${e}/default`),{method:"POST"});if(!r.ok)throw Error("Failed to set default payment method");return r.json()},removePaymentMethod:async e=>{if(!(await c(t(`/customer/payment-methods/${e}`),{method:"DELETE"})).ok)throw Error("Failed to remove payment method")},toggleAutoPay:async e=>{let r=await c(t(`/customer/payment-methods/${e}/toggle-autopay`),{method:"POST"});if(!r.ok)throw Error("Failed to toggle auto pay");return r.json()}}},[e.buildUrl]),apiBaseUrl:e.baseUrl,apiPrefix:e.prefix}}function f(){let e=(0,a.NL)(),{portalApi:t,apiBaseUrl:r,apiPrefix:u}=m(),c=(0,o.useMemo)(()=>[...y.profile(),r,u],[r,u]),f=(0,n.a)({queryKey:c,queryFn:t.fetchProfile,staleTime:3e5,retry:1}),h=(0,i.D)({mutationFn:t.updateProfile,onMutate:async t=>{await e.cancelQueries({queryKey:c});let r=e.getQueryData(c);return r&&e.setQueryData(c,{...r,...t}),s.k.info("Updating customer profile optimistically",{updates:t}),{previousProfile:r}},onError:(t,r,o)=>{o?.previousProfile&&e.setQueryData(c,o.previousProfile),s.k.error("Error updating customer profile",d(t))},onSuccess:t=>{e.setQueryData(c,t),s.k.info("Customer profile updated successfully",{data:t})},onSettled:()=>{e.invalidateQueries({queryKey:c})}});return{profile:f.data??null,loading:f.isLoading,error:f.error?l(f.error,"An error occurred"):null,refetch:f.refetch,updateProfile:h.mutateAsync,isUpdating:h.isPending}}function h(){let e=(0,a.NL)(),{portalApi:t,apiBaseUrl:r,apiPrefix:o}=m(),u=(0,n.a)({queryKey:[...y.service(),r,o],queryFn:t.fetchService,staleTime:18e4,retry:1}),c=(0,i.D)({mutationFn:t.upgradePlan,onMutate:async t=>{await e.cancelQueries({queryKey:y.service()});let r=e.getQueryData(y.service());return s.k.info("Upgrading plan",{planId:t}),{previousService:r}},onError:(t,r,o)=>{o?.previousService&&e.setQueryData(y.service(),o.previousService),s.k.error("Error upgrading plan",d(t))},onSuccess:t=>{e.setQueryData(y.service(),t),s.k.info("Plan upgraded successfully",{data:t})},onSettled:()=>{e.invalidateQueries({queryKey:y.service()})}});return{service:u.data??null,loading:u.isLoading,error:u.error?l(u.error,"An error occurred"):null,refetch:u.refetch,upgradePlan:c.mutateAsync,isUpgrading:c.isPending}}function g(){let{portalApi:e,apiBaseUrl:t,apiPrefix:r}=m(),o=(0,n.a)({queryKey:[...y.invoices(),t,r],queryFn:e.fetchInvoices,staleTime:12e4,retry:1});return{invoices:o.data??[],loading:o.isLoading,error:o.error?l(o.error,"An error occurred"):null,refetch:o.refetch}}function p(){let e=(0,a.NL)(),{portalApi:t,apiBaseUrl:r,apiPrefix:u}=m(),c=(0,o.useMemo)(()=>[...y.payments(),r,u],[r,u]),f=(0,o.useMemo)(()=>[...y.invoices(),r,u],[r,u]),h=(0,n.a)({queryKey:c,queryFn:t.fetchPayments,staleTime:6e4,retry:1}),g=(0,i.D)({mutationFn:({invoiceId:e,amount:r,paymentMethodId:o})=>t.makePayment(e,r,o),onMutate:async()=>{await e.cancelQueries({queryKey:c}),s.k.info("Making payment")},onError:e=>{s.k.error("Error making payment",d(e))},onSuccess:t=>{e.setQueryData(c,(e=[])=>[t,...e]),s.k.info("Payment processed successfully",{data:t})},onSettled:()=>{e.invalidateQueries({queryKey:c}),e.invalidateQueries({queryKey:f})}});return{payments:h.data??[],loading:h.isLoading||g.isPending,error:h.error?l(h.error,"An error occurred"):null,refetch:h.refetch,makePayment:g.mutateAsync,isProcessingPayment:g.isPending}}function k(){let{portalApi:e,apiBaseUrl:t,apiPrefix:r}=m(),o=(0,n.a)({queryKey:[...y.usage(),t,r],queryFn:e.fetchUsage,staleTime:3e4,retry:1});return{usage:o.data??null,loading:o.isLoading,error:o.error?l(o.error,"An error occurred"):null,refetch:o.refetch}}function P(){let e=(0,a.NL)(),{portalApi:t,apiBaseUrl:r,apiPrefix:o}=m(),u=(0,n.a)({queryKey:[...y.tickets(),r,o],queryFn:t.fetchTickets,staleTime:6e4,retry:1}),c=(0,i.D)({mutationFn:t.createTicket,onMutate:async t=>{await e.cancelQueries({queryKey:y.tickets()}),s.k.info("Creating ticket",{ticketData:t})},onError:e=>{s.k.error("Error creating ticket",d(e))},onSuccess:e=>{s.k.info("Ticket created successfully",{data:e})},onSettled:()=>{e.invalidateQueries({queryKey:y.tickets()})}});return{tickets:u.data??[],loading:u.isLoading||c.isPending,error:u.error?l(u.error,"An error occurred"):null,refetch:u.refetch,createTicket:c.mutateAsync,isCreatingTicket:c.isPending}}function w(){let e=(0,a.NL)(),{portalApi:t,apiBaseUrl:r,apiPrefix:u}=m(),c=(0,o.useMemo)(()=>[...y.settings(),r,u],[r,u]),f=(0,n.a)({queryKey:c,queryFn:t.fetchSettings,staleTime:3e5,retry:1}),h=(0,i.D)({mutationFn:t.updateSettings,onMutate:async t=>{await e.cancelQueries({queryKey:c});let r=e.getQueryData(c);return r&&e.setQueryData(c,{...r,...t}),s.k.info("Updating customer settings optimistically",{updates:t}),{previousSettings:r}},onError:(t,r,o)=>{o?.previousSettings&&e.setQueryData(c,o.previousSettings),s.k.error("Error updating customer settings",d(t))},onSuccess:t=>{e.setQueryData(c,t),s.k.info("Customer settings updated successfully",{data:t})},onSettled:()=>{e.invalidateQueries({queryKey:c})}}),g=(0,i.D)({mutationFn:({currentPassword:e,newPassword:r})=>t.changePassword(e,r),onMutate:()=>{s.k.info("Changing password")},onError:e=>{s.k.error("Error changing password",d(e))},onSuccess:e=>{s.k.info("Password changed successfully",{data:e})}});return{settings:f.data??null,loading:f.isLoading,error:f.error?l(f.error,"An error occurred"):null,refetch:f.refetch,updateSettings:h.mutateAsync,changePassword:g.mutateAsync,isUpdatingSettings:h.isPending,isChangingPassword:g.isPending}}function v(){let e=(0,a.NL)(),{portalApi:t,apiBaseUrl:r,apiPrefix:u}=m(),c=(0,o.useMemo)(()=>[...y.paymentMethods(),r,u],[r,u]),f=(0,n.a)({queryKey:c,queryFn:t.fetchPaymentMethods,staleTime:12e4,retry:1}),h=(0,i.D)({mutationFn:e=>t.addPaymentMethod(e),onSuccess:t=>{e.setQueryData(c,(e=[])=>[...e,t]),e.invalidateQueries({queryKey:c}),s.k.info("Payment method added successfully")},onError:e=>{s.k.error("Error adding payment method",d(e))}}),g=(0,i.D)({mutationFn:e=>t.setDefaultPaymentMethod(e),onSuccess:(t,r)=>{e.setQueryData(c,(e=[])=>e.map(e=>({...e,is_default:e.payment_method_id===r,auto_pay_enabled:e.payment_method_id===r?t.auto_pay_enabled:e.auto_pay_enabled}))),e.invalidateQueries({queryKey:c}),s.k.info("Default payment method updated")},onError:e=>{s.k.error("Error setting default payment method",d(e))}}),p=(0,i.D)({mutationFn:e=>t.removePaymentMethod(e),onSuccess:(t,r)=>{e.setQueryData(c,(e=[])=>e.filter(e=>e.payment_method_id!==r)),e.invalidateQueries({queryKey:c}),s.k.info("Payment method removed successfully")},onError:e=>{s.k.error("Error removing payment method",d(e))}}),k=(0,i.D)({mutationFn:e=>t.toggleAutoPay(e),onSuccess:t=>{e.setQueryData(c,(e=[])=>e.map(e=>({...e,auto_pay_enabled:e.payment_method_id===t.payment_method_id&&t.auto_pay_enabled,is_default:e.payment_method_id===t.payment_method_id?t.is_default:e.is_default}))),e.invalidateQueries({queryKey:c}),s.k.info("Auto pay toggled successfully")},onError:e=>{s.k.error("Error toggling auto pay",d(e))}}),P=f.data??[],w=P.find(e=>e.is_default),v=P.find(e=>e.auto_pay_enabled);return{paymentMethods:P,defaultPaymentMethod:w,autoPayPaymentMethod:v,loading:f.isLoading,error:f.error?l(f.error,"An error occurred"):null,refetch:f.refetch,addPaymentMethod:h.mutateAsync,setDefaultPaymentMethod:g.mutateAsync,removePaymentMethod:p.mutateAsync,toggleAutoPay:e=>k.mutateAsync(e)}}}};