"use strict";exports.id=6996,exports.ids=[6996],exports.modules={16996:(e,t,a)=>{a.d(t,{QR:()=>b,eU:()=>T,BG:()=>_,eD:()=>f,$2:()=>$,NC:()=>g,of:()=>S,lB:()=>p,yQ:()=>E,zE:()=>y});var s=a(44976),n=a(17010),i=a(48324),r=a(36607),l=a(29771),c=a(82671);let o=r.LM.api.baseUrl,d="/api/isp/v1/admin";class u{constructor(){this.baseUrl=o}getAuthHeaders(){return{"Content-Type":"application/json"}}async handleResponse(e){if(!e.ok)throw Error(await e.text()||`HTTP ${e.status}: ${e.statusText}`);return e.json()}async sendEmail(e){let t=await fetch(`${this.baseUrl}${d}/communications/email/send`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(e)});return this.handleResponse(t)}async queueEmail(e){let t=await fetch(`${this.baseUrl}${d}/communications/email/queue`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(e)});return this.handleResponse(t)}async queueBulkEmail(e){let t=await fetch(`${this.baseUrl}${d}/communications/bulk/queue`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(e)});return this.handleResponse(t)}async getBulkEmailStatus(e){let t=await fetch(`${this.baseUrl}${d}/communications/bulk/${e}/status`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(t)}async cancelBulkEmail(e){let t=await fetch(`${this.baseUrl}${d}/communications/bulk/${e}/cancel`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(t)}async listTemplates(e={}){let t=new URLSearchParams;e.channel&&t.append("channel",e.channel),void 0!==e.is_active&&t.append("is_active",String(e.is_active)),e.search&&t.append("search",e.search),e.page&&t.append("page",String(e.page)),e.page_size&&t.append("page_size",String(e.page_size));let a=t.toString(),s=`${this.baseUrl}${d}/communications/templates${a?`?${a}`:""}`,n=await fetch(s,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(n)}async getTemplate(e){let t=await fetch(`${this.baseUrl}${d}/communications/templates/${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(t)}async createTemplate(e){let t=await fetch(`${this.baseUrl}${d}/communications/templates`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(e)});return this.handleResponse(t)}async updateTemplate(e,t){let a=await fetch(`${this.baseUrl}${d}/communications/templates/${e}`,{method:"PUT",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(t)});return this.handleResponse(a)}async deleteTemplate(e){let t=await fetch(`${this.baseUrl}${d}/communications/templates/${e}`,{method:"DELETE",headers:this.getAuthHeaders(),credentials:"include"});if(!t.ok&&204!==t.status)throw Error(await t.text()||`HTTP ${t.status}: ${t.statusText}`)}async renderTemplate(e,t){let a=await fetch(`${this.baseUrl}${d}/communications/templates/${e}/render`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify({variables:t})});return this.handleResponse(a)}async quickRender(e){let t=await fetch(`${this.baseUrl}${d}/communications/render`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(e)});return this.handleResponse(t)}async listLogs(e={}){let t=new URLSearchParams;e.channel&&t.append("channel",e.channel),e.status&&t.append("status",e.status),e.recipient_email&&t.append("recipient_email",e.recipient_email),e.template_id&&t.append("template_id",e.template_id),e.date_from&&t.append("date_from",e.date_from),e.date_to&&t.append("date_to",e.date_to),e.page&&t.append("page",String(e.page)),e.page_size&&t.append("page_size",String(e.page_size)),e.sort_by&&t.append("sort_by",e.sort_by),e.sort_order&&t.append("sort_order",e.sort_order);let a=t.toString(),s=`${this.baseUrl}${d}/communications/logs${a?`?${a}`:""}`,n=await fetch(s,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(n)}async getLog(e){let t=await fetch(`${this.baseUrl}${d}/communications/logs/${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(t)}async getTaskStatus(e){let t=await fetch(`${this.baseUrl}${d}/communications/tasks/${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(t)}async getStatistics(e={}){let t=new URLSearchParams;e.date_from&&t.append("date_from",e.date_from),e.date_to&&t.append("date_to",e.date_to),e.channel&&t.append("channel",e.channel);let a=t.toString(),s=`${this.baseUrl}${d}/communications/stats${a?`?${a}`:""}`,n=await fetch(s,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(n)}async getRecentActivity(e={}){let t=new URLSearchParams;e.days&&t.append("days",String(e.days)),e.channel&&t.append("channel",e.channel);let a=t.toString(),s=`${this.baseUrl}${d}/communications/activity${a?`?${a}`:""}`,n=await fetch(s,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(n)}async getMetrics(){let e=await fetch(`${this.baseUrl}${d}/communications/metrics`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(e)}async healthCheck(){try{let e=await fetch(`${this.baseUrl}${d}/communications/health`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return await this.handleResponse(e)}catch(e){return l.k.warn("Communications health endpoint unavailable. Returning fallback response.",{message:e instanceof Error?e.message:String(e)}),{smtp_available:!1,redis_available:!1,celery_available:!1,active_workers:0,pending_tasks:0,failed_tasks:0}}}calculateDeliveryRate(e,t){return 0===t?100:e/t*100}calculateBounceRate(e,t){return 0===t?0:e/t*100}getStatusColor(e){return({[c.Sc.PENDING]:"bg-gray-500",[c.Sc.QUEUED]:"bg-blue-500",[c.Sc.SENDING]:"bg-blue-600",[c.Sc.SENT]:"bg-green-500",[c.Sc.DELIVERED]:"bg-green-600",[c.Sc.FAILED]:"bg-red-500",[c.Sc.BOUNCED]:"bg-orange-500",[c.Sc.OPENED]:"bg-purple-500",[c.Sc.CLICKED]:"bg-purple-600"})[e]||"bg-gray-500"}formatRecipients(e,t=3){return 0===e.length?"No recipients":e.length<=t?e.join(", "):`${e.slice(0,t).join(", ")} +${e.length-t} more`}}let h=new u,m={logs:{all:["communications","logs"],list:e=>["communications","logs","list",e],detail:e=>["communications","logs","detail",e]},templates:{all:["communications","templates"],list:e=>["communications","templates","list",e],detail:e=>["communications","templates","detail",e]},stats:{overview:e=>["communications","stats","overview",e],activity:e=>["communications","stats","activity",e],health:()=>["communications","stats","health"],metrics:()=>["communications","stats","metrics"]}};function p(e){let t=(0,s.NL)();return(0,n.D)({mutationFn:e=>h.sendEmail(e),onSuccess:a=>{t.invalidateQueries({queryKey:m.logs.all}),t.invalidateQueries({queryKey:m.stats.overview({})}),e?.onSuccess?.(a)},onError:t=>{e?.onError?.(t)}})}function g(e){let t=(0,s.NL)();return(0,n.D)({mutationFn:e=>h.queueEmail(e),onSuccess:a=>{t.invalidateQueries({queryKey:m.logs.all}),e?.onSuccess?.(a)},onError:t=>{e?.onError?.(t)}})}function y(e={}){return(0,i.a)({queryKey:m.templates.list(e),queryFn:()=>h.listTemplates(e),staleTime:3e4,gcTime:3e5})}function E(e){return(0,i.a)({queryKey:m.templates.detail(e||""),queryFn:()=>h.getTemplate(e),enabled:!!e,staleTime:6e4,gcTime:6e5})}function f(e){let t=(0,s.NL)();return(0,n.D)({mutationFn:e=>h.createTemplate(e),onSuccess:a=>{t.invalidateQueries({queryKey:m.templates.all}),t.invalidateQueries({queryKey:m.stats.metrics()}),e?.onSuccess?.(a)},onError:t=>{e?.onError?.(t)}})}function $(e){let t=(0,s.NL)();return(0,n.D)({mutationFn:e=>h.deleteTemplate(e),onSuccess:(a,s)=>{t.invalidateQueries({queryKey:m.templates.all}),t.invalidateQueries({queryKey:m.stats.metrics()}),t.removeQueries({queryKey:m.templates.detail(s)}),e?.onSuccess?.()},onError:t=>{e?.onError?.(t)}})}function S(e){return(0,n.D)({mutationFn:({id:e,variables:t})=>h.renderTemplate(e,t),onSuccess:t=>{e?.onSuccess?.(t)},onError:t=>{e?.onError?.(t)}})}function b(e={}){return(0,i.a)({queryKey:m.logs.list(e),queryFn:()=>h.listLogs(e),staleTime:1e4,gcTime:3e5})}function T(e={}){return(0,i.a)({queryKey:m.stats.overview(e),queryFn:()=>h.getStatistics(e),staleTime:3e4,gcTime:3e5})}function _(){let e=T(),t=(0,i.a)({queryKey:m.stats.health(),queryFn:()=>h.healthCheck(),refetchInterval:3e4,staleTime:2e4,gcTime:12e4}),a=b({page:1,page_size:10,sort_by:"created_at",sort_order:"desc"}),s=(0,i.a)({queryKey:m.stats.metrics(),queryFn:()=>h.getMetrics(),staleTime:3e5,gcTime:6e5});return{stats:e.data,health:t.data,recentLogs:a.data?.logs||[],metrics:s.data,isLoading:e.isLoading||t.isLoading||a.isLoading||s.isLoading,error:e.error||t.error||a.error||s.error}}},82671:(e,t,a)=>{var s,n,i,r;function l(e){switch(e){case"sent":case"delivered":return"text-green-600 bg-green-100";case"opened":case"clicked":return"text-blue-600 bg-blue-100";case"pending":case"queued":case"sending":return"text-yellow-600 bg-yellow-100";case"failed":case"bounced":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}}function c(e){return e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function o(e){return`${(100*e).toFixed(1)}%`}function d(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function u(e){return e.split(",").map(e=>e.trim()).filter(e=>e.length>0&&d(e)).map(e=>({email:e}))}function h(e){let t=new Date(e),a=Math.floor((new Date().getTime()-t.getTime())/6e4),s=Math.floor(a/60),n=Math.floor(s/24);return a<1?"Just now":a<60?`${a} minute${a>1?"s":""} ago`:s<24?`${s} hour${s>1?"s":""} ago`:n<7?`${n} day${n>1?"s":""} ago`:t.toLocaleDateString()}function m(e){let t;let a=/\{\{\s*([a-zA-Z_][a-zA-Z0-9_]*)\s*\}\}/g,s=new Set;for(;null!==(t=a.exec(e));)t[1]&&s.add(t[1]);return Array.from(s)}a.d(t,{B:()=>u,FB:()=>s,Lq:()=>i,Sc:()=>n,cA:()=>m,og:()=>o,pi:()=>h,rp:()=>c,vV:()=>d,z2:()=>l}),function(e){e.EMAIL="email",e.SMS="sms",e.PUSH="push",e.IN_APP="in_app"}(s||(s={})),function(e){e.PENDING="pending",e.QUEUED="queued",e.SENDING="sending",e.SENT="sent",e.DELIVERED="delivered",e.FAILED="failed",e.BOUNCED="bounced",e.OPENED="opened",e.CLICKED="clicked"}(n||(n={})),function(e){e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.DATE="date",e.URL="url",e.EMAIL="email"}(i||(i={})),function(e){e.PENDING="pending",e.PROCESSING="processing",e.COMPLETED="completed",e.FAILED="failed",e.CANCELLED="cancelled"}(r||(r={}))}};