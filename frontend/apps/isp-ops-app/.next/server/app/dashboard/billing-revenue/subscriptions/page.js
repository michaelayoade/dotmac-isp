(()=>{var e={};e.id=7843,e.ids=[7843],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},56470:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c}),t(2315),t(13321),t(46366),t(96560);var r=t(23191),a=t(88716),i=t(37922),n=t.n(i),l=t(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(s,o);let c=["",{children:["dashboard",{children:["billing-revenue",{children:["subscriptions",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,2315)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/subscriptions/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],d=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/subscriptions/page.tsx"],u="/dashboard/billing-revenue/subscriptions/page",p={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/billing-revenue/subscriptions/page",pathname:"/dashboard/billing-revenue/subscriptions",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},30521:(e,s,t)=>{Promise.resolve().then(t.bind(t,61299))},61299:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>D,dynamic:()=>_});var r=t(10326),a=t(17577),i=t(48723),n=t(30361),l=t(71059),o=t(94019),c=t(41291),d=t(37358),u=t(83855),p=t(17069),m=t(88307),x=t(21405),h=t(28916),b=t(85206),g=t(94893),j=t(77506),v=t(34041),y=t(19228),C=t(95062),f=t(12705),N=t(59341),w=t(26576),S=t(29771);let _="force-dynamic";function D(){let{toast:e}=(0,i.useToast)(),[s,t]=(0,a.useState)(""),[_,D]=(0,a.useState)(void 0),[P,T]=(0,a.useState)(!1),[A,I]=(0,a.useState)(!1),[M,k]=(0,a.useState)(!1),[R,L]=(0,a.useState)(!1),[q,F]=(0,a.useState)(null),[U,E]=(0,a.useState)(!1),[B,Z]=(0,a.useState)(!1),[H,z]=(0,a.useState)({customerId:"",planId:"",billingCycle:"monthly",trialDays:0}),[$,V]=(0,a.useState)({planId:"",amount:0}),[G,W]=(0,a.useState)(""),{subscriptions:O,isLoading:Q,error:X,refetch:J}=function(e={}){let{page:s=1,pageSize:t=10,status:r,billingCycle:a,search:i,includeCustomer:n=!0,includePlan:l=!0,includeInvoices:o=!1,enabled:c=!0,pollInterval:d=3e4}=e,{data:u,loading:p,error:m,refetch:x}=(0,y.lck)({variables:{page:s,pageSize:t,status:r,billingCycle:a,search:i||void 0,includeCustomer:n,includePlan:l,includeInvoices:o},skip:!c,pollInterval:d,fetchPolicy:"cache-and-network"}),h=u?.subscriptions?.subscriptions??[];return{subscriptions:h,total:u?.subscriptions?.totalCount??0,hasNextPage:u?.subscriptions?.hasNextPage??!1,hasPrevPage:u?.subscriptions?.hasPrevPage??!1,page:u?.subscriptions?.page??s,pageSize:u?.subscriptions?.pageSize??t,isLoading:p,error:m?.message,refetch:x}}({pageSize:100,includeCustomer:!0,includePlan:!0,pollInterval:3e4,..._?{status:_}:{},...s?{search:s}:{}}),{metrics:K}=function(e={}){let{enabled:s=!0,pollInterval:t=6e4}=e,{data:r,loading:a,error:i,refetch:n}=(0,y.LV7)({skip:!s,pollInterval:t,fetchPolicy:"cache-and-network"}),l=r?.subscriptionMetrics;return{metrics:{totalSubscriptions:l?.totalSubscriptions??0,activeSubscriptions:l?.activeSubscriptions??0,trialingSubscriptions:l?.trialingSubscriptions??0,pastDueSubscriptions:l?.pastDueSubscriptions??0,canceledSubscriptions:l?.canceledSubscriptions??0,pausedSubscriptions:l?.pausedSubscriptions??0,monthlyRecurringRevenue:l?.monthlyRecurringRevenue??0,annualRecurringRevenue:l?.annualRecurringRevenue??0,averageRevenuePerUser:l?.averageRevenuePerUser??0,newSubscriptionsThisMonth:l?.newSubscriptionsThisMonth??0,newSubscriptionsLastMonth:l?.newSubscriptionsLastMonth??0,churnRate:l?.churnRate??0,growthRate:l?.growthRate??0,monthlySubscriptions:l?.monthlySubscriptions??0,quarterlySubscriptions:l?.quarterlySubscriptions??0,annualSubscriptions:l?.annualSubscriptions??0,trialConversionRate:l?.trialConversionRate??0,activeTrials:l?.activeTrials??0},isLoading:a,error:i?.message,refetch:n}}({pollInterval:6e4}),{customers:Y}=(0,C.Az)({limit:100,enabled:P}),{data:ee}=(0,f.Jr)({pageSize:100,isActive:!0},P||A),es=O.map(e=>({id:e.id,customer_name:e.customer?.name||"Unknown Customer",customer_email:e.customer?.email||"",plan_name:e.plan?.name||"Unknown Plan",plan_id:e.planId,status:e.status.toLowerCase(),amount:e.plan?.price||0,currency:e.plan?.currency||"USD",billing_cycle:e.plan?.billingCycle?.toLowerCase()||"monthly",current_period_start:e.currentPeriodStart,current_period_end:e.currentPeriodEnd,trial_end:e.trialEnd||null,cancel_at_period_end:!1,created_at:e.createdAt,next_billing_date:e.currentPeriodEnd,payment_method:"Card on file",mrr:e.plan?.billingCycle?.toLowerCase()==="monthly"&&e.plan?.price||0})),et={total:K?.totalSubscriptions||0,active:K?.activeSubscriptions||0,mrr:K?.monthlyRecurringRevenue||0,churnRate:K?.churnRate||0,growthRate:K?.growthRate||0},er=async()=>{if(!H.customerId||!H.planId){e({title:"Error",description:"Please select both customer and plan",variant:"destructive"});return}Z(!0);try{await N.x1.post("/billing/subscriptions",{customer_id:H.customerId,plan_id:H.planId,billing_cycle:H.billingCycle,trial_days:H.trialDays}),S.k.info("Subscription created",{customerId:H.customerId,planId:H.planId}),e({title:"Success",description:"Subscription created successfully"}),T(!1),z({customerId:"",planId:"",billingCycle:"monthly",trialDays:0}),await J()}catch(e){S.k.error("Failed to create subscription",e),(0,w.zG)(e,{userMessage:"Failed to create subscription. Please try again."})}finally{Z(!1)}},ea=async()=>{if(q){Z(!0);try{await N.x1.put(`/billing/subscriptions/${q.id}`,{plan_id:$.planId,amount:$.amount}),S.k.info("Subscription updated",{subscriptionId:q.id}),e({title:"Success",description:"Subscription updated successfully"}),I(!1),await J()}catch(e){S.k.error("Failed to update subscription",e),(0,w.zG)(e,{userMessage:"Failed to update subscription. Please try again."})}finally{Z(!1)}}},ei=async()=>{if(q){Z(!0);try{let s="paused"===q.status?"resume":"pause";await N.x1.post(`/billing/subscriptions/${q.id}/${s}`),S.k.info(`Subscription ${s}d`,{subscriptionId:q.id}),e({title:"Success",description:`Subscription ${"pause"===s?"paused":"resumed"} successfully`}),L(!1),F(null),await J()}catch(e){S.k.error("Failed to pause/resume subscription",e),(0,w.zG)(e,{userMessage:"Failed to update subscription status. Please try again."})}finally{Z(!1)}}},en=async()=>{if(q){if(!G.trim()){e({title:"Error",description:"Please provide a cancellation reason",variant:"destructive"});return}Z(!0);try{await N.x1.post(`/billing/subscriptions/${q.id}/cancel`,{reason:G,cancel_at_period_end:!0}),S.k.info("Subscription cancelled",{subscriptionId:q.id,reason:G}),e({title:"Success",description:"Subscription will be cancelled at the end of the current billing period"}),k(!1),F(null),W(""),await J()}catch(e){S.k.error("Failed to cancel subscription",e),(0,w.zG)(e,{userMessage:"Failed to cancel subscription. Please try again."})}finally{Z(!1)}}},el=e=>{let s={active:{label:"Active",variant:"default",icon:n.Z},paused:{label:"Paused",variant:"outline",icon:l.Z},cancelled:{label:"Cancelled",variant:"secondary",icon:o.Z},past_due:{label:"Past Due",variant:"destructive",icon:c.Z},trialing:{label:"Trial",variant:"default",icon:d.Z}},t=s[e]||s.active,a=t.icon;return(0,r.jsxs)(i.Badge,{variant:t.variant,className:"flex items-center gap-1",children:[(0,r.jsx)(a,{className:"h-3 w-3"}),t.label]})},eo=(e,s)=>new Intl.NumberFormat("en-US",{style:"currency",currency:s}).format(e);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Subscriptions"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Manage recurring billing and subscription plans"})]}),(0,r.jsxs)(i.Button,{onClick:()=>T(!0),children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"New Subscription"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{className:"pb-2",children:(0,r.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"Total Subscriptions"})}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:et.total}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"All time"})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{className:"pb-2",children:(0,r.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"Active"})}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:et.active}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Currently active"})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{className:"pb-2",children:(0,r.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"MRR"})}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:eo(et.mrr,"USD")}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Monthly recurring"})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{className:"pb-2",children:(0,r.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"Churn Rate"})}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:[et.churnRate,"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Last 30 days"})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{className:"pb-2",children:(0,r.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"Growth Rate"})}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[(0,r.jsx)(p.Z,{className:"inline h-5 w-5 mr-1"}),et.growthRate,"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Month over month"})]})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(i.CardTitle,{children:"Subscription List"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(m.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,r.jsx)(i.Input,{placeholder:"Search subscriptions...",value:s,onChange:e=>t(e.target.value),className:"pl-10 w-[250px]"})]}),(0,r.jsxs)("select",{value:_||"all",onChange:e=>D("all"===e.target.value?void 0:e.target.value),className:"h-10 w-[150px] rounded-md border border-border bg-card px-3 text-sm text-foreground",children:[(0,r.jsx)("option",{value:"all",children:"All Status"}),(0,r.jsx)("option",{value:"ACTIVE",children:"Active"}),(0,r.jsx)("option",{value:"TRIALING",children:"Trial"}),(0,r.jsx)("option",{value:"PAST_DUE",children:"Past Due"}),(0,r.jsx)("option",{value:"PAUSED",children:"Paused"}),(0,r.jsx)("option",{value:"CANCELED",children:"Cancelled"})]}),(0,r.jsx)(i.Button,{variant:"outline",onClick:()=>J(),children:(0,r.jsx)(x.Z,{className:"h-4 w-4"})})]})]})}),(0,r.jsx)(i.CardContent,{children:Q?(0,r.jsx)("div",{className:"text-center py-8",children:"Loading subscriptions..."}):X?(0,r.jsxs)("div",{className:"text-center py-8 text-destructive",children:["Failed to load subscriptions. Please try again.",(0,r.jsxs)(i.Button,{variant:"outline",className:"mt-4",onClick:()=>J(),children:[(0,r.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"Retry"]})]}):0===es.length?(0,r.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No subscriptions found. Create your first subscription to get started."}):(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHeader,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableHead,{children:"Customer"}),(0,r.jsx)(i.TableHead,{children:"Plan"}),(0,r.jsx)(i.TableHead,{children:"Status"}),(0,r.jsx)(i.TableHead,{children:"Amount"}),(0,r.jsx)(i.TableHead,{children:"Cycle"}),(0,r.jsx)(i.TableHead,{children:"Next Billing"}),(0,r.jsx)(i.TableHead,{children:"Payment Method"}),(0,r.jsx)(i.TableHead,{children:"Actions"})]})}),(0,r.jsx)(i.TableBody,{children:es.map(e=>(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.customer_name}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:e.customer_email})]})}),(0,r.jsx)(i.TableCell,{children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.plan_name}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.id})]})}),(0,r.jsx)(i.TableCell,{children:el(e.status)}),(0,r.jsxs)(i.TableCell,{children:[(0,r.jsx)("div",{className:"font-medium",children:eo(e.amount,e.currency)}),e.mrr>0&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["MRR: ",eo(e.mrr,e.currency)]})]}),(0,r.jsx)(i.TableCell,{className:"capitalize",children:e.billing_cycle}),(0,r.jsx)(i.TableCell,{children:"trialing"===e.status&&e.trial_end?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm",children:"Trial ends"}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,v.WU)(new Date(e.trial_end),"MMM d, yyyy")})]}):(0,r.jsx)("div",{className:"text-sm",children:(0,v.WU)(new Date(e.next_billing_date),"MMM d, yyyy")})}),(0,r.jsx)(i.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(h.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-sm",children:e.payment_method})]})}),(0,r.jsx)(i.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)(i.Button,{size:"sm",variant:"outline",onClick:()=>{F(e),E(!0)},children:"View"}),(0,r.jsx)(i.Button,{size:"sm",variant:"outline",onClick:()=>{F(e),V({planId:e.plan_id,amount:e.amount}),I(!0)},"aria-label":`Edit subscription for ${e.customer_name}`,title:`Edit subscription for ${e.customer_name}`,children:(0,r.jsx)(b.Z,{className:"h-4 w-4"})}),"active"===e.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Button,{size:"sm",variant:"outline",onClick:()=>{F(e),L(!0)},"aria-label":`Pause subscription for ${e.customer_name}`,title:`Pause subscription for ${e.customer_name}`,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})}),(0,r.jsx)(i.Button,{size:"sm",variant:"outline",onClick:()=>{F(e),k(!0)},"aria-label":`Cancel subscription for ${e.customer_name}`,title:`Cancel subscription for ${e.customer_name}`,children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})]}),"paused"===e.status&&(0,r.jsx)(i.Button,{size:"sm",variant:"outline",onClick:()=>{F(e),L(!0)},"aria-label":`Resume subscription for ${e.customer_name}`,title:`Resume subscription for ${e.customer_name}`,children:(0,r.jsx)(g.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})})]}),(0,r.jsx)(i.Dialog,{open:P,onOpenChange:T,children:(0,r.jsxs)(i.DialogContent,{children:[(0,r.jsxs)(i.DialogHeader,{children:[(0,r.jsx)(i.DialogTitle,{children:"Create New Subscription"}),(0,r.jsx)(i.DialogDescription,{children:"Set up a new recurring subscription for a customer"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Customer"}),(0,r.jsxs)("select",{value:H.customerId,onChange:e=>z({...H,customerId:e.target.value}),className:"flex h-10 w-full rounded-md border border-border bg-card px-3 py-2 text-sm text-foreground",children:[(0,r.jsx)("option",{value:"",children:"Select customer"}),Y.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.displayName||`${e.firstName} ${e.lastName}`," (",e.email,")"]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Plan"}),(0,r.jsxs)("select",{value:H.planId,onChange:e=>z({...H,planId:e.target.value}),className:"flex h-10 w-full rounded-md border border-border bg-card px-3 py-2 text-sm text-foreground",children:[(0,r.jsx)("option",{value:"",children:"Select plan"}),(ee?.plans||[]).map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," - ",e.currency," ",e.price.toFixed(2),"/",e.billingCycle]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Billing Cycle"}),(0,r.jsxs)("select",{value:H.billingCycle,onChange:e=>z({...H,billingCycle:e.target.value}),className:"flex h-10 w-full rounded-md border border-border bg-card px-3 py-2 text-sm text-foreground",children:[(0,r.jsx)("option",{value:"monthly",children:"Monthly"}),(0,r.jsx)("option",{value:"quarterly",children:"Quarterly"}),(0,r.jsx)("option",{value:"annual",children:"Annual"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Trial Period (days)"}),(0,r.jsx)(i.Input,{type:"number",value:H.trialDays,onChange:e=>z({...H,trialDays:parseInt(e.target.value)||0}),placeholder:"0"})]})]}),(0,r.jsxs)(i.DialogFooter,{children:[(0,r.jsx)(i.Button,{variant:"outline",onClick:()=>T(!1),disabled:B,children:"Cancel"}),(0,r.jsx)(i.Button,{onClick:er,disabled:B,children:B?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create Subscription"})]})]})}),q&&(0,r.jsx)(i.Dialog,{open:U,onOpenChange:E,children:(0,r.jsxs)(i.DialogContent,{className:"max-w-2xl",children:[(0,r.jsxs)(i.DialogHeader,{children:[(0,r.jsx)(i.DialogTitle,{children:"Subscription Details"}),(0,r.jsxs)(i.DialogDescription,{children:[q.id," â€¢ ",q.customer_name]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Status"}),(0,r.jsx)("div",{className:"mt-1",children:el(q.status)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Plan"}),(0,r.jsx)("div",{className:"mt-1 font-medium",children:q.plan_name})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Amount"}),(0,r.jsx)("div",{className:"mt-1 font-medium",children:eo(q.amount,q.currency)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Billing Cycle"}),(0,r.jsx)("div",{className:"mt-1 capitalize",children:q.billing_cycle})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Current Period"}),(0,r.jsxs)("div",{className:"mt-1 text-sm",children:[(0,v.WU)(new Date(q.current_period_start),"MMM d")," -"," ",(0,v.WU)(new Date(q.current_period_end),"MMM d, yyyy")]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Next Billing Date"}),(0,r.jsx)("div",{className:"mt-1",children:(0,v.WU)(new Date(q.next_billing_date),"MMM d, yyyy")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Created"}),(0,r.jsx)("div",{className:"mt-1 text-sm",children:(0,v.WU)(new Date(q.created_at),"MMM d, yyyy")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Payment Method"}),(0,r.jsxs)("div",{className:"mt-1 flex items-center gap-1",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"}),q.payment_method]})]})]}),q.cancel_at_period_end&&(0,r.jsxs)("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 rounded-md",children:[(0,r.jsx)(c.Z,{className:"inline h-4 w-4 mr-2"}),"This subscription will be cancelled at the end of the current billing period"]})]}),(0,r.jsx)(i.DialogFooter,{children:(0,r.jsx)(i.Button,{variant:"outline",onClick:()=>E(!1),children:"Close"})})]})}),q&&(0,r.jsx)(i.Dialog,{open:A,onOpenChange:I,children:(0,r.jsxs)(i.DialogContent,{children:[(0,r.jsxs)(i.DialogHeader,{children:[(0,r.jsx)(i.DialogTitle,{children:"Edit Subscription"}),(0,r.jsxs)(i.DialogDescription,{children:["Update subscription plan or amount for ",q.customer_name]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Plan"}),(0,r.jsxs)("select",{value:$.planId,onChange:e=>V({...$,planId:e.target.value}),className:"flex h-10 w-full rounded-md border border-border bg-card px-3 py-2 text-sm text-foreground",children:[(0,r.jsx)("option",{value:"",children:"Select plan"}),(ee?.plans||[]).map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," - ",e.currency," ",e.price.toFixed(2),"/",e.billingCycle]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Label,{children:"Custom Amount (optional)"}),(0,r.jsx)(i.Input,{type:"number",value:$.amount,onChange:e=>V({...$,amount:parseFloat(e.target.value)||0}),placeholder:"Override plan amount"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Leave as 0 to use the plan's default price"})]})]}),(0,r.jsxs)(i.DialogFooter,{children:[(0,r.jsx)(i.Button,{variant:"outline",onClick:()=>I(!1),disabled:B,children:"Cancel"}),(0,r.jsx)(i.Button,{onClick:ea,disabled:B,children:B?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})}),q&&(0,r.jsx)(i.AlertDialog,{open:R,onOpenChange:L,children:(0,r.jsxs)(i.AlertDialogContent,{children:[(0,r.jsxs)(i.AlertDialogHeader,{children:[(0,r.jsxs)(i.AlertDialogTitle,{children:["paused"===q.status?"Resume":"Pause"," Subscription"]}),(0,r.jsx)(i.AlertDialogDescription,{children:"paused"===q.status?(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to resume the subscription for"," ",(0,r.jsx)("span",{className:"font-semibold",children:q.customer_name}),"? Billing will restart immediately."]}):(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to pause the subscription for"," ",(0,r.jsx)("span",{className:"font-semibold",children:q.customer_name}),"?",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),"The customer will not be billed during the pause period, but they will retain access until the current billing period ends."]})})]}),(0,r.jsxs)(i.AlertDialogFooter,{children:[(0,r.jsx)(i.AlertDialogCancel,{disabled:B,children:"Cancel"}),(0,r.jsx)(i.AlertDialogAction,{onClick:ei,disabled:B,children:B?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):"paused"===q.status?"Resume Subscription":"Pause Subscription"})]})]})}),q&&(0,r.jsx)(i.AlertDialog,{open:M,onOpenChange:k,children:(0,r.jsxs)(i.AlertDialogContent,{children:[(0,r.jsxs)(i.AlertDialogHeader,{children:[(0,r.jsx)(i.AlertDialogTitle,{children:"Cancel Subscription"}),(0,r.jsxs)(i.AlertDialogDescription,{children:["Are you sure you want to cancel the subscription for"," ",(0,r.jsx)("span",{className:"font-semibold",children:q.customer_name}),"?",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),"The subscription will be cancelled at the end of the current billing period (",(0,v.WU)(new Date(q.current_period_end),"MMM d, yyyy"),"). The customer will retain access until then."]})]}),(0,r.jsxs)("div",{className:"px-6 pb-4",children:[(0,r.jsx)(i.Label,{children:"Cancellation Reason (required)"}),(0,r.jsx)(i.Textarea,{value:G,onChange:e=>W(e.target.value),placeholder:"Please provide a reason for cancellation...",rows:3,className:"mt-2"})]}),(0,r.jsxs)(i.AlertDialogFooter,{children:[(0,r.jsx)(i.AlertDialogCancel,{disabled:B,children:"Cancel"}),(0,r.jsx)(i.AlertDialogAction,{onClick:en,disabled:B,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:B?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Cancelling..."]}):"Cancel Subscription"})]})]})})]})}},95062:(e,s,t)=>{"use strict";t.d(s,{Az:()=>a,X7:()=>i,eW:()=>n,ir:()=>l});var r=t(70401);function a(e={}){let{limit:s=50,offset:t=0,status:a,search:i,includeActivities:n=!1,includeNotes:l=!1,enabled:o=!0,pollInterval:c=3e4}=e,{data:d,isLoading:u,error:p,refetch:m}=(0,r.useCustomerListQuery)({limit:s,offset:t,status:a,search:i||void 0,includeActivities:n,includeNotes:l},{enabled:o,refetchInterval:c});return{customers:d?.customers?.customers??[],total:d?.customers?.totalCount??0,hasNextPage:d?.customers?.hasNextPage??!1,limit:s,offset:t,isLoading:u,error:p instanceof Error?p.message:p?String(p):void 0,refetch:m}}function i(e={}){let{enabled:s=!0,pollInterval:t=6e4}=e,{data:a,isLoading:i,error:n,refetch:l}=(0,r.useCustomerMetricsQuery)(void 0,{enabled:s,refetchInterval:t}),o=a?.customerMetrics;return{metrics:{totalCustomers:o?.totalCustomers??0,activeCustomers:o?.activeCustomers??0,newCustomers:o?.newCustomers??0,churnedCustomers:o?.churnedCustomers??0,totalCustomerValue:o?.totalCustomerValue??0,averageCustomerValue:o?.averageCustomerValue??0},isLoading:i,error:n instanceof Error?n.message:n?String(n):void 0,refetch:l}}function n(e={}){let{limit:s=20,offset:t=0,status:a,search:i,enabled:n=!0,pollInterval:l=3e4}=e,{data:o,isLoading:c,isFetching:d,error:u,refetch:p}=(0,r.useCustomerDashboardQuery)({limit:s,offset:t,status:a,search:i||void 0},{enabled:n,refetchInterval:l}),m=o?.customers?.customers??[],x=o?.customers?.totalCount??0,h=o?.customers?.hasNextPage??!1,b=o?.customerMetrics;return{customers:m,total:x,hasNextPage:h,metrics:{totalCustomers:b?.totalCustomers??0,activeCustomers:b?.activeCustomers??0,newCustomers:b?.newCustomers??0,churnedCustomers:b?.churnedCustomers??0,totalCustomerValue:b?.totalCustomerValue??0,averageCustomerValue:b?.averageCustomerValue??0},isLoading:c,isFetching:d,error:u instanceof Error?u.message:u?String(u):void 0,refetch:p}}function l(e){let{customerId:s,enabled:t=!0}=e,{data:a,isLoading:i,error:n,refetch:l}=(0,r.useCustomer360ViewQuery)({customerId:s},{enabled:t&&!!s}),o=a?.customerSubscriptions??[],c=o.filter(e=>"ACTIVE"===e.status||"TRIALING"===e.status),d=a?.customerNetworkInfo??{},u=a?.customerDevices??{},p=a?.customerTickets??{},m=a?.customerBilling??{};return{customer:a?.customer??null,subscriptions:{current:c[0]??null,total:o.length,active:c.length},network:d,devices:{total:u?.totalDevices??0,online:u?.onlineDevices??0,offline:u?.offlineDevices??0},tickets:{open:p?.openCount??0,closed:p?.closedCount??0,critical:p?.criticalCount??0},billing:{summary:m?.summary??null,totalInvoices:m?.totalInvoices??0,unpaidInvoices:m?.unpaidInvoices??0},isLoading:i,error:n instanceof Error?n.message:n?String(n):void 0,refetch:l}}},2315:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i,dynamic:()=>a});var r=t(68570);let a=(0,r.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/subscriptions/page.tsx#dynamic`),i=(0,r.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/subscriptions/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[2793,1009,6226,657,6011,401,6032,4218,9228,2552],()=>t(56470));module.exports=r})();