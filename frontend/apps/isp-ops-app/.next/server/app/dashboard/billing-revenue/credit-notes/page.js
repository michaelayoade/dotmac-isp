(()=>{var e={};e.id=8958,e.ids=[8958],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},72747:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>l}),r(56200),r(13321),r(46366),r(96560);var s=r(23191),a=r(88716),o=r(37922),n=r.n(o),i=r(95231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);r.d(t,d);let l=["",{children:["dashboard",{children:["billing-revenue",{children:["credit-notes",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,56200)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/credit-notes/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/credit-notes/page.tsx"],u="/dashboard/billing-revenue/credit-notes/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/billing-revenue/credit-notes/page",pathname:"/dashboard/billing-revenue/credit-notes",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},8595:(e,t,r)=>{Promise.resolve().then(r.bind(r,40652))},40652:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var s=r(10326),a=r(17577),o=r(36283),n=r(37358),i=r(21405),d=r(83855),l=r(71821),c=r(30361),u=r(69669),p=r(59341),m=r(48723),x=r(70607),h=r(35047),g=r(53402);let v={error:"Error",discount:"Discount",return:"Return",goodwill:"Goodwill",other:"Other"};function f(){let e=(0,h.useRouter)(),{toast:t}=(0,m.useToast)(),{currentTenant:r}=(0,g.S8)(),[f,b]=(0,a.useState)([]),[j,y]=(0,a.useState)(!0),[_,C]=(0,a.useState)(null),[N,w]=(0,a.useState)(!1),[P,k]=(0,a.useState)(!1),[S,I]=(0,a.useState)({invoice_id:"",reason:"error",amount:"",description:"",notes:"",internal_notes:"",auto_apply:!1}),A=(0,a.useCallback)(async()=>{try{y(!0),C(null);let e=await p.x1.get("/billing/credit-notes/");if(e.data){let t=e.data;b(t.credit_notes||t.items||[])}else throw Error("Failed to fetch credit notes")}catch(e){console.error("Failed to fetch credit notes:",e),C(e instanceof Error?e.message:"Failed to fetch credit notes")}finally{y(!1)}},[]),D=(0,a.useCallback)(async()=>{try{k(!0);let e=[{description:S.description,amount:parseFloat(S.amount)}],r={invoice_id:S.invoice_id,reason:S.reason,line_items:e,notes:S.notes||null,internal_notes:S.internal_notes||null,auto_apply:S.auto_apply};await p.x1.post("/billing/credit-notes/",r),t({title:"Credit note created",description:"The credit note has been created successfully."}),w(!1),I({invoice_id:"",reason:"error",amount:"",description:"",notes:"",internal_notes:"",auto_apply:!1}),await A()}catch(e){console.error("Failed to create credit note:",e),t({title:"Error",description:"Failed to create credit note. Please try again.",variant:"destructive"})}finally{k(!1)}},[S,A,t]),M=(0,a.useMemo)(()=>[{id:"credit_note_number",header:"Credit Note #",accessorKey:"credit_note_number",cell:({row:e})=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"font-medium",children:e.original.credit_note_number})]})},{id:"customer",header:"Customer",cell:({row:e})=>(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"text-sm font-medium",children:[e.original.customer_id.slice(0,8),"..."]})})},{id:"invoice",header:"Invoice",cell:({row:e})=>(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(o.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,s.jsxs)("span",{className:"text-sm",children:[e.original.invoice_id.slice(0,8),"..."]})]})},{id:"amount",header:"Amount",cell:({row:e})=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:(0,x.formatCurrency)(e.original.total_amount,e.original.currency||"USD")}),e.original.available_credit>0&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Available:"," ",(0,x.formatCurrency)(e.original.available_credit,e.original.currency||"USD")]})]})},{id:"status",header:"Status",accessorKey:"status",cell:({row:e})=>(0,s.jsx)(m.Badge,{variant:"applied"===e.original.status?"success":"void"===e.original.status?"destructive":"draft"===e.original.status?"secondary":"default",children:e.original.status})},{id:"reason",header:"Reason",cell:({row:e})=>(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:v[e.original.reason]||e.original.reason})},{id:"date",header:"Date",cell:({row:e})=>{let t=new Date(e.original.created_at);return(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,s.jsx)(n.Z,{className:"h-3 w-3 text-muted-foreground"}),t.toLocaleDateString()]})}}],[]),q=(0,a.useMemo)(()=>[{label:"Draft",filter:e=>"draft"===e.status},{label:"Issued",filter:e=>"issued"===e.status},{label:"Applied",filter:e=>"applied"===e.status},{label:"Available Credit",filter:e=>e.available_credit>0}],[]),F=(0,a.useMemo)(()=>({totalCredits:f.reduce((e,t)=>e+t.total_amount,0),availableCredit:f.reduce((e,t)=>e+t.available_credit,0),appliedCredit:f.reduce((e,t)=>e+t.applied_amount,0)}),[f]),L=(0,a.useCallback)(t=>{e.push(`/dashboard/billing-revenue/credit-notes/${t.id}`)},[e]);return j?(0,s.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,s.jsx)("div",{className:"rounded-lg border border-border bg-card p-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)(i.Z,{className:"h-6 w-6 animate-spin text-muted-foreground"}),(0,s.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Loading credit notes..."})]})})}):_?(0,s.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,s.jsxs)("div",{className:"rounded-lg border border-red-900/20 bg-red-950/20 p-4",children:[(0,s.jsx)("div",{className:"text-red-600 dark:text-red-400",children:_}),(0,s.jsx)("button",{onClick:A,className:"mt-2 text-sm text-red-700 hover:text-red-600 dark:text-red-300 dark:hover:text-red-200",children:"Try again"})]})}):(0,s.jsxs)("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Credit Notes"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Manage customer credit notes, refunds, and adjustments."})]}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsxs)(m.Button,{onClick:()=>w(!0),className:"flex items-center gap-2",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4"}),"Create Credit Note"]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"rounded-lg border border-border bg-card p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Total Credits"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-foreground",children:(0,x.formatCurrency)(F.totalCredits,"USD")})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-border bg-card p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),(0,s.jsx)("span",{children:"Available Credit"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:(0,x.formatCurrency)(F.availableCredit,"USD")})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-border bg-card p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),(0,s.jsx)("span",{children:"Applied Credit"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(0,x.formatCurrency)(F.appliedCredit,"USD")})]})]}),(0,s.jsx)(m.EnhancedDataTable,{data:f,columns:M,quickFilters:q,searchConfig:{placeholder:"Search credit notes by number, customer, or invoice...",searchableFields:["credit_note_number","customer_id","invoice_id"]},onRowClick:L,emptyMessage:"No credit notes found",getRowId:e=>e.id}),(0,s.jsx)(m.Dialog,{open:N,onOpenChange:w,children:(0,s.jsxs)(m.DialogContent,{className:"max-w-2xl",children:[(0,s.jsxs)(m.DialogHeader,{children:[(0,s.jsx)(m.DialogTitle,{children:"Create Credit Note"}),(0,s.jsx)(m.DialogDescription,{children:"Create a new credit note for a customer invoice."})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.Label,{htmlFor:"invoice_id",children:"Invoice ID"}),(0,s.jsx)(m.Input,{id:"invoice_id",value:S.invoice_id,onChange:e=>I({...S,invoice_id:e.target.value}),placeholder:"Enter invoice ID"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.Label,{htmlFor:"reason",children:"Reason"}),(0,s.jsxs)(m.Select,{value:S.reason,onValueChange:e=>I({...S,reason:e}),children:[(0,s.jsx)(m.SelectTrigger,{children:(0,s.jsx)(m.SelectValue,{placeholder:"Select reason"})}),(0,s.jsxs)(m.SelectContent,{children:[(0,s.jsx)(m.SelectItem,{value:"error",children:"Error"}),(0,s.jsx)(m.SelectItem,{value:"discount",children:"Discount"}),(0,s.jsx)(m.SelectItem,{value:"return",children:"Return"}),(0,s.jsx)(m.SelectItem,{value:"goodwill",children:"Goodwill"}),(0,s.jsx)(m.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.Label,{htmlFor:"amount",children:"Amount"}),(0,s.jsx)(m.Input,{id:"amount",type:"number",step:"0.01",value:S.amount,onChange:e=>I({...S,amount:e.target.value}),placeholder:"0.00"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(m.Input,{id:"description",value:S.description,onChange:e=>I({...S,description:e.target.value}),placeholder:"Description of the credit"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.Label,{htmlFor:"notes",children:"Customer Notes"}),(0,s.jsx)(m.Textarea,{id:"notes",value:S.notes,onChange:e=>I({...S,notes:e.target.value}),placeholder:"Notes visible to customer",rows:3})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(m.Label,{htmlFor:"internal_notes",children:"Internal Notes"}),(0,s.jsx)(m.Textarea,{id:"internal_notes",value:S.internal_notes,onChange:e=>I({...S,internal_notes:e.target.value}),placeholder:"Internal notes (not visible to customer)",rows:3})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"auto_apply",checked:S.auto_apply,onChange:e=>I({...S,auto_apply:e.target.checked}),className:"rounded border-border"}),(0,s.jsx)(m.Label,{htmlFor:"auto_apply",className:"cursor-pointer",children:"Automatically apply to invoice"})]})]}),(0,s.jsxs)(m.DialogFooter,{children:[(0,s.jsx)(m.Button,{variant:"outline",onClick:()=>w(!1),disabled:P,children:"Cancel"}),(0,s.jsx)(m.Button,{onClick:D,disabled:P,children:P?"Creating...":"Create Credit Note"})]})]})})]})}},19566:()=>{throw Error('Module parse failed: Unexpected token (8:7)\nFile was processed with these loaders:\n * ./node_modules/next/dist/build/webpack/loaders/next-flight-client-module-loader.js\n * ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| export * from "./CreateCreditNoteModal";\n| export { default as CustomerBilling } from "./CustomerBilling";\n> export type { CustomerBillingProps } from "./CustomerBilling";\n| export * from "./InvoiceDetailModal";\n| export { default as InvoiceList } from "./InvoiceList";')},70607:(e,t,r)=>{"use strict";var s=r(19566);r.o(s,"AddPaymentMethodModal")&&r.d(t,{AddPaymentMethodModal:function(){return s.AddPaymentMethodModal}}),r.o(s,"AddonsPageSkeleton")&&r.d(t,{AddonsPageSkeleton:function(){return s.AddonsPageSkeleton}}),r.o(s,"InvoiceList")&&r.d(t,{InvoiceList:function(){return s.InvoiceList}}),r.o(s,"formatCurrency")&&r.d(t,{formatCurrency:function(){return s.formatCurrency}});var a=r(58892);r.o(a,"AddPaymentMethodModal")&&r.d(t,{AddPaymentMethodModal:function(){return a.AddPaymentMethodModal}}),r.o(a,"AddonsPageSkeleton")&&r.d(t,{AddonsPageSkeleton:function(){return a.AddonsPageSkeleton}}),r.o(a,"InvoiceList")&&r.d(t,{InvoiceList:function(){return a.InvoiceList}}),r.o(a,"formatCurrency")&&r.d(t,{formatCurrency:function(){return a.formatCurrency}});var o=r(53590);r.o(o,"AddPaymentMethodModal")&&r.d(t,{AddPaymentMethodModal:function(){return o.AddPaymentMethodModal}}),r.o(o,"AddonsPageSkeleton")&&r.d(t,{AddonsPageSkeleton:function(){return o.AddonsPageSkeleton}}),r.o(o,"InvoiceList")&&r.d(t,{InvoiceList:function(){return o.InvoiceList}}),r.o(o,"formatCurrency")&&r.d(t,{formatCurrency:function(){return o.formatCurrency}})},58892:()=>{throw Error('Module parse failed: Unexpected token (7:7)\nFile was processed with these loaders:\n * ./node_modules/next/dist/build/webpack/loaders/next-flight-client-module-loader.js\n * ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n|  */\n| \n> export enum InvoiceStatus {\n|   DRAFT = "draft",\n|   FINALIZED = "finalized",')},53590:()=>{throw Error('Module parse failed: Unexpected token (7:44)\nFile was processed with these loaders:\n * ./node_modules/next/dist/build/webpack/loaders/next-flight-client-module-loader.js\n * ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n|  */\n| \n> import { InvoiceStatus, PaymentStatus, type Invoice } from "./types";\n| \n| /**')},56200:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/credit-notes/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[2793,1009,6226,657,6032,4218],()=>r(72747));module.exports=s})();