(()=>{var e={};e.id=7208,e.ids=[7208],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},74833:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>d.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>o}),s(51196),s(13321),s(46366),s(96560);var r=s(23191),a=s(88716),i=s(37922),d=s.n(i),n=s(95231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(t,l);let o=["",{children:["dashboard",{children:["billing-revenue",{children:["credit-notes",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,51196)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/credit-notes/[id]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/credit-notes/[id]/page.tsx"],u="/dashboard/billing-revenue/credit-notes/[id]/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/billing-revenue/credit-notes/[id]/page",pathname:"/dashboard/billing-revenue/credit-notes/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},14128:(e,t,s)=>{Promise.resolve().then(s.bind(s,19930))},19930:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var r=s(10326),a=s(17577),i=s(35047),d=s(21405),n=s(86333),l=s(30361),o=s(69669),c=s(31540),u=s(36283),x=s(7027),m=s(41291),p=s(71821),h=s(79635),j=s(37358),f=s(59341),v=s(48723),g=s(70607);let y={error:"Error",discount:"Discount",return:"Return",goodwill:"Goodwill",other:"Other"};function b(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),{toast:s}=(0,v.useToast)(),b=(0,v.useConfirmDialog)(),N=e.id,[C,w]=(0,a.useState)(null),[_,k]=(0,a.useState)(!0),[P,A]=(0,a.useState)(null),[I,S]=(0,a.useState)(!1),[T,D]=(0,a.useState)(!1),[M,L]=(0,a.useState)(""),[q,F]=(0,a.useState)(""),B=(0,a.useCallback)(async()=>{try{k(!0),A(null);let e=await f.x1.get(`/billing/credit-notes/${N}`);if(e.data)w(e.data);else throw Error("Failed to fetch credit note")}catch(e){console.error("Failed to fetch credit note:",e),A(e instanceof Error?e.message:"Failed to fetch credit note")}finally{k(!1)}},[N]),E=(0,a.useCallback)(async()=>{if(C)try{S(!0),await f.x1.post(`/billing/credit-notes/${C.id}/issue`),s({title:"Credit note issued",description:"The credit note has been issued successfully."}),await B()}catch(e){console.error("Failed to issue credit note:",e),s({title:"Error",description:"Failed to issue credit note. Please try again.",variant:"destructive"})}finally{S(!1)}},[C,B,s]),Z=(0,a.useCallback)(async()=>{if(C&&await b({title:"Void credit note",description:"Are you sure you want to void this credit note? This action cannot be undone.",confirmText:"Void credit note",variant:"destructive"}))try{S(!0),await f.x1.post(`/billing/credit-notes/${C.id}/void`),s({title:"Credit note voided",description:"The credit note has been voided successfully."}),await B()}catch(e){console.error("Failed to void credit note:",e),s({title:"Error",description:"Failed to void credit note. Please try again.",variant:"destructive"})}finally{S(!1)}},[C,b,B,s]),H=(0,a.useCallback)(async()=>{if(C)try{S(!0);let e={};M&&(e.invoice_id=M),q&&(e.amount=parseFloat(q)),await f.x1.post(`/billing/credit-notes/${C.id}/apply`,e),s({title:"Credit note applied",description:"The credit note has been applied successfully."}),D(!1),L(""),F(""),await B()}catch(e){console.error("Failed to apply credit note:",e),s({title:"Error",description:"Failed to apply credit note. Please try again.",variant:"destructive"})}finally{S(!1)}},[C,M,q,B,s]);return _?(0,r.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,r.jsx)("div",{className:"rounded-lg border border-border bg-card p-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)(d.Z,{className:"h-6 w-6 animate-spin text-muted-foreground"}),(0,r.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Loading credit note..."})]})})}):P||!C?(0,r.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,r.jsxs)("div",{className:"rounded-lg border border-red-900/20 bg-red-950/20 p-4",children:[(0,r.jsx)("div",{className:"text-red-600 dark:text-red-400",children:P||"Credit note not found"}),(0,r.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,r.jsx)("button",{onClick:B,className:"text-sm text-red-700 hover:text-red-600 dark:text-red-300 dark:hover:text-red-200",children:"Try again"}),(0,r.jsx)("button",{onClick:()=>t.push("/dashboard/billing-revenue/credit-notes"),className:"text-sm text-red-700 hover:text-red-600 dark:text-red-300 dark:hover:text-red-200",children:"Back to credit notes"})]})]})}):(0,r.jsxs)("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)(v.Button,{variant:"ghost",size:"sm",onClick:()=>t.push("/dashboard/billing-revenue/credit-notes"),children:[(0,r.jsx)(n.Z,{className:"h-4 w-4 mr-2"}),"Back"]})}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:C.credit_note_number}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v.Badge,{variant:"applied"===C.status?"success":"void"===C.status?"destructive":"draft"===C.status?"secondary":"default",children:C.status}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:y[C.reason]||C.reason})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["draft"===C.status&&(0,r.jsxs)(v.Button,{onClick:E,disabled:I,children:[(0,r.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"Issue"]}),"issued"===C.status&&C.available_credit>0&&(0,r.jsxs)(v.Button,{onClick:()=>D(!0),disabled:I,children:[(0,r.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"Apply to Invoice"]}),("draft"===C.status||"issued"===C.status)&&(0,r.jsxs)(v.Button,{variant:"destructive",onClick:Z,disabled:I,children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Void"]}),(0,r.jsxs)(v.Button,{variant:"outline",disabled:I,children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Download"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,r.jsxs)(v.Card,{children:[(0,r.jsx)(v.CardHeader,{children:(0,r.jsxs)(v.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-5 w-5"}),"Invoice Reference"]})}),(0,r.jsx)(v.CardContent,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Invoice ID"}),(0,r.jsx)("div",{className:"font-medium",children:C.invoice_id})]}),(0,r.jsxs)(v.Button,{variant:"outline",size:"sm",onClick:()=>t.push(`/dashboard/billing-revenue/invoices/${C.invoice_id}`),children:["View Invoice",(0,r.jsx)(x.Z,{className:"h-3 w-3 ml-2"})]})]})})]}),(0,r.jsxs)(v.Card,{children:[(0,r.jsx)(v.CardHeader,{children:(0,r.jsx)(v.CardTitle,{className:"text-lg",children:"Line Items"})}),(0,r.jsxs)(v.CardContent,{children:[(0,r.jsxs)(v.Table,{children:[(0,r.jsx)(v.TableHeader,{children:(0,r.jsxs)(v.TableRow,{children:[(0,r.jsx)(v.TableHead,{children:"Description"}),(0,r.jsx)(v.TableHead,{className:"text-right",children:"Quantity"}),(0,r.jsx)(v.TableHead,{className:"text-right",children:"Amount"})]})}),(0,r.jsx)(v.TableBody,{children:C.line_items.map((e,t)=>(0,r.jsxs)(v.TableRow,{children:[(0,r.jsx)(v.TableCell,{children:e.description}),(0,r.jsx)(v.TableCell,{className:"text-right",children:e.quantity||1}),(0,r.jsx)(v.TableCell,{className:"text-right",children:(0,g.formatCurrency)(e.amount,C.currency)})]},e.line_item_id||t))})]}),(0,r.jsx)(v.Separator,{className:"my-4"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsx)("span",{children:(0,g.formatCurrency)(C.total_amount,C.currency)})]}),C.applied_amount>0&&(0,r.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,r.jsx)("span",{children:"Applied"}),(0,r.jsxs)("span",{children:["-",(0,g.formatCurrency)(C.applied_amount,C.currency)]})]}),C.available_credit>0&&(0,r.jsxs)("div",{className:"flex justify-between text-sm font-medium text-green-600 dark:text-green-400",children:[(0,r.jsx)("span",{children:"Available Credit"}),(0,r.jsx)("span",{children:(0,g.formatCurrency)(C.available_credit,C.currency)})]})]})]})]}),(C.notes||C.internal_notes)&&(0,r.jsxs)(v.Card,{children:[(0,r.jsx)(v.CardHeader,{children:(0,r.jsx)(v.CardTitle,{className:"text-lg",children:"Notes"})}),(0,r.jsxs)(v.CardContent,{className:"space-y-4",children:[C.notes&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Customer Notes"}),(0,r.jsx)("div",{className:"text-sm p-3 rounded-lg bg-muted/50",children:C.notes})]}),C.internal_notes&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Internal Notes"}),(0,r.jsx)("div",{className:"text-sm p-3 rounded-lg bg-muted/50 border border-amber-500/20",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),(0,r.jsx)("span",{children:C.internal_notes})]})})]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(v.Card,{children:[(0,r.jsx)(v.CardHeader,{children:(0,r.jsxs)(v.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,r.jsx)(p.Z,{className:"h-5 w-5"}),"Amount Summary"]})}),(0,r.jsxs)(v.CardContent,{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Amount"}),(0,r.jsx)("span",{className:"font-medium",children:(0,g.formatCurrency)(C.total_amount,C.currency)})]}),(0,r.jsx)(v.Separator,{}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Applied"}),(0,r.jsx)("span",{className:"font-medium",children:(0,g.formatCurrency)(C.applied_amount,C.currency)})]}),(0,r.jsx)(v.Separator,{}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:"Available"}),(0,r.jsx)("span",{className:"font-bold text-green-600 dark:text-green-400",children:(0,g.formatCurrency)(C.available_credit,C.currency)})]})]})]}),(0,r.jsxs)(v.Card,{children:[(0,r.jsx)(v.CardHeader,{children:(0,r.jsxs)(v.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"h-5 w-5"}),"Customer"]})}),(0,r.jsx)(v.CardContent,{children:(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Customer ID"}),(0,r.jsx)("div",{className:"font-medium text-sm",children:C.customer_id})]})})})]}),(0,r.jsxs)(v.Card,{children:[(0,r.jsx)(v.CardHeader,{children:(0,r.jsxs)(v.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"h-5 w-5"}),"Audit Trail"]})}),(0,r.jsxs)(v.CardContent,{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Created"}),(0,r.jsx)("div",{className:"text-sm font-medium",children:new Date(C.created_at).toLocaleString()})]}),C.issued_at&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.Separator,{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Issued"}),(0,r.jsx)("div",{className:"text-sm font-medium",children:new Date(C.issued_at).toLocaleString()})]})]}),C.applied_at&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.Separator,{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Applied"}),(0,r.jsx)("div",{className:"text-sm font-medium",children:new Date(C.applied_at).toLocaleString()})]})]}),C.voided_at&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.Separator,{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Voided"}),(0,r.jsx)("div",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:new Date(C.voided_at).toLocaleString()})]})]})]})]})]})]}),(0,r.jsx)(v.Dialog,{open:T,onOpenChange:D,children:(0,r.jsxs)(v.DialogContent,{children:[(0,r.jsxs)(v.DialogHeader,{children:[(0,r.jsx)(v.DialogTitle,{children:"Apply Credit Note to Invoice"}),(0,r.jsx)(v.DialogDescription,{children:"Apply the available credit to an invoice. Leave fields empty to apply to the original invoice."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(v.Label,{htmlFor:"apply_invoice_id",children:"Invoice ID (optional)"}),(0,r.jsx)(v.Input,{id:"apply_invoice_id",value:M,onChange:e=>L(e.target.value),placeholder:C.invoice_id}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leave empty to apply to the original invoice"})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(v.Label,{htmlFor:"apply_amount",children:"Amount (optional)"}),(0,r.jsx)(v.Input,{id:"apply_amount",type:"number",step:"0.01",value:q,onChange:e=>F(e.target.value),placeholder:C.available_credit.toString()}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Leave empty to apply full available credit (",(0,g.formatCurrency)(C.available_credit,C.currency),")"]})]})]}),(0,r.jsxs)(v.DialogFooter,{children:[(0,r.jsx)(v.Button,{variant:"outline",onClick:()=>D(!1),disabled:I,children:"Cancel"}),(0,r.jsx)(v.Button,{onClick:H,disabled:I,children:I?"Applying...":"Apply Credit"})]})]})})]})}},19566:()=>{throw Error('Module parse failed: Unexpected token (8:7)\nFile was processed with these loaders:\n * ./node_modules/next/dist/build/webpack/loaders/next-flight-client-module-loader.js\n * ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n| export * from "./CreateCreditNoteModal";\n| export { default as CustomerBilling } from "./CustomerBilling";\n> export type { CustomerBillingProps } from "./CustomerBilling";\n| export * from "./InvoiceDetailModal";\n| export { default as InvoiceList } from "./InvoiceList";')},70607:(e,t,s)=>{"use strict";var r=s(19566);s.o(r,"AddPaymentMethodModal")&&s.d(t,{AddPaymentMethodModal:function(){return r.AddPaymentMethodModal}}),s.o(r,"AddonsPageSkeleton")&&s.d(t,{AddonsPageSkeleton:function(){return r.AddonsPageSkeleton}}),s.o(r,"InvoiceList")&&s.d(t,{InvoiceList:function(){return r.InvoiceList}}),s.o(r,"formatCurrency")&&s.d(t,{formatCurrency:function(){return r.formatCurrency}});var a=s(58892);s.o(a,"AddPaymentMethodModal")&&s.d(t,{AddPaymentMethodModal:function(){return a.AddPaymentMethodModal}}),s.o(a,"AddonsPageSkeleton")&&s.d(t,{AddonsPageSkeleton:function(){return a.AddonsPageSkeleton}}),s.o(a,"InvoiceList")&&s.d(t,{InvoiceList:function(){return a.InvoiceList}}),s.o(a,"formatCurrency")&&s.d(t,{formatCurrency:function(){return a.formatCurrency}});var i=s(53590);s.o(i,"AddPaymentMethodModal")&&s.d(t,{AddPaymentMethodModal:function(){return i.AddPaymentMethodModal}}),s.o(i,"AddonsPageSkeleton")&&s.d(t,{AddonsPageSkeleton:function(){return i.AddonsPageSkeleton}}),s.o(i,"InvoiceList")&&s.d(t,{InvoiceList:function(){return i.InvoiceList}}),s.o(i,"formatCurrency")&&s.d(t,{formatCurrency:function(){return i.formatCurrency}})},58892:()=>{throw Error('Module parse failed: Unexpected token (7:7)\nFile was processed with these loaders:\n * ./node_modules/next/dist/build/webpack/loaders/next-flight-client-module-loader.js\n * ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n|  */\n| \n> export enum InvoiceStatus {\n|   DRAFT = "draft",\n|   FINALIZED = "finalized",')},53590:()=>{throw Error('Module parse failed: Unexpected token (7:44)\nFile was processed with these loaders:\n * ./node_modules/next/dist/build/webpack/loaders/next-flight-client-module-loader.js\n * ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js\nYou may need an additional loader to handle the result of these loaders.\n|  */\n| \n> import { InvoiceStatus, PaymentStatus, type Invoice } from "./types";\n| \n| /**')},51196:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/credit-notes/[id]/page.tsx#default`)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[2793,1009,6226,657,6032,4218],()=>s(74833));module.exports=r})();