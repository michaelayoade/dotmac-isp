(()=>{var e={};e.id=2625,e.ids=[2625],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},47791:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>p,pages:()=>d,routeModule:()=>u,tree:()=>o}),s(33267),s(13321),s(46366),s(96560);var a=s(23191),r=s(88716),i=s(37922),n=s.n(i),l=s(95231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let o=["",{children:["dashboard",{children:["billing-revenue",{children:["receipts",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,33267)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/receipts/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],d=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/receipts/page.tsx"],p="/dashboard/billing-revenue/receipts/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/billing-revenue/receipts/page",pathname:"/dashboard/billing-revenue/receipts",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},66506:(e,t,s)=>{Promise.resolve().then(s.bind(s,3661))},3661:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>D});var a=s(10326),r=s(17577),i=s.n(r),n=s(35047),l=s(48723),c=s(30361),o=s(69669),d=s(31540),p=s(36283),m=s(83855),u=s(21405),x=s(95964),h=s(71821),j=s(37358),g=s(88307),f=s(77506),v=s(44976),b=s(48324),y=s(17010),N=s(34041),C=s(59341),w=s(26576),_=s(29771);function P(e,t="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function D(){let e=(0,n.useRouter)(),{toast:t}=(0,l.useToast)(),s=(0,v.NL)(),[D,T]=(0,r.useState)(""),[k,S]=(0,r.useState)(""),[R,M]=(0,r.useState)(""),[q,A]=(0,r.useState)(1),[F]=(0,r.useState)(20),[E,L]=(0,r.useState)(!1),[U,Z]=(0,r.useState)("payment"),[B,H]=(0,r.useState)(""),[I,G]=(0,r.useState)(""),[z,$]=(0,r.useState)(!0),[O,V]=(0,r.useState)(!0),[W,K]=(0,r.useState)(!1),Y={limit:F,offset:(q-1)*F};k&&(Y.from_date=k),R&&(Y.to_date=R);let{data:Q,isLoading:X,error:J,refetch:ee}=(0,b.a)({queryKey:["receipts",Y],queryFn:async()=>(await C.x1.get("/billing/receipts/",{params:Y})).data}),et=i().useMemo(()=>{if(!Q?.receipts)return[];if(!D)return Q.receipts;let e=D.toLowerCase();return Q.receipts.filter(t=>t.receipt_number.toLowerCase().includes(e)||(t.customer_name??"").toLowerCase().includes(e)||(t.customer_email??"").toLowerCase().includes(e)||(t.payment_id??"").toLowerCase().includes(e))},[Q,D]),es=i().useMemo(()=>{if(!Q?.receipts)return{totalReceipts:0,totalAmount:0,thisMonth:0,thisMonthAmount:0};let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),s=Q.receipts.filter(e=>new Date(e.issue_date)>=t);return{totalReceipts:Q.receipts.length,totalAmount:Q.receipts.reduce((e,t)=>e+t.total_amount,0),thisMonth:s.length,thisMonthAmount:s.reduce((e,t)=>e+t.total_amount,0)}},[Q]),ea=(0,y.D)({mutationFn:async e=>(await C.x1.post("payment"===U?"/billing/receipts/generate/payment":"/billing/receipts/generate/invoice",e)).data,onSuccess:e=>{_.k.info("Receipt generated successfully",{receipt:e}),t({title:"Success",description:"Receipt generated successfully"}),L(!1),ei(),s.invalidateQueries({queryKey:["receipts"]})},onError:e=>{_.k.error("Failed to generate receipt",e),(0,w.zG)(e,{userMessage:"Failed to generate receipt. Please try again."})}}),er=async()=>{if("payment"===U&&!B){t({title:"Error",description:"Please enter a payment ID",variant:"destructive"});return}if("invoice"===U&&!I){t({title:"Error",description:"Please enter an invoice ID",variant:"destructive"});return}let e={include_pdf:z,include_html:O,send_email:W};"payment"===U?e.payment_id=B:e.invoice_id=I,ea.mutate(e)},ei=()=>{H(""),G(""),$(!0),V(!0),K(!1),Z("payment")},en=async e=>{try{let s=await C.x1.get("/billing/receipts/export",{params:{format:e,...Y},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([s.data])),r=document.createElement("a");r.href=a;let i=(0,N.WU)(new Date,"yyyy-MM-dd");r.setAttribute("download",`receipts-${e}-${i}.${e}`),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a),_.k.info("Receipts exported",{format:e}),t({title:"Success",description:`Receipts exported to ${e.toUpperCase()} successfully`})}catch(e){_.k.error("Failed to export receipts",e),(0,w.zG)(e,{userMessage:"Failed to export receipts. Please try again."})}},el=e=>e?(0,a.jsxs)(l.Badge,{variant:"default",className:"flex items-center gap-1",children:[(0,a.jsx)(c.Z,{className:"h-3 w-3"}),"Sent"]}):(0,a.jsxs)(l.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,a.jsx)(o.Z,{className:"h-3 w-3"}),"Not Sent"]});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Receipts"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage payment receipts and documents"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(l.Button,{variant:"outline",onClick:()=>en("csv"),children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"Export CSV"]}),(0,a.jsxs)(l.Button,{variant:"outline",onClick:()=>en("pdf"),children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"Export PDF"]}),(0,a.jsxs)(l.Button,{onClick:()=>L(!0),children:[(0,a.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Generate Receipt"]}),(0,a.jsxs)(l.Button,{variant:"outline",onClick:()=>ee(),children:[(0,a.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{className:"pb-2",children:(0,a.jsxs)(l.CardTitle,{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-muted-foreground"}),"Total Receipts"]})}),(0,a.jsxs)(l.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:es.totalReceipts}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"All time"})]})]}),(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{className:"pb-2",children:(0,a.jsxs)(l.CardTitle,{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"}),"Total Amount"]})}),(0,a.jsxs)(l.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:P(es.totalAmount,"USD")}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"All receipts"})]})]}),(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{className:"pb-2",children:(0,a.jsxs)(l.CardTitle,{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 text-muted-foreground"}),"This Month"]})}),(0,a.jsxs)(l.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:es.thisMonth}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Receipts issued"})]})]}),(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{className:"pb-2",children:(0,a.jsxs)(l.CardTitle,{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"}),"Month Amount"]})}),(0,a.jsxs)(l.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:P(es.thisMonthAmount,"USD")}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]})]}),(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(l.CardTitle,{children:"All Receipts"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,a.jsx)(l.Input,{placeholder:"Search receipts...",value:D,onChange:e=>T(e.target.value),className:"pl-10 w-[250px]"})]}),(0,a.jsx)(l.Input,{type:"date",placeholder:"From date",value:k,onChange:e=>S(e.target.value),className:"w-[150px]"}),(0,a.jsx)(l.Input,{type:"date",placeholder:"To date",value:R,onChange:e=>M(e.target.value),className:"w-[150px]"})]})]})}),(0,a.jsxs)(l.CardContent,{children:[X?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(f.Z,{className:"h-6 w-6 animate-spin mx-auto text-muted-foreground"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Loading receipts..."})]}):J?(0,a.jsxs)("div",{className:"text-center py-8 text-destructive",children:["Failed to load receipts. Please try again.",(0,a.jsxs)(l.Button,{variant:"outline",className:"mt-4",onClick:()=>ee(),children:[(0,a.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Retry"]})]}):0===et.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No receipts found for the selected filters."}):(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHeader,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableHead,{children:"Receipt #"}),(0,a.jsx)(l.TableHead,{children:"Customer"}),(0,a.jsx)(l.TableHead,{children:"Payment"}),(0,a.jsx)(l.TableHead,{children:"Amount"}),(0,a.jsx)(l.TableHead,{children:"Date"}),(0,a.jsx)(l.TableHead,{children:"Email Status"}),(0,a.jsx)(l.TableHead,{children:"Actions"})]})}),(0,a.jsx)(l.TableBody,{children:et.map(t=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-medium",children:t.receipt_number})]})}),(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:t.customer_name}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:t.customer_email})]})}),(0,a.jsx)(l.TableCell,{children:t.payment_id?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(h.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-sm font-mono",children:[t.payment_id.slice(0,8),"..."]})]}):t.invoice_id?(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(p.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-sm font-mono",children:[t.invoice_id.slice(0,8),"..."]})]}):(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"N/A"})}),(0,a.jsx)(l.TableCell,{children:(0,a.jsx)("div",{className:"font-medium",children:P(t.total_amount,t.currency)})}),(0,a.jsxs)(l.TableCell,{children:[(0,a.jsx)("div",{className:"text-sm",children:(0,N.WU)(new Date(t.issue_date),"MMM d, yyyy")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,N.WU)(new Date(t.issue_date),"h:mm a")})]}),(0,a.jsx)(l.TableCell,{children:el(!!t.sent_at)}),(0,a.jsx)(l.TableCell,{children:(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>e.push(`/dashboard/billing-revenue/receipts/${t.receipt_id}`),children:"View"})})]},t.receipt_id))})]}),Q&&Q.total>F&&(0,a.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(q-1)*F+1," to ",Math.min(q*F,Q.total)," of"," ",Q.total," receipts"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>A(e=>Math.max(1,e-1)),disabled:1===q,children:"Previous"}),(0,a.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>A(e=>e+1),disabled:q*F>=Q.total,children:"Next"})]})]})]})]}),(0,a.jsx)(l.Dialog,{open:E,onOpenChange:L,children:(0,a.jsxs)(l.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(l.DialogHeader,{children:[(0,a.jsx)(l.DialogTitle,{children:"Generate Receipt"}),(0,a.jsx)(l.DialogDescription,{children:"Create a new receipt for a payment or invoice"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{children:"Receipt Type"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsx)(l.Button,{type:"button",variant:"payment"===U?"default":"outline",onClick:()=>Z("payment"),className:"flex-1",children:"Payment"}),(0,a.jsx)(l.Button,{type:"button",variant:"invoice"===U?"default":"outline",onClick:()=>Z("invoice"),className:"flex-1",children:"Invoice"})]})]}),"payment"===U?(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{htmlFor:"payment_id",children:"Payment ID"}),(0,a.jsx)(l.Input,{id:"payment_id",value:B,onChange:e=>H(e.target.value),placeholder:"Enter payment ID"})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{htmlFor:"invoice_id",children:"Invoice ID"}),(0,a.jsx)(l.Input,{id:"invoice_id",value:I,onChange:e=>G(e.target.value),placeholder:"Enter invoice ID"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"include_pdf",checked:z,onChange:e=>$(e.target.checked),className:"rounded border-border"}),(0,a.jsx)(l.Label,{htmlFor:"include_pdf",className:"cursor-pointer",children:"Generate PDF"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"include_html",checked:O,onChange:e=>V(e.target.checked),className:"rounded border-border"}),(0,a.jsx)(l.Label,{htmlFor:"include_html",className:"cursor-pointer",children:"Generate HTML"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"send_email",checked:W,onChange:e=>K(e.target.checked),className:"rounded border-border"}),(0,a.jsx)(l.Label,{htmlFor:"send_email",className:"cursor-pointer",children:"Send email to customer"})]})]})]}),(0,a.jsxs)(l.DialogFooter,{children:[(0,a.jsx)(l.Button,{variant:"outline",onClick:()=>{L(!1),ei()},disabled:ea.isPending,children:"Cancel"}),(0,a.jsx)(l.Button,{onClick:er,disabled:ea.isPending,children:ea.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):"Generate Receipt"})]})]})})]})}},26576:(e,t,s)=>{"use strict";s.d(t,{zG:()=>c});var a=s(29771);s(17406);let r=e=>e instanceof Error&&("status"in e||"response"in e),i=e=>{if(e instanceof Error)return e.message;if("string"==typeof e)return e;if(r(e)&&e.data){let t=e.data;if(t.message&&"string"==typeof t.message)return t.message;if(t.detail&&"string"==typeof t.detail)return t.detail}return"An unexpected error occurred. Please try again."},n=e=>r(e)?e.status:e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"status"in e.response?e.response.status:void 0,l=e=>{},c=(e,t={})=>{let{showToast:s=!0,userMessage:r,redirectOnUnauthorized:c=!0,context:o,onError:d}=t,p=n(e),m=r||i(e);a.k.error("API Error",e,{status:p,message:m,...o}),(401!==p||!c)&&(403===p?s&&l({title:"Access Denied",description:"You do not have permission to perform this action.",variant:"destructive"}):404===p?s&&l({title:"Not Found",description:m,variant:"destructive"}):422===p?s&&l({title:"Validation Error",description:m,variant:"destructive"}):p&&p>=500?s&&l({title:"Server Error",description:"An unexpected server error occurred. Please try again later.",variant:"destructive"}):s&&l({title:"Error",description:m,variant:"destructive"}),d&&e instanceof Error&&d(e))}},17406:(e,t,s)=>{},33267:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/billing-revenue/receipts/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[2793,1009,6226,657,6032,4218],()=>s(47791));module.exports=a})();