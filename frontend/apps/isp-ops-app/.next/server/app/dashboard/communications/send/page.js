(()=>{var e={};e.id=5728,e.ids=[5728],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},70430:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>o,routeModule:()=>u,tree:()=>n}),s(73310),s(13321),s(46366),s(96560);var a=s(23191),r=s(88716),i=s(37922),l=s.n(i),d=s(95231),c={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>d[e]);s.d(t,c);let n=["",{children:["dashboard",{children:["communications",{children:["send",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,73310)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/communications/send/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/communications/send/page.tsx"],m="/dashboard/communications/send/page",p={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/communications/send/page",pathname:"/dashboard/communications/send",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:n}})},90981:(e,t,s)=>{Promise.resolve().then(s.bind(s,44250))},44250:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var a=s(10326),r=s(17577),i=s(35047),l=s(90434),d=s(16996),c=s(48723),n=s(86333),o=s(12714),m=s(77506),p=s(69436),u=s(82671),h=s(29771),x=s(69217);function j(){let e=(0,i.useRouter)(),{toast:t}=(0,c.useToast)(),s=(0,d.lB)(),j=(0,d.NC)(),{data:b}=(0,d.zE)({channel:u.FB.EMAIL,is_active:!0}),y=(0,d.of)(),[v,g]=(0,r.useState)({to:"",cc:"",bcc:"",subject:"",body_text:"",body_html:"",reply_to:"",template_id:"",priority:5,scheduled_at:""}),[_,f]=(0,r.useState)({}),[N,C]=(0,r.useState)("immediate"),[q,w]=(0,r.useState)(!1),[P,S]=(0,r.useState)(""),[T,F]=(0,r.useState)(!1),[k,E]=(0,r.useState)([]),I=(0,d.yQ)(v.template_id||null),L=(0,r.useMemo)(()=>(0,x.zqs)(P),[P]);I.data,v.body_text,v.body_html;let B=()=>{let e={};if(0===(0,u.B)(v.to).length&&(e.to="At least one valid recipient email is required"),v.cc){let t=(0,u.B)(v.cc);v.cc.trim()&&0===t.length&&(e.cc="Invalid CC email addresses")}if(v.bcc){let t=(0,u.B)(v.bcc);v.bcc.trim()&&0===t.length&&(e.bcc="Invalid BCC email addresses")}if(v.reply_to&&!(0,u.vV)(v.reply_to)&&(e.reply_to="Invalid reply-to email address"),v.subject&&0!==v.subject.trim().length||(e.subject="Subject is required"),T&&!v.template_id?e.template_id="Please select a template":T||v.body_text||v.body_html||(e.body_text="Email body is required"),T&&k.length>0){let t=k.filter(e=>!v.variables?.[e]||""===v.variables[e].trim());t.length>0&&(e.variables=`Missing required variables: ${t.join(", ")}`)}return f(e),0===Object.keys(e).length},M=async()=>{if(B()){if(T&&v.template_id&&v.variables)try{let e=await y.mutateAsync({id:v.template_id,variables:v.variables});h.k.info("Template preview rendered",{templateId:v.template_id}),S(e.rendered_body_html||e.rendered_body_text||""),w(!0)}catch(e){h.k.error("Failed to render template preview",e,{templateId:v.template_id}),t({title:"Preview Failed",description:e.response?.data?.detail||"Failed to render template",variant:"destructive"})}else S(v.body_html||v.body_text||""),w(!0)}},D=async a=>{if(a.preventDefault(),!B()){t({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});return}let r=(0,u.B)(v.to),i=v.cc?(0,u.B)(v.cc):void 0,l=v.bcc?(0,u.B)(v.bcc):void 0,d={to:r,subject:v.subject.trim()};if(i?.length&&(d.cc=i),l?.length&&(d.bcc=l),v.reply_to?.trim()&&(d.reply_to=v.reply_to.trim()),T&&v.template_id?(d.template_id=v.template_id,v.variables&&(d.variables=v.variables)):(v.body_text&&(d.body_text=v.body_text),v.body_html&&(d.body_html=v.body_html)),"immediate"===N)s.mutate(d,{onSuccess:s=>{h.k.info("Email sent successfully",{recipientCount:s.accepted.length,subject:v.subject}),t({title:"Email Sent",description:`Successfully sent to ${s.accepted.length} recipient(s)`}),e.push("/dashboard/communications")},onError:e=>{h.k.error("Failed to send email",e,{subject:v.subject,recipientCount:r.length}),t({title:"Send Failed",description:e.response?.data?.detail||"Failed to send email",variant:"destructive"})}});else{let s={...d,..."number"==typeof v.priority&&{priority:v.priority},...v.scheduled_at&&{scheduled_at:v.scheduled_at}};j.mutate(s,{onSuccess:s=>{h.k.info("Email queued successfully",{taskId:s.task_id,subject:v.subject,priority:v.priority,scheduledAt:v.scheduled_at}),t({title:"Email Queued",description:`Email queued successfully. Task ID: ${s.task_id}`}),e.push("/dashboard/communications")},onError:e=>{h.k.error("Failed to queue email",e,{subject:v.subject,priority:v.priority}),t({title:"Queue Failed",description:e.response?.data?.detail||"Failed to queue email",variant:"destructive"})}})}},U=(e,t)=>{g(s=>({...s,[e]:t})),_[e]&&f(t=>{let s={...t};return delete s[e],s})},A=(e,t)=>{g(s=>({...s,variables:{...s.variables,[e]:t}}))},Q=s.isPending||j.isPending;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsx)(l.default,{href:"/dashboard/communications",children:(0,a.jsxs)(c.Button,{variant:"ghost",size:"sm",children:[(0,a.jsx)(n.Z,{className:"h-4 w-4 mr-2"}),"Back to Communications"]})})}),(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Send Email"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Compose and send email to one or multiple recipients"})]})}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsx)("form",{onSubmit:D,children:(0,a.jsxs)(c.Card,{children:[(0,a.jsx)(c.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(c.CardTitle,{children:"Email Composer"}),(0,a.jsx)(c.CardDescription,{children:"Fill in the email details"})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)(c.Button,{type:"button",variant:"outline",size:"sm",onClick:M,disabled:Q||y.isPending,children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Preview"]})})]})}),(0,a.jsxs)(c.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"use_template",checked:T,onChange:e=>F(e.target.checked),className:"h-4 w-4 rounded border-gray-300"}),(0,a.jsx)(c.Label,{htmlFor:"use_template",className:"font-normal cursor-pointer",children:"Use email template"})]}),T&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{htmlFor:"template_id",children:["Template ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)(c.Select,{value:v.template_id,onValueChange:e=>U("template_id",e),children:[(0,a.jsx)(c.SelectTrigger,{id:"template_id",children:(0,a.jsx)(c.SelectValue,{placeholder:"Select a template"})}),(0,a.jsx)(c.SelectContent,{children:b?.templates.map(e=>a.jsx(c.SelectItem,{value:e.id,children:e.name},e.id))})]}),_.template_id&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.template_id}),I.data&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:I.data.description})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{htmlFor:"to",children:["To ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(c.Input,{id:"to",value:v.to,onChange:e=>U("to",e.target.value),placeholder:"email@example.com, another@example.com"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Comma-separated email addresses"}),_.to&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.to})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:"cc",children:"CC"}),(0,a.jsx)(c.Input,{id:"cc",value:v.cc,onChange:e=>U("cc",e.target.value),placeholder:"cc@example.com"}),_.cc&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.cc})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:"bcc",children:"BCC"}),(0,a.jsx)(c.Input,{id:"bcc",value:v.bcc,onChange:e=>U("bcc",e.target.value),placeholder:"bcc@example.com"}),_.bcc&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.bcc})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(c.Label,{htmlFor:"subject",children:["Subject ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(c.Input,{id:"subject",value:v.subject,onChange:e=>U("subject",e.target.value),placeholder:"Email subject"}),_.subject&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.subject})]}),T&&k.length>0&&(0,a.jsxs)("div",{className:"space-y-3 p-4 border rounded-lg",children:[(0,a.jsx)(c.Label,{children:"Template Variables"}),k.map(e=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:`var_${e}`,className:"text-sm",children:e}),(0,a.jsx)(c.Input,{id:`var_${e}`,value:v.variables?.[e]||"",onChange:t=>A(e,t.target.value),placeholder:`Enter ${e}`})]},e)),_.variables&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.variables})]}),!T&&(0,a.jsxs)(c.Tabs,{defaultValue:"text",children:[(0,a.jsxs)(c.TabsList,{children:[(0,a.jsx)(c.TabsTrigger,{value:"text",children:"Plain Text"}),(0,a.jsx)(c.TabsTrigger,{value:"html",children:"HTML"})]}),(0,a.jsxs)(c.TabsContent,{value:"text",className:"space-y-2",children:[(0,a.jsxs)(c.Label,{htmlFor:"body_text",children:["Email Body ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(c.Textarea,{id:"body_text",value:v.body_text,onChange:e=>U("body_text",e.target.value),placeholder:"Email body text...",rows:12}),_.body_text&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.body_text})]}),(0,a.jsxs)(c.TabsContent,{value:"html",className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:"body_html",children:"HTML Body"}),(0,a.jsx)(c.Textarea,{id:"body_html",value:v.body_html,onChange:e=>U("body_html",e.target.value),placeholder:"<html>...</html>",rows:12,className:"font-mono text-sm"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:"reply_to",children:"Reply To (optional)"}),(0,a.jsx)(c.Input,{id:"reply_to",value:v.reply_to,onChange:e=>U("reply_to",e.target.value),placeholder:"reply@example.com"}),_.reply_to&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.reply_to})]}),(0,a.jsxs)("div",{className:"space-y-3 p-4 border rounded-lg",children:[(0,a.jsx)(c.Label,{children:"Send Mode"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",value:"immediate",checked:"immediate"===N,onChange:()=>C("immediate"),className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"Send Immediately"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",value:"queue",checked:"queue"===N,onChange:()=>C("queue"),className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"Queue for Later"})]})]}),"queue"===N&&(0,a.jsxs)("div",{className:"space-y-3 mt-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:"priority",children:"Priority (1-10)"}),(0,a.jsx)(c.Input,{id:"priority",type:"number",min:1,max:10,value:v.priority,onChange:e=>U("priority",parseInt(e.target.value,10))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.Label,{htmlFor:"scheduled_at",children:"Schedule for (optional)"}),(0,a.jsx)(c.Input,{id:"scheduled_at",type:"datetime-local",value:v.scheduled_at||"",onChange:e=>U("scheduled_at",e.target.value)})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,a.jsx)(c.Button,{type:"submit",disabled:Q,children:Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"immediate"===N?"Sending...":"Queueing..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"immediate"===N?"Send Now":"Queue Email"]})}),(0,a.jsx)(l.default,{href:"/dashboard/communications",children:(0,a.jsx)(c.Button,{type:"button",variant:"outline",children:"Cancel"})})]})]})]})})}),(0,a.jsxs)("div",{className:"space-y-4",children:[q&&(0,a.jsxs)(c.Card,{children:[(0,a.jsx)(c.CardHeader,{children:(0,a.jsxs)(c.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5"}),"Preview"]})}),(0,a.jsx)(c.CardContent,{children:(0,a.jsx)("div",{className:"prose prose-sm max-w-none",children:P?(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:L}}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"No preview available"})})})]}),(0,a.jsxs)(c.Card,{children:[(0,a.jsx)(c.CardHeader,{children:(0,a.jsx)(c.CardTitle,{children:"Tips"})}),(0,a.jsxs)(c.CardContent,{className:"space-y-2 text-sm",children:[(0,a.jsx)("p",{children:"• Use templates for consistent branding"}),(0,a.jsx)("p",{children:"• Test with your own email first"}),(0,a.jsxs)("p",{children:["• Variables: Use ","{{ variable_name }}"," syntax"]}),(0,a.jsx)("p",{children:"• Queue for bulk sending (better performance)"}),(0,a.jsx)("p",{children:"• Check preview before sending"})]})]})]})]})]})}},73310:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/communications/send/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[2793,1009,6226,657,6032,4218,6996],()=>s(70430));module.exports=a})();