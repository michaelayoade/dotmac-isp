(()=>{var e={};e.id=5806,e.ids=[5806],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},92916:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>o,routeModule:()=>m,tree:()=>c}),t(78542),t(13321),t(46366),t(96560);var a=t(23191),r=t(88716),i=t(37922),l=t.n(i),n=t(95231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(s,d);let c=["",{children:["dashboard",{children:["support",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,78542)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/support/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/support/[id]/page.tsx"],u="/dashboard/support/[id]/page",p={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/support/[id]/page",pathname:"/dashboard/support/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},28613:(e,s,t)=>{Promise.resolve().then(t.bind(t,76034))},76034:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>N,dynamic:()=>v,dynamicParams:()=>y});var a=t(10326),r=t(17577),i=t(35047),l=t(86333),n=t(69508),d=t(69436),c=t(41291),o=t(37358),u=t(48998),p=t(77636),m=t(66307),x=t(79635),h=t(53982),g=t(69669),j=t(48723),f=t(37570);let v="force-dynamic",y=!0;function N(){let e=(0,i.useParams)(),s=(0,i.useRouter)(),t=e.id,{ticket:x,loading:h,refetch:g}=(0,f.Q$)(t,!0),{addMessage:v,loading:y}=(0,f.iU)(),{updateTicket:N,loading:S}=(0,f.Qr)(),[k,C]=(0,r.useState)(""),[P,q]=(0,r.useState)(!1),D=async()=>{k.trim()&&await v(t,{message:k})&&(C(""),g())},T=async e=>{await N(t,{status:e})&&g()},Z=async e=>{await N(t,{priority:e})&&g()};return h&&!x?(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Loading ticket..."})}):x?(0,a.jsxs)("div",{className:"space-y-6 pb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>s.push("/dashboard/support"),children:[(0,a.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:x.ticket_number}),(0,a.jsx)(_,{status:x.status}),(0,a.jsx)(w,{priority:x.priority})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:x.subject})]})]}),(0,a.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>q(!P),children:[(0,a.jsx)(n.Z,{className:"h-4 w-4 mr-2"}),"Edit"]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,a.jsx)("div",{className:"lg:col-span-2 space-y-6",children:(0,a.jsxs)(j.Card,{children:[(0,a.jsxs)(j.CardHeader,{children:[(0,a.jsx)(j.CardTitle,{children:"Conversation"}),(0,a.jsxs)(j.CardDescription,{children:[x.messages.length," message",1!==x.messages.length?"s":""]})]}),(0,a.jsxs)(j.CardContent,{className:"space-y-4",children:[0===x.messages.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No messages yet"}):(0,a.jsx)("div",{className:"space-y-4",children:x.messages.map((e,s)=>(0,a.jsx)(b,{message:e,isFirst:0===s},e.id))}),(0,a.jsx)(j.Separator,{}),"closed"!==x.status&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Add Reply"}),(0,a.jsx)(j.Textarea,{placeholder:"Type your message...",value:k,onChange:e=>C(e.target.value),rows:4,disabled:y}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)(j.Button,{onClick:D,disabled:y||!k.trim(),children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Send Message"]})})]})]})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(j.Card,{children:[(0,a.jsx)(j.CardHeader,{children:(0,a.jsx)(j.CardTitle,{className:"text-base",children:"Ticket Management"})}),(0,a.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Status"}),(0,a.jsxs)(j.Select,{value:x.status,onValueChange:e=>T(e),disabled:S||!P,children:[(0,a.jsx)(j.SelectTrigger,{children:(0,a.jsx)(j.SelectValue,{})}),(0,a.jsxs)(j.SelectContent,{children:[(0,a.jsx)(j.SelectItem,{value:"open",children:"Open"}),(0,a.jsx)(j.SelectItem,{value:"in_progress",children:"In Progress"}),(0,a.jsx)(j.SelectItem,{value:"waiting",children:"Waiting"}),(0,a.jsx)(j.SelectItem,{value:"resolved",children:"Resolved"}),(0,a.jsx)(j.SelectItem,{value:"closed",children:"Closed"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Priority"}),(0,a.jsxs)(j.Select,{value:x.priority,onValueChange:e=>Z(e),disabled:S||!P,children:[(0,a.jsx)(j.SelectTrigger,{children:(0,a.jsx)(j.SelectValue,{})}),(0,a.jsxs)(j.SelectContent,{children:[(0,a.jsx)(j.SelectItem,{value:"low",children:"Low"}),(0,a.jsx)(j.SelectItem,{value:"normal",children:"Normal"}),(0,a.jsx)(j.SelectItem,{value:"high",children:"High"}),(0,a.jsx)(j.SelectItem,{value:"urgent",children:"Urgent"})]})]})]})]})]}),(0,a.jsxs)(j.Card,{children:[(0,a.jsx)(j.CardHeader,{children:(0,a.jsx)(j.CardTitle,{className:"text-base",children:"Details"})}),(0,a.jsxs)(j.CardContent,{className:"space-y-3 text-sm",children:[x.ticket_type&&(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Type"}),(0,a.jsx)("div",{className:"text-muted-foreground capitalize",children:x.ticket_type.replace(/_/g," ")})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Created"}),(0,a.jsx)("div",{className:"text-muted-foreground",children:new Date(x.created_at).toLocaleString()})]})]}),x.last_response_at&&(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Last Update"}),(0,a.jsx)("div",{className:"text-muted-foreground",children:new Date(x.last_response_at).toLocaleString()})]})]}),x.service_address&&(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Service Address"}),(0,a.jsx)("div",{className:"text-muted-foreground",children:x.service_address})]})]}),x.affected_services.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Affected Services"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:x.affected_services.map(e=>(0,a.jsx)(j.Badge,{variant:"outline",className:"text-xs",children:e},e))})]}),x.sla_breached&&(0,a.jsxs)("div",{className:"flex items-start gap-2 text-destructive",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"SLA Breached"}),x.sla_due_date&&(0,a.jsxs)("div",{className:"text-xs",children:["Due: ",new Date(x.sla_due_date).toLocaleString()]})]})]}),x.resolution_time_minutes&&(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 text-green-500 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Resolution Time"}),(0,a.jsxs)("div",{className:"text-muted-foreground",children:[Math.floor(x.resolution_time_minutes/60),"h"," ",x.resolution_time_minutes%60,"m"]})]})]})]})]})]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsx)("div",{className:"text-muted-foreground",children:"Ticket not found"})})}function b({message:e,isFirst:s}){return e.sender_type,e.sender_type,(0,a.jsx)("div",{className:`${s?"border-l-4 border-primary pl-4":""}`,children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-accent flex items-center justify-center",children:(0,a.jsx)(x.Z,{className:"h-4 w-4 text-muted-foreground"})})}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium capitalize",children:e.sender_type}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleString()}),s&&(0,a.jsx)(j.Badge,{variant:"outline",className:"text-xs",children:"Initial Message"})]}),(0,a.jsx)("div",{className:"text-sm text-foreground whitespace-pre-wrap",children:e.body}),e.attachments.length>0&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.attachments.length," attachment",1!==e.attachments.length?"s":""]})]})]})})}function _({status:e}){let s={open:{variant:"default",label:"Open",icon:h.Z},in_progress:{variant:"secondary",label:"In Progress",icon:u.Z},waiting:{variant:"outline",label:"Waiting",icon:u.Z},resolved:{variant:"success",label:"Resolved",icon:m.Z},closed:{variant:"secondary",label:"Closed",icon:g.Z}}[e],t=s.icon;return(0,a.jsxs)(j.Badge,{variant:s.variant,children:[(0,a.jsx)(t,{className:"h-3 w-3 mr-1"}),s.label]})}function w({priority:e}){let s={low:{variant:"outline",label:"Low"},normal:{variant:"secondary",label:"Normal"},high:{variant:"default",label:"High"},urgent:{variant:"destructive",label:"Urgent"}}[e];return(0,a.jsx)(j.Badge,{variant:s.variant,children:s.label})}},37570:(e,s,t)=>{"use strict";t.d(s,{OG:()=>n,Q$:()=>d,Qr:()=>o,iU:()=>u,ky:()=>c,yB:()=>p});var a=t(17577),r=t(59341),i=t(29771);let l=e=>e instanceof Error?e:Error("string"==typeof e?e:String(e));function n(e={}){let{status:s,priority:t,search:n,autoRefresh:d=!1,refreshInterval:c=3e4}=e,[o,u]=(0,a.useState)([]),[p,m]=(0,a.useState)(!0),[x,h]=(0,a.useState)(null);return{tickets:o,loading:p,error:x,refetch:(0,a.useCallback)(async()=>{try{m(!0);let e={};s&&(e.status=s),t&&(e.priority=t),n&&(e.search=n);let a=await r.x1.get("/tickets",{params:e});u(a.data),h(null)}catch(e){i.k.error("Failed to fetch tickets",l(e),{status:s}),h(e.response?.data?.detail||"Failed to fetch tickets")}finally{m(!1)}},[s])}}function d(e,s=!1){let[t,n]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),[o,u]=(0,a.useState)(null);return{ticket:t,loading:d,error:o,refetch:(0,a.useCallback)(async()=>{if(!e){c(!1);return}try{c(!0);let s=await r.x1.get(`/tickets/${e}`);n(s.data),u(null)}catch(s){i.k.error("Failed to fetch ticket",l(s),{ticketId:e}),u(s.response?.data?.detail||"Failed to fetch ticket")}finally{c(!1)}},[e])}}function c(){let[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)(null);return{createTicket:(0,a.useCallback)(async e=>{try{return s(!0),n(null),(await r.x1.post("/tickets",e)).data}catch(s){return i.k.error("Failed to create ticket",l(s),{targetType:e.target_type}),n(s.response?.data?.detail||"Failed to create ticket"),null}finally{s(!1)}},[]),loading:e,error:t}}function o(){let[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)(null);return{updateTicket:(0,a.useCallback)(async(e,t)=>{try{return s(!0),n(null),(await r.x1.patch(`/tickets/${e}`,t)).data}catch(s){return i.k.error("Failed to update ticket",l(s),{ticketId:e}),n(s.response?.data?.detail||"Failed to update ticket"),null}finally{s(!1)}},[]),loading:e,error:t}}function u(){let[e,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)(null);return{addMessage:(0,a.useCallback)(async(e,t)=>{try{return s(!0),n(null),(await r.x1.post(`/tickets/${e}/messages`,t)).data}catch(s){return i.k.error("Failed to add ticket message",l(s),{ticketId:e}),n(s.response?.data?.detail||"Failed to add message"),null}finally{s(!1)}},[]),loading:e,error:t}}function p(){let[e,s]=(0,a.useState)(null),[t,n]=(0,a.useState)(!0),[d,c]=(0,a.useState)(null);return{stats:e,loading:t,error:d,refetch:(0,a.useCallback)(async()=>{try{n(!0);let e=(await r.x1.get("/tickets/metrics")).data;s({total:e.total??0,open:e.open??0,in_progress:e.in_progress??0,waiting:e.waiting??0,resolved:e.resolved??0,closed:e.closed??0,by_priority:{low:e.by_priority?.low??0,normal:e.by_priority?.normal??0,high:e.by_priority?.high??0,urgent:e.by_priority?.urgent??0},by_type:e.by_type||{},sla_breached:e.sla_breached??0,avg_resolution_time_minutes:e.avg_resolution_time_minutes??0}),c(null)}catch(e){i.k.error("Failed to fetch ticket stats",l(e)),c(e.response?.data?.detail||"Failed to fetch statistics")}finally{n(!1)}},[])}}},78542:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l,dynamic:()=>r,dynamicParams:()=>i});var a=t(68570);let r=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/support/[id]/page.tsx#dynamic`),i=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/support/[id]/page.tsx#dynamicParams`),l=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/support/[id]/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(92916));module.exports=a})();