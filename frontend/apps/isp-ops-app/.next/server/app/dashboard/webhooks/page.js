(()=>{var e={};e.id=5793,e.ids=[5793],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},23573:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d}),s(28260),s(13321),s(46366),s(96560);var r=s(23191),a=s(88716),o=s(37922),i=s.n(o),n=s(95231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(t,l);let d=["",{children:["dashboard",{children:["webhooks",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,28260)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/webhooks/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/webhooks/page.tsx"],u="/dashboard/webhooks/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/webhooks/page",pathname:"/dashboard/webhooks",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4306:(e,t,s)=>{Promise.resolve().then(s.bind(s,12089))},12089:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>W});var r=s(10326),a=s(17577),o=s(69669),i=s(50949),n=s(30361),l=s(70600),d=s(83855),c=s(88307),u=s(41137),m=s(3634),x=s(66697),h=s(37358),p=s(48998),g=s(15919),f=s(12714),b=s(12978),v=s(69508),j=s(98091),w=s(44976),y=s(48324),k=s(17010),N=s(59341),_=s(29771);let E=(e,t)=>e instanceof Error&&e.message||t,S=e=>({...e,name:e.custom_metadata?.name||e.description||"Webhook",user_id:"current-user",headers:e.custom_metadata?.headers||{},total_deliveries:e.success_count+e.failure_count,failed_deliveries:e.failure_count,has_secret:!0,last_delivery_at:e.last_triggered_at}),P={all:["webhooks"],subscriptions:()=>[...P.all,"subscriptions"],subscription:e=>[...P.subscriptions(),e],events:()=>[...P.all,"events"],deliveries:(e,t)=>[...P.all,"deliveries",e,t]};function C({onClose:e,onWebhookCreated:t,editingWebhook:s}){return(0,r.jsx)("div",{children:"CreateWebhookModal Placeholder"})}function F({webhook:e,onClose:t,onEdit:s,onDelete:a,onTest:o}){return(0,r.jsx)("div",{children:"WebhookDetailModal Placeholder"})}function D({webhook:e,onClose:t,onConfirm:s}){return(0,r.jsx)("div",{children:"DeleteConfirmModal Placeholder"})}function q({webhook:e,onClose:t}){return(0,r.jsx)("div",{children:"TestWebhookModal Placeholder"})}function W(){let{webhooks:e,loading:t,error:s,deleteWebhook:g}=function(e={}){let{page:t=1,limit:s=50,eventFilter:r,activeOnly:o=!1}=e,i=(0,w.NL)(),[n,l]=(0,a.useState)(null),[d,c]=(0,a.useState)([]),u=(0,a.useRef)(0),m=(e,t,s,r)=>{let a={page:e,limit:t,activeOnly:!!r};return s&&(a.eventFilter=s),a},x=async({targetPage:e,targetLimit:t,targetEventFilter:s,targetActiveOnly:r})=>{let a=new URLSearchParams;a.append("limit",t.toString()),a.append("offset",((e-1)*t).toString()),s&&a.append("event_type",s),r&&a.append("is_active","true");try{let o=((await N.x1.get(`/webhooks/subscriptions?${a.toString()}`)).data||[]).map(S);return i.setQueryData(P.subscription(m(e,t,s,r)),o),c(o),u.current=Date.now(),l(null),o}catch(t){_.k.error("Failed to fetch webhooks",t instanceof Error?t:Error(String(t)));let e=E(t,"Failed to fetch webhooks");throw l(e),Error(e)}},h=(0,y.a)({queryKey:P.subscription(m(t,s,r,o)),queryFn:async()=>x({targetPage:t,targetLimit:s,targetActiveOnly:o,...r?{targetEventFilter:r}:{}}),staleTime:3e4,refetchOnWindowFocus:!0}),p=(0,y.a)({queryKey:P.events(),queryFn:async()=>{try{let e=await N.x1.get("/webhooks/events"),t={},s=e.data,r=Array.isArray(s?.events)?s.events:null;if(!r)throw Error("Failed to fetch events");return r.forEach(e=>{t[e.event_type]={name:e.event_type.split(".").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),description:e.description}}),t}catch(s){let e=s instanceof Error?s:Error(String(s)),t=E(e,"Failed to fetch events");throw _.k.error("Failed to fetch events",e),console.error(e),Error(t)}},staleTime:3e5,enabled:h.isSuccess||h.isError,refetchOnWindowFocus:!1}),g=(0,k.D)({mutationFn:async e=>{let t={...e,custom_metadata:{...e.custom_metadata,name:e.name,headers:e.headers}};return S((await N.x1.post("/webhooks/subscriptions",t)).data)},onSuccess:e=>{l(null),u.current=Date.now(),c(t=>[e,...t]),i.setQueryData(P.subscription(m(t,s,r,o)),t=>t?[e,...t]:[e])},onError:e=>{_.k.error("Failed to create webhook",e instanceof Error?e:Error(String(e))),l(E(e,"Failed to create webhook"))}}),f=(0,k.D)({mutationFn:async({id:e,data:t})=>S((await N.x1.patch(`/webhooks/subscriptions/${e}`,t)).data),onSuccess:e=>{l(null),u.current=Date.now(),c(t=>t.map(t=>t.id===e.id?e:t)),i.setQueryData(P.subscription(m(t,s,r,o)),t=>t?t.map(t=>t.id===e.id?e:t):[e])},onError:e=>{_.k.error("Failed to update webhook",e instanceof Error?e:Error(String(e))),l(E(e,"Failed to update webhook"))}}),b=(0,k.D)({mutationFn:async e=>{await N.x1.delete(`/webhooks/subscriptions/${e}`)},onSuccess:(e,a)=>{l(null),u.current=Date.now(),c(e=>e.filter(e=>e.id!==a)),i.setQueryData(P.subscription(m(t,s,r,o)),e=>e?e.filter(e=>e.id!==a):[])},onError:e=>{_.k.error("Failed to delete webhook",e instanceof Error?e:Error(String(e))),l(E(e,"Failed to delete webhook"))}}),v=(0,k.D)({mutationFn:async({id:e,eventType:t,payload:s})=>{try{if(await Promise.resolve(),Math.random()>.3)return{success:!0,status_code:200,response_body:"OK",delivery_time_ms:Math.floor(500*Math.random()+100)};return{success:!1,status_code:500,error_message:"Internal Server Error",delivery_time_ms:Math.floor(1e3*Math.random()+200)}}catch(e){throw e instanceof Error?e:Error(E(e,"Test execution failed"))}}});return{webhooks:d,loading:h.isFetching||g.isPending||f.isPending||b.isPending,error:n,fetchWebhooks:async(e=t,a=s,i=r,n=o)=>{await x({targetPage:e,targetLimit:a,targetActiveOnly:n,...i?{targetEventFilter:i}:{}})},createWebhook:g.mutateAsync,updateWebhook:async(e,t)=>f.mutateAsync({id:e,data:t}),deleteWebhook:b.mutateAsync,testWebhook:async(e,t,s)=>v.mutateAsync(s?{id:e,eventType:t,payload:s}:{id:e,eventType:t}),getAvailableEvents:async()=>{if(p.data&&!p.isError)return p.data;if(p.isError)return{};try{let e=await p.refetch();if(e.data)return e.data;if(e.error)return{};return p.data??{}}catch{return{}}}}}(),[f,b]=(0,a.useState)(""),[v,j]=(0,a.useState)("all"),[W,A]=(0,a.useState)("all"),[M,L]=(0,a.useState)(!1),[T,U]=(0,a.useState)(null),[O,G]=(0,a.useState)(!1),[I,Q]=(0,a.useState)(!1),[$,K]=(0,a.useState)(null),[R,z]=(0,a.useState)(!1),[V,H]=(0,a.useState)(null),X=()=>{L(!0)},B=e=>{U(e),G(!0)},J=e=>{U(e),L(!0)},Y=e=>{K(e),Q(!0)},ee=e=>{H(e),z(!0)},et=async()=>{if($)try{await g($.id),Q(!1),K(null)}catch(e){console.error("Failed to delete webhook:",e)}},es=e.filter(e=>{let t=""===f||e.name?.toLowerCase().includes(f.toLowerCase())||e.url.toLowerCase().includes(f.toLowerCase())||e.description?.toLowerCase().includes(f.toLowerCase()),s="all"===v||e.events.includes(v),r="all"===W||"active"===W&&e.is_active||"inactive"===W&&!e.is_active;return t&&s&&r}),er=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ea=e=>{if(!e.is_active)return"text-muted-foreground bg-card0/20 border-border/30";let t=(e.total_deliveries??0)>0?(e.failed_deliveries??0)/(e.total_deliveries??0)*100:0;return t>20?"text-red-400 bg-red-500/20 border-red-500/30":t>10?"text-yellow-400 bg-yellow-500/20 border-yellow-500/30":"text-green-400 bg-green-500/20 border-green-500/30"},eo=e=>{if(!e.is_active)return"Inactive";let t=(e.total_deliveries??0)>0?(e.failed_deliveries??0)/(e.total_deliveries??0)*100:0;return t>20?"Issues":t>10?"Warning":"Healthy"},ei=e=>{if(!e.is_active)return o.Z;let t=(e.total_deliveries??0)>0?(e.failed_deliveries??0)/(e.total_deliveries??0)*100:0;return t>20?o.Z:t>10?i.Z:n.Z},en=[...new Set(e.flatMap(e=>e.events))];return s?(0,r.jsx)("div",{className:"min-h-screen bg-background p-6",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(i.Z,{className:"mx-auto h-12 w-12 text-red-400 mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Failed to load webhooks"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:s})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-background p-6",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-3",children:[(0,r.jsx)(l.Z,{className:"h-8 w-8 text-sky-400"}),"Webhooks"]}),(0,r.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage webhook subscriptions to receive real-time event notifications"})]}),(0,r.jsxs)("button",{onClick:X,className:"flex items-center gap-2 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white rounded-lg transition-colors",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),"Create Webhook"]})]}),(0,r.jsx)("div",{className:"bg-card rounded-lg p-6 mb-6",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsx)("input",{type:"text",placeholder:"Search webhooks...",value:f,onChange:e=>b(e.target.value),className:"flex-1 px-3 py-2 bg-accent border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsxs)("select",{value:v,onChange:e=>j(e.target.value),className:"px-3 py-2 bg-accent border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-sky-500",children:[(0,r.jsx)("option",{value:"all",children:"All Events"}),en.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("select",{value:W,onChange:e=>A(e.target.value),className:"px-3 py-2 bg-accent border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-sky-500",children:[(0,r.jsx)("option",{value:"all",children:"All Status"}),(0,r.jsx)("option",{value:"active",children:"Active"}),(0,r.jsx)("option",{value:"inactive",children:"Inactive"})]})]})}),(0,r.jsx)("div",{className:"bg-card rounded-lg overflow-hidden",children:t?(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-sky-500 border-t-transparent rounded-full mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Loading webhooks..."})]}):0===es.length?(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)(l.Z,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:0===e.length?"No webhooks yet":"No matching webhooks"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:0===e.length?"Create your first webhook to start receiving event notifications.":"Try adjusting your search criteria or filters."}),0===e.length&&(0,r.jsxs)("button",{onClick:X,className:"flex items-center gap-2 px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white rounded-lg transition-colors mx-auto",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),"Create First Webhook"]})]}):(0,r.jsx)("div",{className:"divide-y divide-border",children:es.map(e=>{let t=ei(e);return(0,r.jsx)("div",{className:"p-6 hover:bg-accent/50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-foreground",children:e.name}),(0,r.jsxs)("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium border ${ea(e)}`,children:[(0,r.jsx)(t,{className:"h-3 w-3"}),eo(e)]})]}),e.description&&(0,r.jsx)("p",{className:"text-muted-foreground mb-3",children:e.description}),(0,r.jsxs)("div",{className:"flex items-center gap-6 text-sm text-muted-foreground mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"font-mono text-xs",children:e.url})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:[e.events.length," events"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Created ",er(e.created_at)]})]}),e.last_delivery_at&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Last delivery ",er(e.last_delivery_at)]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.events.slice(0,3).map(e=>(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-sky-500/20 text-sky-400 border border-sky-500/30",children:e},e)),e.events.length>3&&(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-muted/20 text-muted-foreground border border-border/30",children:["+",e.events.length-3," more"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"font-medium text-foreground",children:e.total_deliveries}),(0,r.jsx)("div",{className:"text-xs",children:"Total"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"font-medium text-red-600 dark:text-red-400",children:e.failed_deliveries}),(0,r.jsx)("div",{className:"text-xs",children:"Failed"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"font-medium text-green-600 dark:text-green-400",children:[(e.total_deliveries??0)>0?Math.round(((e.total_deliveries??0)-(e.failed_deliveries??0))/(e.total_deliveries??0)*100):100,"%"]}),(0,r.jsx)("div",{className:"text-xs",children:"Success"})]})]})]})]}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(Z,{webhook:e,onView:B,onEdit:J,onDelete:Y,onTest:ee})})]})},e.id)})})}),M&&(0,r.jsx)(C,{onClose:()=>{L(!1),U(null)},onWebhookCreated:()=>{L(!1)},editingWebhook:T}),O&&T&&(0,r.jsx)(F,{webhook:T,onClose:()=>{G(!1),U(null)},onEdit:()=>{G(!1),L(!0)},onDelete:()=>{G(!1),Y(T)},onTest:()=>{G(!1),ee(T)}}),I&&$&&(0,r.jsx)(D,{webhook:$,onClose:()=>{Q(!1),K(null)},onConfirm:et}),R&&V&&(0,r.jsx)(q,{webhook:V,onClose:()=>{z(!1),H(null)}})]})})}function Z({webhook:e,onView:t,onEdit:s,onDelete:o,onTest:i}){let[n,l]=(0,a.useState)(!1);return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>l(!n),className:"text-muted-foreground hover:text-foreground transition-colors p-2",children:(0,r.jsx)(g.Z,{className:"h-4 w-4"})}),n&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-48 bg-accent rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-10",children:(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsxs)("button",{onClick:()=>{t(e),l(!1)},className:"flex items-center gap-2 px-4 py-2 text-sm text-muted-foreground hover:bg-muted w-full text-left",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4"}),"View Details"]}),(0,r.jsxs)("button",{onClick:()=>{i(e),l(!1)},className:"flex items-center gap-2 px-4 py-2 text-sm text-muted-foreground hover:bg-muted w-full text-left",children:[(0,r.jsx)(b.Z,{className:"h-4 w-4"}),"Test Webhook"]}),(0,r.jsxs)("button",{onClick:()=>{s(e),l(!1)},className:"flex items-center gap-2 px-4 py-2 text-sm text-muted-foreground hover:bg-muted w-full text-left",children:[(0,r.jsx)(v.Z,{className:"h-4 w-4"}),"Edit Webhook"]}),(0,r.jsxs)("button",{onClick:()=>{o(e),l(!1)},className:"flex items-center gap-2 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-muted w-full text-left",children:[(0,r.jsx)(j.Z,{className:"h-4 w-4"}),"Delete Webhook"]})]})})]})}},28260:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/webhooks/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[2793,1009,6226,657,6032,4218],()=>s(23573));module.exports=r})();