(()=>{var e={};e.id=538,e.ids=[538],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},69682:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>h,tree:()=>d}),r(20608),r(13321),r(46366),r(96560);var i=r(23191),t=r(88716),a=r(37922),n=r.n(a),l=r(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(s,o);let d=["",{children:["dashboard",{children:["pon",{children:["onus",{children:["discover",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,20608)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/pon/onus/discover/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/pon/onus/discover/page.tsx"],p="/dashboard/pon/onus/discover/page",u={require:r,loadChunk:()=>Promise.resolve()},h=new i.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/dashboard/pon/onus/discover/page",pathname:"/dashboard/pon/onus/discover",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},90063:(e,s,r)=>{Promise.resolve().then(r.bind(r,14126))},14126:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>g});var i=r(10326),t=r(17577),a=r(44976),n=r(48324),l=r(17010),o=r(48723),d=r(86333),c=r(21405),p=r(41291),u=r(88307),h=r(3634),m=r(94893),x=r(90434),v=r(20892),b=r(59341);let _={serial_number:"",olt_device_id:"",pon_port:0},f=e=>({...e,metadata:e.metadata??{}});function j(){let[e,s]=(0,t.useState)(""),[r,v]=(0,t.useState)(null),[j,g]=(0,t.useState)(_),N=(0,a.NL)(),{toast:y}=(0,o.useToast)(),{data:w=[],isLoading:C,refetch:P}=(0,n.a)({queryKey:["access-discover-onus"],queryFn:async()=>((await b.x1.get("/access/discover-onus")).data||[]).map(f)}),O=(0,l.D)({mutationFn:async e=>{let s={serial_number:e.serial_number,olt_device_id:e.olt_device_id,pon_port:e.pon_port};return e.subscriber_id&&(s.subscriber_id=e.subscriber_id),void 0!==e.vlan&&(s.vlan=e.vlan),e.bandwidth_profile&&(s.bandwidth_profile=e.bandwidth_profile),e.line_profile_id&&(s.line_profile_id=e.line_profile_id),e.service_profile_id&&(s.service_profile_id=e.service_profile_id),(await b.x1.post(`/access/olts/${encodeURIComponent(e.olt_device_id)}/onus`,s)).data},onSuccess:()=>{N.invalidateQueries({queryKey:["access-discover-onus"]}),N.invalidateQueries({queryKey:["access-devices"]}),v(null),g(_),y({title:"ONU provisioned successfully"})},onError:e=>{y({title:"Provisioning failed",description:e?.response?.data?.detail||e?.message||"Failed to provision ONU",variant:"destructive"})}}),q=(0,t.useMemo)(()=>{let s=e.trim().toLowerCase();return s?w.filter(e=>{let r=e.metadata||{},i=String(r.olt_id??"").toLowerCase(),t=String(r.vendor_id??"").toLowerCase();return e.serial_number.toLowerCase().includes(s)||i.includes(s)||t.includes(s)}):w},[w,e]),U=e=>{let s=e.metadata||{},r=Number(s.pon_port??s.port??0);v(e);let i={serial_number:e.serial_number,olt_device_id:String(s.olt_id??e.onu_id.split(":")[0]??""),pon_port:Number.isFinite(r)?r:0};s.subscriber_id&&(i.subscriber_id=s.subscriber_id),void 0!==s.vlan&&null!==s.vlan&&(i.vlan=Number(s.vlan)),s.bandwidth_profile&&(i.bandwidth_profile=s.bandwidth_profile),s.line_profile_id&&(i.line_profile_id=s.line_profile_id),s.service_profile_id&&(i.service_profile_id=s.service_profile_id),g(i)};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)(o.Button,{variant:"ghost",size:"icon",asChild:!0,children:(0,i.jsx)(x.default,{href:"/dashboard/pon/onus",children:(0,i.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold",children:"ONU Discovery"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Discover and provision new ONUs on the access network"})]})]}),(0,i.jsxs)(o.Button,{variant:"outline",onClick:()=>P(),disabled:C,children:[(0,i.jsx)(c.Z,{className:`h-4 w-4 mr-2 ${C?"animate-spin":""}`}),"Scan Network"]})]}),(0,i.jsx)(o.Card,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-900 dark:bg-blue-950/20",children:(0,i.jsx)(o.CardContent,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)(p.Z,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"About ONU Discovery"}),(0,i.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"This page scans registered OLTs for ONUs that are detected by drivers but have not yet been provisioned. Select a discovered ONU to review metadata and push service configuration."})]})]})})}),(0,i.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,i.jsxs)(o.Card,{children:[(0,i.jsx)(o.CardHeader,{children:(0,i.jsx)("div",{className:"flex items-center justify-between",children:(0,i.jsxs)("div",{children:[(0,i.jsxs)(o.CardTitle,{children:["Discovered ONUs (",q.length,")"]}),(0,i.jsx)(o.CardDescription,{children:"Results provided by access drivers"})]})})}),(0,i.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(u.Z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,i.jsx)(o.Input,{placeholder:"Search by serial number, vendor, or OLT...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),C?(0,i.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,i.jsx)(c.Z,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),(0,i.jsx)("p",{children:"Scanning network for ONUs..."})]}):0===q.length?(0,i.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:e?"No ONUs match your search":"No discovered ONUs found"}):(0,i.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:q.map(e=>{let s=e.metadata||{};return(0,i.jsxs)("button",{type:"button",className:`w-full text-left border rounded-lg p-3 transition-colors ${r?.serial_number===e.serial_number?"border-primary bg-accent":"hover:bg-accent"}`,onClick:()=>U(e),children:[(0,i.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(h.Z,{className:"h-4 w-4 text-amber-600"}),(0,i.jsx)("span",{className:"font-medium",children:e.serial_number})]}),(0,i.jsx)(o.Badge,{variant:"provisioned"===e.state.toLowerCase()?"secondary":"outline",children:e.state})]}),(0,i.jsxs)("div",{className:"text-xs space-y-1 text-muted-foreground",children:[(0,i.jsxs)("p",{children:["OLT: ",s.olt_id??"Unknown"]}),(0,i.jsxs)("p",{children:["PON Port: ",s.pon_port??"Unknown"]}),s.vendor_id&&(0,i.jsxs)("p",{children:["Vendor: ",s.vendor_id]}),s.rssi&&(0,i.jsxs)("p",{children:["RSSI: ",s.rssi]})]})]},`${e.serial_number}-${s.olt_id??""}-${s.pon_port??""}`)})})]})]}),(0,i.jsxs)(o.Card,{children:[(0,i.jsxs)(o.CardHeader,{children:[(0,i.jsx)(o.CardTitle,{children:"Provision ONU"}),(0,i.jsx)(o.CardDescription,{children:"Configure and activate the selected ONU"})]}),(0,i.jsx)(o.CardContent,{className:"space-y-4",children:r?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"serial",children:"Serial Number *"}),(0,i.jsx)(o.Input,{id:"serial",value:j.serial_number,readOnly:!0})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"olt",children:"OLT Device ID *"}),(0,i.jsx)(o.Input,{id:"olt",value:j.olt_device_id,onChange:e=>g({...j,olt_device_id:e.target.value})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"port",children:"PON Port *"}),(0,i.jsx)(o.Input,{id:"port",type:"number",value:j.pon_port,onChange:e=>g({...j,pon_port:Number.isFinite(parseInt(e.target.value,10))?parseInt(e.target.value,10):0})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"subscriber",children:"Subscriber ID (Optional)"}),(0,i.jsx)(o.Input,{id:"subscriber",placeholder:"Enter subscriber ID",value:j.subscriber_id||"",onChange:e=>{let s=e.target.value.trim();g(e=>{let r={...e};return s?r.subscriber_id=s:delete r.subscriber_id,r})}})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"vlan",children:"Service VLAN (Optional)"}),(0,i.jsx)(o.Input,{id:"vlan",type:"number",placeholder:"e.g., 100",value:j.vlan??"",onChange:e=>{let s=e.target.value;g(e=>{let r={...e};if(s){let e=parseInt(s,10);Number.isNaN(e)?delete r.vlan:r.vlan=e}else delete r.vlan;return r})}})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"bandwidth",children:"Bandwidth Profile (Optional)"}),(0,i.jsx)(o.Input,{id:"bandwidth",placeholder:"e.g., 100M",value:j.bandwidth_profile||"",onChange:e=>{let s=e.target.value.trim();g(e=>{let r={...e};return s?r.bandwidth_profile=s:delete r.bandwidth_profile,r})}})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"line-profile",children:"Line Profile ID (Optional)"}),(0,i.jsx)(o.Input,{id:"line-profile",placeholder:"Driver-specific line profile",value:j.line_profile_id||"",onChange:e=>{let s=e.target.value.trim();g(e=>{let r={...e};return s?r.line_profile_id=s:delete r.line_profile_id,r})}})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.Label,{htmlFor:"service-profile",children:"Service Profile ID (Optional)"}),(0,i.jsx)(o.Input,{id:"service-profile",placeholder:"Driver-specific service profile",value:j.service_profile_id||"",onChange:e=>{let s=e.target.value.trim();g(e=>{let r={...e};return s?r.service_profile_id=s:delete r.service_profile_id,r})}})]}),(0,i.jsxs)("div",{className:"pt-4 flex gap-2",children:[(0,i.jsx)(o.Button,{variant:"outline",onClick:()=>{v(null),g(_)},className:"flex-1",children:"Cancel"}),(0,i.jsxs)(o.Button,{onClick:()=>{if(!j.serial_number||!j.olt_device_id){y({title:"Missing required fields",description:"Serial number and OLT device ID are required",variant:"destructive"});return}O.mutate(j)},disabled:O.isPending,className:"flex-1",children:[(0,i.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Provision ONU"]})]})]}):(0,i.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,i.jsx)(p.Z,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,i.jsx)("p",{children:"Select a discovered ONU to begin provisioning"})]})})]})]})]})}function g(){return(0,i.jsx)(v.eu,{permission:"isp.network['pon'].write",children:(0,i.jsx)(j,{})})}},20608:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>i});let i=(0,r(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/pon/onus/discover/page.tsx#default`)}};var s=require("../../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),i=s.X(0,[2793,1009,6226,657,6032,4218],()=>r(69682));module.exports=i})();