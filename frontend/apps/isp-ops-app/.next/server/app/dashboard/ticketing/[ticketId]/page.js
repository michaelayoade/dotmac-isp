(()=>{var e={};e.id=9611,e.ids=[9611],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},68525:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>p,tree:()=>c}),t(80249),t(13321),t(46366),t(96560);var a=t(23191),r=t(88716),i=t(37922),l=t.n(i),n=t(95231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(s,d);let c=["",{children:["dashboard",{children:["ticketing",{children:["[ticketId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,80249)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/ticketing/[ticketId]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/ticketing/[ticketId]/page.tsx"],x="/dashboard/ticketing/[ticketId]/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/ticketing/[ticketId]/page",pathname:"/dashboard/ticketing/[ticketId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},58405:(e,s,t)=>{Promise.resolve().then(t.bind(t,77607))},77607:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>w});var a=t(10326),r=t(17577),i=t(44976),l=t(48324),n=t(17010),d=t(48723),c=t(41291),o=t(3240),x=t(48998),m=t(30361),p=t(69669),u=t(86333),h=t(79635),g=t(37358),j=t(69436),f=t(93158),v=t(20892),N=t(90434),y=t(35047),b=t(34041);function C(){var e;let s=(0,y.useParams)(),t=s?.ticketId,{api:v}=(0,f.M)(),C=v.baseUrl||"",w=(0,i.NL)(),{toast:k}=(0,d.useToast)(),[P,_]=(0,r.useState)(""),[T,S]=(0,r.useState)(!1),{data:q,isLoading:I}=(0,l.a)({queryKey:["ticket",C,t],queryFn:async()=>{let e=await fetch(`${C}/api/v1/tickets/${t}`,{credentials:"include"});if(!e.ok)throw Error("Failed to fetch ticket");return e.json()},enabled:!!t}),{data:D=[]}=(0,l.a)({queryKey:["ticket-messages",C,t],queryFn:async()=>{let e=await fetch(`${C}/api/v1/tickets/${t}/messages`,{credentials:"include"});if(!e.ok)throw Error("Failed to fetch messages");return(await e.json()).messages||[]},enabled:!!t,refetchInterval:1e4}),U=(0,n.D)({mutationFn:async e=>{let s=await fetch(`${C}/api/v1/tickets/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!s.ok)throw Error("Failed to update ticket");return s.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["ticket",C,t]}),w.invalidateQueries({queryKey:["tickets"]}),k({title:"Ticket updated successfully"})},onError:e=>{k({title:"Failed to update ticket",description:e.message,variant:"destructive"})}}),F=(0,n.D)({mutationFn:async e=>{let s=await fetch(`${C}/api/v1/tickets/${t}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e,is_internal:T})});if(!s.ok)throw Error("Failed to add message");return s.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["ticket-messages",C,t]}),_(""),S(!1),k({title:"Message added successfully"})},onError:e=>{k({title:"Failed to add message",description:e.message,variant:"destructive"})}});return I?(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsx)(o.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):q?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d.Button,{variant:"outline",size:"icon",asChild:!0,children:(0,a.jsx)(N.default,{href:"/dashboard/ticketing",children:(0,a.jsx)(u.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold font-mono",children:q.ticket_number}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:q.subject})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{let s={open:{icon:c.Z,color:"bg-blue-100 text-blue-800",label:"Open"},in_progress:{icon:o.Z,color:"bg-yellow-100 text-yellow-800",label:"In Progress"},waiting:{icon:x.Z,color:"bg-orange-100 text-orange-800",label:"Waiting"},resolved:{icon:m.Z,color:"bg-green-100 text-green-800",label:"Resolved"},closed:{icon:p.Z,color:"bg-gray-100 text-gray-800",label:"Closed"}},t=s[e]||s.open,r=t.icon;return(0,a.jsxs)(d.Badge,{className:t.color,children:[(0,a.jsx)(r,{className:"h-3 w-3 mr-1"}),t.label]})})(q.status),(e=q.priority,(0,a.jsx)(d.Badge,{className:{low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800",children:e.toUpperCase()}))]})]}),(0,a.jsx)(d.Card,{children:(0,a.jsx)(d.CardContent,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(d.Select,{value:q.status,onValueChange:e=>U.mutate({status:e}),disabled:U.isPending,children:[(0,a.jsx)(d.SelectTrigger,{className:"w-[180px]",children:(0,a.jsx)(d.SelectValue,{placeholder:"Status"})}),(0,a.jsxs)(d.SelectContent,{children:[(0,a.jsx)(d.SelectItem,{value:"open",children:"Open"}),(0,a.jsx)(d.SelectItem,{value:"in_progress",children:"In Progress"}),(0,a.jsx)(d.SelectItem,{value:"waiting",children:"Waiting"}),(0,a.jsx)(d.SelectItem,{value:"resolved",children:"Resolved"}),(0,a.jsx)(d.SelectItem,{value:"closed",children:"Closed"})]})]}),(0,a.jsxs)(d.Select,{value:q.priority,onValueChange:e=>U.mutate({priority:e}),disabled:U.isPending,children:[(0,a.jsx)(d.SelectTrigger,{className:"w-[180px]",children:(0,a.jsx)(d.SelectValue,{placeholder:"Priority"})}),(0,a.jsxs)(d.SelectContent,{children:[(0,a.jsx)(d.SelectItem,{value:"low",children:"Low"}),(0,a.jsx)(d.SelectItem,{value:"medium",children:"Medium"}),(0,a.jsx)(d.SelectItem,{value:"high",children:"High"}),(0,a.jsx)(d.SelectItem,{value:"urgent",children:"Urgent"})]})]})]})})}),(0,a.jsxs)(d.Tabs,{defaultValue:"overview",className:"space-y-4",children:[(0,a.jsxs)(d.TabsList,{children:[(0,a.jsx)(d.TabsTrigger,{value:"overview",children:"Overview"}),(0,a.jsxs)(d.TabsTrigger,{value:"messages",children:["Messages (",D.length,")"]}),(0,a.jsx)(d.TabsTrigger,{value:"details",children:"Details"})]}),(0,a.jsxs)(d.TabsContent,{value:"overview",className:"space-y-4",children:[(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-lg",children:"Description"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:q.description})})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-lg",children:"Customer Information"})}),(0,a.jsxs)(d.CardContent,{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Name"}),(0,a.jsx)("p",{className:"font-medium",children:q.customer_name||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Email"}),(0,a.jsx)("p",{className:"font-medium",children:q.customer_email||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Customer ID"}),(0,a.jsx)("p",{className:"font-medium font-mono",children:q.customer_id||"N/A"})]}),q.organization_slug&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Organization"}),(0,a.jsx)("p",{className:"font-medium",children:q.organization_slug})]})]})]}),(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-lg",children:"Ticket Information"})}),(0,a.jsxs)(d.CardContent,{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Category"}),(0,a.jsx)("p",{className:"font-medium",children:q.category||"General"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Assigned To"}),(0,a.jsx)("p",{className:"font-medium",children:q.assigned_to||"Unassigned"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Created"}),(0,a.jsx)("p",{className:"font-medium",children:(0,b.WU)(new Date(q.created_at),"PPpp")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Last Updated"}),(0,a.jsx)("p",{className:"font-medium",children:(0,b.WU)(new Date(q.updated_at),"PPpp")})]}),q.resolved_at&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Resolved"}),(0,a.jsx)("p",{className:"font-medium",children:(0,b.WU)(new Date(q.resolved_at),"PPpp")})]}),q.closed_at&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Closed"}),(0,a.jsx)("p",{className:"font-medium",children:(0,b.WU)(new Date(q.closed_at),"PPpp")})]})]})]})]}),q.tags&&q.tags.length>0&&(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-lg",children:"Tags"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:q.tags.map((e,s)=>(0,a.jsx)(d.Badge,{variant:"outline",children:e},s))})})]})]}),(0,a.jsxs)(d.TabsContent,{value:"messages",className:"space-y-4",children:[(0,a.jsx)("div",{className:"space-y-4",children:0===D.length?(0,a.jsx)(d.Card,{children:(0,a.jsx)(d.CardContent,{className:"py-8 text-center text-muted-foreground",children:"No messages yet"})}):D.map(e=>(0,a.jsxs)(d.Card,{className:e.is_internal?"border-yellow-200 bg-yellow-50/50":"",children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(h.Z,{className:`h-8 w-8 ${e.is_staff?"text-primary":"text-muted-foreground"}`}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.CardTitle,{className:"text-base",children:e.author_name||e.author_email||"Unknown"}),(0,a.jsxs)(d.CardDescription,{className:"flex items-center gap-2",children:[(0,a.jsx)(g.Z,{className:"h-3 w-3"}),(0,b.WU)(new Date(e.created_at),"PPpp")]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.is_staff&&(0,a.jsx)(d.Badge,{className:"bg-purple-100 text-purple-800",children:"Staff"}),e.is_internal&&(0,a.jsx)(d.Badge,{className:"bg-yellow-100 text-yellow-800",children:"Internal"})]})]})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:e.content})})]},e.id))}),(0,a.jsxs)(d.Card,{children:[(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsx)(d.CardTitle,{className:"text-lg",children:"Add Message"}),(0,a.jsx)(d.CardDescription,{children:"Reply to this ticket"})]}),(0,a.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,a.jsx)(d.Textarea,{placeholder:"Type your message here...",value:P,onChange:e=>_(e.target.value),rows:4}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"internal",checked:T,onChange:e=>S(e.target.checked),className:"rounded"}),(0,a.jsx)("label",{htmlFor:"internal",className:"text-sm text-muted-foreground cursor-pointer",children:"Internal note (not visible to customer)"})]}),(0,a.jsxs)(d.Button,{onClick:()=>F.mutate(P),disabled:!P.trim()||F.isPending,children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Send Message"]})]})]})]})]}),(0,a.jsx)(d.TabsContent,{value:"details",className:"space-y-4",children:(0,a.jsxs)(d.Card,{children:[(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsx)(d.CardTitle,{className:"text-lg",children:"Metadata"}),(0,a.jsx)(d.CardDescription,{children:"Additional ticket information"})]}),(0,a.jsx)(d.CardContent,{children:q.metadata?(0,a.jsx)("pre",{className:"p-4 bg-accent rounded-lg overflow-x-auto text-sm",children:JSON.stringify(q.metadata,null,2)}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"No additional metadata"})})]})})]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-96",children:[(0,a.jsx)(c.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Ticket Not Found"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"The ticket you're looking for doesn't exist."}),(0,a.jsx)(d.Button,{asChild:!0,children:(0,a.jsxs)(N.default,{href:"/dashboard/ticketing",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Back to Tickets"]})})]})}function w(){return(0,a.jsx)(v.eu,{permission:"tickets:read",children:(0,a.jsx)(C,{})})}},80249:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/ticketing/[ticketId]/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(68525));module.exports=a})();