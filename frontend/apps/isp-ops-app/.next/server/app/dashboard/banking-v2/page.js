(()=>{var e={};e.id=7076,e.ids=[7076],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},40245:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>o,routeModule:()=>h,tree:()=>d}),t(32380),t(13321),t(46366),t(96560);var s=t(23191),n=t(88716),r=t(37922),i=t.n(r),c=t(95231),l={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>c[e]);t.d(a,l);let d=["",{children:["dashboard",{children:["banking-v2",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,32380)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/banking-v2/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/banking-v2/page.tsx"],u="/dashboard/banking-v2/page",m={require:t,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/dashboard/banking-v2/page",pathname:"/dashboard/banking-v2",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},12896:(e,a,t)=>{Promise.resolve().then(t.bind(t,7672))},7672:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>J,dynamic:()=>Q,dynamicParams:()=>V});var s=t(10326),n=t(17577),r=t(48723),i=t(59734),c=t(95964),l=t(71383),d=t(30361),o=t(48998),u=t(69669),m=t(83855),h=t(39447),x=t(12714),p=t(71821),j=t(48324),g=t(44976),y=t(17010),b=t(36607);class v{buildUrl(e){let a=b.LM.api?.buildUrl;if(a)return a(e);let t=b.LM.api?.baseUrl??"",s=b.LM.api?.prefix??"",n=t.endsWith("/")?t.slice(0,-1):t,r=s?s.startsWith("/")?s.replace(/\/$/,""):`/${s.replace(/\/$/,"")}`:"",i=e.startsWith("/")?e:`/${e}`;return`${n}${r}${i}`||i}getAuthHeaders(){let e=localStorage.getItem("access_token");return{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}async createBankAccount(e){let a=await fetch(this.buildUrl("/billing/bank-accounts"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to create bank account");return a.json()}async listBankAccounts(e=!1){let a=new URLSearchParams;e&&a.append("include_inactive","true");let t=await fetch(this.buildUrl(`/billing/bank-accounts?${a.toString()}`),{headers:this.getAuthHeaders()});if(!t.ok)throw Error((await t.json().catch(()=>({}))).detail||"Failed to list bank accounts");return t.json()}async getBankAccount(e){let a=await fetch(this.buildUrl(`/billing/bank-accounts/${e}`),{headers:this.getAuthHeaders()});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to get bank account");return a.json()}async getBankAccountSummary(e){let a=await fetch(this.buildUrl(`/billing/bank-accounts/${e}/summary`),{headers:this.getAuthHeaders()});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to get bank account summary");return a.json()}async updateBankAccount(e,a){let t=await fetch(this.buildUrl(`/billing/bank-accounts/${e}`),{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify(a)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).detail||"Failed to update bank account");return t.json()}async verifyBankAccount(e,a){let t=new URLSearchParams;a&&t.append("notes",a);let s=await fetch(this.buildUrl(`/billing/bank-accounts/${e}/verify?${t.toString()}`),{method:"POST",headers:this.getAuthHeaders()});if(!s.ok)throw Error((await s.json().catch(()=>({}))).detail||"Failed to verify bank account");return s.json()}async deactivateBankAccount(e){let a=await fetch(this.buildUrl(`/billing/bank-accounts/${e}`),{method:"DELETE",headers:this.getAuthHeaders()});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to deactivate bank account");return a.json()}async recordCashPayment(e){let a=await fetch(this.buildUrl("/billing/payments/cash"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to record cash payment");return a.json()}async recordCheckPayment(e){let a=await fetch(this.buildUrl("/billing/payments/check"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to record check payment");return a.json()}async recordBankTransfer(e){let a=await fetch(this.buildUrl("/billing/payments/bank-transfer"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to record bank transfer");return a.json()}async recordMobileMoney(e){let a=await fetch(this.buildUrl("/billing/payments/mobile-money"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to record mobile money payment");return a.json()}async searchPayments(e,a=100,t=0){let s=new URLSearchParams;s.set("limit",String(Math.max(0,a))),s.set("offset",String(Math.max(0,t)));let n=await fetch(this.buildUrl(`/billing/payments/search?${s.toString()}`),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!n.ok)throw Error((await n.json().catch(()=>({}))).detail||"Failed to search payments");return n.json()}async verifyPayment(e,a){let t=new URLSearchParams;a&&t.append("notes",a);let s=await fetch(this.buildUrl(`/billing/payments/${e}/verify?${t.toString()}`),{method:"POST",headers:this.getAuthHeaders()});if(!s.ok)throw Error((await s.json().catch(()=>({}))).detail||"Failed to verify payment");return s.json()}async reconcilePayments(e){let a=await fetch(this.buildUrl("/billing/payments/reconcile"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to reconcile payments");return a.json()}async uploadPaymentAttachment(e,a){let t=localStorage.getItem("access_token"),s=new FormData;s.append("file",a);let n=await fetch(this.buildUrl(`/billing/payments/${e}/attachments`),{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s});if(!n.ok)throw Error((await n.json().catch(()=>({}))).detail||"Failed to upload attachment");return n.json()}}let f=new v;function _(e=!1){return(0,j.a)({queryKey:["bank-accounts",e],queryFn:()=>f.listBankAccounts(e),staleTime:3e4})}function N(e){return(0,j.a)({queryKey:["manual-payments",e],queryFn:()=>f.searchPayments(e||{}),staleTime:3e4})}let k=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:e=>f.recordBankTransfer(e),onSuccess:()=>{e.invalidateQueries({queryKey:["manual-payments"]}),e.invalidateQueries({queryKey:["bank-account-summary"]}),a({title:"Bank Transfer Recorded",description:"The bank transfer has been recorded successfully."})},onError:e=>{a({title:"Recording Failed",description:e.message||"Failed to record bank transfer",variant:"destructive"})}})},w=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:e=>f.recordMobileMoney(e),onSuccess:()=>{e.invalidateQueries({queryKey:["manual-payments"]}),e.invalidateQueries({queryKey:["bank-account-summary"]}),a({title:"Mobile Money Recorded",description:"The mobile money payment has been recorded successfully."})},onError:e=>{a({title:"Recording Failed",description:e.message||"Failed to record mobile money payment",variant:"destructive"})}})};var C=t(77506);function S({open:e,onOpenChange:a,account:t,onSuccess:i}){let c=!!t,l=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:e=>f.createBankAccount(e),onSuccess:()=>{e.invalidateQueries({queryKey:["bank-accounts"]}),a({title:"Bank Account Created",description:"The bank account has been created successfully."})},onError:e=>{a({title:"Creation Failed",description:e.message||"Failed to create bank account",variant:"destructive"})}})}(),d=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:({accountId:e,data:a})=>f.updateBankAccount(e,a),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["bank-accounts"]}),e.invalidateQueries({queryKey:["bank-account",s.accountId]}),e.invalidateQueries({queryKey:["bank-account-summary",s.accountId]}),a({title:"Bank Account Updated",description:"The bank account has been updated successfully."})},onError:e=>{a({title:"Update Failed",description:e.message||"Failed to update bank account",variant:"destructive"})}})}(),[o,u]=(0,n.useState)({account_name:"",account_nickname:"",bank_name:"",bank_address:"",bank_country:"US",account_type:"business",currency:"USD",account_number:"",routing_number:"",swift_code:"",iban:"",is_primary:!1,accepts_deposits:!0,notes:""}),m=async e=>{e.preventDefault(),c&&t?await d.mutateAsync({accountId:t.id,data:{account_nickname:o.account_nickname||null,bank_address:o.bank_address||null,is_primary:o.is_primary??null,accepts_deposits:o.accepts_deposits??null,notes:o.notes||null}}):await l.mutateAsync(o),i?.()},h=l.isPending||d.isPending;return(0,s.jsx)(r.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(r.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(r.DialogHeader,{children:[(0,s.jsx)(r.DialogTitle,{children:c?"Edit Bank Account":"Add Bank Account"}),(0,s.jsx)(r.DialogDescription,{children:c?"Update bank account information. Account number cannot be changed.":"Add a new company bank account for receiving payments."})]}),(0,s.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"account_name",children:"Account Holder Name *"}),(0,s.jsx)(r.Input,{id:"account_name",value:o.account_name,onChange:e=>u({...o,account_name:e.target.value}),required:!0,disabled:c,placeholder:"Acme Corporation"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"account_nickname",children:"Nickname (optional)"}),(0,s.jsx)(r.Input,{id:"account_nickname",value:o.account_nickname??"",onChange:e=>u({...o,account_nickname:e.target.value}),placeholder:"Operating Account"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"bank_name",children:"Bank Name *"}),(0,s.jsx)(r.Input,{id:"bank_name",value:o.bank_name,onChange:e=>u({...o,bank_name:e.target.value}),required:!0,disabled:c,placeholder:"First National Bank"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"bank_country",children:"Bank Country *"}),(0,s.jsx)(r.Input,{id:"bank_country",value:o.bank_country,onChange:e=>u({...o,bank_country:e.target.value.toUpperCase()}),required:!0,disabled:c,maxLength:2,placeholder:"US"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"bank_address",children:"Bank Address"}),(0,s.jsx)(r.Input,{id:"bank_address",value:o.bank_address??"",onChange:e=>u({...o,bank_address:e.target.value}),placeholder:"123 Main St, City, State, ZIP"})]}),!c&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"account_number",children:"Account Number *"}),(0,s.jsx)(r.Input,{id:"account_number",type:"password",value:o.account_number,onChange:e=>u({...o,account_number:e.target.value}),required:!0,placeholder:"Full account number"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Only the last 4 digits will be stored and displayed"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"account_type",children:"Account Type *"}),(0,s.jsxs)(r.Select,{value:o.account_type,onValueChange:e=>u({...o,account_type:e}),disabled:c,children:[(0,s.jsx)(r.SelectTrigger,{id:"account_type",children:(0,s.jsx)(r.SelectValue,{})}),(0,s.jsxs)(r.SelectContent,{children:[(0,s.jsx)(r.SelectItem,{value:"checking",children:"Checking"}),(0,s.jsx)(r.SelectItem,{value:"savings",children:"Savings"}),(0,s.jsx)(r.SelectItem,{value:"business",children:"Business"}),(0,s.jsx)(r.SelectItem,{value:"money_market",children:"Money Market"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"currency",children:"Currency *"}),(0,s.jsx)(r.Input,{id:"currency",value:o.currency,onChange:e=>u({...o,currency:e.target.value.toUpperCase()}),required:!0,disabled:c,maxLength:3,placeholder:"USD"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"routing_number",children:"Routing Number"}),(0,s.jsx)(r.Input,{id:"routing_number",value:o.routing_number??"",onChange:e=>u({...o,routing_number:e.target.value}),disabled:c,placeholder:"123456789"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"swift_code",children:"SWIFT/BIC Code"}),(0,s.jsx)(r.Input,{id:"swift_code",value:o.swift_code??"",onChange:e=>u({...o,swift_code:e.target.value.toUpperCase()}),disabled:c,maxLength:11,placeholder:"ABCDUS33XXX"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"iban",children:"IBAN"}),(0,s.jsx)(r.Input,{id:"iban",value:o.iban??"",onChange:e=>u({...o,iban:e.target.value.toUpperCase()}),disabled:c,maxLength:34,placeholder:"GB82WEST..."})]})]}),(0,s.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.Label,{htmlFor:"is_primary",children:"Primary Account"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Use this account as the primary payout account"})]}),(0,s.jsx)(r.Switch,{id:"is_primary",checked:!!o.is_primary,onCheckedChange:e=>u({...o,is_primary:e})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.Label,{htmlFor:"accepts_deposits",children:"Accepts Deposits"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Can this account receive customer payments"})]}),(0,s.jsx)(r.Switch,{id:"accepts_deposits",checked:!!o.accepts_deposits,onCheckedChange:e=>u({...o,accepts_deposits:e})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"notes",children:"Internal Notes"}),(0,s.jsx)(r.Textarea,{id:"notes",value:o.notes??"",onChange:e=>u({...o,notes:e.target.value}),placeholder:"Add any internal notes about this account...",rows:3})]}),(0,s.jsxs)(r.DialogFooter,{children:[(0,s.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:h,children:"Cancel"}),(0,s.jsxs)(r.Button,{type:"submit",disabled:h,children:[h&&(0,s.jsx)(C.Z,{className:"h-4 w-4 mr-2 animate-spin"}),c?"Update Account":"Create Account"]})]})]})]})})}var D=t(17069),T=t(37358);function F({open:e,onOpenChange:a,accountId:t}){let{data:n,isLoading:c}=(0,j.a)({queryKey:["bank-account-summary",t],queryFn:()=>f.getBankAccountSummary(t),enabled:!!t});return t?(0,s.jsx)(r.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(r.DialogContent,{className:"max-w-2xl",children:[(0,s.jsxs)(r.DialogHeader,{children:[(0,s.jsx)(r.DialogTitle,{children:"Bank Account Details"}),(0,s.jsx)(r.DialogDescription,{children:"View account information and statistics"})]}),c?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(r.Skeleton,{className:"h-32 w-full"}),(0,s.jsx)(r.Skeleton,{className:"h-32 w-full"})]}):n?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"pt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-lg",children:n.account.account_nickname||n.account.account_name}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:n.account.bank_name})]}),(0,s.jsx)(r.Badge,{children:n.account.status.charAt(0).toUpperCase()+n.account.status.slice(1)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Account Number"}),(0,s.jsxs)("p",{className:"font-mono",children:["****",n.account.account_number_last_four]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Account Type"}),(0,s.jsx)("p",{className:"capitalize",children:n.account.account_type.replace("_"," ")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Currency"}),(0,s.jsx)("p",{children:n.account.currency})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Country"}),(0,s.jsx)("p",{children:n.account.bank_country})]}),n.account.routing_number&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Routing"}),(0,s.jsx)("p",{className:"font-mono",children:n.account.routing_number})]}),n.account.swift_code&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"SWIFT"}),(0,s.jsx)("p",{className:"font-mono",children:n.account.swift_code})]}),n.account.iban&&(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"IBAN"}),(0,s.jsx)("p",{className:"font-mono",children:n.account.iban})]})]}),n.account.notes&&(0,s.jsxs)("div",{className:"border-t pt-4",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Notes"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:n.account.notes})]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"pt-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(D.Z,{className:"h-4 w-4 text-green-500"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"MTD Deposits"})]}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[n.account.currency," ",n.total_deposits_mtd.toFixed(2)]})]})}),(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"pt-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4 text-blue-500"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"YTD Deposits"})]}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[n.account.currency," ",n.total_deposits_ytd.toFixed(2)]})]})}),(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"pt-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4 text-orange-500"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Pending Payments"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:n.pending_payments})]})}),(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"pt-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(T.Z,{className:"h-4 w-4 text-purple-500"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Last Reconciled"})]}),(0,s.jsx)("p",{className:"text-sm font-medium",children:n.last_reconciliation?new Date(n.last_reconciliation).toLocaleDateString():"Never"})]})})]}),null!==n.current_balance&&(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Current Balance"}),(0,s.jsxs)("p",{className:"text-xl font-bold",children:[n.account.currency," ",n.current_balance.toFixed(2)]})]})})})]}):(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Account not found"})]})}):null}function A(){let[e,a]=(0,n.useState)(!1),[t,c]=(0,n.useState)(null),[l,j]=(0,n.useState)(!1),[b,v]=(0,n.useState)(!1),{data:N,isLoading:k}=_(b),w=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:({accountId:e,notes:a})=>f.verifyBankAccount(e,a),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["bank-accounts"]}),e.invalidateQueries({queryKey:["bank-account",s.accountId]}),e.invalidateQueries({queryKey:["bank-account-summary",s.accountId]}),a({title:"Bank Account Verified",description:"The bank account has been verified successfully."})},onError:e=>{a({title:"Verification Failed",description:e.message||"Failed to verify bank account",variant:"destructive"})}})}(),C=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:e=>f.deactivateBankAccount(e),onSuccess:()=>{e.invalidateQueries({queryKey:["bank-accounts"]}),a({title:"Bank Account Deactivated",description:"The bank account has been deactivated successfully."})},onError:e=>{a({title:"Deactivation Failed",description:e.message||"Failed to deactivate bank account",variant:"destructive"})}})}(),D=(0,r.useConfirmDialog)(),T=e=>{switch(e){case"verified":return(0,s.jsx)(d.Z,{className:"h-4 w-4 text-green-500"});case"pending":return(0,s.jsx)(o.Z,{className:"h-4 w-4 text-yellow-500"});case"failed":return(0,s.jsx)(u.Z,{className:"h-4 w-4 text-red-500"});default:return(0,s.jsx)(o.Z,{className:"h-4 w-4 text-gray-500"})}},A=e=>(0,s.jsx)(r.Badge,{variant:{verified:"default",pending:"secondary",failed:"destructive",suspended:"outline"}[e]||"outline",children:e.charAt(0).toUpperCase()+e.slice(1)}),P=e=>{c(e),j(!0)},I=e=>{c(e),a(!0)},B=async e=>{await w.mutateAsync({accountId:e,notes:"Verified via banking dashboard"})},L=async e=>{await D({title:"Deactivate bank account",description:"Are you sure you want to deactivate this bank account?",confirmText:"Deactivate",variant:"destructive"})&&await C.mutateAsync(e)};return k?(0,s.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,a)=>(0,s.jsx)(r.Skeleton,{className:"h-32 w-full"},a))}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold",children:"Bank Accounts"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage company bank accounts for receiving payments"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.Button,{variant:"outline",onClick:()=>v(!b),children:b?"Hide Inactive":"Show Inactive"}),(0,s.jsxs)(r.Button,{onClick:()=>{c(null),a(!0)},children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Add Bank Account"]})]})]}),N&&0!==N.length?(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:N.map(e=>(0,s.jsxs)(r.Card,{className:e.is_active?"":"opacity-60",children:[(0,s.jsxs)(r.CardHeader,{className:"pb-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[T(e.status),(0,s.jsx)(r.CardTitle,{className:"text-base",children:e.account_nickname||e.account_name})]}),(0,s.jsxs)(r.DropdownMenu,{children:[(0,s.jsx)(r.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(r.Button,{variant:"ghost",size:"icon","aria-label":"Open actions menu",children:(0,s.jsx)(h.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(r.DropdownMenuContent,{align:"end",children:[(0,s.jsxs)(r.DropdownMenuItem,{onClick:()=>P(e),children:[(0,s.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"View Details"]}),(0,s.jsx)(r.DropdownMenuItem,{onClick:()=>I(e),children:"Edit Account"}),"pending"===e.status&&(0,s.jsxs)(r.DropdownMenuItem,{onClick:()=>B(e.id),children:[(0,s.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Verify Account"]}),e.is_active&&(0,s.jsxs)(r.DropdownMenuItem,{onClick:()=>L(e.id),className:"text-red-600",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Deactivate"]})]})]})]}),(0,s.jsxs)(r.CardDescription,{className:"text-xs",children:[e.bank_name," â€¢ ",e.bank_country]})]}),(0,s.jsxs)(r.CardContent,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Account"}),(0,s.jsxs)("span",{className:"text-sm font-mono",children:["****",e.account_number_last_four]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Type"}),(0,s.jsx)(r.Badge,{variant:"outline",className:"text-xs",children:e.account_type.replace("_"," ")})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Currency"}),(0,s.jsx)("span",{className:"text-sm",children:e.currency})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Status"}),A(e.status)]}),e.is_primary&&(0,s.jsxs)(r.Badge,{variant:"default",className:"w-full justify-center",children:[(0,s.jsx)(p.Z,{className:"h-3 w-3 mr-1"}),"Primary Account"]}),!e.is_active&&(0,s.jsx)(r.Badge,{variant:"outline",className:"w-full justify-center",children:"Inactive"})]})]},e.id))}):(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(i.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Bank Accounts"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center mb-4",children:"Add your company bank accounts to start accepting manual payments"}),(0,s.jsxs)(r.Button,{onClick:()=>a(!0),children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Add First Bank Account"]})]})}),(0,s.jsx)(S,{open:e,onOpenChange:a,account:t,onSuccess:()=>{a(!1),c(null)}}),(0,s.jsx)(F,{open:l,onOpenChange:j,accountId:t?.id||null})]})}var P=t(88307),I=t(36283),B=t(94019),L=t(63685);function q({open:e,onOpenChange:a,onSuccess:t}){let[i,c]=(0,n.useState)("cash"),[l,d]=(0,n.useState)(null),{data:o}=_(!1),u=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:e=>f.recordCashPayment(e),onSuccess:()=>{e.invalidateQueries({queryKey:["manual-payments"]}),e.invalidateQueries({queryKey:["bank-account-summary"]}),a({title:"Cash Payment Recorded",description:"The cash payment has been recorded successfully."})},onError:e=>{a({title:"Recording Failed",description:e.message||"Failed to record cash payment",variant:"destructive"})}})}(),m=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:e=>f.recordCheckPayment(e),onSuccess:()=>{e.invalidateQueries({queryKey:["manual-payments"]}),e.invalidateQueries({queryKey:["bank-account-summary"]}),a({title:"Check Payment Recorded",description:"The check payment has been recorded successfully."})},onError:e=>{a({title:"Recording Failed",description:e.message||"Failed to record check payment",variant:"destructive"})}})}(),h=k(),x=w(),[p,j]=(0,n.useState)({customer_id:"",invoice_id:"",amount:"",currency:"USD",payment_date:new Date().toISOString().slice(0,10),notes:""}),[b,v]=(0,n.useState)({cash_register_id:"",denomination_breakdown:"",cashier_name:""}),[N,S]=(0,n.useState)({check_number:"",bank_name:"",check_date:new Date().toISOString().slice(0,10)}),[D,T]=(0,n.useState)({bank_account_id:"",sender_account_name:"",sender_account_number:"",sender_bank_name:"",transaction_reference:""}),[F,A]=(0,n.useState)({provider:"",sender_phone:"",transaction_id:""}),P=()=>{let e=Number.parseFloat(p.amount);if(Number.isNaN(e))return null;let a={customer_id:p.customer_id.trim(),invoice_id:p.invoice_id?p.invoice_id.trim():null,amount:e,payment_date:p.payment_date,notes:p.notes?p.notes:null};return p.currency&&(a.currency=p.currency),a},I=async e=>{e.preventDefault();let a=P();if(a)try{switch(i){case"cash":{let e={...a,payment_method:"cash",cash_register_id:b.cash_register_id?b.cash_register_id:null,cashier_name:b.cashier_name?b.cashier_name:null};await u.mutateAsync(e);break}case"check":{let e={...a,payment_method:"check",received_date:N.check_date,check_number:N.check_number,check_bank_name:N.bank_name||null};await m.mutateAsync(e);break}case"bank_transfer":{let e={...a,payment_method:"bank_transfer",bank_account_id:D.bank_account_id?Number.parseInt(D.bank_account_id,10):null,sender_name:D.sender_account_name?D.sender_account_name:null,sender_bank:D.sender_bank_name?D.sender_bank_name:null,sender_account_last_four:D.sender_account_number?D.sender_account_number.slice(-4):null,external_reference:D.transaction_reference?D.transaction_reference:null};await h.mutateAsync(e);break}case"mobile_money":{let e={...a,payment_method:"mobile_money",mobile_provider:F.provider,mobile_number:F.sender_phone,external_reference:F.transaction_id?F.transaction_id:null};await x.mutateAsync(e)}}t?.(),q()}catch(e){}},q=()=>{j({customer_id:"",invoice_id:"",amount:"",currency:"USD",payment_date:new Date().toISOString().slice(0,10),notes:""}),v({cash_register_id:"",denomination_breakdown:"",cashier_name:""}),S({check_number:"",bank_name:"",check_date:new Date().toISOString().slice(0,10)}),T({bank_account_id:"",sender_account_name:"",sender_account_number:"",sender_bank_name:"",transaction_reference:""}),A({provider:"",sender_phone:"",transaction_id:""}),d(null)},R=u.isPending||m.isPending||h.isPending||x.isPending;return(0,s.jsx)(r.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(r.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(r.DialogHeader,{children:[(0,s.jsx)(r.DialogTitle,{children:"Record Manual Payment"}),(0,s.jsx)(r.DialogDescription,{children:"Record a payment received outside of automated payment systems"})]}),(0,s.jsxs)("form",{onSubmit:I,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"paymentMethod",children:"Payment Method *"}),(0,s.jsxs)(r.Select,{value:i,onValueChange:e=>c(e),children:[(0,s.jsx)(r.SelectTrigger,{id:"paymentMethod",children:(0,s.jsx)(r.SelectValue,{})}),(0,s.jsxs)(r.SelectContent,{children:[(0,s.jsx)(r.SelectItem,{value:"cash",children:"Cash"}),(0,s.jsx)(r.SelectItem,{value:"check",children:"Check"}),(0,s.jsx)(r.SelectItem,{value:"bank_transfer",children:"Bank Transfer"}),(0,s.jsx)(r.SelectItem,{value:"mobile_money",children:"Mobile Money"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-sm",children:"Payment Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"customer_id",children:"Customer ID *"}),(0,s.jsx)(r.Input,{id:"customer_id",type:"number",value:p.customer_id,onChange:e=>j({...p,customer_id:e.target.value}),required:!0,placeholder:"12345"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"invoice_id",children:"Invoice ID (optional)"}),(0,s.jsx)(r.Input,{id:"invoice_id",type:"number",value:p.invoice_id,onChange:e=>j({...p,invoice_id:e.target.value}),placeholder:"67890"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,s.jsx)(r.Label,{htmlFor:"amount",children:"Amount *"}),(0,s.jsx)(r.Input,{id:"amount",type:"number",step:"0.01",value:p.amount,onChange:e=>j({...p,amount:e.target.value}),required:!0,placeholder:"100.00"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"currency",children:"Currency *"}),(0,s.jsx)(r.Input,{id:"currency",value:p.currency,onChange:e=>j({...p,currency:e.target.value.toUpperCase()}),required:!0,maxLength:3,placeholder:"USD"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"payment_date",children:"Payment Date *"}),(0,s.jsx)(r.Input,{id:"payment_date",type:"date",value:p.payment_date,onChange:e=>j({...p,payment_date:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"notes",children:"Notes (optional)"}),(0,s.jsx)(r.Textarea,{id:"notes",value:p.notes,onChange:e=>j({...p,notes:e.target.value}),placeholder:"Add any additional information about this payment...",rows:3})]})]}),(0,s.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,s.jsxs)("h3",{className:"font-semibold text-sm",children:["cash"===i&&"Cash Payment Details","check"===i&&"Check Details","bank_transfer"===i&&"Bank Transfer Details","mobile_money"===i&&"Mobile Money Details"]}),"cash"===i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"cash_register_id",children:"Cash Register ID (optional)"}),(0,s.jsx)(r.Input,{id:"cash_register_id",type:"number",value:b.cash_register_id,onChange:e=>v({...b,cash_register_id:e.target.value}),placeholder:"123"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"denomination_breakdown",children:"Denomination Breakdown (optional, JSON)"}),(0,s.jsx)(r.Textarea,{id:"denomination_breakdown",value:b.denomination_breakdown,onChange:e=>v({...b,denomination_breakdown:e.target.value}),placeholder:'{"100": 5, "50": 2, "20": 10}',rows:3}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Enter as JSON object with denomination as key and count as value"})]})]}),"check"===i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"check_number",children:"Check Number *"}),(0,s.jsx)(r.Input,{id:"check_number",value:N.check_number,onChange:e=>S({...N,check_number:e.target.value}),required:!0,placeholder:"1234567890"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"check_bank_name",children:"Bank Name *"}),(0,s.jsx)(r.Input,{id:"check_bank_name",value:N.bank_name,onChange:e=>S({...N,bank_name:e.target.value}),required:!0,placeholder:"First National Bank"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"check_date",children:"Check Date *"}),(0,s.jsx)(r.Input,{id:"check_date",type:"date",value:N.check_date,onChange:e=>S({...N,check_date:e.target.value}),required:!0})]})]}),"bank_transfer"===i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"bank_account_id",children:"Receiving Bank Account *"}),(0,s.jsxs)(r.Select,{value:D.bank_account_id,onValueChange:e=>T({...D,bank_account_id:e}),children:[(0,s.jsx)(r.SelectTrigger,{id:"bank_account_id",children:(0,s.jsx)(r.SelectValue,{placeholder:"Select bank account"})}),(0,s.jsx)(r.SelectContent,{children:o?.map(e=>s.jsxs(r.SelectItem,{value:e.id.toString(),children:[e.account_nickname||e.account_name," (****",e.account_number_last_four,")"]},e.id))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"sender_account_name",children:"Sender Account Name *"}),(0,s.jsx)(r.Input,{id:"sender_account_name",value:D.sender_account_name,onChange:e=>T({...D,sender_account_name:e.target.value}),required:!0,placeholder:"John Doe"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"sender_account_number",children:"Sender Account Number (optional)"}),(0,s.jsx)(r.Input,{id:"sender_account_number",value:D.sender_account_number,onChange:e=>T({...D,sender_account_number:e.target.value}),placeholder:"1234567890"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"sender_bank_name",children:"Sender Bank Name (optional)"}),(0,s.jsx)(r.Input,{id:"sender_bank_name",value:D.sender_bank_name,onChange:e=>T({...D,sender_bank_name:e.target.value}),placeholder:"Second National Bank"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"transaction_reference",children:"Transaction Reference (optional)"}),(0,s.jsx)(r.Input,{id:"transaction_reference",value:D.transaction_reference,onChange:e=>T({...D,transaction_reference:e.target.value}),placeholder:"TXN123456789"})]})]}),"mobile_money"===i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"provider",children:"Mobile Money Provider *"}),(0,s.jsx)(r.Input,{id:"provider",value:F.provider,onChange:e=>A({...F,provider:e.target.value}),required:!0,placeholder:"M-Pesa, MTN Mobile Money, etc."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"sender_phone",children:"Sender Phone Number *"}),(0,s.jsx)(r.Input,{id:"sender_phone",type:"tel",value:F.sender_phone,onChange:e=>A({...F,sender_phone:e.target.value}),required:!0,placeholder:"+1234567890"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"transaction_id",children:"Transaction ID *"}),(0,s.jsx)(r.Input,{id:"transaction_id",value:F.transaction_id,onChange:e=>A({...F,transaction_id:e.target.value}),required:!0,placeholder:"MM123456789"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-sm",children:"Receipt / Proof of Payment (optional)"}),l?(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 border rounded-md",children:[(0,s.jsx)("span",{className:"text-sm flex-1",children:l.name}),(0,s.jsx)(r.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{d(null)},children:(0,s.jsx)(B.Z,{className:"h-4 w-4"})})]}):(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(r.Input,{id:"receipt",type:"file",accept:"image/*,.pdf",onChange:e=>{e.target.files&&e.target.files[0]&&d(e.target.files[0])},className:"cursor-pointer"}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,s.jsx)(L.Z,{className:"h-4 w-4 mr-2 text-muted-foreground"})})]})]}),(0,s.jsxs)(r.DialogFooter,{children:[(0,s.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:R,children:"Cancel"}),(0,s.jsxs)(r.Button,{type:"submit",disabled:R,children:[R&&(0,s.jsx)(C.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Record Payment"]})]})]})]})})}var R=t(34041);function U(){let[e,a]=(0,n.useState)(!1),[t,i]=(0,n.useState)({status:"all",method:"all",search:"",startDate:"",endDate:""}),{data:l,isLoading:h}=N({..."all"!==t.status&&{status:t.status},..."all"!==t.method&&{payment_method:t.method},...t.search&&{search:t.search},...t.startDate&&{date_from:t.startDate},...t.endDate&&{date_to:t.endDate}}),x=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:({paymentId:e,verificationNotes:a})=>f.verifyPayment(e,a),onSuccess:()=>{e.invalidateQueries({queryKey:["manual-payments"]}),a({title:"Payment Verified",description:"The payment has been verified successfully."})},onError:e=>{a({title:"Verification Failed",description:e.message||"Failed to verify payment",variant:"destructive"})}})}(),j=e=>{switch(e){case"completed":return(0,s.jsx)(d.Z,{className:"h-4 w-4 text-green-500"});case"pending":return(0,s.jsx)(o.Z,{className:"h-4 w-4 text-yellow-500"});case"failed":return(0,s.jsx)(u.Z,{className:"h-4 w-4 text-red-500"});case"cancelled":return(0,s.jsx)(u.Z,{className:"h-4 w-4 text-gray-500"});default:return(0,s.jsx)(o.Z,{className:"h-4 w-4 text-gray-500"})}},b=e=>(0,s.jsx)(r.Badge,{variant:{completed:"default",pending:"secondary",failed:"destructive",cancelled:"outline",processing:"secondary"}[e]||"outline",children:e.charAt(0).toUpperCase()+e.slice(1)}),v=e=>(0,s.jsx)(r.Badge,{variant:"outline",children:{bank_transfer:"Bank Transfer",wire_transfer:"Wire Transfer",ach:"ACH",cash:"Cash",check:"Check",money_order:"Money Order",mobile_money:"Mobile Money",crypto:"Crypto",other:"Other"}[e]||e}),_=async e=>{await x.mutateAsync({paymentId:e,verificationNotes:"Verified via banking dashboard"})};return h?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(r.Skeleton,{className:"h-32 w-full"}),(0,s.jsx)(r.Skeleton,{className:"h-96 w-full"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold",children:"Manual Payments"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Record and manage manual payments received outside of automated systems"})]}),(0,s.jsxs)(r.Button,{onClick:()=>a(!0),children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Record Payment"]})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsx)(r.CardTitle,{className:"text-base",children:"Filters"})}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"search",children:"Search"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(P.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(r.Input,{id:"search",placeholder:"Reference, customer...",className:"pl-8",value:t.search,onChange:e=>i({...t,search:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"status",children:"Status"}),(0,s.jsxs)(r.Select,{value:t.status,onValueChange:e=>i({...t,status:e}),children:[(0,s.jsx)(r.SelectTrigger,{id:"status",children:(0,s.jsx)(r.SelectValue,{})}),(0,s.jsxs)(r.SelectContent,{children:[(0,s.jsx)(r.SelectItem,{value:"all",children:"All Statuses"}),(0,s.jsx)(r.SelectItem,{value:"pending",children:"Pending"}),(0,s.jsx)(r.SelectItem,{value:"processing",children:"Processing"}),(0,s.jsx)(r.SelectItem,{value:"completed",children:"Completed"}),(0,s.jsx)(r.SelectItem,{value:"failed",children:"Failed"}),(0,s.jsx)(r.SelectItem,{value:"cancelled",children:"Cancelled"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"method",children:"Payment Method"}),(0,s.jsxs)(r.Select,{value:t.method,onValueChange:e=>i({...t,method:e}),children:[(0,s.jsx)(r.SelectTrigger,{id:"method",children:(0,s.jsx)(r.SelectValue,{})}),(0,s.jsxs)(r.SelectContent,{children:[(0,s.jsx)(r.SelectItem,{value:"all",children:"All Methods"}),(0,s.jsx)(r.SelectItem,{value:"cash",children:"Cash"}),(0,s.jsx)(r.SelectItem,{value:"check",children:"Check"}),(0,s.jsx)(r.SelectItem,{value:"bank_transfer",children:"Bank Transfer"}),(0,s.jsx)(r.SelectItem,{value:"mobile_money",children:"Mobile Money"}),(0,s.jsx)(r.SelectItem,{value:"wire_transfer",children:"Wire Transfer"}),(0,s.jsx)(r.SelectItem,{value:"ach",children:"ACH"}),(0,s.jsx)(r.SelectItem,{value:"money_order",children:"Money Order"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"startDate",children:"Start Date"}),(0,s.jsx)(r.Input,{id:"startDate",type:"date",value:t.startDate,onChange:e=>i({...t,startDate:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"endDate",children:"End Date"}),(0,s.jsx)(r.Input,{id:"endDate",type:"date",value:t.endDate,onChange:e=>i({...t,endDate:e.target.value})})]})]}),(t.search||"all"!==t.status||"all"!==t.method||t.startDate||t.endDate)&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>i({status:"all",method:"all",search:"",startDate:"",endDate:""}),children:"Clear Filters"})})]})]}),l&&0!==l.length?(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{children:[(0,s.jsxs)(r.CardTitle,{className:"text-base",children:["Payments (",l.length,")"]}),(0,s.jsx)(r.CardDescription,{children:"All manual payments recorded in the system"})]}),(0,s.jsx)(r.CardContent,{children:(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(r.Table,{children:[(0,s.jsx)(r.TableHeader,{children:(0,s.jsxs)(r.TableRow,{children:[(0,s.jsx)(r.TableHead,{children:"Date"}),(0,s.jsx)(r.TableHead,{children:"Reference"}),(0,s.jsx)(r.TableHead,{children:"Customer"}),(0,s.jsx)(r.TableHead,{children:"Method"}),(0,s.jsx)(r.TableHead,{children:"Amount"}),(0,s.jsx)(r.TableHead,{children:"Status"}),(0,s.jsx)(r.TableHead,{children:"Reconciled"}),(0,s.jsx)(r.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(r.TableBody,{children:l.map(e=>(0,s.jsxs)(r.TableRow,{children:[(0,s.jsx)(r.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(T.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-sm",children:(0,R.WU)(new Date(e.payment_date),"MMM d, yyyy")})]})}),(0,s.jsx)(r.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[j(e.status),(0,s.jsx)("span",{className:"font-mono text-sm",children:e.payment_reference})]})}),(0,s.jsx)(r.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.customer_id||"N/A"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.external_reference||""})]})}),(0,s.jsx)(r.TableCell,{children:v(e.payment_method)}),(0,s.jsx)(r.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(p.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,s.jsxs)("span",{className:"font-semibold",children:[e.currency," ",e.amount.toFixed(2)]})]})}),(0,s.jsx)(r.TableCell,{children:b(e.status)}),(0,s.jsx)(r.TableCell,{children:e.reconciled?(0,s.jsxs)(r.Badge,{variant:"default",className:"gap-1",children:[(0,s.jsx)(d.Z,{className:"h-3 w-3"}),"Reconciled"]}):(0,s.jsx)(r.Badge,{variant:"outline",children:"Pending"})}),(0,s.jsx)(r.TableCell,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:["pending"===e.status&&(0,s.jsx)(r.Button,{size:"sm",variant:"outline",onClick:()=>_(e.id),disabled:x.isPending,children:"Verify"}),e.receipt_url&&(0,s.jsx)(r.Button,{size:"sm",variant:"ghost",asChild:!0,children:(0,s.jsx)("a",{href:e.receipt_url,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(I.Z,{className:"h-4 w-4"})})})]})})]},e.id))})]})})})]}):(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(c.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Payments Found"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center mb-4",children:t.search||"all"!==t.status||"all"!==t.method?"No payments match your filters. Try adjusting your search criteria.":"Record your first manual payment to get started."}),(0,s.jsxs)(r.Button,{onClick:()=>a(!0),children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Record Payment"]})]})}),(0,s.jsx)(q,{open:e,onOpenChange:a,onSuccess:()=>a(!1)})]})}var M=t(66307),H=t(41291);let Z="/api/isp/v1/admin";class O{getAuthHeaders(){let e=localStorage.getItem("access_token");return{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}async startReconciliation(e){let a=await fetch(`${this.baseUrl}${Z}/billing/reconciliations`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to start reconciliation");return a.json()}async listReconciliations(e){let a=new URLSearchParams;e?.bank_account_id&&a.append("bank_account_id",e.bank_account_id.toString()),e?.status&&a.append("status",e.status),e?.start_date&&a.append("start_date",e.start_date),e?.end_date&&a.append("end_date",e.end_date),e?.page&&a.append("page",e.page.toString()),e?.page_size&&a.append("page_size",e.page_size.toString());let t=await fetch(`${this.baseUrl}${Z}/billing/reconciliations?${a.toString()}`,{headers:this.getAuthHeaders()});if(!t.ok)throw Error((await t.json().catch(()=>({}))).detail||"Failed to list reconciliations");return t.json()}async getReconciliationSummary(e){let a=new URLSearchParams;e?.bank_account_id&&a.append("bank_account_id",e.bank_account_id.toString()),e?.days&&a.append("days",e.days.toString());let t=await fetch(`${this.baseUrl}${Z}/billing/reconciliations/summary?${a.toString()}`,{headers:this.getAuthHeaders()});if(!t.ok)throw Error((await t.json().catch(()=>({}))).detail||"Failed to get reconciliation summary");return t.json()}async getReconciliation(e){let a=await fetch(`${this.baseUrl}${Z}/billing/reconciliations/${e}`,{headers:this.getAuthHeaders()});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to get reconciliation");return a.json()}async addReconciledPayment(e,a){let t=await fetch(`${this.baseUrl}${Z}/billing/reconciliations/${e}/payments`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(a)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).detail||"Failed to add reconciled payment");return t.json()}async completeReconciliation(e,a){let t=await fetch(`${this.baseUrl}${Z}/billing/reconciliations/${e}/complete`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(a)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).detail||"Failed to complete reconciliation");return t.json()}async approveReconciliation(e,a){let t=await fetch(`${this.baseUrl}${Z}/billing/reconciliations/${e}/approve`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(a)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).detail||"Failed to approve reconciliation");return t.json()}async retryFailedPayment(e){let a=await fetch(`${this.baseUrl}${Z}/billing/reconciliations/retry-payment`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).detail||"Failed to retry payment");return a.json()}async getCircuitBreakerStatus(){let e=await fetch(`${this.baseUrl}${Z}/billing/reconciliations/circuit-breaker/status`,{headers:this.getAuthHeaders()});if(!e.ok)throw Error((await e.json().catch(()=>({}))).detail||"Failed to get circuit breaker status");return e.json()}constructor(){this.baseUrl=b.LM.api.baseUrl}}let $=new O;function E({open:e,onOpenChange:a,onComplete:t}){let[i,c]=(0,n.useState)("setup"),[l,d]=(0,n.useState)(null),[o,u]=(0,n.useState)({bank_account_id:"",period_start:new Date(new Date().setDate(1)).toISOString().slice(0,10),period_end:new Date().toISOString().slice(0,10),statement_balance:"",notes:""}),[m,h]=(0,n.useState)([]),{data:x}=_(!1),{data:p}=N({payment_status:"completed",date_from:o.period_start,date_to:o.period_end}),j=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:e=>$.startReconciliation(e),onSuccess:()=>{e.invalidateQueries({queryKey:["reconciliations"]}),e.invalidateQueries({queryKey:["reconciliation-summary"]}),a({title:"Reconciliation Started",description:"The reconciliation session has been started successfully."})},onError:e=>{a({title:"Start Failed",description:e.message||"Failed to start reconciliation",variant:"destructive"})}})}(),b=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:({reconciliationId:e,paymentData:a})=>$.addReconciledPayment(e,a),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["reconciliation",s.reconciliationId]}),e.invalidateQueries({queryKey:["reconciliations"]}),e.invalidateQueries({queryKey:["manual-payments"]}),a({title:"Payment Reconciled",description:"The payment has been added to the reconciliation session."})},onError:e=>{a({title:"Reconciliation Failed",description:e.message||"Failed to reconcile payment",variant:"destructive"})}})}(),v=function(){let e=(0,g.NL)(),{toast:a}=(0,r.useToast)();return(0,y.D)({mutationFn:({reconciliationId:e,data:a})=>$.completeReconciliation(e,a),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["reconciliation",s.reconciliationId]}),e.invalidateQueries({queryKey:["reconciliations"]}),e.invalidateQueries({queryKey:["reconciliation-summary"]}),a({title:"Reconciliation Completed",description:"The reconciliation session has been completed successfully."})},onError:e=>{a({title:"Completion Failed",description:e.message||"Failed to complete reconciliation",variant:"destructive"})}})}(),f=async()=>{try{let e=Number.parseInt(o.bank_account_id,10),a=Number.parseFloat(o.statement_balance);if(Number.isNaN(e)||Number.isNaN(a))return;let t=o.notes.trim(),s={bank_account_id:e,period_start:o.period_start,period_end:o.period_end,opening_balance:a,statement_balance:a,...t&&{notes:t}},n=await j.mutateAsync(s);d(n.id),c("matching")}catch(e){}},k=async()=>{if(l)try{for(let e of m)await b.mutateAsync({reconciliationId:l,paymentData:{payment_id:e}});c("review")}catch(e){}},w=async()=>{if(l)try{let e=o.notes.trim();await v.mutateAsync({reconciliationId:l,data:{...e&&{notes:e}}}),c("complete"),setTimeout(()=>{S(),t?.()},2e3)}catch(e){}},S=()=>{c("setup"),d(null),h([]),u({bank_account_id:"",period_start:new Date(new Date().setDate(1)).toISOString().slice(0,10),period_end:new Date().toISOString().slice(0,10),statement_balance:"",notes:""}),a(!1)},D=e=>{h(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},T=()=>p?p.filter(e=>m.includes(e.id)).reduce((e,a)=>e+a.amount,0):0,F=()=>Math.abs((parseFloat(o.statement_balance)||0)-T()),A=j.isPending||b.isPending||v.isPending;return(0,s.jsx)(r.Dialog,{open:e,onOpenChange:S,children:(0,s.jsxs)(r.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(r.DialogHeader,{children:[(0,s.jsxs)(r.DialogTitle,{children:["setup"===i&&"Start Reconciliation","matching"===i&&"Match Payments","review"===i&&"Review Reconciliation","complete"===i&&"Reconciliation Complete"]}),(0,s.jsxs)(r.DialogDescription,{children:["setup"===i&&"Configure the reconciliation period and bank account","matching"===i&&"Select payments that match your bank statement","review"===i&&"Review and complete the reconciliation","complete"===i&&"Reconciliation has been completed successfully"]})]}),"setup"===i&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"bank_account_id",children:"Bank Account *"}),(0,s.jsxs)(r.Select,{value:o.bank_account_id,onValueChange:e=>u({...o,bank_account_id:e}),children:[(0,s.jsx)(r.SelectTrigger,{id:"bank_account_id",children:(0,s.jsx)(r.SelectValue,{placeholder:"Select bank account"})}),(0,s.jsx)(r.SelectContent,{children:x?.map(e=>s.jsxs(r.SelectItem,{value:e.id.toString(),children:[e.account_nickname||e.account_name," (****",e.account_number_last_four,")"]},e.id))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"period_start",children:"Period Start *"}),(0,s.jsx)(r.Input,{id:"period_start",type:"date",value:o.period_start,onChange:e=>u({...o,period_start:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"period_end",children:"Period End *"}),(0,s.jsx)(r.Input,{id:"period_end",type:"date",value:o.period_end,onChange:e=>u({...o,period_end:e.target.value}),required:!0})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"statement_balance",children:"Bank Statement Balance *"}),(0,s.jsx)(r.Input,{id:"statement_balance",type:"number",step:"0.01",value:o.statement_balance,onChange:e=>u({...o,statement_balance:e.target.value}),required:!0,placeholder:"0.00"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{htmlFor:"notes",children:"Notes (optional)"}),(0,s.jsx)(r.Textarea,{id:"notes",value:o.notes,onChange:e=>u({...o,notes:e.target.value}),placeholder:"Add any notes about this reconciliation...",rows:3})]}),(0,s.jsxs)(r.DialogFooter,{children:[(0,s.jsx)(r.Button,{variant:"outline",onClick:S,children:"Cancel"}),(0,s.jsxs)(r.Button,{onClick:f,disabled:!o.bank_account_id||!o.period_start||!o.period_end||!o.statement_balance||A,children:[A&&(0,s.jsx)(C.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Next: Match Payments"]})]})]}),"matching"===i&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-muted p-4 rounded-lg space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Statement Balance:"}),(0,s.jsxs)("span",{className:"text-lg font-bold",children:["$",parseFloat(o.statement_balance).toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Selected Payments Total:"}),(0,s.jsxs)("span",{className:"text-lg font-bold",children:["$",T().toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center border-t pt-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Discrepancy:"}),(0,s.jsxs)("span",{className:`text-lg font-bold ${0===F()?"text-green-600":"text-orange-600"}`,children:["$",F().toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(r.Label,{children:"Unreconciled Payments"}),p&&0!==p.length?(0,s.jsx)("div",{className:"border rounded-lg divide-y max-h-96 overflow-y-auto",children:p.filter(e=>!e.reconciled).map(e=>{let a=m.includes(e.id);return(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 hover:bg-muted cursor-pointer",onClick:()=>D(e.id),children:[(0,s.jsx)(r.Checkbox,{checked:a,onChange:a=>{a.stopPropagation(),D(e.id)}}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"font-medium",children:["Customer: ",e.customer_id]}),(0,s.jsxs)("span",{className:"font-bold",children:[e.currency," ",e.amount.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)("span",{children:e.payment_reference}),(0,s.jsx)(r.Badge,{variant:"outline",className:"text-xs",children:e.payment_method}),(0,s.jsx)("span",{children:new Date(e.payment_date).toLocaleDateString()})]})]})]},e.id)})}):(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No unreconciled payments found for this period"})]}),(0,s.jsxs)(r.DialogFooter,{children:[(0,s.jsx)(r.Button,{variant:"outline",onClick:S,children:"Cancel"}),(0,s.jsxs)(r.Button,{onClick:k,disabled:0===m.length||A,children:[A&&(0,s.jsx)(C.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Next: Review (",m.length," selected)"]})]})]}),"review"===i&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-muted p-4 rounded-lg space-y-3",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Reconciliation Summary"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Bank Account"}),(0,s.jsx)("p",{className:"font-medium",children:x?.find(e=>e.id===parseInt(o.bank_account_id))?.account_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Period"}),(0,s.jsxs)("p",{className:"font-medium",children:[new Date(o.period_start).toLocaleDateString()," -"," ",new Date(o.period_end).toLocaleDateString()]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Payments Reconciled"}),(0,s.jsx)("p",{className:"font-medium",children:m.length})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Amount"}),(0,s.jsxs)("p",{className:"font-medium",children:["$",T().toFixed(2)]})]})]}),F()>0&&(0,s.jsxs)("div",{className:"flex items-start gap-2 bg-orange-50 dark:bg-orange-950 p-3 rounded border border-orange-200 dark:border-orange-800",children:[(0,s.jsx)(H.Z,{className:"h-4 w-4 text-orange-600 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-orange-900 dark:text-orange-100",children:"Discrepancy Detected"}),(0,s.jsxs)("p",{className:"text-xs text-orange-700 dark:text-orange-300",children:["There is a $",F().toFixed(2)," difference between the statement balance and selected payments. Please verify before completing."]})]})]}),0===F()&&(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-950 p-3 rounded border border-green-200 dark:border-green-800",children:[(0,s.jsx)(M.Z,{className:"h-4 w-4 text-green-600"}),(0,s.jsx)("p",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"Perfect match! No discrepancies found."})]})]}),(0,s.jsxs)(r.DialogFooter,{children:[(0,s.jsx)(r.Button,{variant:"outline",onClick:S,children:"Cancel"}),(0,s.jsxs)(r.Button,{onClick:w,disabled:A,children:[A&&(0,s.jsx)(C.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Complete Reconciliation"]})]})]}),"complete"===i&&(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[(0,s.jsx)(M.Z,{className:"h-16 w-16 text-green-500"}),(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Reconciliation Complete"}),(0,s.jsxs)("p",{className:"text-muted-foreground text-center",children:["Successfully reconciled ",m.length," payment(s) totaling $",T().toFixed(2)]})]})]})})}function K(){var e,a;let[t,i]=(0,n.useState)(!1),[c,l]=(0,n.useState)({start:new Date(new Date().setDate(1)).toISOString().slice(0,10),end:new Date().toISOString().slice(0,10)}),{data:d,isLoading:u}=(e={start_date:c.start,end_date:c.end},(0,j.a)({queryKey:["reconciliations",e],queryFn:()=>$.listReconciliations(e),staleTime:3e4})),{data:h,isLoading:x}=(0,j.a)({queryKey:["reconciliation-summary",void 0],queryFn:()=>$.getReconciliationSummary(a),staleTime:6e4}),g=e=>{let a={in_progress:{variant:"secondary",icon:o.Z},completed:{variant:"default",icon:M.Z},cancelled:{variant:"outline",icon:H.Z}}[e]||{variant:"outline",icon:H.Z},t=a.icon;return(0,s.jsxs)(r.Badge,{variant:a.variant,className:"gap-1",children:[(0,s.jsx)(t,{className:"h-3 w-3"}),e.replace("_"," ").charAt(0).toUpperCase()+e.slice(1)]})};return u||x?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(r.Skeleton,{className:"h-32 w-full"}),(0,s.jsx)(r.Skeleton,{className:"h-96 w-full"})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold",children:"Reconciliation"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Match manual payments with bank statements to ensure accuracy"})]}),(0,s.jsxs)(r.Button,{onClick:()=>i(!0),children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Start Reconciliation"]})]}),h&&(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Sessions"})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(I.Z,{className:"h-4 w-4 text-blue-500"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:h.total_reconciliations})]})})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Completed"})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(M.Z,{className:"h-4 w-4 text-green-500"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:h.completed_reconciliations})]})})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Average Discrepancy"})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4 text-purple-500"}),(0,s.jsxs)("span",{className:"text-2xl font-bold",children:["$",h.avg_discrepancy.toFixed(2)]})]})})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Discrepancy"})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(H.Z,{className:"h-4 w-4 text-orange-500"}),(0,s.jsxs)("span",{className:"text-2xl font-bold",children:["$",h.total_discrepancy.toFixed(2)]})]})})]})]}),d&&d.reconciliations&&0!==d.reconciliations.length?(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{children:[(0,s.jsx)(r.CardTitle,{className:"text-base",children:"Reconciliation Sessions"}),(0,s.jsx)(r.CardDescription,{children:"All reconciliation sessions for the selected period"})]}),(0,s.jsx)(r.CardContent,{children:(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(r.Table,{children:[(0,s.jsx)(r.TableHeader,{children:(0,s.jsxs)(r.TableRow,{children:[(0,s.jsx)(r.TableHead,{children:"Period"}),(0,s.jsx)(r.TableHead,{children:"Bank Account"}),(0,s.jsx)(r.TableHead,{children:"Status"}),(0,s.jsx)(r.TableHead,{children:"Payments"}),(0,s.jsx)(r.TableHead,{children:"Amount"}),(0,s.jsx)(r.TableHead,{children:"Discrepancies"}),(0,s.jsx)(r.TableHead,{children:"Created By"}),(0,s.jsx)(r.TableHead,{children:"Completed"})]})}),(0,s.jsx)(r.TableBody,{children:d.reconciliations.map(e=>(0,s.jsxs)(r.TableRow,{children:[(0,s.jsx)(r.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(T.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:new Date(e.period_start).toLocaleDateString()}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["to ",new Date(e.period_end).toLocaleDateString()]})]})]})}),(0,s.jsx)(r.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.bank_account.account_nickname||e.bank_account.account_name}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["****",e.bank_account.account_number_last_four]})]})}),(0,s.jsx)(r.TableCell,{children:g(e.status)}),(0,s.jsx)(r.TableCell,{children:(0,s.jsx)("span",{className:"text-sm font-medium",children:e.payments_reconciled_count})}),(0,s.jsx)(r.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(p.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-sm font-semibold",children:e.total_amount_reconciled.toFixed(2)})]})}),(0,s.jsx)(r.TableCell,{children:e.discrepancies_count>0?(0,s.jsxs)(r.Badge,{variant:"destructive",className:"gap-1",children:[(0,s.jsx)(H.Z,{className:"h-3 w-3"}),e.discrepancies_count]}):(0,s.jsx)(r.Badge,{variant:"outline",children:"None"})}),(0,s.jsx)(r.TableCell,{children:(0,s.jsx)("span",{className:"text-sm",children:e.created_by_user_id})}),(0,s.jsx)(r.TableCell,{children:e.completed_at?(0,s.jsx)("span",{className:"text-sm",children:new Date(e.completed_at).toLocaleDateString()}):(0,s.jsx)(r.Badge,{variant:"secondary",children:"In Progress"})})]},e.id))})]})})})]}):(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(I.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Reconciliation Sessions"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center mb-4",children:"Start your first reconciliation session to match payments with bank statements."}),(0,s.jsxs)(r.Button,{onClick:()=>i(!0),children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Start Reconciliation"]})]})}),(0,s.jsx)(E,{open:t,onOpenChange:i,onComplete:()=>i(!1)})]})}let Q="force-dynamic",V=!0;function J(){let[e,a]=(0,n.useState)("accounts");return(0,s.jsxs)("div",{className:"space-y-6 p-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Banking & Payments"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:"Manage bank accounts, record manual payments, and reconcile transactions"})]}),(0,s.jsxs)(r.Tabs,{value:e,onValueChange:a,children:[(0,s.jsxs)(r.TabsList,{className:"grid w-full grid-cols-3 lg:w-[600px]",children:[(0,s.jsxs)(r.TabsTrigger,{value:"accounts",className:"flex items-center gap-2",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),"Bank Accounts"]}),(0,s.jsxs)(r.TabsTrigger,{value:"payments",className:"flex items-center gap-2",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4"}),"Manual Payments"]}),(0,s.jsxs)(r.TabsTrigger,{value:"reconciliation",className:"flex items-center gap-2",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),"Reconciliation"]})]}),(0,s.jsx)(r.TabsContent,{value:"accounts",className:"mt-6",children:(0,s.jsx)(A,{})}),(0,s.jsx)(r.TabsContent,{value:"payments",className:"mt-6",children:(0,s.jsx)(U,{})}),(0,s.jsx)(r.TabsContent,{value:"reconciliation",className:"mt-6",children:(0,s.jsx)(K,{})})]})]})}},32380:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>i,dynamic:()=>n,dynamicParams:()=>r});var s=t(68570);let n=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/banking-v2/page.tsx#dynamic`),r=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/banking-v2/page.tsx#dynamicParams`),i=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/banking-v2/page.tsx#default`)}};var a=require("../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),s=a.X(0,[2793,1009,6226,657,6032,4218],()=>t(40245));module.exports=s})();