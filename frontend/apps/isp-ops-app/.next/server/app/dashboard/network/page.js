(()=>{var e={};e.id=1916,e.ids=[1916],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},67804:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>d}),s(15529),s(13321),s(46366),s(96560);var a=s(23191),r=s(88716),i=s(37922),o=s.n(i),n=s(95231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(t,l);let d=["",{children:["dashboard",{children:["network",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,15529)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/page.tsx"],x="/dashboard/network/page",p={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/network/page",pathname:"/dashboard/network",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},84883:(e,t,s)=>{Promise.resolve().then(s.bind(s,84396))},84396:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(10326),r=s(48723),i=s(46502),o=s(41007),n=s(93158),l=s(69217),d=s(29771),c=s(51110),x=s(54014),p=s(45091),u=s(58038),m=s(48324);function h(e,t={},s=8e3){if(t.signal||"undefined"==typeof AbortController)return fetch(e,t);let a=new AbortController,r=setTimeout(()=>a.abort(),s);return fetch(e,{...t,signal:a.signal}).finally(()=>{clearTimeout(r)})}function f(){let{data:e,isLoading:t,error:s}=(0,m.a)({queryKey:["networkProfileStats"],queryFn:async()=>{let e=await h("/api/v1/network/profiles/stats",{credentials:"include"},8e3);if(!e.ok)throw Error("Failed to fetch network profile stats");return e.json()},retry:1,staleTime:6e4}),{data:i,isLoading:o,error:n}=(0,m.a)({queryKey:["ipv6LifecycleStats"],queryFn:async()=>{let e=await h("/api/v1/network/ipv6/stats",{credentials:"include"},8e3);if(!e.ok)throw Error("Failed to fetch IPv6 lifecycle stats");let t=await e.json(),s=t.utilization??{},a=t.netboxIntegration??t.netbox_integration??{};return{stateCounts:t.stateCounts??t.state_counts??{},utilization:{totalProfiles:s.totalProfiles??s.total_profiles??0,totalWithIpv6:s.totalWithIpv6??s.total_with_ipv6??0,activePrefixes:s.activePrefixes??s.active_prefixes??0,allocatedNotActive:s.allocatedNotActive??s.allocated_not_active??0,revokedPrefixes:s.revokedPrefixes??s.revoked_prefixes??0,utilizationRate:s.utilizationRate??s.utilization_rate??0},netboxIntegration:{prefixesWithNetboxId:a.prefixesWithNetboxId??a.prefixes_with_netbox_id??0,prefixesWithoutNetboxId:a.prefixesWithoutNetboxId??a.prefixes_without_netbox_id??0,netboxIntegrationRate:a.netboxIntegrationRate??a.netbox_integration_rate??0}}},retry:1,staleTime:6e4}),l=t||o,d=i?.stateCounts??{},f={allocated:d.allocated??d.ALLOCATED??0,active:d.active??d.ACTIVE??0,suspended:d.suspended??d.SUSPENDED??0,revoked:d.revoked??d.REVOKED??0},g=i?.utilization?.utilizationRate??0,j=i?.utilization?.totalWithIpv6??0,N=i?.utilization?.activePrefixes??0,v=i?.netboxIntegration?.netboxIntegrationRate??0,b=[{title:"Total Profiles",value:e?.totalProfiles??0,icon:c.Z,description:"Configured network profiles"},{title:"With Static IPv4",value:e?.profilesWithStaticIpv4??0,icon:x.Z,description:"Subscribers with static IPv4 addresses"},{title:"With Static IPv6",value:e?.profilesWithStaticIpv6??0,icon:x.Z,description:"Subscribers with IPv6 configuration"},{title:"Dual Stack",value:e?.dualStackProfiles??0,icon:x.Z,description:"Profiles with both IPv4 and IPv6"},{title:"With VLANs",value:e?.profilesWithVlans??0,icon:p.Z,description:"Profiles with VLAN configuration"},{title:"QinQ Enabled",value:e?.profilesWithQinq??0,icon:p.Z,description:"Profiles using 802.1ad QinQ"},{title:"Option 82 Bindings",value:e?.profilesWithOption82??0,icon:u.Z,description:"Profiles with DHCP Option 82"},{title:"NetBox Tracked",value:e?.netboxTrackedProfiles??0,icon:c.Z,description:"Profiles tracked in NetBox IPAM"}];return s||n?(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Network Profile Statistics"}),(0,a.jsx)(r.CardDescription,{children:"Unable to load network statistics"})]}),(0,a.jsxs)(r.CardContent,{children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[s?"Failed to load profile stats. ":"",n?"Failed to load IPv6 stats. ":"","The statistics API may be unavailable or taking too long to respond."]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"You can still access other network management features."})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:b.map(e=>{let t=e.icon;return(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(r.CardTitle,{className:"text-sm font-medium",children:e.title}),(0,a.jsx)(t,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(r.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:l?"...":e.value.toLocaleString()}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.description})]})]},e.title)})}),(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Option 82 Enforcement Policies"}),(0,a.jsx)(r.CardDescription,{children:"Distribution of DHCP Option 82 enforcement policies across profiles"})]}),(0,a.jsx)(r.CardContent,{children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Enforce"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":e?.option82EnforceCount??0}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Block on mismatch"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Log"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":e?.option82LogCount??0}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Log but allow"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Ignore"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":e?.option82IgnoreCount??0}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"No validation"})]})]})})]}),(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"IPv6 Lifecycle Utilization"}),(0,a.jsx)(r.CardDescription,{children:"Distribution of IPv6 prefixes across lifecycle states with activation and NetBox metrics"})]}),(0,a.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Allocated"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":f.allocated}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Ready to activate"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Active"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":f.active}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Currently in use"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Suspended"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":f.suspended}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Service paused"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Revoked"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":f.revoked}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Returned to pool"})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Activation Rate"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":`${(j>0?Math.round(N/j*1e3)/10:0).toFixed(1)}%`}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Active prefixes divided by IPv6-capable profiles"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Utilization Rate"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":`${g.toFixed(1)}%`}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Active prefixes compared to all network profiles"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"NetBox Integration"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:l?"...":`${v.toFixed(1)}%`}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"Prefixes tracked in NetBox"})]})]})]})]})]})}function g(){let{hasPermission:e}=(0,i.ss)(),{features:t}=(0,n.M)(),s=t.enableNetwork&&e("isp.ipam.read"),{data:c,isLoading:x}=(0,o.Z)({enabled:s}),{data:p,isLoading:u}=(0,o.u)({limit:50,enabled:s});if(!s)return(0,a.jsx)("main",{className:"max-w-5xl mx-auto px-6 py-12 space-y-8",children:(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Network inventory"}),(0,a.jsxs)(r.CardDescription,{children:["Access requires ",(0,a.jsx)("code",{children:"isp.ipam.read"})," and the NetBox integration to be configured for this tenant."]})]}),(0,a.jsx)(r.CardContent,{children:(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Operators can enable the NetBox connector via the OSS configuration screen or update",(0,a.jsx)("code",{children:"NEXT_PUBLIC_ENABLE_NETWORK"})," to share development data."]})})]})});let m=(p??[]).filter(e=>null!=e.latitude&&null!=e.longitude).map(e=>({id:`site-${e.id}`,name:e.name,type:"fiber_node",coordinates:{lat:e.latitude,lng:e.longitude},status:c?.healthy?"online":"maintenance"})),h=m.length>0&&m[0]?m[0].coordinates:{lat:0,lng:0};return(0,a.jsxs)("main",{className:"max-w-5xl mx-auto px-6 py-12 space-y-8",children:[(0,a.jsxs)("header",{className:"space-y-1",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Network inventory"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Visualize sites, devices, and cabling imported from NetBox for the current tenant."})]}),(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"NetBox health"}),(0,a.jsx)(r.CardDescription,{children:"Connectivity status for the tenant-scoped NetBox API."})]}),(0,a.jsx)(r.CardContent,{className:"flex flex-col gap-2",children:x?(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Checking NetBox…"}):c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Badge,{variant:c.healthy?"outline":"destructive",className:"w-fit uppercase tracking-wide",children:c.healthy?"Healthy":"Degraded"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:c.message}),c.version&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Reported version: ",c.version]})]}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No health data available."})})]}),(0,a.jsx)(f,{}),(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Sites"}),(0,a.jsx)(r.CardDescription,{children:"Primary network locations defined in NetBox."})]}),(0,a.jsx)(r.CardContent,{className:"overflow-x-auto",children:(0,a.jsxs)(r.Table,{children:[(0,a.jsx)(r.TableHeader,{children:(0,a.jsxs)(r.TableRow,{children:[(0,a.jsx)(r.TableHead,{children:"Name"}),(0,a.jsx)(r.TableHead,{children:"Slug"}),(0,a.jsx)(r.TableHead,{children:"Facility"}),(0,a.jsx)(r.TableHead,{children:"Address"})]})}),(0,a.jsxs)(r.TableBody,{children:[u&&(0,a.jsx)(r.TableRow,{children:(0,a.jsx)(r.TableCell,{colSpan:4,className:"text-center text-muted-foreground",children:"Loading sites…"})}),!u&&(p?.length??0)===0&&(0,a.jsx)(r.TableRow,{children:(0,a.jsx)(r.TableCell,{colSpan:4,className:"text-center text-muted-foreground",children:"No sites returned from NetBox."})}),p?.map(e=>a.jsxs(r.TableRow,{children:[a.jsx(r.TableCell,{className:"font-medium text-foreground",children:e.name}),a.jsx(r.TableCell,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:e.slug}),a.jsx(r.TableCell,{children:e.facility??"—"}),a.jsx(r.TableCell,{className:"text-sm text-muted-foreground",children:e.physical_address||e.description||"—"})]},e.id))]})]})})]}),(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{children:[(0,a.jsx)(r.CardTitle,{children:"Topology view"}),(0,a.jsx)(r.CardDescription,{children:"Interactive map rendering NetBox site coordinates. Enhance with device-level nodes once available."})]}),(0,a.jsx)(r.CardContent,{children:m.length?(0,a.jsx)(l.ig$,{center:h,zoom:6,networkNodes:m,height:360,variant:"admin",showLegend:!0,onNodeSelect:e=>d.k.info("network-topology.node-selected",{nodeId:e.id,nodeType:e.type})}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No geographic coordinates detected for NetBox sites. Populate latitude/longitude fields to enable the topology map."})})]})]})}},41007:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o,u:()=>n});var a=s(48324),r=s(59341),i=s(16704);function o({enabled:e=!0,queryOptions:t}={}){return(0,a.a)({queryKey:["netbox","health"],queryFn:async()=>{let e=await r.x1.get("/netbox/health",{timeout:8e3});return(0,i.uN)(e)},enabled:e,staleTime:6e4,retry:1,...t})}function n({limit:e=20,offset:t=0,enabled:s=!0,queryOptions:o}={}){return(0,a.a)({queryKey:["netbox","sites",{limit:e,offset:t}],queryFn:async()=>{let s=await r.x1.get("/netbox/dcim/sites",{params:{limit:e,offset:t},timeout:8e3});return(0,i.uN)(s)},enabled:s,staleTime:6e4,retry:1,...o})}},15529:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[2793,1009,6226,657,6032,4218],()=>s(67804));module.exports=a})();