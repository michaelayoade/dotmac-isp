(()=>{var e={};e.id=6580,e.ids=[6580],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},60912:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>o,routeModule:()=>u,tree:()=>d}),t(81125),t(13321),t(46366),t(96560);var s=t(23191),r=t(88716),l=t(37922),i=t.n(l),n=t(95231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(a,c);let d=["",{children:["dashboard",{children:["network",{children:["faults",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,81125)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/faults/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/faults/page.tsx"],m="/dashboard/network/faults/page",x={require:t,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/network/faults/page",pathname:"/dashboard/network/faults",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},65040:(e,a,t)=>{Promise.resolve().then(t.bind(t,88236))},88236:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>B});var s=t(10326),r=t(17577),l=t(48723),i=t(69217),n=t(34041),c=t(50949),d=t(41291),o=t(18019),m=t(6507),x=t(31540),u=t(94019),h=t(30361),p=t(36283),j=t(21405),g=t(48998),f=t(66697),y=t(31215),v=t(40617),b=t(79635),N=t(7027);let C=e=>({critical:"bg-red-500",major:"bg-orange-500",minor:"bg-yellow-500",warning:"bg-blue-500",info:"bg-gray-500"})[e]||"bg-gray-500",w=e=>({critical:(0,s.jsx)(c.Z,{className:"h-5 w-5"}),major:(0,s.jsx)(d.Z,{className:"h-5 w-5"}),minor:(0,s.jsx)(o.Z,{className:"h-5 w-5"}),warning:(0,s.jsx)(m.Z,{className:"h-5 w-5"}),info:(0,s.jsx)(o.Z,{className:"h-5 w-5"})})[e]||(0,s.jsx)(o.Z,{className:"h-5 w-5"}),_=e=>({active:"bg-red-100 text-red-800 border-red-200",acknowledged:"bg-yellow-100 text-yellow-800 border-yellow-200",cleared:"bg-blue-100 text-blue-800 border-blue-200",resolved:"bg-green-100 text-green-800 border-green-200"})[e]||"bg-gray-100 text-gray-800 border-gray-200",k=(e,a)=>{let t=new Date(e),s=(a?new Date(a):new Date).getTime()-t.getTime(),r=Math.floor(s/36e5),l=Math.floor(s%36e5/6e4);return r>24?`${Math.floor(r/24)}d ${r%24}h`:r>0?`${r}h ${l}m`:`${l}m`};function S({alarm:e,open:a,onClose:t,onUpdate:i,history:c=[],notes:d=[],relatedTickets:o=[],isLoading:m=!1,onAcknowledge:S,onClear:D,onCreateTicket:T,onAddNote:A,onFetchDetails:L}){let[P,q]=(0,r.useState)("details"),[F,$]=(0,r.useState)(""),[B,E]=(0,r.useState)(!1),Z=async()=>{if(e&&S)try{await S(e.id),i?.()}catch(e){console.error("Failed to acknowledge alarm:",e)}},H=async()=>{if(e&&D)try{await D(e.id),i?.()}catch(e){console.error("Failed to clear alarm:",e)}},M=async()=>{if(e&&T)try{await T(e.id),i?.()}catch(e){console.error("Failed to create ticket:",e)}},R=async()=>{if(e&&F.trim()&&A){E(!0);try{await A(e.id,F),$("")}catch(e){console.error("Failed to add note:",e)}finally{E(!1)}}};return e?(0,s.jsx)(l.Dialog,{open:a,onOpenChange:e=>!e&&t(),children:(0,s.jsxs)(l.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,s.jsx)(l.DialogHeader,{children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("div",{className:`p-2 rounded-lg ${C(e.severity)}`,children:(0,s.jsx)("div",{className:"text-white",children:w(e.severity)})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.DialogTitle,{className:"text-xl font-semibold",children:e.title}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,s.jsx)(l.Badge,{variant:"outline",className:"font-mono text-xs",children:e.alarm_id}),(0,s.jsx)(l.Badge,{className:_(e.status),children:e.status.toUpperCase()}),(0,s.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:e.source.toUpperCase()})]})]})]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>{if(!e)return;let a=new Blob([JSON.stringify({alarm:e,history:c,notes:d,exported_at:new Date().toISOString()},null,2)],{type:"application/json"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=`alarm-${e.alarm_id}-${Date.now()}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)},children:[(0,s.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,s.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:t,children:(0,s.jsx)(u.Z,{className:"h-4 w-4"})})]})]})}),(0,s.jsx)(l.Separator,{}),(0,s.jsxs)("div",{className:"flex gap-2 py-2",children:["active"===e.status&&(0,s.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:Z,children:[(0,s.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Acknowledge"]}),("active"===e.status||"acknowledged"===e.status)&&(0,s.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:H,children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Clear"]}),!e.ticket_id&&(0,s.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:M,children:[(0,s.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Create Ticket"]}),(0,s.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>L?.(e.id),children:[(0,s.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),(0,s.jsx)(l.Separator,{}),(0,s.jsxs)(l.Tabs,{value:P,onValueChange:q,className:"flex-1 flex flex-col overflow-hidden",children:[(0,s.jsxs)(l.TabsList,{className:"grid w-full grid-cols-4",children:[(0,s.jsx)(l.TabsTrigger,{value:"details",children:"Details"}),(0,s.jsxs)(l.TabsTrigger,{value:"history",children:["History",c.length>0&&(0,s.jsx)(l.Badge,{variant:"secondary",className:"ml-2",children:c.length})]}),(0,s.jsxs)(l.TabsTrigger,{value:"notes",children:["Notes",d.length>0&&(0,s.jsx)(l.Badge,{variant:"secondary",className:"ml-2",children:d.length})]}),(0,s.jsx)(l.TabsTrigger,{value:"related",children:"Related"})]}),(0,s.jsxs)(l.ScrollArea,{className:"flex-1 mt-4",children:[(0,s.jsxs)(l.TabsContent,{value:"details",className:"space-y-4 mt-0",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{className:"pb-2",children:(0,s.jsx)(l.CardDescription,{children:"First Occurrence"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,n.WU)(new Date(e.first_occurrence),"PPp")})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{className:"pb-2",children:(0,s.jsx)(l.CardDescription,{children:"Last Occurrence"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,n.WU)(new Date(e.last_occurrence),"PPp")})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{className:"pb-2",children:(0,s.jsx)(l.CardDescription,{children:"Duration"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-sm font-medium",children:k(e.first_occurrence,e.cleared_at)})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{className:"pb-2",children:(0,s.jsx)(l.CardDescription,{children:"Occurrences"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-sm font-medium",children:e.occurrence_count})})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{className:"text-base",children:"Alarm Information"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-3",children:[e.description&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Description"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:e.description})]}),e.message&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Message"}),(0,s.jsx)("p",{className:"text-sm mt-1 font-mono bg-muted p-2 rounded",children:e.message})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Alarm Type"}),(0,s.jsx)("p",{className:"text-sm mt-1 font-medium",children:e.alarm_type})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Severity"}),(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(l.Badge,{className:C(e.severity),children:e.severity.toUpperCase()})})]})]})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{className:"text-base",children:"Resource Information"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[e.resource_type&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Resource Type"}),(0,s.jsx)("p",{className:"text-sm mt-1 font-medium",children:e.resource_type})]}),e.resource_name&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Resource Name"}),(0,s.jsx)("p",{className:"text-sm mt-1 font-mono",children:e.resource_name})]}),e.resource_id&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Resource ID"}),(0,s.jsx)("p",{className:"text-sm mt-1 font-mono text-xs",children:e.resource_id})]}),e.customer_name&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Customer"}),(0,s.jsx)("p",{className:"text-sm mt-1 font-medium",children:e.customer_name})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Affected Subscribers"}),(0,s.jsx)("p",{className:"text-sm mt-1 font-medium",children:e.subscriber_count})]})]})]}),(e.is_root_cause||e.probable_cause||e.recommended_action)&&(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{className:"text-base",children:"Root Cause Analysis"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-3",children:[e.is_root_cause&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(l.Badge,{variant:"destructive",children:"Root Cause"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"This is identified as a root cause alarm"})]}),e.probable_cause&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Probable Cause"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:e.probable_cause})]}),e.recommended_action&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Recommended Action"}),(0,s.jsx)("p",{className:"text-sm mt-1",children:e.recommended_action})]}),e.correlation_id&&(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Label,{className:"text-xs text-muted-foreground",children:"Correlation ID"}),(0,s.jsx)("p",{className:"text-sm mt-1 font-mono text-xs",children:e.correlation_id})]})]})]}),Object.keys(e.metadata||{}).length>0&&(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{className:"text-base",children:"Metadata"})}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("pre",{className:"text-xs bg-muted p-3 rounded overflow-x-auto",children:JSON.stringify(e.metadata,null,2)})})]})]}),(0,s.jsx)(l.TabsContent,{value:"history",className:"space-y-4 mt-0",children:0===c.length?(0,s.jsx)(l.Card,{children:(0,s.jsxs)(l.CardContent,{className:"py-8 text-center text-muted-foreground",children:[(0,s.jsx)(g.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{children:"No history available"})]})}):(0,s.jsx)("div",{className:"space-y-4",children:c.map((e,a)=>(0,s.jsx)(l.Card,{children:(0,s.jsx)(l.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:(0,s.jsx)(f.Z,{className:"h-4 w-4 text-primary"})}),a<c.length-1&&(0,s.jsx)("div",{className:"h-full w-0.5 bg-border mt-2"})]}),(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.action}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,n.WU)(new Date(e.timestamp),"PPp")})]}),e.details&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.details}),e.user&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["by ",e.user]}),e.previous_status&&e.new_status&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsx)(l.Badge,{variant:"outline",className:_(e.previous_status),children:e.previous_status}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"→"}),(0,s.jsx)(l.Badge,{variant:"outline",className:_(e.new_status),children:e.new_status})]})]})]})})},e.id))})}),(0,s.jsxs)(l.TabsContent,{value:"notes",className:"space-y-4 mt-0",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{className:"text-base",children:"Add Note"})}),(0,s.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,s.jsx)(l.Textarea,{placeholder:"Enter your note here...",value:F,onChange:e=>$(e.target.value),rows:3}),(0,s.jsxs)(l.Button,{onClick:R,disabled:!F.trim()||B,size:"sm",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),B?"Saving...":"Add Note"]})]})]}),0===d.length?(0,s.jsx)(l.Card,{children:(0,s.jsxs)(l.CardContent,{className:"py-8 text-center text-muted-foreground",children:[(0,s.jsx)(v.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{children:"No notes yet"})]})}):(0,s.jsx)("div",{className:"space-y-4",children:d.map(e=>(0,s.jsx)(l.Card,{children:(0,s.jsx)(l.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:e.user_name})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,n.WU)(new Date(e.created_at),"PPp")})]}),(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content})]})})},e.id))})]}),(0,s.jsxs)(l.TabsContent,{value:"related",className:"space-y-4 mt-0",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsx)(l.CardHeader,{children:(0,s.jsx)(l.CardTitle,{className:"text-base",children:"Related Tickets"})}),(0,s.jsx)(l.CardContent,{children:0===o.length?(0,s.jsxs)("div",{className:"py-8 text-center text-muted-foreground",children:[(0,s.jsx)(p.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{children:"No related tickets"}),!e.ticket_id&&(0,s.jsx)(l.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:M,children:"Create Ticket"})]}):(0,s.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.ticket_number}),(0,s.jsx)(l.Badge,{variant:"outline",children:e.status}),(0,s.jsx)(l.Badge,{variant:"secondary",children:e.priority})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.title}),e.assigned_to&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Assigned to: ",e.assigned_to]})]}),(0,s.jsx)(l.Button,{variant:"ghost",size:"sm",children:(0,s.jsx)(N.Z,{className:"h-4 w-4"})})]},e.id))})})]}),e.correlation_id&&(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{className:"text-base",children:"Correlated Alarms"}),(0,s.jsxs)(l.CardDescription,{children:["Correlation ID: ",e.correlation_id]})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Correlation data will be loaded here"})})]})]})]})]})]})}):null}var D=t(59341);function T(e){let{alarm:a,open:t}=e,[l,i]=(0,r.useState)([]),[n,c]=(0,r.useState)([]),[d,o]=(0,r.useState)([]),[m,x]=(0,r.useState)(!1),u=(0,r.useCallback)(async e=>{if(a){x(!0);try{let t=await D.x1.get(`/api/v1/faults/alarms/${e}/history`);i(t.data||[]);let s=await D.x1.get(`/api/v1/faults/alarms/${e}/notes`);if(c(s.data||[]),a.ticket_id){let e=await D.x1.get(`/api/v1/tickets/${a.ticket_id}`);o([e.data])}}catch(e){console.error("Failed to fetch alarm details:",e)}finally{x(!1)}}},[a]),h=async a=>{await D.x1.post(`/api/v1/faults/alarms/${a}/acknowledge`,{note:"Acknowledged from detail view"}),e.onUpdate?.(),u(a)},p=async a=>{await D.x1.post(`/api/v1/faults/alarms/${a}/clear`,{}),e.onUpdate?.(),u(a)},j=async t=>{a&&(await D.x1.post(`/api/v1/faults/alarms/${t}/create-ticket`,{priority:"critical"===a.severity?"urgent":"normal"}),e.onUpdate?.(),u(t))},g=async(e,a)=>{await D.x1.post(`/api/v1/faults/alarms/${e}/notes`,{content:a}),u(e)};return(0,s.jsx)(S,{...e,history:l,notes:n,relatedTickets:d,isLoading:m,onAcknowledge:h,onClear:p,onCreateTicket:j,onAddNote:g,onFetchDetails:u})}var A=t(46502),L=t(48324),P=t(44976),q=t(17010),F=t(29771);let $={all:["faults"],alarms:e=>[...$.all,"alarms",e],statistics:()=>[...$.all,"statistics"],slaCompliance:e=>[...$.all,"sla-compliance",e],slaRollup:(e,a)=>[...$.all,"sla-rollup",e,a],alarmDetails:e=>[...$.all,"alarm-details",e]};function B(){var e;let{hasPermission:a}=(0,A.ss)(),[t,n]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),[x,f]=(0,r.useState)(!0),y=a("faults.alarms.read"),{alarms:v,isLoading:b,refetch:N}=function(e){let a=(0,L.a)({queryKey:$.alarms(e),queryFn:async()=>{try{let a=new URLSearchParams;e?.severity&&e.severity.forEach(e=>a.append("severity",e)),e?.status&&e.status.forEach(e=>a.append("status",e)),e?.source&&e.source.forEach(e=>a.append("source",e)),e?.alarm_type&&a.set("alarm_type",e.alarm_type),e?.resource_type&&a.set("resource_type",e.resource_type),e?.resource_id&&a.set("resource_id",e.resource_id),e?.customer_id&&a.set("customer_id",e.customer_id),e?.assigned_to&&a.set("assigned_to",e.assigned_to),e?.is_root_cause!==void 0&&a.set("is_root_cause",String(e.is_root_cause)),e?.from_date&&a.set("from_date",e.from_date),e?.to_date&&a.set("to_date",e.to_date),e?.limit&&a.set("limit",String(e.limit)),e?.offset&&a.set("offset",String(e.offset));let t=`/faults/alarms${a.toString()?`?${a.toString()}`:""}`;return(await D.x1.get(t)).data||[]}catch(e){throw F.k.error("Failed to fetch alarms",e instanceof Error?e:Error(String(e))),e}},staleTime:1e4,refetchInterval:3e4,refetchOnWindowFocus:!0});return{...a,alarms:a.data??[]}}({limit:100,offset:0}),{statistics:C}=function(){let e=(0,L.a)({queryKey:$.statistics(),queryFn:async()=>{try{return(await D.x1.get("/faults/alarms/statistics")).data||{}}catch(e){throw F.k.error("Failed to fetch alarm statistics",e instanceof Error?e:Error(String(e))),e}},staleTime:3e4,refetchInterval:6e4,refetchOnWindowFocus:!0});return{...e,statistics:e.data}}(),{acknowledgeAlarms:w,clearAlarms:_,createTickets:k,isLoading:S}=function(){let e=(0,P.NL)(),a=(0,q.D)({mutationFn:async({alarmIds:e,note:a})=>{let t=a?{note:a}:{},s=e.map(e=>D.x1.post(`/faults/alarms/${e}/acknowledge`,t));await Promise.all(s)},onSuccess:()=>{e.invalidateQueries({queryKey:$.all})},onError:e=>{F.k.error("Failed to acknowledge alarms",e instanceof Error?e:Error(String(e)))}}),t=(0,q.D)({mutationFn:async e=>{let a=e.map(e=>D.x1.post(`/faults/alarms/${e}/clear`,{}));await Promise.all(a)},onSuccess:()=>{e.invalidateQueries({queryKey:$.all})},onError:e=>{F.k.error("Failed to clear alarms",e instanceof Error?e:Error(String(e)))}}),s=(0,q.D)({mutationFn:async({alarmIds:e,priority:a="normal"})=>{let t=e.map(e=>D.x1.post(`/faults/alarms/${e}/create-ticket`,{priority:a}));await Promise.all(t)},onSuccess:()=>{e.invalidateQueries({queryKey:$.all})},onError:e=>{F.k.error("Failed to create tickets",e instanceof Error?e:Error(String(e)))}});return{acknowledgeAlarms:async(e,t)=>{try{return await a.mutateAsync(t?{alarmIds:e,note:t}:{alarmIds:e}),!0}catch{return!1}},clearAlarms:async e=>{try{return await t.mutateAsync(e),!0}catch{return!1}},createTickets:async(e,a="normal")=>{try{return await s.mutateAsync({alarmIds:e,priority:a}),!0}catch{return!1}},isLoading:a.isPending||t.isPending||s.isPending,error:a.error||t.error||s.error||null}}(),{data:B=[],isLoading:E,error:Z,refetch:H}=(e={days:30,excludeMaintenance:x},(0,L.a)({queryKey:$.slaCompliance(e),queryFn:async()=>{try{let a=new URLSearchParams,t=e?.days??30,s=e?.fromDate??new Date(Date.now()-864e5*t).toISOString();a.set("from_date",s),e?.excludeMaintenance!==void 0&&a.set("exclude_maintenance",String(e.excludeMaintenance));let r=`/faults/sla/compliance?${a.toString()}`;return(await D.x1.get(r)).data||[]}catch(e){throw F.k.error("Failed to fetch SLA compliance",e instanceof Error?e:Error(String(e))),e}},staleTime:3e5,refetchOnWindowFocus:!0})),{stats:M,isLoading:R}=function(e=30,a=99.9){let t=(0,L.a)({queryKey:$.slaRollup(e,a),queryFn:async()=>{try{let t=new URLSearchParams;t.set("days",String(e)),t.set("target_percentage",String(a));let s=`/faults/sla/rollup-stats?${t.toString()}`;return(await D.x1.get(s)).data||null}catch(e){throw F.k.error("Failed to fetch SLA rollup stats",e instanceof Error?e:Error(String(e))),e}},staleTime:3e5,refetchOnWindowFocus:!0});return{...t,stats:t.data??null}}(30,99.9),U=b||S,O=(0,r.useMemo)(()=>{if(C)return{active:C.active_alarms,critical:C.critical_alarms,acknowledged:C.acknowledged_alarms,totalImpacted:C.total_impacted_subscribers||0};let e=v.filter(e=>"active"===e.status).length;return{active:e,critical:v.filter(e=>"critical"===e.severity&&"active"===e.status).length,acknowledged:v.filter(e=>"acknowledged"===e.status).length,totalImpacted:v.filter(e=>"active"===e.status).reduce((e,a)=>e+a.subscriber_count,0)}},[v,C]),I=(0,r.useMemo)(()=>{if(!v.length)return[];let e=Array.from({length:24},(e,a)=>({hour:`${a.toString().padStart(2,"0")}:00`,critical:0,major:0,minor:0,warning:0,info:0}));return v.forEach(a=>{let t=new Date(a.last_occurrence||a.first_occurrence||a.created_at||new Date().toISOString()).getHours(),s=(a.severity||"info").toLowerCase(),r=e[t];r&&(s in r?r[s]+=1:r.info+=1)}),e},[v]),K=(0,r.useMemo)(()=>B.map(e=>({dateLabel:new Date(e.date).toLocaleDateString(void 0,{month:"short",day:"numeric"}),compliance:e.compliance_percentage,target:e.target_percentage})),[B]),z=[{accessorKey:"severity",header:"Severity",cell:({row:e})=>{let a=e.getValue("severity"),{color:t,icon:r}={critical:{color:"bg-red-600 text-white",icon:c.Z},major:{color:"bg-orange-500 text-white",icon:c.Z},minor:{color:"bg-yellow-500 text-black",icon:g.Z},warning:{color:"bg-yellow-400 text-black",icon:c.Z},info:{color:"bg-blue-500 text-white",icon:o.Z}}[a];return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r,{className:"h-4 w-4"}),(0,s.jsx)(l.Badge,{className:t,children:a})]})}},{accessorKey:"alarm_type",header:(0,l.createSortableHeader)("Type"),cell:({row:e})=>(0,s.jsx)("div",{className:"font-mono text-xs",children:e.getValue("alarm_type")})},{accessorKey:"title",header:(0,l.createSortableHeader)("Title"),cell:({row:e})=>(0,s.jsxs)("div",{className:"max-w-md",children:[(0,s.jsx)("div",{className:"font-medium",children:e.getValue("title")}),e.original.resource_name&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.original.resource_name})]})},{accessorKey:"customer_name",header:"Customer",cell:({row:e})=>{let a=e.getValue("customer_name"),t=e.original.subscriber_count;return a||t>0?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:a||"Multiple"}),t>0&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[t," subscriber",1!==t?"s":""]})]}):(0,s.jsx)("span",{className:"text-muted-foreground",children:"—"})}},{accessorKey:"status",header:"Status",cell:({row:e})=>{let{color:a,label:t}={active:{color:"bg-red-500 text-white",label:"Active"},acknowledged:{color:"bg-yellow-500 text-black",label:"Acknowledged"},cleared:{color:"bg-blue-500 text-white",label:"Cleared"},resolved:{color:"bg-green-500 text-white",label:"Resolved"}}[e.getValue("status")];return(0,s.jsx)(l.Badge,{className:a,children:t})}},{accessorKey:"occurrence_count",header:(0,l.createSortableHeader)("Count"),cell:({row:e})=>(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(l.Badge,{variant:"outline",children:e.getValue("occurrence_count")})})},{accessorKey:"last_occurrence",header:(0,l.createSortableHeader)("Last Seen"),cell:({row:e})=>{let a=new Date(e.getValue("last_occurrence")),t=Math.floor((new Date().getTime()-a.getTime())/6e4),r=Math.floor(t/60),l="";return l=r>24?`${Math.floor(r/24)}d ago`:r>0?`${r}h ago`:`${t}m ago`,(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm",children:l}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:a.toLocaleTimeString()})]})}}],W=[{label:"Acknowledge",icon:h.Z,action:async e=>{let a=e.map(e=>e.id);await w(a,"Bulk acknowledged via dashboard")&&await N()},disabled:e=>e.every(e=>"active"!==e.status)},{label:"Clear Alarms",icon:u.Z,action:async e=>{let a=e.map(e=>e.id);await _(a)&&await N()}},{label:"Create Ticket",icon:p.Z,action:async e=>{let a=e.map(e=>e.id);await k(a,"normal")&&(alert(`Successfully created tickets for ${e.length} alarm(s)`),await N())}}];return y?(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-6 py-8 space-y-6",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Fault Management"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Monitor and manage network alarms and SLA compliance"})]}),(0,s.jsxs)(l.Button,{onClick:()=>N(),variant:"outline",disabled:U,children:[(0,s.jsx)(j.Z,{className:`h-4 w-4 mr-2 ${U?"animate-spin":""}`}),"Refresh"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"pb-3",children:[(0,s.jsx)(l.CardDescription,{children:"Active Alarms"}),(0,s.jsx)(l.CardTitle,{className:"text-3xl",children:O.active})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Currently active in the system"})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"pb-3",children:[(0,s.jsx)(l.CardDescription,{children:"Critical Alarms"}),(0,s.jsx)(l.CardTitle,{className:"text-3xl text-red-600",children:O.critical})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Requiring immediate attention"})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"pb-3",children:[(0,s.jsx)(l.CardDescription,{children:"Acknowledged"}),(0,s.jsx)(l.CardTitle,{className:"text-3xl",children:O.acknowledged})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Being handled by operators"})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"pb-3",children:[(0,s.jsx)(l.CardDescription,{children:"Impacted Subscribers"}),(0,s.jsx)(l.CardTitle,{className:"text-3xl",children:O.totalImpacted})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Affected by active alarms"})})]})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"SLA Performance Summary (Last 30 Days)"}),(0,s.jsx)(l.CardDescription,{children:"Aggregate downtime, breach metrics, and compliance tracking"})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Total Downtime"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:R?"...":`${((M?.total_downtime_minutes??0)/60).toFixed(1)}h`}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:[M?.total_downtime_minutes??0," minutes total"]})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Total Breaches"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:R?"...":M?.total_breaches??0}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Days below ",99.9,"% uptime"]})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Worst Day"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:R?"...":`${(M?.worst_day_compliance??100).toFixed(2)}%`}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Minimum compliance in period"})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Average Compliance"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:R?"...":`${(M?.avg_compliance??100).toFixed(2)}%`}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Mean uptime across all days"})]})]})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"Alarm Frequency (Last 24 Hours)"}),(0,s.jsx)(l.CardDescription,{children:"Alarms by severity over time"})]}),(0,s.jsx)(l.CardContent,{children:0===I.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No alarm telemetry available for the past 24 hours."}):(0,s.jsx)(i.fu$,{type:"bar",data:I,series:[{key:"critical",name:"Critical",color:"#dc2626"},{key:"major",name:"Major",color:"#f97316"},{key:"minor",name:"Minor",color:"#eab308"},{key:"warning",name:"Warning",color:"#facc15"},{key:"info",name:"Info",color:"#3b82f6"}],xAxis:{dataKey:"hour"},height:300,stacked:!0})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(l.CardTitle,{children:"SLA Compliance Trends"}),(0,s.jsx)(l.CardDescription,{children:"Network availability over the last 30 days"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(l.Label,{htmlFor:"exclude-maintenance",className:"text-sm text-muted-foreground",children:"Exclude maintenance windows"}),(0,s.jsx)(l.Switch,{id:"exclude-maintenance",checked:x,onCheckedChange:e=>f(e)})]})]}),(0,s.jsx)(l.CardContent,{children:E?(0,s.jsx)(l.Skeleton,{className:"h-[320px] w-full"}):Z?(0,s.jsxs)(l.Alert,{variant:"destructive",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4"}),(0,s.jsxs)(l.AlertDescription,{className:"flex items-center justify-between gap-4",children:[(0,s.jsx)("span",{children:"Unable to load SLA compliance data."}),(0,s.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>H(),children:[(0,s.jsx)(j.Z,{className:"h-3 w-3 mr-1"}),"Retry"]})]})]}):0===K.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No SLA telemetry is available for this period."}):(0,s.jsx)(i.fu$,{type:"line",data:K,series:[{key:"compliance",name:"Actual Compliance",type:"area",color:"#10b981"},{key:"target",name:"Target",strokeDasharray:"5 5",color:"#6b7280"}],xAxis:{dataKey:"dateLabel"},yAxis:{left:{format:e=>`${e.toFixed(1)}%`,domain:[95,100]}},height:300,smooth:!0})})]}),(0,s.jsxs)(l.Card,{children:[(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"Active Alarms"}),(0,s.jsx)(l.CardDescription,{children:"All alarms in the system with filtering and bulk actions"})]}),(0,s.jsx)(l.CardContent,{children:(0,s.jsx)(l.EnhancedDataTable,{data:v,columns:z,searchColumn:"title",searchPlaceholder:"Search alarms by title...",isLoading:U,selectable:!0,bulkActions:W,exportable:!0,exportFilename:"alarms",exportColumns:["alarm_id","severity","status","alarm_type","title","resource_name","customer_name"],filterable:!0,filters:[{column:"severity",label:"Severity",type:"select",options:[{label:"Critical",value:"critical"},{label:"Major",value:"major"},{label:"Minor",value:"minor"},{label:"Warning",value:"warning"},{label:"Info",value:"info"}]},{column:"status",label:"Status",type:"select",options:[{label:"Active",value:"active"},{label:"Acknowledged",value:"acknowledged"},{label:"Cleared",value:"cleared"},{label:"Resolved",value:"resolved"}]},{column:"source",label:"Source",type:"select",options:[{label:"GenieACS",value:"genieacs"},{label:"VOLTHA",value:"voltha"},{label:"NetBox",value:"netbox"},{label:"Manual",value:"manual"}]}],onRowClick:e=>{n(e),m(!0)}})})]}),(0,s.jsx)(T,{alarm:t,open:d,onClose:()=>{m(!1),n(null)},onUpdate:()=>{N()}})]}):(0,s.jsx)("main",{className:"max-w-7xl mx-auto px-6 py-12",children:(0,s.jsx)(l.Card,{children:(0,s.jsxs)(l.CardHeader,{children:[(0,s.jsx)(l.CardTitle,{children:"Fault Management"}),(0,s.jsxs)(l.CardDescription,{children:["Access requires ",(0,s.jsx)("code",{children:"faults.alarms.read"})," permission."]})]})})})}},81125:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>s});let s=(0,t(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/faults/page.tsx#default`)}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),s=a.X(0,[2793,1009,6226,657,6032,4218],()=>t(60912));module.exports=s})();