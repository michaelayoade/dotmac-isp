(()=>{var e={};e.id=9025,e.ids=[9025],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},52037:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>o}),r(66675),r(13321),r(46366),r(96560);var s=r(23191),a=r(88716),i=r(37922),n=r.n(i),d=r(95231),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);r.d(t,l);let o=["",{children:["dashboard",{children:["network",{children:["wireguard",{children:["peers",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,66675)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/new/page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/new/page.tsx"],p="/dashboard/network/wireguard/peers/new/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/network/wireguard/peers/new/page",pathname:"/dashboard/network/wireguard/peers/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},93500:(e,t,r)=>{Promise.resolve().then(r.bind(r,35965))},35965:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v,dynamic:()=>h,dynamicParams:()=>x});var s=r(10326),a=r(17577),i=r(35047),n=r(90434),d=r(4743),l=r(89098),o=r(48723),c=r(77506),p=r(86333),u=r(41291),m=r(31215);let h="force-dynamic",x=!0;function v(){let e=(0,i.useRouter)(),{toast:t}=(0,o.useToast)(),r=(0,d.Ml)(),{data:h,isLoading:x}=(0,d.JI)({status:l.dN.ACTIVE}),[v,g]=(0,a.useState)({server_id:"",name:"",peer_name:"",customer_id:"",allowed_ips:"0.0.0.0/0, ::/0",persistent_keepalive:25,notes:""}),[y,f]=(0,a.useState)({}),[w,_]=(0,a.useState)(!1),j=()=>{let e={};if(v.server_id||(e.server_id="Server is required"),v.peer_name&&0!==v.peer_name.trim().length?v.peer_name.length>100&&(e.peer_name="Peer name must be 100 characters or less"):e.peer_name="Peer name is required",w&&!v.customer_id&&(e.customer_id="Customer ID is required when customer info is enabled"),v.allowed_ips){for(let t of"string"==typeof v.allowed_ips?v.allowed_ips.split(",").map(e=>e.trim()):v.allowed_ips)if(t&&!/^[\d\.:a-fA-F]+\/\d+$/.test(t)){e.allowed_ips=`Invalid IP range: ${t}`;break}}return void 0!==v.persistent_keepalive&&null!==v.persistent_keepalive&&(v.persistent_keepalive<0||v.persistent_keepalive>3600)&&(e.persistent_keepalive="Persistent keepalive must be between 0 and 3600 seconds"),v.expiration_date&&new Date(v.expiration_date)<new Date&&(e.expiration_date="Expiration date must be in the future"),f(e),0===Object.keys(e).length},b=async s=>{if(s.preventDefault(),!j()){t({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});return}let a=(v.peer_name||v.name||"").trim(),i=v.allowed_ips,n="string"==typeof i?i.trim():Array.isArray(i)?i[0]:"0.0.0.0/0, ::/0",d={server_id:v.server_id,name:a||"WireGuard Peer",allowed_ips:n||"0.0.0.0/0, ::/0",persistent_keepalive:void 0!==v.persistent_keepalive?v.persistent_keepalive:25};if(a&&(d.peer_name=a),w){let e=v.customer_id?.trim();e&&(d.customer_id=e)}if(v.notes){let e=v.notes.trim();e&&(d.notes=e)}v.expiration_date&&(d.expiration_date=v.expiration_date),r.mutate(d,{onSuccess:r=>{t({title:"Peer Created",description:`Peer "${r.peer_name}" has been created successfully`}),e.push(`/dashboard/network/wireguard/peers/${r.id}`)},onError:e=>{t({title:"Error Creating Peer",description:e.response?.data?.detail||"Failed to create peer",variant:"destructive"})}})},N=(e,t)=>{g(r=>({...r,[e]:t})),y[e]&&f(t=>{let r={...t};return delete r[e],r})};return x?(0,s.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,s.jsx)(c.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,s.jsx)(n.default,{href:"/dashboard/network/wireguard/peers",children:(0,s.jsxs)(o.Button,{variant:"ghost",size:"sm",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Back to Peers"]})})}),(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Create WireGuard Peer"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:"Add a new VPN peer to a WireGuard server"})]})}),h&&0===h.length&&(0,s.jsxs)(o.Alert,{children:[(0,s.jsx)(u.Z,{className:"h-4 w-4"}),(0,s.jsxs)(o.AlertDescription,{children:["No active WireGuard servers available. Please"," ",(0,s.jsx)(n.default,{href:"/dashboard/network/wireguard/servers/new",className:"underline font-medium",children:"create a server"})," ","first."]})]}),(0,s.jsx)("form",{onSubmit:b,children:(0,s.jsxs)(o.Card,{children:[(0,s.jsxs)(o.CardHeader,{children:[(0,s.jsx)(o.CardTitle,{children:"Peer Configuration"}),(0,s.jsx)(o.CardDescription,{children:"Enter the peer details. Keys and IP address will be generated automatically."})]}),(0,s.jsxs)(o.CardContent,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(o.Label,{htmlFor:"server_id",children:["WireGuard Server ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)(o.Select,{value:v.server_id,onValueChange:e=>N("server_id",e),children:[(0,s.jsx)(o.SelectTrigger,{id:"server_id",children:(0,s.jsx)(o.SelectValue,{placeholder:"Select a server"})}),(0,s.jsx)(o.SelectContent,{children:h?.map(e=>s.jsxs(o.SelectItem,{value:e.id,children:[e.name," (",e.public_endpoint,")"]},e.id))})]}),y.server_id&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:y.server_id})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(o.Label,{htmlFor:"peer_name",children:["Peer Name ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(o.Input,{id:"peer_name",value:v.peer_name,onChange:e=>N("peer_name",e.target.value),placeholder:"e.g., john-laptop, office-router",maxLength:100}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Friendly name to identify this peer"}),y.peer_name&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:y.peer_name})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"has_customer",checked:w,onChange:e=>_(e.target.checked),className:"h-4 w-4 rounded border-gray-300"}),(0,s.jsx)(o.Label,{htmlFor:"has_customer",className:"font-normal cursor-pointer",children:"Associate with customer (optional)"})]}),w&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(o.Label,{htmlFor:"customer_id",children:["Customer ID ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(o.Input,{id:"customer_id",value:v.customer_id||"",onChange:e=>N("customer_id",e.target.value),placeholder:"Enter customer ID"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Link this peer to a customer account"}),y.customer_id&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:y.customer_id})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.Label,{htmlFor:"allowed_ips",children:"Allowed IPs"}),(0,s.jsx)(o.Input,{id:"allowed_ips",value:v.allowed_ips,onChange:e=>N("allowed_ips",e.target.value),placeholder:"0.0.0.0/0, ::/0"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Comma-separated list of IP ranges this peer can route (default: all traffic)"}),y.allowed_ips&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:y.allowed_ips})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.Label,{htmlFor:"persistent_keepalive",children:"Persistent Keepalive (seconds)"}),(0,s.jsx)(o.Input,{id:"persistent_keepalive",type:"number",min:0,max:3600,value:v.persistent_keepalive||25,onChange:e=>N("persistent_keepalive",parseInt(e.target.value,10))}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"How often to send keepalive packets (0 = disabled, recommended: 25)"}),y.persistent_keepalive&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:y.persistent_keepalive})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.Label,{htmlFor:"expiration_date",children:"Expiration Date (optional)"}),(0,s.jsx)(o.Input,{id:"expiration_date",type:"datetime-local",value:v.expiration_date||"",onChange:e=>N("expiration_date",e.target.value)}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"When this peer's access should expire (leave blank for no expiration)"}),y.expiration_date&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:y.expiration_date})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.Label,{htmlFor:"notes",children:"Notes"}),(0,s.jsx)(o.Textarea,{id:"notes",value:v.notes||"",onChange:e=>N("notes",e.target.value),placeholder:"Additional information about this peer...",rows:4}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Internal notes for reference"})]}),(0,s.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,s.jsx)(o.Button,{type:"submit",disabled:r.isPending||h?.length===0,children:r.isPending?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Create Peer"]})}),(0,s.jsx)(n.default,{href:"/dashboard/network/wireguard/peers",children:(0,s.jsx)(o.Button,{type:"button",variant:"outline",children:"Cancel"})})]})]})]})}),(0,s.jsxs)(o.Card,{children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsx)(o.CardTitle,{children:"What Happens Next?"})}),(0,s.jsxs)(o.CardContent,{className:"space-y-2 text-sm",children:[(0,s.jsx)("p",{children:"When you create a peer, the system will automatically:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,s.jsx)("li",{children:"Generate a unique public/private key pair for the peer"}),(0,s.jsx)("li",{children:"Allocate an available IP address from the server's subnet"}),(0,s.jsx)("li",{children:"Create the WireGuard configuration file"}),(0,s.jsx)("li",{children:"Make the configuration available for download"})]}),(0,s.jsx)("p",{className:"mt-4 font-medium",children:"After creation, you can download the configuration file and import it into the WireGuard client."})]})]})]})}},4743:(e,t,r)=>{"use strict";r.d(t,{EQ:()=>h,Eb:()=>p,FP:()=>v,JI:()=>c,Ml:()=>y,Mp:()=>w,Nd:()=>u,aN:()=>g,d4:()=>_,f2:()=>x,f_:()=>j,mI:()=>m,sZ:()=>f,v6:()=>b,vY:()=>N});var s=r(48324),a=r(44976),i=r(17010),n=r(59341);let d="/wireguard",l=["wireguard"],o={all:l,servers:{all:[...l,"servers"],lists:()=>[...l,"servers","list"],list:e=>[...l,"servers","list",e],detail:e=>[...l,"servers","detail",e],health:e=>[...l,"servers","health",e]},peers:{all:[...l,"peers"],lists:()=>[...l,"peers","list"],list:e=>[...l,"peers","list",e],detail:e=>[...l,"peers","detail",e],config:e=>[...l,"peers","config",e]},dashboard:()=>[...l,"dashboard"]};function c(e={}){return(0,s.a)({queryKey:o.servers.list(e),queryFn:async()=>{let t=new URLSearchParams;e.status&&t.append("status",e.status),e.location&&t.append("location",e.location),e.limit&&t.append("limit",String(e.limit)),e.offset&&t.append("offset",String(e.offset));let r=`${d}/servers?${t.toString()}`;return(await n.x1.get(r)).data},staleTime:3e4})}function p(e){return(0,s.a)({queryKey:o.servers.detail(e),queryFn:async()=>(await n.x1.get(`${d}/servers/${e}`)).data,enabled:!!e,staleTime:6e4})}function u(e){return(0,s.a)({queryKey:o.servers.health(e),queryFn:async()=>(await n.x1.get(`${d}/servers/${e}/health`)).data,enabled:!!e,staleTime:1e4,refetchInterval:3e4})}function m(){let e=(0,a.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.post(`${d}/servers`,e)).data,onSuccess:()=>{e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function h(){let e=(0,a.NL)();return(0,i.D)({mutationFn:async({serverId:e,data:t})=>(await n.x1.patch(`${d}/servers/${e}`,t)).data,onSuccess:(t,r)=>{e.invalidateQueries({queryKey:o.servers.detail(r.serverId)}),e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function x(){let e=(0,a.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.delete(`${d}/servers/${e}`),e),onSuccess:()=>{e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function v(e={}){return(0,s.a)({queryKey:o.peers.list(e),queryFn:async()=>{let t=new URLSearchParams;e.server_id&&t.append("server_id",e.server_id),e.customer_id&&t.append("customer_id",e.customer_id),e.subscriber_id&&t.append("subscriber_id",e.subscriber_id),e.status&&t.append("status",e.status),e.limit&&t.append("limit",String(e.limit)),e.offset&&t.append("offset",String(e.offset));let r=`${d}/peers?${t.toString()}`;return(await n.x1.get(r)).data},staleTime:3e4})}function g(e){return(0,s.a)({queryKey:o.peers.detail(e),queryFn:async()=>(await n.x1.get(`${d}/peers/${e}`)).data,enabled:!!e,staleTime:6e4})}function y(){let e=(0,a.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.post(`${d}/peers`,e)).data,onSuccess:t=>{e.invalidateQueries({queryKey:o.peers.lists()}),e.invalidateQueries({queryKey:o.servers.detail(t.server_id)}),e.invalidateQueries({queryKey:o.dashboard()})}})}function f(){let e=(0,a.NL)();return(0,i.D)({mutationFn:async({peerId:e,data:t})=>(await n.x1.patch(`${d}/peers/${e}`,t)).data,onSuccess:(t,r)=>{e.invalidateQueries({queryKey:o.peers.detail(r.peerId)}),e.invalidateQueries({queryKey:o.peers.lists()}),e.invalidateQueries({queryKey:o.servers.detail(t.server_id)}),e.invalidateQueries({queryKey:o.dashboard()})}})}function w(){let e=(0,a.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.delete(`${d}/peers/${e}`),e),onSuccess:()=>{e.invalidateQueries({queryKey:o.peers.lists()}),e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function _(){let e=(0,a.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.post(`${d}/peers/${e}/regenerate`)).data,onSuccess:(t,r)=>{e.invalidateQueries({queryKey:o.peers.detail(r)}),e.invalidateQueries({queryKey:o.peers.config(r)})}})}function j(){return(0,s.a)({queryKey:o.dashboard(),queryFn:async()=>(await n.x1.get(`${d}/dashboard`)).data,staleTime:1e4,refetchInterval:3e4})}function b(){let e=(0,a.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.post(`${d}/provision`,e)).data,onSuccess:()=>{e.invalidateQueries({queryKey:o.peers.lists()}),e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function N(){return(0,i.D)({mutationFn:async e=>{let t=(await n.x1.get(`${d}/peers/${e}/config`)).data,r=new Blob([t.config_file],{type:"text/plain"}),s=window.URL.createObjectURL(r),a=document.createElement("a");return a.href=s,a.download=`${t.peer_name}.conf`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s),t}})}},89098:(e,t,r)=>{"use strict";var s,a;r.d(t,{Aj:()=>i,Cz:()=>n,Sc:()=>a,dN:()=>s,pi:()=>l,td:()=>d}),function(e){e.ACTIVE="active",e.INACTIVE="inactive",e.DEGRADED="degraded",e.MAINTENANCE="maintenance"}(s||(s={})),function(e){e.ACTIVE="active",e.INACTIVE="inactive",e.DISABLED="disabled",e.EXPIRED="expired"}(a||(a={}));let i={active:"bg-green-500",inactive:"bg-gray-500",degraded:"bg-yellow-500",maintenance:"bg-blue-500"},n={active:"bg-green-500",inactive:"bg-gray-500",disabled:"bg-red-500",expired:"bg-orange-500"};function d(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,t)).toFixed(2))} ${["B","KB","MB","GB","TB"][t]}`}function l(e){if(!e)return"Never";let t=Math.floor((new Date().getTime()-new Date(e).getTime())/1e3),r=Math.floor(t/60),s=Math.floor(r/60),a=Math.floor(s/24);return a>0?`${a}d ago`:s>0?`${s}h ago`:r>0?`${r}m ago`:`${t}s ago`}},66675:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,dynamic:()=>a,dynamicParams:()=>i});var s=r(68570);let a=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/new/page.tsx#dynamic`),i=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/new/page.tsx#dynamicParams`),n=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/new/page.tsx#default`)}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[2793,1009,6226,657,6032,4218],()=>r(52037));module.exports=s})();