(()=>{var e={};e.id=4341,e.ids=[4341],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},35766:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>l}),t(75994),t(13321),t(46366),t(96560);var a=t(23191),i=t(88716),r=t(37922),n=t.n(r),o=t(95231),d={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);t.d(s,d);let l=["",{children:["dashboard",{children:["network",{children:["sessions",{children:["live",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,75994)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/sessions/live/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/sessions/live/page.tsx"],p="/dashboard/network/sessions/live/page",x={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/dashboard/network/sessions/live/page",pathname:"/dashboard/network/sessions/live",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},79242:(e,s,t)=>{Promise.resolve().then(t.bind(t,79537))},79537:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>v});var a=t(10326),i=t(17577),r=t(48723),n=t(66697),o=t(45091),d=t(24061),l=t(29163),c=t(17069),p=t(48998),x=t(69669),m=t(47101),u=t(96409),h=t(17010),g=t(59341),f=t(29771);function j({maxSessions:e=100,enabled:s=!0,compact:t=!1}){let[j,v]=(0,i.useState)(new Map),{status:b,isConnected:N}=(0,m.yv)(e=>{D(e)},s),{disconnectSession:_,isDisconnecting:w}=function(){let{toast:e}=(0,r.useToast)(),s=(0,h.D)({mutationFn:async({username:e,acctsessionid:s,nasipaddress:t})=>(await g.x1.post("/radius/sessions/disconnect",{username:e,acctsessionid:s,nasipaddress:t})).data,onSuccess:(s,t)=>{f.k.info("RADIUS session disconnected",{username:t.username,acctsessionid:t.acctsessionid}),e({title:"Session Disconnected",description:"The RADIUS session has been disconnected successfully."})},onError:(s,t)=>{f.k.error("Failed to disconnect RADIUS session",{username:t.username,acctsessionid:t.acctsessionid,error:s}),e({title:"Failed to Disconnect Session",description:s.response?.data?.detail||"Unable to disconnect session. Please try again.",variant:"destructive"})}}),t=(0,h.D)({mutationFn:async({host:e,count:s=4})=>(await g.x1.post("/diagnostics/ping",{host:e,count:s})).data,onSuccess:s=>{f.k.info("Ping completed",{host:s.host,packetLoss:s.packet_loss_percent}),e({title:"Ping Completed",description:`${s.packets_received}/${s.packets_sent} packets received (${s.packet_loss_percent}% loss)`})},onError:(s,t)=>{f.k.error("Failed to ping device",{host:t.host,error:s}),e({title:"Ping Failed",description:s.response?.data?.detail||"Unable to ping device. Please try again.",variant:"destructive"})}}),a=(0,h.D)({mutationFn:async({host:e,maxHops:s=30})=>(await g.x1.post("/diagnostics/traceroute",{host:e,max_hops:s})).data,onSuccess:s=>{f.k.info("Traceroute completed",{host:s.host,hops:s.hops.length}),e({title:"Traceroute Completed",description:`Reached ${s.host} in ${s.hops.length} hops`})},onError:(s,t)=>{f.k.error("Failed to traceroute device",{host:t.host,error:s}),e({title:"Traceroute Failed",description:s.response?.data?.detail||"Unable to traceroute device. Please try again.",variant:"destructive"})}});return{disconnectSession:s,pingDevice:t,tracerouteDevice:a,isDisconnecting:s.isPending,isPinging:t.isPending,isTracerouting:a.isPending,isLoading:s.isPending||t.isPending||a.isPending,pingResult:t.data,tracerouteResult:a.data}}(),P=(0,r.useConfirmDialog)(),D=s=>{let t=s.session_id;"session.started"===s.event_type?v(a=>{let i=new Map(a);if(i.set(t,{session_id:t,username:s.username,nas_ip_address:s.nas_ip_address,framed_ip_address:s.framed_ip_address||"",bytes_in:s.bytes_in,bytes_out:s.bytes_out,session_time:s.session_time,started_at:s.timestamp,last_updated:s.timestamp}),i.size>e){let e=i.keys().next().value;e&&i.delete(e)}return i}):"session.updated"===s.event_type?v(e=>{let a=new Map(e),i=a.get(t);return i&&a.set(t,{...i,bytes_in:s.bytes_in,bytes_out:s.bytes_out,session_time:s.session_time,last_updated:s.timestamp}),a}):"session.stopped"===s.event_type&&v(e=>{let s=new Map(e);return s.delete(t),s})},k=async e=>{if(await P({title:"Disconnect session",description:`Are you sure you want to disconnect session for user "${e.username}"? This will immediately terminate their connection.`,confirmText:"Disconnect",variant:"destructive"}))try{await _.mutateAsync({username:e.username,acctsessionid:e.session_id,nasipaddress:e.nas_ip_address})}catch(e){}},$=Array.from(j.values()),q=$.reduce((e,s)=>e+s.bytes_in,0),T=$.reduce((e,s)=>e+s.bytes_out,0);return t?(0,a.jsxs)(r.Card,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"h-5 w-5 text-primary"}),(0,a.jsx)("h3",{className:"font-bold",children:"Active Sessions"}),(0,a.jsx)(r.Badge,{variant:"outline","data-testid":"compact-active-count",children:$.length})]}),(0,a.jsx)(u.K,{})]}),(0,a.jsxs)("div",{className:"grid gap-2 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"p-3 bg-gray-50 rounded",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active Users"}),(0,a.jsx)("p",{className:"text-2xl font-bold","data-testid":"compact-active-users",children:$.length})]}),(0,a.jsxs)("div",{className:"p-3 bg-green-50 rounded",children:[(0,a.jsx)("p",{className:"text-xs text-green-900",children:"Total RX"}),(0,a.jsx)("p",{className:"text-xl font-bold text-green-900","data-testid":"compact-total-rx",children:y(q)})]}),(0,a.jsxs)("div",{className:"p-3 bg-blue-50 rounded",children:[(0,a.jsx)("p",{className:"text-xs text-blue-900",children:"Total TX"}),(0,a.jsx)("p",{className:"text-xl font-bold text-blue-900","data-testid":"compact-total-tx",children:y(T)})]})]})]}):(0,a.jsxs)(r.Card,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-6 w-6 text-primary"}),(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Live RADIUS Sessions"}),(0,a.jsx)(r.Badge,{variant:N?"default":"secondary",className:"ml-2","data-testid":"connection-status-badge",children:(0,a.jsx)("span",{"data-testid":"connection-status-label",children:N?"Live":"Disconnected"})})]}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Real-time authentication session monitoring"})]}),(0,a.jsx)(u.K,{})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[(0,a.jsx)("div",{className:"p-4 bg-primary/10 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Active Sessions"}),(0,a.jsx)("p",{className:"text-3xl font-bold","data-testid":"summary-active-count",children:$.length})]}),(0,a.jsx)(d.Z,{className:"h-10 w-10 text-primary"})]})}),(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-green-900",children:"Total RX"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-900","data-testid":"summary-total-rx",children:y(q)})]}),(0,a.jsx)(l.Z,{className:"h-10 w-10 text-green-600"})]})}),(0,a.jsx)("div",{className:"p-4 bg-blue-50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-blue-900",children:"Total TX"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-900","data-testid":"summary-total-tx",children:y(T)})]}),(0,a.jsx)(c.Z,{className:"h-10 w-10 text-blue-600"})]})}),(0,a.jsx)("div",{className:"p-4 bg-purple-50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-purple-900",children:"Total Traffic"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-900","data-testid":"summary-total-traffic",children:y(q+T)})]}),(0,a.jsx)(n.Z,{className:"h-10 w-10 text-purple-600"})]})})]}),0===$.length?(0,a.jsxs)("div",{className:"text-center py-12 border rounded-lg",children:[(0,a.jsx)(d.Z,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:N?"No active sessions. Waiting for connections...":"Connect to view live sessions"})]}):(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Username"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"NAS IP"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"User IP"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"RX"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"TX"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"Duration"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"Last Update"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:$.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm font-medium","data-testid":`session-username-${e.session_id}`,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse"}),e.username]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm font-mono text-muted-foreground","data-testid":`session-nas-${e.session_id}`,children:e.nas_ip_address}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm font-mono text-muted-foreground","data-testid":`session-framed-${e.session_id}`,children:e.framed_ip_address||"N/A"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600","data-testid":`session-rx-${e.session_id}`,children:y(e.bytes_in)}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-right font-semibold text-blue-600","data-testid":`session-tx-${e.session_id}`,children:y(e.bytes_out)}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,a.jsx)(p.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{"data-testid":`session-duration-${e.session_id}`,children:function(e){let s=Math.floor(e/3600),t=Math.floor(e%3600/60),a=e%60;return s>0?`${s}h ${t}m`:t>0?`${t}m ${a}s`:`${a}s`}(e.session_time)})]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-right text-muted-foreground",children:function(e){let s=Math.floor((new Date().getTime()-new Date(e).getTime())/1e3);return s<60?`${s}s ago`:s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:`${Math.floor(s/86400)}d ago`}(e.last_updated)}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>k(e),disabled:w,className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-1"}),"Disconnect"]})})})]},e.session_id))})]})})}),$.length>=e&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-900",children:(0,a.jsxs)("p",{children:["Showing most recent ",e," sessions. Some older sessions may not be displayed."]})})]})}function y(e){if(0===e)return"0 B";let s=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,s)).toFixed(2)} ${["B","KB","MB","GB","TB"][s]}`}function v(){return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Live RADIUS Sessions"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Monitor active authentication sessions in real-time"})]}),(0,a.jsx)(j,{maxSessions:100,enabled:!0})]})}},75994:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/sessions/live/page.tsx#default`)}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(35766));module.exports=a})();