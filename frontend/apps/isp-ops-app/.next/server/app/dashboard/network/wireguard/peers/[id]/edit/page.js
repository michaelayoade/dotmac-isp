(()=>{var e={};e.id=7794,e.ids=[7794],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},27631:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>c,pages:()=>p,routeModule:()=>m,tree:()=>o}),t(71331),t(13321),t(46366),t(96560);var a=t(23191),r=t(88716),i=t(37922),n=t.n(i),d=t(95231),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);t.d(s,l);let o=["",{children:["dashboard",{children:["network",{children:["wireguard",{children:["peers",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,71331)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/[id]/edit/page.tsx"]}]},{}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],p=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/[id]/edit/page.tsx"],c="/dashboard/network/wireguard/peers/[id]/edit/page",u={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/network/wireguard/peers/[id]/edit/page",pathname:"/dashboard/network/wireguard/peers/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},50716:(e,s,t)=>{Promise.resolve().then(t.bind(t,39296))},39296:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>v,dynamic:()=>h,dynamicParams:()=>x});var a=t(10326),r=t(17577),i=t(35047),n=t(90434),d=t(4743),l=t(48723),o=t(77506),p=t(41291),c=t(86333),u=t(18019),m=t(31215);let h="force-dynamic",x=!0;function v({params:e}){let{id:s}=e,t=(0,i.useRouter)(),{toast:h}=(0,l.useToast)(),{data:x,isLoading:v,error:y}=(0,d.aN)(s),{data:g}=(0,d.JI)(),f=(0,d.sZ)(),[j,w]=(0,r.useState)({}),[_,b]=(0,r.useState)({}),N=()=>{let e={};if(void 0!==j.peer_name&&(j.peer_name&&0!==j.peer_name.trim().length?j.peer_name.length>100&&(e.peer_name="Peer name must be 100 characters or less"):e.peer_name="Peer name is required"),void 0!==j.allowed_ips){for(let s of"string"==typeof j.allowed_ips?j.allowed_ips.split(",").map(e=>e.trim()):j.allowed_ips)if(s&&!/^[\d\.:a-fA-F]+\/\d+$/.test(s)){e.allowed_ips=`Invalid IP range: ${s}`;break}}return void 0!==j.persistent_keepalive&&null!==j.persistent_keepalive&&(j.persistent_keepalive<0||j.persistent_keepalive>3600)&&(e.persistent_keepalive="Persistent keepalive must be between 0 and 3600 seconds"),j.expiration_date&&new Date(j.expiration_date)<new Date&&(e.expiration_date="Expiration date must be in the future"),b(e),0===Object.keys(e).length},q=async e=>{if(e.preventDefault(),!N()){h({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});return}let a={};if(j.peer_name!==x?.peer_name&&(a.peer_name=j.peer_name),j.status!==x?.status&&(a.status=j.status),j.allowed_ips!==x?.allowed_ips&&(a.allowed_ips=j.allowed_ips),j.persistent_keepalive!==x?.persistent_keepalive&&(a.persistent_keepalive=j.persistent_keepalive),j.expiration_date!==x?.expiration_date&&(a.expiration_date=j.expiration_date),j.notes!==x?.notes&&(a.notes=j.notes),0===Object.keys(a).length){h({title:"No Changes",description:"No fields were modified"});return}f.mutate({peerId:s,data:a},{onSuccess:e=>{h({title:"Peer Updated",description:`Peer "${e.peer_name}" has been updated successfully`}),t.push(`/dashboard/network/wireguard/peers/${s}`)},onError:e=>{h({title:"Error Updating Peer",description:e.response?.data?.detail||"Failed to update peer",variant:"destructive"})}})},P=(e,s)=>{w(t=>({...t,[e]:s})),_[e]&&b(s=>{let t={...s};return delete t[e],t})};if(v)return(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsx)(o.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})});if(y||!x)return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Alert,{variant:"destructive",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),(0,a.jsx)(l.AlertDescription,{children:"Failed to load peer details"})]}),(0,a.jsx)(n.default,{href:"/dashboard/network/wireguard/peers",children:(0,a.jsxs)(l.Button,{variant:"outline",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Back to Peers"]})})]});let k=g?.find(e=>e.id===x.server_id);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,a.jsx)(n.default,{href:`/dashboard/network/wireguard/peers/${s}`,children:(0,a.jsxs)(l.Button,{variant:"ghost",size:"sm",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Back to Peer Details"]})})}),(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Edit WireGuard Peer"}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Update configuration for peer: ",x.peer_name]})]})}),(0,a.jsxs)(l.Alert,{children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsx)(l.AlertDescription,{children:"Some fields like public key, IP address, and server assignment are immutable and cannot be changed. To change these, you must regenerate the peer configuration or create a new peer."})]}),(0,a.jsx)("form",{onSubmit:q,children:(0,a.jsxs)(l.Card,{children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsx)(l.CardTitle,{children:"Peer Configuration"}),(0,a.jsx)(l.CardDescription,{children:"Update the peer details"})]}),(0,a.jsxs)(l.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{children:"WireGuard Server (Read-Only)"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.Input,{value:k?.name||"Unknown Server",disabled:!0}),(0,a.jsx)(l.Badge,{variant:"outline",children:k?.status||"unknown"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Server assignment cannot be changed"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{children:"Peer IP Address (Read-Only)"}),(0,a.jsx)(l.Input,{value:x.peer_ip||"Not assigned",disabled:!0}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"IP address is assigned automatically and cannot be changed"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{children:"Public Key (Read-Only)"}),(0,a.jsx)(l.Input,{value:x.public_key||"N/A",disabled:!0,className:"font-mono text-xs"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:'To change keys, use the "Regenerate Configuration" feature'})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(l.Label,{htmlFor:"peer_name",children:["Peer Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(l.Input,{id:"peer_name",value:j.peer_name||"",onChange:e=>P("peer_name",e.target.value),placeholder:"e.g., john-laptop",maxLength:100}),_.peer_name&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.peer_name})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"status",children:"Status"}),(0,a.jsxs)(l.Select,{value:j.status||x.status,onValueChange:e=>P("status",e),children:[(0,a.jsx)(l.SelectTrigger,{id:"status",children:(0,a.jsx)(l.SelectValue,{})}),(0,a.jsxs)(l.SelectContent,{children:[(0,a.jsx)(l.SelectItem,{value:"active",children:"Active"}),(0,a.jsx)(l.SelectItem,{value:"inactive",children:"Inactive"}),(0,a.jsx)(l.SelectItem,{value:"disabled",children:"Disabled"}),(0,a.jsx)(l.SelectItem,{value:"expired",children:"Expired"})]})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Control peer's access status"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"allowed_ips",children:"Allowed IPs"}),(0,a.jsx)(l.Input,{id:"allowed_ips",value:j.allowed_ips||"",onChange:e=>P("allowed_ips",e.target.value),placeholder:"0.0.0.0/0, ::/0"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Comma-separated list of IP ranges this peer can route"}),_.allowed_ips&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.allowed_ips})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"persistent_keepalive",children:"Persistent Keepalive (seconds)"}),(0,a.jsx)(l.Input,{id:"persistent_keepalive",type:"number",min:0,max:3600,value:j.persistent_keepalive??25,onChange:e=>P("persistent_keepalive",parseInt(e.target.value,10))}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"How often to send keepalive packets (0 = disabled)"}),_.persistent_keepalive&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.persistent_keepalive})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"expiration_date",children:"Expiration Date (optional)"}),(0,a.jsx)(l.Input,{id:"expiration_date",type:"datetime-local",value:j.expiration_date?new Date(j.expiration_date).toISOString().slice(0,16):"",onChange:e=>P("expiration_date",e.target.value)}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"When this peer's access should expire"}),_.expiration_date&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:_.expiration_date})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"notes",children:"Notes"}),(0,a.jsx)(l.Textarea,{id:"notes",value:j.notes||"",onChange:e=>P("notes",e.target.value),placeholder:"Additional information about this peer...",rows:4})]}),x.customer_id&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{children:"Customer ID (Read-Only)"}),(0,a.jsx)(l.Input,{value:x.customer_id,disabled:!0}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Customer association cannot be changed"})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,a.jsx)(l.Button,{type:"submit",disabled:f.isPending,children:f.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Save Changes"]})}),(0,a.jsx)(n.default,{href:`/dashboard/network/wireguard/peers/${s}`,children:(0,a.jsx)(l.Button,{type:"button",variant:"outline",children:"Cancel"})})]})]})]})}),(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{children:(0,a.jsx)(l.CardTitle,{children:"Metadata"})}),(0,a.jsx)(l.CardContent,{className:"space-y-2 text-sm",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Created"}),(0,a.jsx)("p",{className:"font-medium",children:x.created_at?new Date(x.created_at).toLocaleString():"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Last Updated"}),(0,a.jsx)("p",{className:"font-medium",children:x.updated_at?new Date(x.updated_at).toLocaleString():"N/A"})]})]})})]})]})}},4743:(e,s,t)=>{"use strict";t.d(s,{EQ:()=>h,Eb:()=>c,FP:()=>v,JI:()=>p,Ml:()=>g,Mp:()=>j,Nd:()=>u,aN:()=>y,d4:()=>w,f2:()=>x,f_:()=>_,mI:()=>m,sZ:()=>f,v6:()=>b,vY:()=>N});var a=t(48324),r=t(44976),i=t(17010),n=t(59341);let d="/wireguard",l=["wireguard"],o={all:l,servers:{all:[...l,"servers"],lists:()=>[...l,"servers","list"],list:e=>[...l,"servers","list",e],detail:e=>[...l,"servers","detail",e],health:e=>[...l,"servers","health",e]},peers:{all:[...l,"peers"],lists:()=>[...l,"peers","list"],list:e=>[...l,"peers","list",e],detail:e=>[...l,"peers","detail",e],config:e=>[...l,"peers","config",e]},dashboard:()=>[...l,"dashboard"]};function p(e={}){return(0,a.a)({queryKey:o.servers.list(e),queryFn:async()=>{let s=new URLSearchParams;e.status&&s.append("status",e.status),e.location&&s.append("location",e.location),e.limit&&s.append("limit",String(e.limit)),e.offset&&s.append("offset",String(e.offset));let t=`${d}/servers?${s.toString()}`;return(await n.x1.get(t)).data},staleTime:3e4})}function c(e){return(0,a.a)({queryKey:o.servers.detail(e),queryFn:async()=>(await n.x1.get(`${d}/servers/${e}`)).data,enabled:!!e,staleTime:6e4})}function u(e){return(0,a.a)({queryKey:o.servers.health(e),queryFn:async()=>(await n.x1.get(`${d}/servers/${e}/health`)).data,enabled:!!e,staleTime:1e4,refetchInterval:3e4})}function m(){let e=(0,r.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.post(`${d}/servers`,e)).data,onSuccess:()=>{e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function h(){let e=(0,r.NL)();return(0,i.D)({mutationFn:async({serverId:e,data:s})=>(await n.x1.patch(`${d}/servers/${e}`,s)).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:o.servers.detail(t.serverId)}),e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function x(){let e=(0,r.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.delete(`${d}/servers/${e}`),e),onSuccess:()=>{e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function v(e={}){return(0,a.a)({queryKey:o.peers.list(e),queryFn:async()=>{let s=new URLSearchParams;e.server_id&&s.append("server_id",e.server_id),e.customer_id&&s.append("customer_id",e.customer_id),e.subscriber_id&&s.append("subscriber_id",e.subscriber_id),e.status&&s.append("status",e.status),e.limit&&s.append("limit",String(e.limit)),e.offset&&s.append("offset",String(e.offset));let t=`${d}/peers?${s.toString()}`;return(await n.x1.get(t)).data},staleTime:3e4})}function y(e){return(0,a.a)({queryKey:o.peers.detail(e),queryFn:async()=>(await n.x1.get(`${d}/peers/${e}`)).data,enabled:!!e,staleTime:6e4})}function g(){let e=(0,r.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.post(`${d}/peers`,e)).data,onSuccess:s=>{e.invalidateQueries({queryKey:o.peers.lists()}),e.invalidateQueries({queryKey:o.servers.detail(s.server_id)}),e.invalidateQueries({queryKey:o.dashboard()})}})}function f(){let e=(0,r.NL)();return(0,i.D)({mutationFn:async({peerId:e,data:s})=>(await n.x1.patch(`${d}/peers/${e}`,s)).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:o.peers.detail(t.peerId)}),e.invalidateQueries({queryKey:o.peers.lists()}),e.invalidateQueries({queryKey:o.servers.detail(s.server_id)}),e.invalidateQueries({queryKey:o.dashboard()})}})}function j(){let e=(0,r.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.delete(`${d}/peers/${e}`),e),onSuccess:()=>{e.invalidateQueries({queryKey:o.peers.lists()}),e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function w(){let e=(0,r.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.post(`${d}/peers/${e}/regenerate`)).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:o.peers.detail(t)}),e.invalidateQueries({queryKey:o.peers.config(t)})}})}function _(){return(0,a.a)({queryKey:o.dashboard(),queryFn:async()=>(await n.x1.get(`${d}/dashboard`)).data,staleTime:1e4,refetchInterval:3e4})}function b(){let e=(0,r.NL)();return(0,i.D)({mutationFn:async e=>(await n.x1.post(`${d}/provision`,e)).data,onSuccess:()=>{e.invalidateQueries({queryKey:o.peers.lists()}),e.invalidateQueries({queryKey:o.servers.lists()}),e.invalidateQueries({queryKey:o.dashboard()})}})}function N(){return(0,i.D)({mutationFn:async e=>{let s=(await n.x1.get(`${d}/peers/${e}/config`)).data,t=new Blob([s.config_file],{type:"text/plain"}),a=window.URL.createObjectURL(t),r=document.createElement("a");return r.href=a,r.download=`${s.peer_name}.conf`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),s}})}},71331:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n,dynamic:()=>r,dynamicParams:()=>i});var a=t(68570);let r=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/[id]/edit/page.tsx#dynamic`),i=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/[id]/edit/page.tsx#dynamicParams`),n=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/network/wireguard/peers/[id]/edit/page.tsx#default`)}};var s=require("../../../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(27631));module.exports=a})();