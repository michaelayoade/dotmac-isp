(()=>{var e={};e.id=9024,e.ids=[9024],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},75398:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>l,routeModule:()=>x,tree:()=>o}),t(56632),t(13321),t(46366),t(96560);var i=t(23191),r=t(88716),a=t(37922),n=t.n(a),c=t(95231),d={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>c[e]);t.d(s,d);let o=["",{children:["dashboard",{children:["diagnostics",{children:["subscriber",{children:["[subscriberId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,56632)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/diagnostics/subscriber/[subscriberId]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],l=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/diagnostics/subscriber/[subscriberId]/page.tsx"],u="/dashboard/diagnostics/subscriber/[subscriberId]/page",m={require:t,loadChunk:()=>Promise.resolve()},x=new i.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/diagnostics/subscriber/[subscriberId]/page",pathname:"/dashboard/diagnostics/subscriber/[subscriberId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},40141:(e,s,t)=>{Promise.resolve().then(t.bind(t,93465))},93465:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>O});var i,r,a,n=t(10326),c=t(17577),d=t(44976),o=t(48324),l=t(17010),u=t(35047),m=t(48723),x=t(20892),h=t(93158),p=t(48998),g=t(77506),j=t(30361),b=t(69669),f=t(41291),v=t(18019),N=t(50949),y=t(61056),C=t(86333),E=t(21405),w=t(45091),P=t(66697),T=t(93892),_=t(27379),S=t(51110),D=t(85962),k=t(12714),I=t(90434),R=t(34041);(function(e){e.CONNECTIVITY_CHECK="connectivity_check",e.PING_TEST="ping_test",e.TRACEROUTE="traceroute",e.RADIUS_SESSION="radius_session",e.ONU_STATUS="onu_status",e.CPE_STATUS="cpe_status",e.IP_VERIFICATION="ip_verification",e.BANDWIDTH_TEST="bandwidth_test",e.LATENCY_TEST="latency_test",e.PACKET_LOSS_TEST="packet_loss_test",e.CPE_RESTART="cpe_restart",e.ONU_REBOOT="onu_reboot",e.HEALTH_CHECK="health_check",e.SERVICE_PATH_TRACE="service_path_trace"})(i||(i={})),function(e){e.PENDING="pending",e.RUNNING="running",e.COMPLETED="completed",e.FAILED="failed",e.TIMEOUT="timeout"}(r||(r={})),function(e){e.INFO="info",e.WARNING="warning",e.ERROR="error",e.CRITICAL="critical"}(a||(a={}));let q=e=>{let s={pending:{icon:p.Z,color:"bg-yellow-100 text-yellow-800",label:"Pending"},running:{icon:g.Z,color:"bg-blue-100 text-blue-800",label:"Running"},completed:{icon:j.Z,color:"bg-green-100 text-green-800",label:"Completed"},failed:{icon:b.Z,color:"bg-red-100 text-red-800",label:"Failed"},timeout:{icon:f.Z,color:"bg-orange-100 text-orange-800",label:"Timeout"}},t=s[e]||s.pending,i=t.icon;return(0,n.jsxs)(m.Badge,{className:t.color,children:[(0,n.jsx)(i,{className:`h-3 w-3 mr-1 ${"running"===e?"animate-spin":""}`}),t.label]})},F=e=>{if(!e)return null;let s={info:{icon:v.Z,color:"bg-blue-100 text-blue-800",label:"Info"},warning:{icon:N.Z,color:"bg-yellow-100 text-yellow-800",label:"Warning"},error:{icon:b.Z,color:"bg-red-100 text-red-800",label:"Error"},critical:{icon:y.Z,color:"bg-red-600 text-white",label:"Critical"}}[e];if(!s)return null;let t=s.icon;return(0,n.jsxs)(m.Badge,{className:s.color,children:[(0,n.jsx)(t,{className:"h-3 w-3 mr-1"}),s.label]})},A=e=>e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());function U(){let e=(0,u.useParams)();(0,u.useRouter)();let{toast:s}=(0,m.useToast)(),t=(0,d.NL)(),i=e.subscriberId,{api:r}=(0,h.M)(),a=r.baseUrl||"",[x,p]=(0,c.useState)(!1),[b,f]=(0,c.useState)(null),{data:v,isLoading:N}=(0,o.a)({queryKey:["diagnostics-runs",i,a],queryFn:async()=>{let e=new URLSearchParams;e.append("subscriber_id",i),e.append("limit","10");let s=await fetch(`${a}/api/v1/diagnostics/runs?${e.toString()}`,{credentials:"include"});if(!s.ok)throw Error("Failed to fetch diagnostic runs");return s.json()},refetchInterval:e=>!!e?.state?.data?.items?.some(e=>"running"===e.status||"pending"===e.status)&&5e3}),{data:y}=(0,o.a)({queryKey:["diagnostic-run",b,a],queryFn:async()=>{let e=await fetch(`${a}/api/v1/diagnostics/runs/${b}`,{credentials:"include"});if(!e.ok)throw Error("Failed to fetch diagnostic run");return e.json()},enabled:!!b,refetchInterval:e=>!!e?.state?.data&&("running"===e.state.data.status||"pending"===e.state.data.status)&&5e3}),U=(0,l.D)({mutationFn:async()=>{let e=await fetch(`${a}/api/v1/diagnostics/subscribers/${i}/connectivity`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to run connectivity check");return e.json()},onSuccess:e=>{t.invalidateQueries({queryKey:["diagnostics-runs",i]}),f(e.id),s({title:"Success",description:"Connectivity check started"})},onError:()=>{s({title:"Error",description:"Failed to run connectivity check",variant:"destructive"})}}),O=(0,l.D)({mutationFn:async()=>{let e=await fetch(`${a}/api/v1/diagnostics/subscribers/${i}/radius-sessions`,{credentials:"include"});if(!e.ok)throw Error("Failed to get RADIUS sessions");return e.json()},onSuccess:e=>{t.invalidateQueries({queryKey:["diagnostics-runs",i]}),f(e.id),s({title:"Success",description:"RADIUS sessions retrieved"})},onError:()=>{s({title:"Error",description:"Failed to get RADIUS sessions",variant:"destructive"})}}),$=(0,l.D)({mutationFn:async()=>{let e=await fetch(`${a}/api/v1/diagnostics/subscribers/${i}/onu-status`,{credentials:"include"});if(!e.ok)throw Error("Failed to get ONU status");return e.json()},onSuccess:e=>{t.invalidateQueries({queryKey:["diagnostics-runs",i]}),f(e.id),s({title:"Success",description:"ONU status retrieved"})},onError:()=>{s({title:"Error",description:"Failed to get ONU status",variant:"destructive"})}}),Z=(0,l.D)({mutationFn:async()=>{let e=await fetch(`${a}/api/v1/diagnostics/subscribers/${i}/cpe-status`,{credentials:"include"});if(!e.ok)throw Error("Failed to get CPE status");return e.json()},onSuccess:e=>{t.invalidateQueries({queryKey:["diagnostics-runs",i]}),f(e.id),s({title:"Success",description:"CPE status retrieved"})},onError:()=>{s({title:"Error",description:"Failed to get CPE status",variant:"destructive"})}}),B=(0,l.D)({mutationFn:async()=>{let e=await fetch(`${a}/api/v1/diagnostics/subscribers/${i}/ip-verification`,{credentials:"include"});if(!e.ok)throw Error("Failed to verify IP");return e.json()},onSuccess:e=>{t.invalidateQueries({queryKey:["diagnostics-runs",i]}),f(e.id),s({title:"Success",description:"IP verification completed"})},onError:()=>{s({title:"Error",description:"Failed to verify IP",variant:"destructive"})}}),H=(0,l.D)({mutationFn:async()=>{let e=await fetch(`${a}/api/v1/diagnostics/subscribers/${i}/restart-cpe`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to restart CPE");return e.json()},onSuccess:e=>{t.invalidateQueries({queryKey:["diagnostics-runs",i]}),f(e.id),p(!1),s({title:"Success",description:"CPE restart initiated"})},onError:()=>{s({title:"Error",description:"Failed to restart CPE",variant:"destructive"})}}),K=(0,l.D)({mutationFn:async()=>{let e=await fetch(`${a}/api/v1/diagnostics/subscribers/${i}/health-check`,{credentials:"include"});if(!e.ok)throw Error("Failed to run health check");return e.json()},onSuccess:e=>{t.invalidateQueries({queryKey:["diagnostics-runs",i]}),f(e.id),s({title:"Success",description:"Health check started"})},onError:()=>{s({title:"Error",description:"Failed to run health check",variant:"destructive"})}}),L=v?.items||[];return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(m.Button,{variant:"ghost",size:"icon",asChild:!0,children:(0,n.jsx)(I.default,{href:"/dashboard/diagnostics",children:(0,n.jsx)(C.Z,{className:"h-4 w-4"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"Subscriber Diagnostics"}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Subscriber ID: ",(0,n.jsx)("span",{className:"font-mono",children:i})]})]})]}),(0,n.jsxs)(m.Button,{variant:"outline",onClick:()=>t.invalidateQueries({queryKey:["diagnostics-runs",i]}),children:[(0,n.jsx)(E.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),(0,n.jsxs)(m.Card,{children:[(0,n.jsxs)(m.CardHeader,{children:[(0,n.jsx)(m.CardTitle,{children:"Quick Actions"}),(0,n.jsx)(m.CardDescription,{children:"Run diagnostics for this subscriber"})]}),(0,n.jsx)(m.CardContent,{children:(0,n.jsxs)("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4",children:[(0,n.jsxs)(m.Button,{variant:"outline",className:"h-auto flex flex-col items-start p-4 gap-2",onClick:()=>U.mutate(),disabled:U.isPending,children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(w.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"font-medium",children:"Connectivity Check"})]}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Test full connectivity"})]}),(0,n.jsxs)(m.Button,{variant:"outline",className:"h-auto flex flex-col items-start p-4 gap-2",onClick:()=>O.mutate(),disabled:O.isPending,children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(P.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"font-medium",children:"RADIUS Sessions"})]}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Check active sessions"})]}),(0,n.jsxs)(m.Button,{variant:"outline",className:"h-auto flex flex-col items-start p-4 gap-2",onClick:()=>$.mutate(),disabled:$.isPending,children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(T.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"font-medium",children:"ONU Status"})]}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Check ONU device"})]}),(0,n.jsxs)(m.Button,{variant:"outline",className:"h-auto flex flex-col items-start p-4 gap-2",onClick:()=>Z.mutate(),disabled:Z.isPending,children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(_.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"font-medium",children:"CPE Status"})]}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Check CPE device"})]}),(0,n.jsxs)(m.Button,{variant:"outline",className:"h-auto flex flex-col items-start p-4 gap-2",onClick:()=>B.mutate(),disabled:B.isPending,children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(S.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"font-medium",children:"IP Verification"})]}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Verify IP allocation"})]}),(0,n.jsxs)(m.Button,{variant:"outline",className:"h-auto flex flex-col items-start p-4 gap-2 border-orange-200 hover:bg-orange-50",onClick:()=>p(!0),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(D.Z,{className:"h-4 w-4 text-orange-600"}),(0,n.jsx)("span",{className:"font-medium text-orange-600",children:"Restart CPE"})]}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Reboot customer device"})]}),(0,n.jsxs)(m.Button,{variant:"outline",className:"h-auto flex flex-col items-start p-4 gap-2",onClick:()=>K.mutate(),disabled:K.isPending,children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(j.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"font-medium",children:"Health Check"})]}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Comprehensive check"})]})]})})]}),y&&(0,n.jsxs)(m.Card,{children:[(0,n.jsx)(m.CardHeader,{children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(m.CardTitle,{children:"Latest Diagnostic Result"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[q(y.status),F(y.severity)]})]})}),(0,n.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:"Type"}),(0,n.jsx)("div",{className:"font-medium",children:A(y.diagnostic_type)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:"Duration"}),(0,n.jsx)("div",{className:"font-medium",children:y.duration_ms?`${y.duration_ms}ms`:"N/A"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:"Started"}),(0,n.jsx)("div",{className:"font-medium",children:y.started_at?(0,R.WU)(new Date(y.started_at),"PPp"):"N/A"})]})]}),y.summary&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Summary"}),(0,n.jsx)("p",{className:"text-sm",children:y.summary})]}),y.error_message&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Error"}),(0,n.jsx)("p",{className:"text-sm text-destructive",children:y.error_message})]}),y.recommendations.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm font-medium mb-2",children:"Recommendations"}),(0,n.jsx)("div",{className:"space-y-2",children:y.recommendations.map((e,s)=>(0,n.jsx)("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 rounded border border-blue-200",children:(0,n.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"font-medium text-sm",children:e.title}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]}),(0,n.jsx)(m.Badge,{variant:"outline",className:"text-xs",children:e.priority})]})},s))})]}),Object.keys(y.results).length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm font-medium mb-2",children:"Results"}),(0,n.jsx)("pre",{className:"p-3 bg-muted rounded text-xs overflow-auto max-h-64",children:JSON.stringify(y.results,null,2)})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(m.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,n.jsxs)(I.default,{href:`/dashboard/diagnostics/runs/${y.id}`,children:[(0,n.jsx)(k.Z,{className:"h-4 w-4 mr-2"}),"View Full Details"]})})})]})]}),(0,n.jsxs)(m.Card,{children:[(0,n.jsxs)(m.CardHeader,{children:[(0,n.jsx)(m.CardTitle,{children:"Recent Diagnostic Runs"}),(0,n.jsx)(m.CardDescription,{children:"Last 10 diagnostic executions for this subscriber"})]}),(0,n.jsx)(m.CardContent,{children:N?(0,n.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,n.jsx)(g.Z,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):0===L.length?(0,n.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No diagnostic runs found for this subscriber"}):(0,n.jsxs)(m.Table,{children:[(0,n.jsx)(m.TableHeader,{children:(0,n.jsxs)(m.TableRow,{children:[(0,n.jsx)(m.TableHead,{children:"Type"}),(0,n.jsx)(m.TableHead,{children:"Status"}),(0,n.jsx)(m.TableHead,{children:"Duration"}),(0,n.jsx)(m.TableHead,{children:"Created At"}),(0,n.jsx)(m.TableHead,{children:"Actions"})]})}),(0,n.jsx)(m.TableBody,{children:L.map(e=>(0,n.jsxs)(m.TableRow,{children:[(0,n.jsx)(m.TableCell,{className:"font-medium",children:A(e.diagnostic_type)}),(0,n.jsx)(m.TableCell,{children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[q(e.status),F(e.severity)]})}),(0,n.jsx)(m.TableCell,{children:e.duration_ms?`${e.duration_ms}ms`:"N/A"}),(0,n.jsx)(m.TableCell,{children:(0,R.WU)(new Date(e.created_at),"PPp")}),(0,n.jsx)(m.TableCell,{children:(0,n.jsx)(m.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,n.jsxs)(I.default,{href:`/dashboard/diagnostics/runs/${e.id}`,children:[(0,n.jsx)(k.Z,{className:"h-4 w-4 mr-2"}),"View"]})})})]},e.id))})]})})]}),(0,n.jsx)(m.Dialog,{open:x,onOpenChange:p,children:(0,n.jsxs)(m.DialogContent,{children:[(0,n.jsxs)(m.DialogHeader,{children:[(0,n.jsx)(m.DialogTitle,{children:"Restart CPE Device"}),(0,n.jsx)(m.DialogDescription,{children:"This will restart the customer's CPE device, which may cause a temporary service interruption. Are you sure you want to proceed?"})]}),(0,n.jsxs)(m.DialogFooter,{children:[(0,n.jsx)(m.Button,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),(0,n.jsx)(m.Button,{variant:"destructive",onClick:()=>H.mutate(),disabled:H.isPending,children:H.isPending?"Restarting...":"Restart CPE"})]})]})})]})}function O(){return(0,n.jsx)(x.eu,{permission:"isp.diagnostics.read",children:(0,n.jsx)(U,{})})}},56632:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i});let i=(0,t(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/diagnostics/subscriber/[subscriberId]/page.tsx#default`)}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),i=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(75398));module.exports=i})();