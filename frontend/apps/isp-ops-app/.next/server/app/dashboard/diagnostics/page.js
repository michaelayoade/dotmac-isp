(()=>{var e={};e.id=2010,e.ids=[2010],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},67137:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>o,routeModule:()=>m,tree:()=>d}),t(89390),t(13321),t(46366),t(96560);var r=t(23191),a=t(88716),i=t(37922),l=t.n(i),n=t(95231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(s,c);let d=["",{children:["dashboard",{children:["diagnostics",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,89390)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/diagnostics/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/diagnostics/page.tsx"],u="/dashboard/diagnostics/page",x={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/diagnostics/page",pathname:"/dashboard/diagnostics",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},91660:(e,s,t)=>{Promise.resolve().then(t.bind(t,78139))},78139:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>S});var r=t(10326),a=t(17577),i=t(48324),l=t(48723),n=t(48998),c=t(21405),d=t(30361),o=t(69669),u=t(50949),x=t(18019),m=t(41291),p=t(31540),h=t(66697),g=t(17069),j=t(88307),b=t(93158),f=t(20892),v=t(90434);function y(){let[e,s]=(0,a.useState)(""),[t,f]=(0,a.useState)("all"),[y,S]=(0,a.useState)("all"),[N,C]=(0,a.useState)("all"),{api:w}=(0,b.M)(),_=w.baseUrl,{data:P,isLoading:I,refetch:q}=(0,i.a)({queryKey:["diagnostics-all",_,t,y],queryFn:async()=>{let e=new URLSearchParams;"all"!==t&&e.append("diagnostic_type",t),e.append("limit","100");let s=await fetch(`${_}/api/v1/diagnostics/runs?${e.toString()}`,{credentials:"include"});if(!s.ok)throw Error("Failed to fetch diagnostics");return s.json()}}),D=P?.items||[],T={total:D.length,byStatus:D.reduce((e,s)=>(e[s.status]=(e[s.status]||0)+1,e),{}),bySeverity:D.reduce((e,s)=>(s.severity&&(e[s.severity]=(e[s.severity]||0)+1),e),{}),byType:D.reduce((e,s)=>(e[s.diagnostic_type]=(e[s.diagnostic_type]||0)+1,e),{}),avgDuration:D.length>0?Math.round(D.reduce((e,s)=>e+(s.duration_ms||0),0)/D.length):0,successRate:D.length>0?Math.round(D.filter(e=>e.success).length/D.length*100):0},R=D.filter(s=>{let t=!e||s.subscriber_id?.toLowerCase().includes(e.toLowerCase())||s.diagnostic_type.toLowerCase().includes(e.toLowerCase())||s.summary?.toLowerCase().includes(e.toLowerCase()),r="all"===y||s.status===y,a="all"===N||s.severity===N;return t&&r&&a}),Z=e=>{let s={pending:{icon:n.Z,color:"bg-gray-100 text-gray-800",label:"Pending"},running:{icon:c.Z,color:"bg-blue-100 text-blue-800",label:"Running"},completed:{icon:d.Z,color:"bg-green-100 text-green-800",label:"Completed"},failed:{icon:o.Z,color:"bg-red-100 text-red-800",label:"Failed"},timeout:{icon:u.Z,color:"bg-amber-100 text-amber-800",label:"Timeout"}},t=s[e]||s.pending,a=t.icon;return(0,r.jsxs)(l.Badge,{className:t.color,children:[(0,r.jsx)(a,{className:`h-3 w-3 mr-1 ${"running"===e?"animate-spin":""}`}),t.label]})},U=e=>{if(!e)return null;let s={info:{icon:x.Z,color:"bg-blue-100 text-blue-800",label:"Info"},warning:{icon:u.Z,color:"bg-amber-100 text-amber-800",label:"Warning"},error:{icon:m.Z,color:"bg-red-100 text-red-800",label:"Error"},critical:{icon:o.Z,color:"bg-red-600 text-white",label:"Critical"}}[e],t=s.icon;return(0,r.jsxs)(l.Badge,{className:s.color,children:[(0,r.jsx)(t,{className:"h-3 w-3 mr-1"}),s.label]})},k=e=>e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Diagnostic History"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"View and analyze all diagnostic runs across subscribers"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(l.Button,{variant:"outline",onClick:()=>{let e=new Blob([["Time,Type,Subscriber,Status,Severity,Duration,Summary",...R.map(e=>[new Date(e.created_at).toISOString(),e.diagnostic_type,e.subscriber_id||"",e.status,e.severity||"",e.duration_ms||"",`"${e.summary?.replace(/"/g,'""')||""}"`].join(","))].join("\n")],{type:"text/csv"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=`diagnostics-${new Date().toISOString()}.csv`,t.click(),URL.revokeObjectURL(s)},children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Export"]}),(0,r.jsxs)(l.Button,{variant:"outline",onClick:()=>q(),children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsxs)(l.Card,{children:[(0,r.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,r.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Total Diagnostics"}),(0,r.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:T.total}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"All time"})]})]}),(0,r.jsxs)(l.Card,{children:[(0,r.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,r.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Success Rate"}),(0,r.jsx)(g.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[T.successRate,"%"]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[T.byStatus.completed||0," completed"]})]})]}),(0,r.jsxs)(l.Card,{children:[(0,r.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,r.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Avg Duration"}),(0,r.jsx)(n.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[T.avgDuration,"ms"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per diagnostic"})]})]}),(0,r.jsxs)(l.Card,{children:[(0,r.jsxs)(l.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,r.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Critical Issues"}),(0,r.jsx)(m.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-600",children:T.bySeverity.critical||0}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[T.bySeverity.error||0," errors"]})]})]})]}),(0,r.jsxs)(l.Card,{children:[(0,r.jsx)(l.CardHeader,{children:(0,r.jsx)(l.CardTitle,{children:"Filters"})}),(0,r.jsx)(l.CardContent,{children:(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(j.Z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(l.Input,{placeholder:"Search...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),(0,r.jsxs)(l.Select,{value:t,onValueChange:f,children:[(0,r.jsx)(l.SelectTrigger,{children:(0,r.jsx)(l.SelectValue,{placeholder:"All Types"})}),(0,r.jsxs)(l.SelectContent,{children:[(0,r.jsx)(l.SelectItem,{value:"all",children:"All Types"}),(0,r.jsx)(l.SelectItem,{value:"connectivity_check",children:"Connectivity Check"}),(0,r.jsx)(l.SelectItem,{value:"radius_session",children:"RADIUS Session"}),(0,r.jsx)(l.SelectItem,{value:"onu_status",children:"ONU Status"}),(0,r.jsx)(l.SelectItem,{value:"cpe_status",children:"CPE Status"}),(0,r.jsx)(l.SelectItem,{value:"ip_verification",children:"IP Verification"}),(0,r.jsx)(l.SelectItem,{value:"health_check",children:"Health Check"})]})]}),(0,r.jsxs)(l.Select,{value:y,onValueChange:S,children:[(0,r.jsx)(l.SelectTrigger,{children:(0,r.jsx)(l.SelectValue,{placeholder:"All Statuses"})}),(0,r.jsxs)(l.SelectContent,{children:[(0,r.jsx)(l.SelectItem,{value:"all",children:"All Statuses"}),(0,r.jsx)(l.SelectItem,{value:"pending",children:"Pending"}),(0,r.jsx)(l.SelectItem,{value:"running",children:"Running"}),(0,r.jsx)(l.SelectItem,{value:"completed",children:"Completed"}),(0,r.jsx)(l.SelectItem,{value:"failed",children:"Failed"}),(0,r.jsx)(l.SelectItem,{value:"timeout",children:"Timeout"})]})]}),(0,r.jsxs)(l.Select,{value:N,onValueChange:C,children:[(0,r.jsx)(l.SelectTrigger,{children:(0,r.jsx)(l.SelectValue,{placeholder:"All Severities"})}),(0,r.jsxs)(l.SelectContent,{children:[(0,r.jsx)(l.SelectItem,{value:"all",children:"All Severities"}),(0,r.jsx)(l.SelectItem,{value:"info",children:"Info"}),(0,r.jsx)(l.SelectItem,{value:"warning",children:"Warning"}),(0,r.jsx)(l.SelectItem,{value:"error",children:"Error"}),(0,r.jsx)(l.SelectItem,{value:"critical",children:"Critical"})]})]})]})})]}),(0,r.jsxs)(l.Card,{children:[(0,r.jsxs)(l.CardHeader,{children:[(0,r.jsxs)(l.CardTitle,{children:["Diagnostic Runs (",R.length,")"]}),(0,r.jsx)(l.CardDescription,{children:"Recent diagnostic executions"})]}),(0,r.jsx)(l.CardContent,{children:I?(0,r.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading diagnostic history..."}):0===R.length?(0,r.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No diagnostic runs found"}):(0,r.jsx)("div",{className:"space-y-3",children:R.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-4 space-y-2",children:[(0,r.jsx)("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("h4",{className:"font-medium",children:k(e.diagnostic_type)}),Z(e.status),U(e.severity)]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,r.jsx)("span",{children:new Date(e.created_at).toLocaleString()}),e.duration_ms&&(0,r.jsxs)("span",{children:["• ",e.duration_ms,"ms"]}),e.subscriber_id&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:"•"}),(0,r.jsx)(v.default,{href:`/dashboard/radius/subscribers/${e.subscriber_id}/diagnostics`,className:"text-primary hover:underline",children:e.subscriber_id})]})]})]})}),e.summary&&(0,r.jsx)("p",{className:"text-sm",children:e.summary}),e.error_message&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:e.error_message}),e.recommendations.length>0&&(0,r.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,r.jsx)("p",{className:"text-xs font-medium",children:"Recommendations:"}),e.recommendations.slice(0,2).map((e,s)=>(0,r.jsxs)("div",{className:"text-xs p-2 bg-blue-50 dark:bg-blue-950/20 rounded",children:[(0,r.jsx)("p",{className:"font-medium",children:e.title}),(0,r.jsx)("p",{className:"text-muted-foreground",children:e.description})]},s)),e.recommendations.length>2&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",e.recommendations.length-2," more"]})]}),Object.keys(e.results).length>0&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsx)("summary",{className:"text-xs font-medium cursor-pointer",children:"View Details"}),(0,r.jsx)("pre",{className:"mt-2 p-2 bg-muted rounded text-xs overflow-auto max-h-40",children:JSON.stringify(e.results,null,2)})]})]},e.id))})})]})]})}function S(){return(0,r.jsx)(f.eu,{permission:"diagnostics.read",children:(0,r.jsx)(y,{})})}},89390:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/diagnostics/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(67137));module.exports=r})();