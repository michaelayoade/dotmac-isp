(()=>{var e={};e.id=1365,e.ids=[1365],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},89136:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>c}),t(97944),t(13321),t(46366),t(96560);var a=t(23191),r=t(88716),i=t(37922),n=t.n(i),l=t(95231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);t.d(s,d);let c=["",{children:["dashboard",{children:["partners",{children:["revenue",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,97944)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/partners/revenue/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/partners/revenue/page.tsx"],m="/dashboard/partners/revenue/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/partners/revenue/page",pathname:"/dashboard/partners/revenue",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7550:(e,s,t)=>{Promise.resolve().then(t.bind(t,42451))},42451:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>Q,dynamic:()=>K,dynamicParams:()=>O});var a=t(10326),r=t(17577),i=t(48723),n=t(17069),l=t(95964),d=t(16671),c=t(88378),o=t(72257),m=t(21405),u=t(71821),x=t(66307),h=t(48998),p=t(37358),j=t(48324);let f=t(36607).LM.api.baseUrl;class g{constructor(){this.baseUrl=f}getAuthHeaders(){return{"Content-Type":"application/json",credentials:"include"}}async handleResponse(e){if(!e.ok)throw Error(await e.text()||`HTTP ${e.status}: ${e.statusText}`);return e.json()}async getRevenueMetrics(e={}){let s=new URLSearchParams;e.period_start&&s.append("period_start",e.period_start),e.period_end&&s.append("period_end",e.period_end);let t=s.toString(),a=`${this.baseUrl}/api/isp/v1/admin/partners/revenue/metrics${t?`?${t}`:""}`,r=await fetch(a,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(r)}async listCommissionEvents(e={}){let s=new URLSearchParams;e.status&&s.append("status_filter",e.status),void 0!==e.limit&&s.append("limit",e.limit.toString()),void 0!==e.offset&&s.append("offset",e.offset.toString());let t=s.toString(),a=`${this.baseUrl}/api/isp/v1/admin/partners/revenue/commissions${t?`?${t}`:""}`,r=await fetch(a,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(r)}async getCommissionEvent(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/partners/revenue/commissions/${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(s)}async listPayouts(e={}){let s=new URLSearchParams;e.status&&s.append("status_filter",e.status),void 0!==e.limit&&s.append("limit",e.limit.toString()),void 0!==e.offset&&s.append("offset",e.offset.toString());let t=s.toString(),a=`${this.baseUrl}/api/isp/v1/admin/partners/revenue/payouts${t?`?${t}`:""}`,r=await fetch(a,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(r)}async getPayout(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/partners/revenue/payouts/${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(s)}calculateCommission(e,s){return e*s}formatCurrency(e,s="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:s}).format(e)}calculateConversionRate(e,s){return 0===s?0:e/s*100}}let v=new g;function y(e={}){return(0,j.a)({queryKey:["partner-revenue-metrics",e],queryFn:()=>v.getRevenueMetrics(e),staleTime:6e4,gcTime:6e5})}function N(e={}){return(0,j.a)({queryKey:["partner-commissions",e],queryFn:()=>v.listCommissionEvents(e),staleTime:3e4,gcTime:3e5})}function b(e={}){return(0,j.a)({queryKey:["partner-payouts",e],queryFn:()=>v.listPayouts(e),staleTime:3e4,gcTime:3e5})}function C(){let[e,s]=(0,r.useState)({start:new Date(new Date().setDate(1)).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),{data:t,isLoading:l,error:d,refetch:c}=y({period_start:`${e.start}T00:00:00Z`,period_end:`${e.end}T23:59:59Z`}),{statistics:o,isLoading:j}=function(e={}){let{data:s,isLoading:t,error:a}=y(e),{data:r=[]}=N({}),{data:i=[]}=b({});return{statistics:{totalCommissions:s?.total_commissions||0,totalPayouts:s?.total_payouts||0,pendingAmount:s?.pending_amount||0,commissionCount:s?.total_commission_count||0,approvedCommissions:r.filter(e=>"approved"===e.status).reduce((e,s)=>e+s.commission_amount,0),pendingCommissions:r.filter(e=>"pending"===e.status).reduce((e,s)=>e+s.commission_amount,0),paidCommissions:r.filter(e=>"paid"===e.status).reduce((e,s)=>e+s.commission_amount,0),completedPayouts:i.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.total_amount,0),pendingPayouts:i.filter(e=>"pending"===e.status||"ready"===e.status).reduce((e,s)=>e+s.total_amount,0),processingPayouts:i.filter(e=>"processing"===e.status).reduce((e,s)=>e+s.total_amount,0),totalPayoutsCount:i.length,completedPayoutsCount:i.filter(e=>"completed"===e.status).length,failedPayoutsCount:i.filter(e=>"failed"===e.status).length},isLoading:t,error:a}}({period_start:`${e.start}T00:00:00Z`,period_end:`${e.end}T23:59:59Z`}),f=()=>{c()};if(l||j)return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(i.Skeleton,{className:"h-32 w-full"}),(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(i.Skeleton,{className:"h-32"},s))})]});if(d)return(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)("p",{className:"text-destructive mb-4",children:"Failed to load revenue metrics"}),(0,a.jsxs)(i.Button,{onClick:f,children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Retry"]})]})});let g=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:t?.currency||"USD"}).format(e);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsx)(i.CardTitle,{className:"text-base",children:"Select Period"}),(0,a.jsx)(i.CardDescription,{children:"Choose the date range for revenue metrics"})]}),(0,a.jsx)(i.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"period_start",children:"Start Date"}),(0,a.jsx)(i.Input,{id:"period_start",type:"date",value:e.start,onChange:t=>s({...e,start:t.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"period_end",children:"End Date"}),(0,a.jsx)(i.Input,{id:"period_end",type:"date",value:e.end,onChange:t=>s({...e,end:t.target.value})})]}),(0,a.jsxs)(i.Button,{onClick:f,variant:"outline",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Commissions"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 text-green-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:g(t?.total_commissions||0)})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:[t?.total_commission_count||0," events"]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Payouts"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-blue-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:g(t?.total_payouts||0)})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:[o.completedPayoutsCount," completed"]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Pending Amount"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 text-orange-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:g(t?.pending_amount||0)})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Awaiting payout"})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Payout Rate"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"h-4 w-4 text-purple-500"}),(0,a.jsxs)("span",{className:"text-2xl font-bold",children:[t?.total_commissions?(t.total_payouts/t.total_commissions*100).toFixed(1):0,"%"]})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Commissions paid out"})]})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsx)(i.CardTitle,{className:"text-base",children:"Commission Breakdown"})}),(0,a.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Approved"}),(0,a.jsx)("span",{className:"font-semibold",children:g(o.approvedCommissions)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Pending"}),(0,a.jsx)("span",{className:"font-semibold",children:g(o.pendingCommissions)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Paid"}),(0,a.jsx)("span",{className:"font-semibold",children:g(o.paidCommissions)})]}),(0,a.jsxs)("div",{className:"border-t pt-4 flex justify-between items-center",children:[(0,a.jsx)("span",{className:"font-medium",children:"Total"}),(0,a.jsx)("span",{className:"text-lg font-bold",children:g(o.approvedCommissions+o.pendingCommissions+o.paidCommissions)})]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsx)(i.CardTitle,{className:"text-base",children:"Payout Breakdown"})}),(0,a.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Completed"}),(0,a.jsxs)("span",{className:"font-semibold",children:[g(o.completedPayouts)," (",o.completedPayoutsCount,")"]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Pending"}),(0,a.jsx)("span",{className:"font-semibold",children:g(o.pendingPayouts)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Processing"}),(0,a.jsx)("span",{className:"font-semibold",children:g(o.processingPayouts)})]}),(0,a.jsxs)("div",{className:"border-t pt-4 flex justify-between items-center",children:[(0,a.jsx)("span",{className:"font-medium",children:"Failed"}),(0,a.jsxs)("span",{className:"text-lg font-semibold text-destructive",children:[o.failedPayoutsCount," payouts"]})]})]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsxs)(i.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),"Period Summary"]})}),(0,a.jsx)(i.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Period:"}),(0,a.jsxs)("p",{className:"font-medium mt-1",children:[e.start&&new Date(e.start).toLocaleDateString()," -"," ",e.end&&new Date(e.end).toLocaleDateString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Commission Events:"}),(0,a.jsx)("p",{className:"font-medium mt-1",children:t?.total_commission_count||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Average Commission:"}),(0,a.jsx)("p",{className:"font-medium mt-1",children:g(t?.total_commission_count?t.total_commissions/t.total_commission_count:0)})]})]})})]})]})}var _=t(69669);function w(){let[e,s]=(0,r.useState)("all"),[t,n]=(0,r.useState)(1),{data:d,isLoading:c}=N({status:"all"!==e?e:void 0,limit:20,offset:(t-1)*20}),o=e=>{let{variant:s,icon:t,color:r}={pending:{variant:"secondary",icon:h.Z,color:"text-yellow-600"},approved:{variant:"default",icon:x.Z,color:"text-blue-600"},paid:{variant:"default",icon:x.Z,color:"text-green-600"},rejected:{variant:"destructive",icon:_.Z,color:"text-red-600"}}[e];return(0,a.jsxs)(i.Badge,{variant:s,className:"gap-1",children:[(0,a.jsx)(t,{className:`h-3 w-3 ${r}`}),e.charAt(0).toUpperCase()+e.slice(1)]})},m=(e,s="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:s}).format(e);if(c)return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(i.Skeleton,{className:"h-32 w-full"}),(0,a.jsx)(i.Skeleton,{className:"h-96 w-full"})]});let j=d?.reduce((e,s)=>e+s.commission_amount,0)||0,f=d?.filter(e=>"pending"===e.status).reduce((e,s)=>e+s.commission_amount,0)||0,g=d?.filter(e=>"approved"===e.status).reduce((e,s)=>e+s.commission_amount,0)||0,v=d?.filter(e=>"paid"===e.status).reduce((e,s)=>e+s.commission_amount,0)||0;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Commissions"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4 text-purple-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:m(j)})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:[d?.length||0," events"]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 text-yellow-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:m(f)})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Awaiting approval"})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Approved"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-blue-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:m(g)})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Ready for payout"})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Paid"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-green-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:m(v)})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Paid out"})]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsx)(i.CardTitle,{className:"text-base",children:"Filters"})}),(0,a.jsx)(i.CardContent,{children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"status",children:"Status"}),(0,a.jsxs)(i.Select,{value:e,onValueChange:e=>{s(e),n(1)},children:[(0,a.jsx)(i.SelectTrigger,{id:"status",children:(0,a.jsx)(i.SelectValue,{})}),(0,a.jsxs)(i.SelectContent,{children:[(0,a.jsx)(i.SelectItem,{value:"all",children:"All Statuses"}),(0,a.jsx)(i.SelectItem,{value:"pending",children:"Pending"}),(0,a.jsx)(i.SelectItem,{value:"approved",children:"Approved"}),(0,a.jsx)(i.SelectItem,{value:"paid",children:"Paid"}),(0,a.jsx)(i.SelectItem,{value:"rejected",children:"Rejected"})]})]})]})})})]}),d&&0!==d.length?(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsx)(i.CardTitle,{className:"text-base",children:"Commission Events"}),(0,a.jsx)(i.CardDescription,{children:"All commission events for your partnership"})]}),(0,a.jsx)(i.CardContent,{children:(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(i.Table,{children:[(0,a.jsx)(i.TableHeader,{children:(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableHead,{children:"Date"}),(0,a.jsx)(i.TableHead,{children:"Type"}),(0,a.jsx)(i.TableHead,{children:"Base Amount"}),(0,a.jsx)(i.TableHead,{children:"Rate"}),(0,a.jsx)(i.TableHead,{children:"Commission"}),(0,a.jsx)(i.TableHead,{children:"Status"}),(0,a.jsx)(i.TableHead,{children:"Payout"})]})}),(0,a.jsx)(i.TableBody,{children:d.map(e=>(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:new Date(e.event_date).toLocaleDateString()})]})}),(0,a.jsx)(i.TableCell,{children:(0,a.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:e.event_type})}),(0,a.jsx)(i.TableCell,{children:e.base_amount?m(e.base_amount,e.currency):"-"}),(0,a.jsx)(i.TableCell,{children:e.commission_rate?`${(100*e.commission_rate).toFixed(2)}%`:"-"}),(0,a.jsx)(i.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(u.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-semibold",children:m(e.commission_amount,e.currency)})]})}),(0,a.jsx)(i.TableCell,{children:o(e.status)}),(0,a.jsx)(i.TableCell,{children:e.payout_id?(0,a.jsxs)(i.Badge,{variant:"default",className:"gap-1",children:[(0,a.jsx)(x.Z,{className:"h-3 w-3"}),"Included"]}):(0,a.jsx)(i.Badge,{variant:"outline",children:"Pending"})})]},e.id))})]})})})]}):(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)(l.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Commissions Found"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"all"!==e?"No commissions match your filters. Try adjusting your criteria.":"You don&apos;t have any commission events yet."})]})}),d&&d.length>=20&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(t-1)*20+1," to ",Math.min(20*t,d.length)," ","commissions"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>n(t-1),disabled:1===t,children:"Previous"}),(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>n(t+1),disabled:d.length<20,children:"Next"})]})]})]})}var T=t(41291);function S(){let[e,s]=(0,r.useState)("all"),[t,n]=(0,r.useState)(1),{data:c,isLoading:o}=b({status:"all"!==e?e:void 0,limit:20,offset:(t-1)*20}),m=e=>{let{variant:s,icon:t,color:r}={pending:{variant:"secondary",icon:h.Z,color:"text-yellow-600"},ready:{variant:"default",icon:x.Z,color:"text-blue-600"},processing:{variant:"default",icon:T.Z,color:"text-purple-600"},completed:{variant:"default",icon:x.Z,color:"text-green-600"},failed:{variant:"destructive",icon:_.Z,color:"text-red-600"},cancelled:{variant:"outline",icon:_.Z,color:"text-gray-600"}}[e];return(0,a.jsxs)(i.Badge,{variant:s,className:"gap-1",children:[(0,a.jsx)(t,{className:`h-3 w-3 ${r}`}),e.charAt(0).toUpperCase()+e.slice(1)]})},j=(e,s="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:s}).format(e);if(o)return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(i.Skeleton,{className:"h-32 w-full"}),(0,a.jsx)(i.Skeleton,{className:"h-96 w-full"})]});let f=c?.reduce((e,s)=>e+s.total_amount,0)||0,g=c?.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.total_amount,0)||0,v=c?.filter(e=>"pending"===e.status||"ready"===e.status).reduce((e,s)=>e+s.total_amount,0)||0,y=c?.filter(e=>"processing"===e.status).reduce((e,s)=>e+s.total_amount,0)||0,N=c?.filter(e=>"completed"===e.status).length||0,C=c?.filter(e=>"failed"===e.status).length||0;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Payouts"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 text-purple-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:j(f)})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:[c?.length||0," payouts"]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Completed"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-green-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:j(g)})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:[N," payouts"]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 text-yellow-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:j(v)})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Awaiting processing"})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Processing"})}),(0,a.jsxs)(i.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4 text-blue-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:j(y)})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"In progress"})]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsx)(i.CardTitle,{className:"text-base",children:"Filters"})}),(0,a.jsx)(i.CardContent,{children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"status",children:"Status"}),(0,a.jsxs)(i.Select,{value:e,onValueChange:e=>{s(e),n(1)},children:[(0,a.jsx)(i.SelectTrigger,{id:"status",children:(0,a.jsx)(i.SelectValue,{})}),(0,a.jsxs)(i.SelectContent,{children:[(0,a.jsx)(i.SelectItem,{value:"all",children:"All Statuses"}),(0,a.jsx)(i.SelectItem,{value:"pending",children:"Pending"}),(0,a.jsx)(i.SelectItem,{value:"ready",children:"Ready"}),(0,a.jsx)(i.SelectItem,{value:"processing",children:"Processing"}),(0,a.jsx)(i.SelectItem,{value:"completed",children:"Completed"}),(0,a.jsx)(i.SelectItem,{value:"failed",children:"Failed"}),(0,a.jsx)(i.SelectItem,{value:"cancelled",children:"Cancelled"})]})]})]})})})]}),c&&0!==c.length?(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsx)(i.CardTitle,{className:"text-base",children:"Payout History"}),(0,a.jsx)(i.CardDescription,{children:"All payouts processed for your partnership"})]}),(0,a.jsx)(i.CardContent,{children:(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(i.Table,{children:[(0,a.jsx)(i.TableHeader,{children:(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableHead,{children:"Payout Date"}),(0,a.jsx)(i.TableHead,{children:"Period"}),(0,a.jsx)(i.TableHead,{children:"Commissions"}),(0,a.jsx)(i.TableHead,{children:"Amount"}),(0,a.jsx)(i.TableHead,{children:"Method"}),(0,a.jsx)(i.TableHead,{children:"Status"}),(0,a.jsx)(i.TableHead,{children:"Reference"})]})}),(0,a.jsx)(i.TableBody,{children:c.map(e=>(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:new Date(e.payout_date).toLocaleDateString()})]})}),(0,a.jsx)(i.TableCell,{children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("p",{children:new Date(e.period_start).toLocaleDateString()}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["to ",new Date(e.period_end).toLocaleDateString()]})]})}),(0,a.jsx)(i.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-medium",children:e.commission_count})]})}),(0,a.jsx)(i.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(u.Z,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-semibold",children:j(e.total_amount,e.currency)})]})}),(0,a.jsx)(i.TableCell,{children:(0,a.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:e.payment_method})}),(0,a.jsx)(i.TableCell,{children:m(e.status)}),(0,a.jsx)(i.TableCell,{children:e.payment_reference?(0,a.jsx)("span",{className:"text-sm font-mono",children:e.payment_reference}):(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"-"})})]},e.id))})]})})})]}):(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)(d.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Payouts Found"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"all"!==e?"No payouts match your filters. Try adjusting your criteria.":"You don&apos;t have any payouts yet."})]})}),C>0&&(0,a.jsxs)(i.Card,{className:"border-destructive",children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsxs)(i.CardTitle,{className:"text-base flex items-center gap-2 text-destructive",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4"}),"Failed Payouts"]})}),(0,a.jsx)(i.CardContent,{children:(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["You have ",C," failed payout",C>1?"s":"",". Please contact support to resolve payment issues."]})})]}),c&&c.length>=20&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(t-1)*20+1," to ",Math.min(20*t,c.length)," ","payouts"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>n(t-1),disabled:1===t,children:"Previous"}),(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>n(t+1),disabled:c.length<20,children:"Next"})]})]})]})}var P=t(25276);function F(){let[e,s]=(0,r.useState)("revenue_share"),[t,l]=(0,r.useState)("1000"),[d,c]=(0,r.useState)("10"),[m,x]=(0,r.useState)("50"),[h,p]=(0,r.useState)("5000"),[j,f]=(0,r.useState)(null),g=[{min_volume:0,max_volume:5e3,rate:5},{min_volume:5e3,max_volume:1e4,rate:7.5},{min_volume:1e4,max_volume:25e3,rate:10},{min_volume:25e3,max_volume:null,rate:12.5}];return(0,a.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5"}),"Commission Calculator"]}),(0,a.jsx)(i.CardDescription,{children:"Simulate commission earnings based on different models"})]}),(0,a.jsxs)(i.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{children:"Commission Model"}),(0,a.jsxs)(i.Select,{value:e,onValueChange:e=>s(e),children:[(0,a.jsx)(i.SelectTrigger,{children:(0,a.jsx)(i.SelectValue,{})}),(0,a.jsxs)(i.SelectContent,{children:[(0,a.jsx)(i.SelectItem,{value:"revenue_share",children:"Revenue Share (Percentage)"}),(0,a.jsx)(i.SelectItem,{value:"flat_fee",children:"Flat Fee"}),(0,a.jsx)(i.SelectItem,{value:"tiered",children:"Tiered (Volume-based)"}),(0,a.jsx)(i.SelectItem,{value:"hybrid",children:"Hybrid (Percentage + Flat Fee)"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"baseAmount",children:"Invoice/Revenue Amount ($)"}),(0,a.jsx)(i.Input,{id:"baseAmount",type:"number",value:t,onChange:e=>l(e.target.value),placeholder:"1000"})]}),("revenue_share"===e||"hybrid"===e)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"rate",children:"Commission Rate (%)"}),(0,a.jsx)(i.Input,{id:"rate",type:"number",value:d,onChange:e=>c(e.target.value),placeholder:"10",step:"0.1"})]}),("flat_fee"===e||"hybrid"===e)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"flatFee",children:"Flat Fee Amount ($)"}),(0,a.jsx)(i.Input,{id:"flatFee",type:"number",value:m,onChange:e=>x(e.target.value),placeholder:"50"})]}),"tiered"===e&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"volume",children:"Total Volume ($)"}),(0,a.jsx)(i.Input,{id:"volume",type:"number",value:h,onChange:e=>p(e.target.value),placeholder:"5000"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Tier structure:"}),(0,a.jsx)("ul",{className:"text-xs text-muted-foreground space-y-1",children:g.map((e,s)=>(0,a.jsxs)("li",{children:["$",e.min_volume.toLocaleString()," - $",e.max_volume?.toLocaleString()||"∞",": ",e.rate,"%"]},s))})]}),(0,a.jsxs)(i.Button,{onClick:()=>{let s=parseFloat(t)||0,a=parseFloat(h)||0,r=0,i=0,n="";switch(e){case"revenue_share":r=(i=parseFloat(d)||0)/100*s;break;case"flat_fee":r=parseFloat(m)||0,i=s>0?r/s*100:0;break;case"tiered":let l=g.find(e=>a>=e.min_volume&&(null===e.max_volume||a<e.max_volume));if(l){r=(i=l.rate)/100*s;let e=l.max_volume?l.max_volume.toLocaleString():"∞";n=`$${l.min_volume.toLocaleString()} - $${e}`}break;case"hybrid":r=(parseFloat(d)||0)/100*s+(parseFloat(m)||0),i=s>0?r/s*100:0}f({baseAmount:s,commissionRate:i,commissionAmount:r,effectiveRate:i,model:e,tier:n})},className:"w-full",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Calculate Commission"]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"h-5 w-5"}),"Calculation Results"]}),(0,a.jsx)(i.CardDescription,{children:"Commission breakdown and earnings estimate"})]}),(0,a.jsx)(i.CardContent,{children:j?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-6 rounded-lg bg-primary/10 border border-primary/20",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-2",children:"Estimated Commission"}),(0,a.jsxs)("div",{className:"text-4xl font-bold text-primary flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"h-8 w-8"}),j.commissionAmount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Base Amount"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:["$",j.baseAmount.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted",children:[(0,a.jsxs)("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)(P.Z,{className:"h-3 w-3"}),"Effective Rate"]}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[j.effectiveRate.toFixed(2),"%"]})]}),j.tier&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Applicable Tier"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:j.tier})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Commission Model"}),(0,a.jsx)("span",{className:"text-sm font-medium capitalize",children:j.model.replace("_"," ")})]})]}),(0,a.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold mb-3",children:"Monthly Projections"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"10 transactions/month:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",(10*j.commissionAmount).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"25 transactions/month:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",(25*j.commissionAmount).toLocaleString(void 0,{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"50 transactions/month:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",(50*j.commissionAmount).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,a.jsx)(o.Z,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,a.jsx)("p",{children:"Configure your parameters and click Calculate to see results"})]})})]})]})}var H=t(83855),D=t(77506),L=t(69508),Z=t(98091),q=t(44976),R=t(17010),$=t(93158);let A={"Content-Type":"application/json"};async function I(e,s){let t=new URLSearchParams;s?.partner_id&&t.append("partner_id",s.partner_id),s?.is_active!==void 0&&t.append("is_active",String(s.is_active)),s?.page&&t.append("page",String(s.page)),s?.page_size&&t.append("page_size",String(s.page_size));let a=e(`/partners/commission-rules/?${t}`),r=await fetch(a,{headers:A,credentials:"include"});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Failed to fetch commission rules"}))).detail||`HTTP ${r.status}`);return r.json()}async function k(e,s){let t=e("/partners/commission-rules/"),a=await fetch(t,{method:"POST",headers:A,credentials:"include",body:JSON.stringify(s)});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Failed to create commission rule"}))).detail||`HTTP ${a.status}`);return a.json()}async function U(e,s,t){let a=e(`/partners/commission-rules/${s}`),r=await fetch(a,{method:"PATCH",headers:A,credentials:"include",body:JSON.stringify(t)});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Failed to update commission rule"}))).detail||`HTTP ${r.status}`);return r.json()}async function E(e,s){let t=e(`/partners/commission-rules/${s}`),a=await fetch(t,{method:"DELETE",headers:A,credentials:"include"});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Failed to delete commission rule"}))).detail||`HTTP ${a.status}`)}var B=t(78855);function M({partnerId:e}){let[s,t]=(0,r.useState)(!1),[n,l]=(0,r.useState)(null),[d,c]=(0,r.useState)(e||""),[o,m]=(0,r.useState)({commission_type:"revenue_share",is_active:!0,priority:1}),{data:u}=(0,B.o5)(void 0,1,100),{data:h,isLoading:p,error:f}=function(e){let{api:s}=(0,$.M)();return(0,j.a)({queryKey:["commission-rules",e,s.baseUrl,s.prefix],queryFn:()=>I(s.buildUrl,e)})}({page:1,page_size:100,...e&&{partner_id:e}}),g=function(){let{api:e}=(0,$.M)(),s=(0,q.NL)();return(0,R.D)({mutationFn:s=>k(e.buildUrl,s),onSuccess:()=>{s.invalidateQueries({queryKey:["commission-rules"]})}})}(),v=function(){let{api:e}=(0,$.M)(),s=(0,q.NL)();return(0,R.D)({mutationFn:({ruleId:s,data:t})=>U(e.buildUrl,s,t),onSuccess:()=>{s.invalidateQueries({queryKey:["commission-rules"]})}})}(),y=function(){let{api:e}=(0,$.M)(),s=(0,q.NL)();return(0,R.D)({mutationFn:s=>E(e.buildUrl,s),onSuccess:()=>{s.invalidateQueries({queryKey:["commission-rules"]})}})}(),N=()=>{l(null),m(e=>({...e,commission_type:"revenue_share",is_active:!0,priority:1,effective_from:new Date().toISOString().split("T")[0]})),t(!0)},b=e=>{l(e),m(s=>({...s,rule_name:e.rule_name,description:e.description,commission_type:e.commission_type,commission_rate:e.commission_rate,flat_fee_amount:e.flat_fee_amount,tier_config:e.tier_config,applies_to_products:e.applies_to_products,applies_to_customers:e.applies_to_customers,effective_from:e.effective_from.split("T")[0],effective_to:e.effective_to?.split("T")[0],is_active:e.is_active,priority:e.priority})),c(e.partner_id),t(!0)},C=async e=>{if(confirm("Are you sure you want to delete this commission rule?"))try{await y.mutateAsync(e)}catch(e){alert(`Failed to delete rule: ${e}`)}},_=async()=>{try{if(!o.rule_name||!d||!o.effective_from){alert("Please fill in all required fields");return}if("revenue_share"===o.commission_type&&!o.commission_rate){alert("Revenue share model requires a commission rate");return}if("flat_fee"===o.commission_type&&!o.flat_fee_amount){alert("Flat fee model requires a flat fee amount");return}if("hybrid"===o.commission_type&&(!o.commission_rate||!o.flat_fee_amount)){alert("Hybrid model requires both commission rate and flat fee amount");return}n?await v.mutateAsync({ruleId:n.id,data:o}):await g.mutateAsync({partner_id:d,...o}),t(!1),m({commission_type:"revenue_share",is_active:!0,priority:1})}catch(e){alert(`Failed to save rule: ${e.message||e}`)}},w=e=>{let{label:s,className:t}={revenue_share:{label:"Revenue Share",className:"bg-blue-500/10 text-blue-500"},flat_fee:{label:"Flat Fee",className:"bg-green-500/10 text-green-500"},tiered:{label:"Tiered",className:"bg-purple-500/10 text-purple-500"},hybrid:{label:"Hybrid",className:"bg-orange-500/10 text-orange-500"}}[e];return(0,a.jsx)(i.Badge,{className:t,children:s})},S=h?.rules||[];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(i.Card,{children:(0,a.jsx)(i.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(i.CardTitle,{children:"Commission Rules"}),(0,a.jsx)(i.CardDescription,{children:"Configure commission calculation rules for different products and customers"})]}),(0,a.jsxs)(i.Button,{onClick:N,disabled:!e&&!u,children:[(0,a.jsx)(H.Z,{className:"h-4 w-4 mr-2"}),"Create Rule"]})]})})}),f&&(0,a.jsx)(i.Card,{className:"border-destructive/20 bg-destructive/5",children:(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2 text-destructive",children:[(0,a.jsx)(T.Z,{className:"h-5 w-5"}),"Error Loading Rules"]}),(0,a.jsx)(i.CardDescription,{className:"text-destructive/80",children:f.message||"Failed to load commission rules"})]})}),(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsx)(i.CardTitle,{className:"text-base",children:"Active Rules"}),(0,a.jsx)(i.CardDescription,{children:p?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(D.Z,{className:"h-3 w-3 animate-spin"}),"Loading rules..."]}):(0,a.jsxs)(a.Fragment,{children:[S.length," rule",1!==S.length?"s":""," configured"]})})]}),(0,a.jsx)(i.CardContent,{children:p?(0,a.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,a.jsx)(D.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{children:"Loading commission rules..."})]}):0===S.length?(0,a.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,a.jsx)("p",{children:"No commission rules configured"}),(0,a.jsxs)(i.Button,{className:"mt-4",onClick:N,children:[(0,a.jsx)(H.Z,{className:"h-4 w-4 mr-2"}),"Create your first rule"]})]}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(i.Table,{children:[(0,a.jsx)(i.TableHeader,{children:(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableHead,{children:"Rule Name"}),(0,a.jsx)(i.TableHead,{children:"Model"}),(0,a.jsx)(i.TableHead,{children:"Rate/Amount"}),(0,a.jsx)(i.TableHead,{children:"Effective Period"}),(0,a.jsx)(i.TableHead,{children:"Status"}),(0,a.jsx)(i.TableHead,{children:"Priority"}),(0,a.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(i.TableBody,{children:S.map(e=>(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableCell,{className:"font-medium",children:e.rule_name}),(0,a.jsx)(i.TableCell,{children:w(e.commission_type)}),(0,a.jsxs)(i.TableCell,{children:["revenue_share"===e.commission_type&&(0,a.jsxs)("span",{children:[(100*e.commission_rate).toFixed(1),"%"]}),"flat_fee"===e.commission_type&&(0,a.jsxs)("span",{children:["$",e.flat_fee_amount?.toFixed(2)]}),"tiered"===e.commission_type&&(0,a.jsx)("span",{children:"Tiered rates"}),"hybrid"===e.commission_type&&(0,a.jsxs)("span",{children:[(100*e.commission_rate).toFixed(1),"% + $",e.flat_fee_amount?.toFixed(2)]})]}),(0,a.jsxs)(i.TableCell,{className:"text-sm",children:[(0,a.jsx)("div",{children:new Date(e.effective_from).toLocaleDateString()}),e.effective_to&&(0,a.jsxs)("div",{className:"text-muted-foreground",children:["to ",new Date(e.effective_to).toLocaleDateString()]})]}),(0,a.jsx)(i.TableCell,{children:e.is_active?(0,a.jsxs)(i.Badge,{variant:"secondary",className:"flex items-center gap-1 w-fit",children:[(0,a.jsx)(x.Z,{className:"h-3 w-3"}),"Active"]}):(0,a.jsx)(i.Badge,{variant:"outline",children:"Inactive"})}),(0,a.jsx)(i.TableCell,{children:e.priority}),(0,a.jsx)(i.TableCell,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>b(e),children:(0,a.jsx)(L.Z,{className:"h-4 w-4"})}),(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>C(e.id),disabled:y.isPending,children:y.isPending?(0,a.jsx)(D.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(Z.Z,{className:"h-4 w-4 text-destructive"})})]})})]},e.id))})]})})})]}),(0,a.jsx)(i.Dialog,{open:s,onOpenChange:t,children:(0,a.jsxs)(i.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(i.DialogHeader,{children:[(0,a.jsx)(i.DialogTitle,{children:n?"Edit Commission Rule":"Create Commission Rule"}),(0,a.jsx)(i.DialogDescription,{children:"Configure how commissions are calculated for this rule"})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[!n&&!e&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(i.Label,{htmlFor:"partner",children:["Partner ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsxs)(i.Select,{value:d,onValueChange:c,children:[(0,a.jsx)(i.SelectTrigger,{children:(0,a.jsx)(i.SelectValue,{placeholder:"Select a partner"})}),(0,a.jsx)(i.SelectContent,{children:u?.partners.map(e=>a.jsxs(i.SelectItem,{value:e.id,children:[e.company_name," (",e.partner_number,")"]},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(i.Label,{htmlFor:"rule_name",children:["Rule Name ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(i.Input,{id:"rule_name",placeholder:"e.g., Standard Revenue Share",value:o.rule_name||"",onChange:e=>m(s=>({...s,rule_name:e.target.value}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"description",children:"Description"}),(0,a.jsx)(i.Input,{id:"description",placeholder:"Optional description",value:o.description||"",onChange:e=>m(s=>({...s,description:e.target.value}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(i.Label,{htmlFor:"commission_type",children:["Commission Model ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsxs)(i.Select,{value:o.commission_type??"revenue_share",onValueChange:e=>m(s=>({...s,commission_type:e})),children:[(0,a.jsx)(i.SelectTrigger,{children:(0,a.jsx)(i.SelectValue,{})}),(0,a.jsxs)(i.SelectContent,{children:[(0,a.jsx)(i.SelectItem,{value:"revenue_share",children:"Revenue Share (Percentage)"}),(0,a.jsx)(i.SelectItem,{value:"flat_fee",children:"Flat Fee"}),(0,a.jsx)(i.SelectItem,{value:"tiered",children:"Tiered (Volume-based)"}),(0,a.jsx)(i.SelectItem,{value:"hybrid",children:"Hybrid (Percentage + Flat)"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(i.Label,{htmlFor:"commission_rate",children:["Commission Rate (%)",("revenue_share"===o.commission_type||"hybrid"===o.commission_type)&&(0,a.jsx)("span",{className:"text-destructive",children:" *"})]}),(0,a.jsx)(i.Input,{id:"commission_rate",type:"number",step:"0.1",min:"0",max:"100",placeholder:"10.0",value:o.commission_rate?100*o.commission_rate:"",onChange:e=>m(s=>({...s,commission_rate:e.target.value?parseFloat(e.target.value)/100:void 0})),disabled:"flat_fee"===o.commission_type})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(i.Label,{htmlFor:"flat_fee_amount",children:["Flat Fee Amount ($)",("flat_fee"===o.commission_type||"hybrid"===o.commission_type)&&(0,a.jsx)("span",{className:"text-destructive",children:" *"})]}),(0,a.jsx)(i.Input,{id:"flat_fee_amount",type:"number",step:"0.01",min:"0",placeholder:"50.00",value:o.flat_fee_amount||"",onChange:e=>m(s=>({...s,flat_fee_amount:e.target.value?parseFloat(e.target.value):void 0})),disabled:"revenue_share"===o.commission_type})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(i.Label,{htmlFor:"effective_from",children:["Effective From ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(i.Input,{id:"effective_from",type:"date",value:o.effective_from||"",onChange:e=>m(s=>({...s,effective_from:e.target.value}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"effective_to",children:"Effective To (Optional)"}),(0,a.jsx)(i.Input,{id:"effective_to",type:"date",value:o.effective_to||"",onChange:e=>m(s=>({...s,effective_to:e.target.value||void 0}))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"priority",children:"Priority"}),(0,a.jsx)(i.Input,{id:"priority",type:"number",min:"1",placeholder:"1",value:o.priority||1,onChange:e=>m(s=>({...s,priority:parseInt(e.target.value)||1}))}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Lower numbers have higher priority when multiple rules apply"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"is_active",checked:!1!==o.is_active,onChange:e=>m(s=>({...s,is_active:e.target.checked})),className:"rounded border-gray-300"}),(0,a.jsx)(i.Label,{htmlFor:"is_active",className:"cursor-pointer",children:"Active"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>t(!1),disabled:g.isPending||v.isPending,children:"Cancel"}),(0,a.jsxs)(i.Button,{onClick:_,disabled:g.isPending||v.isPending,children:[(g.isPending||v.isPending)&&(0,a.jsx)(D.Z,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Update Rule":"Create Rule"]})]})]})})]})}let K="force-dynamic",O=!0;function Q(){let[e,s]=(0,r.useState)("metrics");return(0,a.jsxs)("div",{className:"space-y-6 p-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Partner Revenue"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Track commissions, view payouts, configure rules, and analyze your revenue performance"})]}),(0,a.jsxs)(i.Tabs,{value:e,onValueChange:s,children:[(0,a.jsxs)(i.TabsList,{className:"grid w-full grid-cols-5 lg:w-full",children:[(0,a.jsxs)(i.TabsTrigger,{value:"metrics",className:"flex items-center gap-2",children:[(0,a.jsx)(n.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Revenue Metrics"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Metrics"})]}),(0,a.jsxs)(i.TabsTrigger,{value:"commissions",className:"flex items-center gap-2",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Commissions"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Comm."})]}),(0,a.jsxs)(i.TabsTrigger,{value:"payouts",className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4"}),"Payouts"]}),(0,a.jsxs)(i.TabsTrigger,{value:"rules",className:"flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4"}),"Rules"]}),(0,a.jsxs)(i.TabsTrigger,{value:"simulator",className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Simulator"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Calc"})]})]}),(0,a.jsx)(i.TabsContent,{value:"metrics",className:"mt-6",children:(0,a.jsx)(C,{})}),(0,a.jsx)(i.TabsContent,{value:"commissions",className:"mt-6",children:(0,a.jsx)(w,{})}),(0,a.jsx)(i.TabsContent,{value:"payouts",className:"mt-6",children:(0,a.jsx)(S,{})}),(0,a.jsx)(i.TabsContent,{value:"rules",className:"mt-6",children:(0,a.jsx)(M,{})}),(0,a.jsx)(i.TabsContent,{value:"simulator",className:"mt-6",children:(0,a.jsx)(F,{})})]})]})}},78855:(e,s,t)=>{"use strict";t.d(s,{Jb:()=>y,Kg:()=>j,Lw:()=>g,o5:()=>p,qi:()=>v,qo:()=>N,r2:()=>b,y5:()=>f});var a=t(48324),r=t(44976),i=t(17010),n=t(93158);async function l(e,s,t=1,a=50){let r=new URLSearchParams({page:t.toString(),page_size:a.toString()});s&&r.append("status",s);let i=await fetch(e(`/partners?${r.toString()}`),{credentials:"include",headers:{"Content-Type":"application/json"}});if(!i.ok)throw Error("Failed to fetch partners");return i.json()}async function d(e,s){let t=await fetch(e(`/partners/${s}`),{credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch partner");return t.json()}async function c(e,s){let t=await fetch(e("/partners"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw Error((await t.json()).detail||"Failed to create partner");return t.json()}async function o(e,s,t){let a=await fetch(e(`/partners/${s}`),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json()).detail||"Failed to update partner");return a.json()}async function m(e,s){if(!(await fetch(e(`/partners/${s}`),{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)throw Error("Failed to delete partner")}async function u(e,s,t,a){let r=new URLSearchParams({requested_licenses:t.toString()});a&&r.append("tenant_id",a);let i=await fetch(e(`/partners/${s}/quota/check?${r.toString()}`),{credentials:"include",headers:{"Content-Type":"application/json"}});if(!i.ok)throw Error((await i.json()).detail||"Failed to check license quota");return i.json()}async function x(e,s,t,a="managed",r,i){let n=await fetch(e(`/partners/${s}/customers`),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_data:t,engagement_type:a,custom_commission_rate:r,tenant_id:i})});if(!n.ok)throw Error((await n.json()).detail||"Failed to create partner customer");return n.json()}async function h(e,s){let t=await fetch(e("/partners/onboarding/complete"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw Error((await t.json()).detail||"Failed to complete partner onboarding");return t.json()}function p(e,s=1,t=50){let{api:r}=(0,n.M)();return(0,a.a)({queryKey:["partners",e,s,t,r.baseUrl,r.prefix],queryFn:()=>l(r.buildUrl,e,s,t)})}function j(e){let{api:s}=(0,n.M)();return(0,a.a)({queryKey:["partner",e,s.baseUrl,s.prefix],queryFn:()=>d(s.buildUrl,e),enabled:!!e})}function f(){let{api:e}=(0,n.M)(),s=(0,r.NL)();return(0,i.D)({mutationFn:s=>c(e.buildUrl,s),onSuccess:()=>{s.invalidateQueries({queryKey:["partners"]})}})}function g(){let{api:e}=(0,n.M)(),s=(0,r.NL)();return(0,i.D)({mutationFn:({partnerId:s,data:t})=>o(e.buildUrl,s,t),onSuccess:(e,t)=>{s.invalidateQueries({queryKey:["partners"]}),s.invalidateQueries({queryKey:["partner",t.partnerId]})}})}function v(){let{api:e}=(0,n.M)(),s=(0,r.NL)();return(0,i.D)({mutationFn:s=>m(e.buildUrl,s),onSuccess:()=>{s.invalidateQueries({queryKey:["partners"]})}})}function y(){let{api:e}=(0,n.M)();return(0,i.D)({mutationFn:({partnerId:s,requestedLicenses:t,tenantId:a})=>u(e.buildUrl,s,t,a)})}function N(){let{api:e}=(0,n.M)(),s=(0,r.NL)();return(0,i.D)({mutationFn:({partnerId:s,customerData:t,engagementType:a,customCommissionRate:r,tenantId:i})=>x(e.buildUrl,s,t,a,r,i),onSuccess:(e,t)=>{s.invalidateQueries({queryKey:["partners"]}),s.invalidateQueries({queryKey:["partner",t.partnerId]}),s.invalidateQueries({queryKey:["customers"]})}})}function b(){let{api:e}=(0,n.M)(),s=(0,r.NL)();return(0,i.D)({mutationFn:s=>h(e.buildUrl,s),onSuccess:e=>{s.invalidateQueries({queryKey:["partners"]}),s.invalidateQueries({queryKey:["partner",e.partner.id]}),s.invalidateQueries({queryKey:["customers"]}),s.invalidateQueries({queryKey:["licenses"]}),s.invalidateQueries({queryKey:["deployments"]})}})}},97944:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n,dynamic:()=>r,dynamicParams:()=>i});var a=t(68570);let r=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/partners/revenue/page.tsx#dynamic`),i=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/partners/revenue/page.tsx#dynamicParams`),n=(0,a.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/partners/revenue/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(89136));module.exports=a})();