(()=>{var e={};e.id=2426,e.ids=[2426],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},23629:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>c}),a(87223),a(13321),a(46366),a(96560);var r=a(23191),t=a(88716),i=a(37922),l=a.n(i),n=a(95231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);a.d(s,d);let c=["",{children:["dashboard",{children:["subscribers",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,87223)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/subscribers/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/subscribers/page.tsx"],x="/dashboard/subscribers/page",u={require:a,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/dashboard/subscribers/page",pathname:"/dashboard/subscribers",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},67868:(e,s,a)=>{Promise.resolve().then(a.bind(a,96541))},96541:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>P});var r=a(10326),t=a(17577),i=a(48723),l=a(46502),n=a(36607),d=a(93158),c=a(29771),o=a(58291),x=a(46465),u=a(51110),m=a(58038),h=a(41291),p=a(45091),j=a(69508),b=a(77506);function v({open:e,onOpenChange:s,subscriberId:a,profile:l,onSuccess:n}){let{toast:d}=(0,i.useToast)(),[c,o]=(0,t.useState)(!1),x=e=>({serviceVlan:e?.serviceVlan?.toString()||"",innerVlan:e?.innerVlan?.toString()||"",vlanPool:e?.vlanPool||"",qinqEnabled:e?.qinqEnabled||!1,staticIpv4:e?.staticIpv4||"",staticIpv6:e?.staticIpv6||"",delegatedIpv6Prefix:e?.delegatedIpv6Prefix||"",ipv6PdSize:e?.ipv6PdSize?.toString()||"",ipv6AssignmentMode:e?.ipv6AssignmentMode||"none",circuitId:e?.circuitId||"",remoteId:e?.remoteId||"",option82Policy:e?.option82Policy||"log"}),[u,m]=(0,t.useState)(()=>x(l??null)),h=async e=>{e.preventDefault(),o(!0);try{let e={};u.serviceVlan&&(e.serviceVlan=parseInt(u.serviceVlan)),u.innerVlan&&(e.innerVlan=parseInt(u.innerVlan)),u.vlanPool&&(e.vlanPool=u.vlanPool),e.qinqEnabled=u.qinqEnabled,u.staticIpv4&&(e.staticIpv4=u.staticIpv4),u.staticIpv6&&(e.staticIpv6=u.staticIpv6),u.delegatedIpv6Prefix&&(e.delegatedIpv6Prefix=u.delegatedIpv6Prefix),u.ipv6PdSize&&(e.ipv6PdSize=parseInt(u.ipv6PdSize)),e.ipv6AssignmentMode=u.ipv6AssignmentMode,u.circuitId&&(e.circuitId=u.circuitId),u.remoteId&&(e.remoteId=u.remoteId),e.option82Policy=u.option82Policy;let s=await fetch(`/api/v1/network/subscribers/${a}/profile`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();throw Error(e.detail||"Failed to update network profile")}d({title:"Success",description:"Network profile updated successfully"}),n()}catch(e){console.error("Error updating network profile:",e),d({title:"Error",description:e instanceof Error?e.message:"Failed to update network profile",variant:"destructive"})}finally{o(!1)}};return(0,r.jsx)(i.Dialog,{open:e,onOpenChange:s,children:(0,r.jsxs)(i.DialogContent,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,r.jsxs)(i.DialogHeader,{children:[(0,r.jsxs)(i.DialogTitle,{children:[l?"Edit":"Configure"," Network Profile"]}),(0,r.jsx)(i.DialogDescription,{children:"Configure VLAN, IP addressing, and DHCP Option 82 settings for this subscriber"})]}),(0,r.jsxs)("form",{onSubmit:h,children:[(0,r.jsxs)(i.Tabs,{defaultValue:"vlan",className:"w-full",children:[(0,r.jsxs)(i.TabsList,{className:"grid w-full grid-cols-3",children:[(0,r.jsx)(i.TabsTrigger,{value:"vlan",children:"VLAN"}),(0,r.jsx)(i.TabsTrigger,{value:"ip",children:"IP Addressing"}),(0,r.jsx)(i.TabsTrigger,{value:"option82",children:"Option 82"})]}),(0,r.jsxs)(i.TabsContent,{value:"vlan",className:"space-y-4 mt-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"serviceVlan",children:"Service VLAN (S-VLAN)"}),(0,r.jsx)(i.Input,{id:"serviceVlan",type:"number",min:"1",max:"4094",placeholder:"100",value:u.serviceVlan,onChange:e=>m({...u,serviceVlan:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"innerVlan",children:"Inner VLAN (C-VLAN)"}),(0,r.jsx)(i.Input,{id:"innerVlan",type:"number",min:"1",max:"4094",placeholder:"200",value:u.innerVlan,onChange:e=>m({...u,innerVlan:e.target.value})})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"vlanPool",children:"VLAN Pool"}),(0,r.jsx)(i.Input,{id:"vlanPool",placeholder:"pool-business",value:u.vlanPool,onChange:e=>m({...u,vlanPool:e.target.value})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(i.Switch,{id:"qinqEnabled",checked:u.qinqEnabled,onCheckedChange:e=>m({...u,qinqEnabled:e})}),(0,r.jsx)(i.Label,{htmlFor:"qinqEnabled",children:"Enable QinQ (802.1ad)"})]})]}),(0,r.jsxs)(i.TabsContent,{value:"ip",className:"space-y-4 mt-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"staticIpv4",children:"Static IPv4 Address"}),(0,r.jsx)(i.Input,{id:"staticIpv4",placeholder:"10.0.0.100",value:u.staticIpv4,onChange:e=>m({...u,staticIpv4:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"staticIpv6",children:"Static IPv6 Address"}),(0,r.jsx)(i.Input,{id:"staticIpv6",placeholder:"2001:db8::100",value:u.staticIpv6,onChange:e=>m({...u,staticIpv6:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"delegatedIpv6Prefix",children:"IPv6 Prefix Delegation"}),(0,r.jsx)(i.Input,{id:"delegatedIpv6Prefix",placeholder:"2001:db8:1000::/56",value:u.delegatedIpv6Prefix,onChange:e=>m({...u,delegatedIpv6Prefix:e.target.value})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"ipv6PdSize",children:"PD Size"}),(0,r.jsx)(i.Input,{id:"ipv6PdSize",type:"number",min:"0",max:"128",placeholder:"56",value:u.ipv6PdSize,onChange:e=>m({...u,ipv6PdSize:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"ipv6AssignmentMode",children:"IPv6 Assignment Mode"}),(0,r.jsxs)(i.Select,{value:u.ipv6AssignmentMode,onValueChange:e=>m({...u,ipv6AssignmentMode:e}),children:[(0,r.jsx)(i.SelectTrigger,{children:(0,r.jsx)(i.SelectValue,{placeholder:"Select mode"})}),(0,r.jsxs)(i.SelectContent,{children:[(0,r.jsx)(i.SelectItem,{value:"none",children:"None"}),(0,r.jsx)(i.SelectItem,{value:"slaac",children:"SLAAC"}),(0,r.jsx)(i.SelectItem,{value:"stateful",children:"Stateful DHCPv6"}),(0,r.jsx)(i.SelectItem,{value:"pd",children:"Prefix Delegation"}),(0,r.jsx)(i.SelectItem,{value:"dual_stack",children:"Dual Stack"})]})]})]})]})]}),(0,r.jsxs)(i.TabsContent,{value:"option82",className:"space-y-4 mt-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"circuitId",children:"Circuit ID"}),(0,r.jsx)(i.Input,{id:"circuitId",placeholder:"OLT1:1/1/1",value:u.circuitId,onChange:e=>m({...u,circuitId:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"remoteId",children:"Remote ID"}),(0,r.jsx)(i.Input,{id:"remoteId",placeholder:"OLT1",value:u.remoteId,onChange:e=>m({...u,remoteId:e.target.value})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.Label,{htmlFor:"option82Policy",children:"Enforcement Policy"}),(0,r.jsxs)(i.Select,{value:u.option82Policy,onValueChange:e=>m({...u,option82Policy:e}),children:[(0,r.jsx)(i.SelectTrigger,{children:(0,r.jsx)(i.SelectValue,{placeholder:"Select policy"})}),(0,r.jsxs)(i.SelectContent,{children:[(0,r.jsx)(i.SelectItem,{value:"enforce",children:"Enforce - Block mismatches"}),(0,r.jsx)(i.SelectItem,{value:"log",children:"Log - Allow but log"}),(0,r.jsx)(i.SelectItem,{value:"ignore",children:"Ignore - No validation"})]})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["enforce"===u.option82Policy&&"Sessions will be rejected if Option 82 doesn't match","log"===u.option82Policy&&"Sessions will be allowed but mismatches will be logged","ignore"===u.option82Policy&&"Option 82 validation is disabled"]})]})]})]}),(0,r.jsxs)(i.DialogFooter,{className:"mt-6",children:[(0,r.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:c,children:"Cancel"}),(0,r.jsxs)(i.Button,{type:"submit",disabled:c,children:[c&&(0,r.jsx)(b.Z,{className:"mr-2 h-4 w-4 animate-spin"}),l?"Update":"Create"," Profile"]})]})]})]})})}function g({profile:e,subscriberId:s,onUpdate:a,isLoading:l=!1}){var n;let[d,c]=(0,t.useState)(!1),o=!!e?.serviceVlan,x=!!e?.staticIpv4||!!e?.staticIpv6,b=!!e?.circuitId||!!e?.remoteId;return l?(0,r.jsxs)(i.Card,{children:[(0,r.jsxs)(i.CardHeader,{children:[(0,r.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-5 w-5"}),"Network Profile"]}),(0,r.jsx)(i.CardDescription,{children:"Loading network configuration..."})]}),(0,r.jsx)(i.CardContent,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-4 w-full bg-muted animate-pulse rounded"}),(0,r.jsx)("div",{className:"h-4 w-3/4 bg-muted animate-pulse rounded"}),(0,r.jsx)("div",{className:"h-4 w-1/2 bg-muted animate-pulse rounded"})]})})]}):e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-5 w-5"}),"Network Profile"]}),(0,r.jsx)(i.CardDescription,{children:"Subscriber network configuration and policies"})]}),(0,r.jsxs)(i.Button,{onClick:()=>c(!0),variant:"outline",size:"sm",children:[(0,r.jsx)(j.Z,{className:"mr-2 h-4 w-4"}),"Edit"]})]})}),(0,r.jsxs)(i.CardContent,{className:"space-y-4",children:[o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4"}),"VLAN Configuration"]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.serviceVlan&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Service VLAN"}),(0,r.jsx)("p",{className:"font-mono",children:e.serviceVlan})]}),e.innerVlan&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Inner VLAN"}),(0,r.jsx)("p",{className:"font-mono",children:e.innerVlan})]}),e.vlanPool&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"VLAN Pool"}),(0,r.jsx)("p",{className:"font-mono",children:e.vlanPool})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"QinQ"}),(0,r.jsx)(i.Badge,{variant:e.qinqEnabled?"default":"secondary",children:e.qinqEnabled?"Enabled":"Disabled"})]})]})]}),(0,r.jsx)(i.Separator,{})]}),x&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"IP Addressing"}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[e.staticIpv4&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Static IPv4"}),(0,r.jsx)("p",{className:"font-mono",children:e.staticIpv4})]}),e.staticIpv6&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Static IPv6"}),(0,r.jsx)("p",{className:"font-mono break-all",children:e.staticIpv6})]}),e.delegatedIpv6Prefix&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"IPv6 Prefix Delegation"}),(0,r.jsxs)("p",{className:"font-mono",children:[e.delegatedIpv6Prefix,e.ipv6PdSize&&` (/${e.ipv6PdSize})`]})]}),"none"!==e.ipv6AssignmentMode&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"IPv6 Mode"}),"none"===(n=e.ipv6AssignmentMode)?null:(0,r.jsxs)(i.Badge,{variant:"outline",className:"gap-1",children:[(0,r.jsx)(p.Z,{className:"h-3 w-3"}),n.toUpperCase().replace("_"," ")]})]})]})]}),(0,r.jsx)(i.Separator,{})]}),b&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4"}),"DHCP Option 82 Binding"]}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[e.circuitId&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Circuit ID"}),(0,r.jsx)("p",{className:"font-mono",children:e.circuitId})]}),e.remoteId&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Remote ID"}),(0,r.jsx)("p",{className:"font-mono",children:e.remoteId})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Enforcement Policy"}),(e=>{let s={enforce:{variant:"destructive",icon:m.Z},log:{variant:"secondary",icon:h.Z},ignore:{variant:"default",icon:h.Z}},a=s[e]??s.ignore,t=a?.icon??h.Z,l=a?.variant??"default";return(0,r.jsxs)(i.Badge,{variant:l,className:"gap-1",children:[(0,r.jsx)(t,{className:"h-3 w-3"}),e.toUpperCase()]})})(e.option82Policy)]})]})]}),(0,r.jsx)(i.Separator,{})]}),!o&&!x&&!b&&(0,r.jsxs)("div",{className:"text-center text-muted-foreground py-4",children:[(0,r.jsx)("p",{children:"Basic network profile configured"}),(0,r.jsx)("p",{className:"text-xs mt-1",children:"Click Edit to add more configuration"})]}),e.updatedAt&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground pt-2 border-t",children:["Last updated: ",new Date(e.updatedAt).toLocaleString()]})]})]}),(0,r.jsx)(v,{open:d,onOpenChange:c,subscriberId:s,profile:e,onSuccess:()=>{a?.(),c(!1)}})]}):(0,r.jsxs)(i.Card,{children:[(0,r.jsxs)(i.CardHeader,{children:[(0,r.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-5 w-5"}),"Network Profile"]}),(0,r.jsx)(i.CardDescription,{children:"No network profile configured for this subscriber"})]}),(0,r.jsx)(i.CardContent,{children:(0,r.jsxs)(i.Button,{onClick:()=>c(!0),variant:"outline",className:"w-full",children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Configure Network Profile"]})}),(0,r.jsx)(v,{open:d,onOpenChange:c,subscriberId:s,profile:null,onSuccess:()=>{a?.(),c(!1)}})]})}var f=a(69669),N=a(50949),C=a(18019);function I({alerts:e}){if(!e||0===e.length)return null;let s=e=>{switch(e.toLowerCase()){case"critical":return(0,r.jsx)(f.Z,{className:"h-4 w-4"});case"warning":return(0,r.jsx)(N.Z,{className:"h-4 w-4"});case"info":return(0,r.jsx)(C.Z,{className:"h-4 w-4"});default:return(0,r.jsx)(h.Z,{className:"h-4 w-4"})}},a=e=>"critical"===e.toLowerCase()?"destructive":"default",t=e=>{switch(e.toLowerCase()){case"critical":return"bg-red-100 text-red-800 border-red-200";case"warning":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"info":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},l={critical:e.filter(e=>"critical"===e.severity),warning:e.filter(e=>"warning"===e.severity),info:e.filter(e=>"info"===e.severity)};return(0,r.jsxs)("div",{className:"space-y-4",children:[e.length>1&&(0,r.jsx)(i.Card,{children:(0,r.jsx)(i.CardContent,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:"Alert Summary"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[l.critical.length>0&&(0,r.jsxs)(i.Badge,{variant:"destructive",className:"flex items-center gap-1",children:[(0,r.jsx)(f.Z,{className:"h-3 w-3"}),l.critical.length," Critical"]}),l.warning.length>0&&(0,r.jsxs)(i.Badge,{variant:"outline",className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[(0,r.jsx)(N.Z,{className:"h-3 w-3 mr-1"}),l.warning.length," Warning"]}),l.info.length>0&&(0,r.jsxs)(i.Badge,{variant:"outline",className:"bg-blue-100 text-blue-800 border-blue-200",children:[(0,r.jsx)(C.Z,{className:"h-3 w-3 mr-1"}),l.info.length," Info"]})]})]})})}),(0,r.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,r.jsx)(i.Alert,{variant:a(e.severity),className:"border-l-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[s(e.severity),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsxs)(i.AlertTitle,{className:"flex items-center gap-2",children:[e.title,(0,r.jsx)(i.Badge,{variant:"outline",className:t(e.severity),children:e.severity.toUpperCase()}),e.type&&(0,r.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:e.type.replace(/_/g," ").toUpperCase()})]}),(0,r.jsxs)(i.AlertDescription,{className:"space-y-2",children:[(0,r.jsx)("p",{children:e.message}),void 0!==e.count&&(0,r.jsxs)("p",{className:"text-sm font-semibold",children:["Occurrence count: ",e.count]}),e.timestamp&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(e.timestamp).toLocaleString()})]})]})]})},e.id))})]})}var y=a(48324);function w(){let{hasPermission:e}=(0,l.ss)(),{features:s}=(0,d.M)(),[a,x]=(0,t.useState)(""),u=n.LM.features.enableRadius&&e("isp.radius.read"),[m,h]=(0,t.useState)(null),[p,j]=(0,t.useState)(!1),{toast:b}=(0,i.useToast)(),v=s.enableAutomation&&e("isp.automation.read"),f=a.trim(),{subscribers:N,sessions:C,metrics:w,loading:P,error:S,refetch:T}=(0,o.Q)({limit:50,...f?{search:f}:{},enabled:u,lifecycleMetricsEnabled:v}),D=N.filter(e=>e.username.toLowerCase().includes(a.trim().toLowerCase())),A=N.find(e=>e.id===m)??null,L=A?(0,o.NM)(N,A.username):[],{data:q,refetch:k}=(0,y.a)({queryKey:["networkProfile",A?.subscriberId],queryFn:async()=>{if(!A?.subscriberId)return null;let e=await fetch(`/api/v1/network/subscribers/${A.subscriberId}/profile`);if(404===e.status)return null;if(!e.ok)throw Error("Failed to fetch network profile");return e.json()},enabled:!!A?.subscriberId&&p}),{data:V}=(0,y.a)({queryKey:["subscriberAlerts",A?.subscriberId],queryFn:async()=>{if(!A?.subscriberId)return[];let e=await fetch(`/api/v1/radius/subscribers/${A.subscriberId}/alerts`,{credentials:"include"});return e.ok?e.json():[]},enabled:!!A?.subscriberId&&p});return u?S?(c.k.error("Failed to load subscriber dashboard via GraphQL",Error(S)),(0,r.jsx)("main",{className:"max-w-6xl mx-auto px-6 py-12 space-y-8",children:(0,r.jsxs)(i.Card,{children:[(0,r.jsxs)(i.CardHeader,{children:[(0,r.jsx)(i.CardTitle,{children:"Error Loading Subscribers"}),(0,r.jsx)(i.CardDescription,{children:"Failed to load subscriber data from GraphQL API"})]}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsx)("p",{className:"text-sm text-destructive mb-4",children:S}),(0,r.jsx)(i.Button,{onClick:()=>T(),children:"Retry"})]})]})})):(0,r.jsxs)("main",{className:"max-w-6xl mx-auto px-6 py-12 space-y-8",children:[(0,r.jsxs)("header",{className:"space-y-1",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Subscriber directory"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage broadband subscriber credentials, service assignments, and active RADIUS sessions."})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{className:"pb-2",children:(0,r.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Tracked subscribers"})}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsx)("div",{className:"text-3xl font-semibold text-foreground",children:P?"...":w.totalSubscribers}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"In FreeRADIUS for this tenant"})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{className:"pb-2",children:(0,r.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Active sessions"})}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsx)("div",{className:"text-3xl font-semibold text-foreground",children:P?"...":w.activeSessions}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"PPP sessions currently authenticated"})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsx)(i.CardHeader,{className:"pb-2",children:(0,r.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Active services"})}),(0,r.jsxs)(i.CardContent,{children:[(0,r.jsx)("div",{className:"text-3xl font-semibold text-foreground",children:P?"...":w.activeServices}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Service instances in ACTIVE status"})]})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsxs)(i.CardHeader,{children:[(0,r.jsx)(i.CardTitle,{children:"RADIUS subscribers"}),(0,r.jsx)(i.CardDescription,{children:"Search and review subscriber credentials and profile settings."})]}),(0,r.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,r.jsx)(i.Input,{value:a,onChange:e=>x(e.target.value),placeholder:"Search by username",className:"max-w-sm"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHeader,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableHead,{children:"Username"}),(0,r.jsx)(i.TableHead,{children:"Status"}),(0,r.jsx)(i.TableHead,{children:"Framed IP"}),(0,r.jsx)(i.TableHead,{children:"Bandwidth Profile"}),(0,r.jsx)(i.TableHead,{children:"Active Sessions"}),(0,r.jsx)(i.TableHead,{children:"Created"})]})}),(0,r.jsxs)(i.TableBody,{children:[P&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:6,className:"text-center text-muted-foreground",children:"Loading subscribers…"})}),!P&&0===D.length&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:6,className:"text-center text-muted-foreground",children:"No subscribers match your search."})}),D.map(e=>(0,r.jsxs)(i.TableRow,{className:"cursor-pointer hover:bg-accent/30",onClick:()=>{h(e.id),j(!0)},children:[(0,r.jsx)(i.TableCell,{className:"font-medium text-foreground",children:e.username}),(0,r.jsx)(i.TableCell,{children:(0,r.jsx)(i.Badge,{variant:e.enabled?"outline":"secondary",children:e.enabled?"Enabled":"Disabled"})}),(0,r.jsx)(i.TableCell,{children:e.framedIpAddress??"—"}),(0,r.jsx)(i.TableCell,{children:e.bandwidthProfileId??"—"}),(0,r.jsx)(i.TableCell,{children:(0,r.jsx)(i.Badge,{variant:"secondary",children:e.sessions.length})}),(0,r.jsx)(i.TableCell,{className:"text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleString()})]},e.id))]})]})})]})]}),(0,r.jsxs)(i.Card,{children:[(0,r.jsxs)(i.CardHeader,{children:[(0,r.jsx)(i.CardTitle,{children:"Active RADIUS sessions"}),(0,r.jsx)(i.CardDescription,{children:"Latest PPP sessions authenticated via FreeRADIUS."})]}),(0,r.jsx)(i.CardContent,{className:"overflow-x-auto",children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHeader,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableHead,{children:"Username"}),(0,r.jsx)(i.TableHead,{children:"NAS IP"}),(0,r.jsx)(i.TableHead,{children:"Session ID"}),(0,r.jsx)(i.TableHead,{children:"Duration (s)"}),(0,r.jsx)(i.TableHead,{children:"Data transfer (MB)"})]})}),(0,r.jsxs)(i.TableBody,{children:[C.slice(0,20).map(e=>(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{className:"font-medium text-foreground",children:e.username}),(0,r.jsx)(i.TableCell,{children:e.nasipaddress}),(0,r.jsx)(i.TableCell,{className:"font-mono text-xs",children:e.acctsessionid}),(0,r.jsx)(i.TableCell,{children:e.acctsessiontime??0}),(0,r.jsxs)(i.TableCell,{children:[((e.acctinputoctets??0)/1048576).toFixed(2),"/",((e.acctoutputoctets??0)/1048576).toFixed(2)]})]},e.radacctid)),0===C.length&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:5,className:"text-center text-muted-foreground",children:"No active sessions at the moment."})})]})]})})]}),(0,r.jsx)(i.Dialog,{open:p,onOpenChange:j,children:(0,r.jsxs)(i.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(i.DialogHeader,{children:[(0,r.jsx)(i.DialogTitle,{children:"Subscriber details"}),(0,r.jsxs)(i.DialogDescription,{children:["Detailed information for ",(0,r.jsx)("code",{children:A?.username??"—"})]})]}),A?(0,r.jsxs)("div",{className:"space-y-6",children:[V&&V.length>0&&(0,r.jsx)(I,{alerts:V}),(0,r.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold",children:"Basic Information"}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Subscriber ID"}),(0,r.jsx)("span",{className:"font-medium text-foreground",children:A.subscriberId})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Status"}),(0,r.jsx)(i.Badge,{variant:A.enabled?"outline":"secondary",children:A.enabled?"Enabled":"Disabled"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Bandwidth profile"}),(0,r.jsx)("span",{className:"font-medium text-foreground",children:A.bandwidthProfileId??"—"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Framed IP address"}),(0,r.jsx)("span",{className:"font-medium text-foreground",children:A.framedIpAddress??"—"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Created"}),(0,r.jsx)("span",{children:new Date(A.createdAt).toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Updated"}),(0,r.jsx)("span",{children:new Date(A.updatedAt).toLocaleString()})]})]})]}),(0,r.jsx)(g,{profile:q??null,subscriberId:A.subscriberId,onUpdate:()=>{k()}}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:["Active sessions (",L.length,")"]}),L.length?(0,r.jsx)("div",{className:"max-h-48 overflow-y-auto rounded border border-border/60",children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHeader,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableHead,{className:"text-xs",children:"NAS"}),(0,r.jsx)(i.TableHead,{className:"text-xs",children:"Session ID"}),(0,r.jsx)(i.TableHead,{className:"text-xs",children:"Start"}),(0,r.jsx)(i.TableHead,{className:"text-xs",children:"Duration (s)"})]})}),(0,r.jsx)(i.TableBody,{children:L.map(e=>(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{className:"text-xs",children:e.nasipaddress}),(0,r.jsx)(i.TableCell,{className:"text-xs font-mono",children:e.acctsessionid}),(0,r.jsx)(i.TableCell,{className:"text-xs",children:e.acctstarttime?new Date(e.acctstarttime).toLocaleString():"—"}),(0,r.jsx)(i.TableCell,{className:"text-xs",children:e.acctsessiontime??0})]},e.radacctid))})]})}):(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"No active sessions for this subscriber."})]})]}):(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a subscriber to view details."}),(0,r.jsx)(i.DialogFooter,{children:(0,r.jsx)(i.Button,{variant:"outline",onClick:()=>j(!1),children:"Close"})})]})})]}):(0,r.jsx)("main",{className:"max-w-6xl mx-auto px-6 py-12 space-y-8",children:(0,r.jsxs)(i.Card,{children:[(0,r.jsxs)(i.CardHeader,{children:[(0,r.jsx)(i.CardTitle,{children:"Subscribers"}),(0,r.jsxs)(i.CardDescription,{children:["Access to RADIUS subscriber records requires the ",(0,r.jsx)("code",{children:"isp.radius.read"})," ","permission."]})]}),(0,r.jsx)(i.CardContent,{children:(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Contact a platform administrator to grant ISP operator privileges, or enable the feature flag ",(0,r.jsx)("code",{children:"NEXT_PUBLIC_ENABLE_RADIUS"}),"."]})})]})})}function P(){return(0,r.jsx)(x.e,{children:(0,r.jsx)(w,{})})}},21720:()=>{"use strict";!function(){var e=Error("Cannot find module '../../../shared/hooks/useServiceLifecycle'");throw e.code="MODULE_NOT_FOUND",e}()},58291:(e,s,a)=>{"use strict";a.d(s,{NM:()=>n,Q:()=>l});var r=a(17577),t=a(19228);a(29771);var i=a(21720);function l(e={}){let{limit:s=50,search:a,enabled:l=!0,pollingIntervalMs:n=3e4,pollingEnabled:d=!0,lifecycleMetricsEnabled:c=!1}=e,{data:o,loading:x,error:u,refetch:m}=(0,t.j_N)({variables:{limit:s,search:a||void 0},skip:!l}),{data:h,error:p}=(0,i.y)({enabled:c});(0,r.useRef)(m);let j=o?.subscribers??[],b=o?.subscriberMetrics,v=j.filter(e=>e.sessions.length>0).length,g=h?.active_count??v,f=j.flatMap(e=>e.sessions);return{subscribers:j,subscribersCount:j.length,sessions:f,sessionsCount:f.length,metrics:{totalSubscribers:b?.totalCount??0,enabledSubscribers:b?.enabledCount??0,disabledSubscribers:b?.disabledCount??0,activeSessions:b?.activeSessionsCount??0,activeServices:g,totalDataUsageMb:b?.totalDataUsageMb??0},loading:x,error:u?.message,refetch:m}}function n(e,s){let a=e.find(e=>e.username===s);return a?.sessions??[]}},87223:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>r});let r=(0,a(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/subscribers/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),r=s.X(0,[2793,1009,6226,657,6011,6032,4218,9228],()=>a(23629));module.exports=r})();