(()=>{var e={};e.id=1354,e.ids=[1354],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},24995:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>o,routeModule:()=>p,tree:()=>d}),t(60807),t(13321),t(46366),t(96560);var a=t(23191),r=t(88716),i=t(37922),n=t.n(i),l=t(95231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);t.d(s,c);let d=["",{children:["dashboard",{children:["settings",{children:["security",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,60807)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/settings/security/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/settings/security/page.tsx"],u="/dashboard/settings/security/page",h={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/settings/security/page",pathname:"/dashboard/settings/security",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},96162:(e,s,t)=>{Promise.resolve().then(t.bind(t,72110))},72110:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>_});var a=t(10326),r=t(17577),i=t(48723),n=t(77506),l=t(58038),c=t(41291),d=t(9015),o=t(83495),u=t(66307),h=t(76828),p=t(98091),x=t(91216),m=t(12714),j=t(31215),g=t(43810),w=t(31540),f=t(59341),v=t(20892),b=t(29771),y=t(46226);let N=e=>e instanceof Error?e:Error("string"==typeof e?e:String(e));function C(){let{toast:e}=(0,i.useToast)(),[s,t]=(0,r.useState)(null),[v,C]=(0,r.useState)([]),[_,T]=(0,r.useState)([]),[k,D]=(0,r.useState)(!0),[P,S]=(0,r.useState)(!1),[A,E]=(0,r.useState)(""),[F,Z]=(0,r.useState)(""),[q,B]=(0,r.useState)(""),[L,H]=(0,r.useState)(!1),[U,I]=(0,r.useState)(!1),[R,V]=(0,r.useState)(!1),[M,O]=(0,r.useState)(!1),[z,G]=(0,r.useState)(""),[Q,$]=(0,r.useState)(""),[X,Y]=(0,r.useState)(!1),[J,K]=(0,r.useState)(!1),W=(0,r.useCallback)(async()=>{try{D(!0);let e=await f.x1.get("/auth/security/settings").catch(()=>({data:{mfa_enabled:!1,password_last_changed:new Date().toISOString(),active_sessions:1,backup_codes_remaining:0}}));t(e.data);let s=await f.x1.get("/auth/sessions").catch(()=>({data:[]}));C(s.data)}catch(s){b.k.error("Failed to load security settings",N(s)),e({title:"Error",description:"Failed to load security settings",variant:"destructive"})}finally{D(!1)}},[e]),ee=async()=>{if(!F||!A){e({title:"Validation Error",description:"Please fill in all password fields",variant:"destructive"});return}if(F!==q){e({title:"Validation Error",description:"New passwords do not match",variant:"destructive"});return}if(F.length<8){e({title:"Validation Error",description:"Password must be at least 8 characters long",variant:"destructive"});return}try{V(!0),await f.x1.post("/auth/change-password",{current_password:A,new_password:F}),e({title:"Success",description:"Password changed successfully"}),S(!1),E(""),Z(""),B(""),await W()}catch(s){e({title:"Error",description:s.response?.data?.detail||"Failed to change password",variant:"destructive"})}finally{V(!1)}},es=async()=>{try{Y(!0);let e=await f.x1.post("/auth/2fa/enable");G(e.data.qr_code),T(e.data.backup_codes||[]),O(!0)}catch(s){e({title:"Error",description:s.response?.data?.detail||"Failed to enable 2FA",variant:"destructive"})}finally{Y(!1)}},et=async()=>{if(!Q||6!==Q.length){e({title:"Validation Error",description:"Please enter a valid 6-digit code",variant:"destructive"});return}try{await f.x1.post("/auth/2fa/verify",{code:Q}),e({title:"Success",description:"Two-factor authentication enabled successfully"}),O(!1),$(""),K(!0),await W()}catch(s){e({title:"Error",description:s.response?.data?.detail||"Invalid verification code",variant:"destructive"})}},ea=async()=>{try{await f.x1.post("/auth/2fa/disable"),e({title:"Success",description:"Two-factor authentication disabled"}),await W()}catch(s){e({title:"Error",description:s.response?.data?.detail||"Failed to disable 2FA",variant:"destructive"})}},er=async s=>{try{await f.x1.delete(`/auth/sessions/${s}`),e({title:"Success",description:"Session revoked successfully"}),await W()}catch(s){e({title:"Error",description:s.response?.data?.detail||"Failed to revoke session",variant:"destructive"})}};return k?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)(n.Z,{className:"h-8 w-8 animate-spin text-sky-500"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-2",children:[(0,a.jsx)(l.Z,{className:"h-8 w-8 text-sky-500"}),"Security Settings"]}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Manage your password, two-factor authentication, and active sessions"})]}),!s?.mfa_enabled&&(0,a.jsx)(i.Card,{className:"border-orange-200 dark:border-orange-900 bg-orange-50 dark:bg-orange-950/20",children:(0,a.jsx)(i.CardContent,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-orange-900 dark:text-orange-200",children:"Two-Factor Authentication Disabled"}),(0,a.jsx)("p",{className:"text-sm text-orange-700 dark:text-orange-300 mt-1",children:"Enable 2FA to add an extra layer of security to your account"}),(0,a.jsxs)(i.Button,{size:"sm",className:"mt-3 bg-orange-600 hover:bg-orange-700",onClick:es,disabled:X,children:[X?(0,a.jsx)(n.Z,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"Enable 2FA Now"]})]})]})})}),(0,a.jsxs)(i.Tabs,{defaultValue:"password",className:"space-y-4",children:[(0,a.jsxs)(i.TabsList,{children:[(0,a.jsx)(i.TabsTrigger,{value:"password",children:"Password"}),(0,a.jsx)(i.TabsTrigger,{value:"2fa",children:"Two-Factor Auth"}),(0,a.jsx)(i.TabsTrigger,{value:"sessions",children:"Active Sessions"})]}),(0,a.jsx)(i.TabsContent,{value:"password",className:"space-y-4",children:(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5"}),"Password Management"]}),(0,a.jsx)(i.CardDescription,{children:"Change your account password"})]}),(0,a.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Current Password"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Last changed:"," ",s?.password_last_changed?new Date(s.password_last_changed).toLocaleDateString():"Never"]})]}),(0,a.jsxs)(i.Button,{onClick:()=>S(!0),children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Change Password"]})]}),(0,a.jsx)(i.Separator,{}),(0,a.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Password Requirements:"}),(0,a.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsx)("li",{children:"• At least 8 characters long"}),(0,a.jsx)("li",{children:"• Include uppercase and lowercase letters"}),(0,a.jsx)("li",{children:"• Include at least one number"}),(0,a.jsx)("li",{children:"• Include at least one special character"})]})]})]})]})}),(0,a.jsx)(i.TabsContent,{value:"2fa",className:"space-y-4",children:(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5"}),"Two-Factor Authentication"]}),(0,a.jsx)(i.CardDescription,{children:"Add an extra layer of security using authenticator apps"})]}),(0,a.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:`h-12 w-12 rounded-full flex items-center justify-center ${s?.mfa_enabled?"bg-green-500/10":"bg-muted"}`,children:s?.mfa_enabled?(0,a.jsx)(u.Z,{className:"h-6 w-6 text-green-500"}):(0,a.jsx)(c.Z,{className:"h-6 w-6 text-muted-foreground"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["2FA Status: ",s?.mfa_enabled?"Enabled":"Disabled"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:s?.mfa_enabled?"Your account is protected with 2FA":"Enable 2FA for enhanced security"})]})]}),s?.mfa_enabled?(0,a.jsx)(i.Button,{variant:"destructive",onClick:ea,children:"Disable 2FA"}):(0,a.jsxs)(i.Button,{onClick:es,disabled:X,children:[X?(0,a.jsx)(n.Z,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(l.Z,{className:"h-4 w-4 mr-2"}),"Enable 2FA"]})]}),s?.mfa_enabled&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Separator,{}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Backup Codes"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[s.backup_codes_remaining," codes remaining"]})]}),(0,a.jsxs)(i.Button,{variant:"outline",onClick:()=>K(!0),children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"View Backup Codes"]})]})]}),(0,a.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Supported Authenticator Apps:"}),(0,a.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1",children:[(0,a.jsx)("li",{children:"• Google Authenticator"}),(0,a.jsx)("li",{children:"• Microsoft Authenticator"}),(0,a.jsx)("li",{children:"• Authy"}),(0,a.jsx)("li",{children:"• 1Password"})]})]})]})]})}),(0,a.jsx)(i.TabsContent,{value:"sessions",className:"space-y-4",children:(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5"}),"Active Sessions"]}),(0,a.jsx)(i.CardDescription,{children:"Manage devices and browsers where you're currently logged in"})]}),(0,a.jsx)(i.CardContent,{children:0===v.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(o.Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No active sessions"})]}):(0,a.jsxs)(i.Table,{children:[(0,a.jsx)(i.TableHeader,{children:(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableHead,{children:"Device"}),(0,a.jsx)(i.TableHead,{children:"Location"}),(0,a.jsx)(i.TableHead,{children:"IP Address"}),(0,a.jsx)(i.TableHead,{children:"Last Active"}),(0,a.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(i.TableBody,{children:v.map(e=>(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableCell,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.device,e.is_current&&(0,a.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:"Current"})]})}),(0,a.jsx)(i.TableCell,{children:e.location}),(0,a.jsx)(i.TableCell,{className:"font-mono text-sm",children:e.ip_address}),(0,a.jsx)(i.TableCell,{className:"text-sm text-muted-foreground",children:new Date(e.last_active).toLocaleString()}),(0,a.jsx)(i.TableCell,{className:"text-right",children:!e.is_current&&(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>er(e.id),children:(0,a.jsx)(p.Z,{className:"h-4 w-4 text-red-500"})})})]},e.id))})]})})]})})]}),(0,a.jsx)(i.Dialog,{open:P,onOpenChange:S,children:(0,a.jsxs)(i.DialogContent,{children:[(0,a.jsxs)(i.DialogHeader,{children:[(0,a.jsx)(i.DialogTitle,{children:"Change Password"}),(0,a.jsx)(i.DialogDescription,{children:"Enter your current password and choose a new secure password"})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"current-password",children:"Current Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(i.Input,{id:"current-password",type:L?"text":"password",value:A,onChange:e=>E(e.target.value),placeholder:"Enter current password"}),(0,a.jsx)(i.Button,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>H(!L),children:L?(0,a.jsx)(x.Z,{className:"h-4 w-4"}):(0,a.jsx)(m.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"new-password",children:"New Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(i.Input,{id:"new-password",type:U?"text":"password",value:F,onChange:e=>Z(e.target.value),placeholder:"Enter new password"}),(0,a.jsx)(i.Button,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>I(!U),children:U?(0,a.jsx)(x.Z,{className:"h-4 w-4"}):(0,a.jsx)(m.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"confirm-password",children:"Confirm New Password"}),(0,a.jsx)(i.Input,{id:"confirm-password",type:"password",value:q,onChange:e=>B(e.target.value),placeholder:"Confirm new password"})]})]}),(0,a.jsxs)(i.DialogFooter,{children:[(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),(0,a.jsxs)(i.Button,{onClick:ee,disabled:R,children:[R?(0,a.jsx)(n.Z,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Change Password"]})]})]})}),(0,a.jsx)(i.Dialog,{open:M,onOpenChange:O,children:(0,a.jsxs)(i.DialogContent,{children:[(0,a.jsxs)(i.DialogHeader,{children:[(0,a.jsx)(i.DialogTitle,{children:"Enable Two-Factor Authentication"}),(0,a.jsx)(i.DialogDescription,{children:"Scan the QR code with your authenticator app and enter the verification code"})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[z&&(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(y.default,{src:z,alt:"QR Code",width:192,height:192,className:"w-48 h-48",unoptimized:!0})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{htmlFor:"verification-code",children:"Verification Code"}),(0,a.jsx)(i.Input,{id:"verification-code",type:"text",maxLength:6,value:Q,onChange:e=>$(e.target.value.replace(/\D/g,"")),placeholder:"Enter 6-digit code",className:"text-center text-2xl tracking-widest"})]})]}),(0,a.jsxs)(i.DialogFooter,{children:[(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>O(!1),children:"Cancel"}),(0,a.jsxs)(i.Button,{onClick:et,children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Verify and Enable"]})]})]})}),(0,a.jsx)(i.Dialog,{open:J,onOpenChange:K,children:(0,a.jsxs)(i.DialogContent,{children:[(0,a.jsxs)(i.DialogHeader,{children:[(0,a.jsx)(i.DialogTitle,{children:"Backup Codes"}),(0,a.jsx)(i.DialogDescription,{children:"Save these codes in a secure location. Each code can only be used once."})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsx)("div",{className:"bg-muted rounded-lg p-4 font-mono text-sm space-y-2",children:_.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:e.used?"line-through text-muted-foreground":"",children:e.code}),e.used&&(0,a.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:"Used"})]},s))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.Button,{variant:"outline",onClick:()=>{let s=_.map(e=>e.code).join("\n");navigator.clipboard.writeText(s),e({title:"Copied",description:"Backup codes copied to clipboard"})},className:"flex-1",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"Copy"]}),(0,a.jsxs)(i.Button,{variant:"outline",onClick:()=>{let e=new Blob([_.map(e=>e.code).join("\n")],{type:"text/plain"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="backup-codes.txt",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s)},className:"flex-1",children:[(0,a.jsx)(w.Z,{className:"h-4 w-4 mr-2"}),"Download"]})]})]}),(0,a.jsx)(i.DialogFooter,{children:(0,a.jsx)(i.Button,{onClick:()=>K(!1),children:"Close"})})]})})]})}function _(){return(0,a.jsx)(v.eu,{permission:"settings.security.read",children:(0,a.jsx)(C,{})})}},60807:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/settings/security/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(24995));module.exports=a})();