(()=>{var e={};e.id=3459,e.ids=[3459],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},71577:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>l}),s(7151),s(13321),s(46366),s(96560);var r=s(23191),a=s(88716),i=s(37922),n=s.n(i),d=s(95231),o={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>d[e]);s.d(t,o);let l=["",{children:["dashboard",{children:["infrastructure",{children:["status",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7151)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/infrastructure/status/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/infrastructure/status/page.tsx"],u="/dashboard/infrastructure/status/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/infrastructure/status/page",pathname:"/dashboard/infrastructure/status",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},13873:(e,t,s)=>{Promise.resolve().then(s.bind(s,97222))},97222:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(10326),a=s(17577),i=s(30361),n=s(50949),d=s(15601),o=s(66697),l=s(21405),c=s(48723),u=s(20892),p=s(17972),m=s(65037),h=s(41007),x=s(46502),g=s(93158);function f(e){switch(e){case"healthy":return"bg-emerald-500/10 text-emerald-400 border-emerald-500/20";case"degraded":return"bg-yellow-500/10 text-yellow-400 border-yellow-500/20";case"unhealthy":return"bg-red-500/10 text-red-400 border-red-500/20";default:return"bg-muted text-muted-foreground border-border/60"}}function y(){let{hasPermission:e}=(0,x.ss)(),{health:t,loading:s,error:y,refreshHealth:j}=(0,p.QB)(),{data:b,isLoading:v,refetch:N}=(0,m.l_)(),{features:w}=(0,g.M)(),q=w.enableNetwork&&e("isp.ipam.read"),{data:C,isLoading:k,refetch:P}=(0,h.Z)({enabled:q}),_=(0,a.useMemo)(()=>{if(t?.status){let e=t.status.toLowerCase();if("healthy"===e||"degraded"===e||"unhealthy"===e)return e}return b?.status?b.status:"unknown"},[t?.status,b?.status]),S=(0,a.useMemo)(()=>{let e=[t?.timestamp?new Date(t.timestamp):null,b?.timestamp?new Date(b.timestamp):null].filter(Boolean);return 0===e.length?null:(e.sort((e,t)=>t.getTime()-e.getTime()),e[0])},[t?.timestamp,b?.timestamp]),D=(0,a.useMemo)(()=>{let e=[];return t?.services?.length&&e.push(...t.services.map((e,t)=>{let s="healthy"===e.status||"degraded"===e.status||"unhealthy"===e.status?e.status:"unknown";return{id:`core-${e.name}-${t}`,name:e.name,status:s,message:e.message,required:e.required,source:"core"}})),b?.checks&&e.push(...Object.entries(b.checks).map(([e,t])=>({id:`system-${e}`,name:t?.name??e,status:t?.status??"unknown",message:t?.message,required:t?.required,source:"system"}))),q&&e.push({id:"network-netbox",name:"NetBox",status:C?C.healthy?"healthy":"unhealthy":"unknown",message:C?.message??"NetBox connectivity for this tenant",required:!1,source:"network"}),e},[t?.services,C,q,b?.checks]),E=s||v||q&&k,T=async()=>{j(),N(),q&&P()};return(0,r.jsx)(u.eu,{permission:"infrastructure.read",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Infrastructure Status"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Live view of platform and Docker-backed service health."}),S&&(0,r.jsxs)("p",{className:"mt-2 text-xs text-muted-foreground",children:["Last updated ",S.toLocaleString()]})]}),(0,r.jsxs)(c.Button,{onClick:T,variant:"outline",size:"sm",disabled:E,children:[(0,r.jsx)(l.Z,{className:`mr-2 h-4 w-4 ${E?"animate-spin":"hidden"}`}),E?"Refreshingâ€¦":"Refresh"]})]}),y&&(0,r.jsx)("div",{className:"rounded-lg border border-border bg-destructive/10 px-4 py-3 text-sm text-destructive",children:y}),(0,r.jsxs)(c.Card,{children:[(0,r.jsxs)(c.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c.CardTitle,{className:"text-lg",children:"Overall Status"}),(0,r.jsx)(c.CardDescription,{children:"Aggregated health across core infrastructure services."})]}),(0,r.jsx)(c.Badge,{className:`border ${f(_)}`,variant:"outline",children:_.toUpperCase()})]}),(0,r.jsx)(c.CardContent,{children:0===D.length?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No service information available. Try refreshing or verify your permissions."}):(0,r.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3",children:D.map(e=>{let t=function(e){switch(e){case"healthy":return i.Z;case"degraded":return n.Z;case"unhealthy":return d.Z;default:return o.Z}}(e.status);return(0,r.jsxs)("div",{className:"rounded-lg border border-border bg-card/60 p-4 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:`rounded-md border px-2 py-1 text-xs font-medium ${f(e.status)}`,children:(0,r.jsx)(t,{className:"h-3.5 w-3.5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground capitalize",children:e.source})]})]}),(0,r.jsx)(c.Badge,{className:`border ${f(e.status)}`,variant:"outline",children:e.status.toUpperCase()})]}),e.message&&(0,r.jsx)("p",{className:"mt-3 text-xs text-muted-foreground leading-relaxed",children:e.message}),!1===e.required&&(0,r.jsx)("p",{className:"mt-2 text-[10px] uppercase tracking-wide text-muted-foreground",children:"optional service"})]},e.id)})})})]}),(0,r.jsxs)("div",{className:"grid gap-4 lg:grid-cols-[2fr_1fr]",children:[(0,r.jsxs)(c.Card,{children:[(0,r.jsxs)(c.CardHeader,{children:[(0,r.jsx)(c.CardTitle,{className:"text-lg",children:"Core Service Detail"}),(0,r.jsx)(c.CardDescription,{children:"Status reported by the backend `/ready` and `/health` endpoints."})]}),(0,r.jsx)(c.CardContent,{children:0===D.length?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Service data unavailable. Ensure the platform backend is reachable."}):(0,r.jsx)("div",{className:"space-y-3",children:D.map(e=>(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-md border border-border/80 bg-card/70 p-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.name}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Source: ",e.source]}),e.message&&(0,r.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:e.message})]}),(0,r.jsx)(c.Badge,{className:`border ${f(e.status)}`,variant:"outline",children:e.status.toUpperCase()})]},`detail-${e.id}`))})})]}),(0,r.jsxs)(c.Card,{children:[(0,r.jsxs)(c.CardHeader,{children:[(0,r.jsx)(c.CardTitle,{className:"text-lg",children:"Troubleshooting"}),(0,r.jsx)(c.CardDescription,{children:"Quick steps if a service is down or degraded."})]}),(0,r.jsxs)(c.CardContent,{className:"space-y-3 text-sm text-muted-foreground",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:"1. Check Docker containers"}),(0,r.jsxs)("p",{className:"text-xs",children:["Run ",(0,r.jsx)("code",{className:"rounded bg-muted px-1 py-0.5 text-xs",children:"docker ps"})," to confirm containers are running and healthy."]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:"2. Inspect logs"}),(0,r.jsxs)("p",{className:"text-xs",children:["Use"," ",(0,r.jsx)("code",{className:"rounded bg-muted px-1 py-0.5 text-xs",children:"docker logs <container>"})," ","or the built-in infrastructure logs dashboard."]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:"3. Verify tenant OSS config"}),(0,r.jsxs)("p",{className:"text-xs",children:["Ensure each tenant has the required OSS entries (e.g., NetBox credentials) in"," ",(0,r.jsx)("code",{children:"tenant_settings"}),"."]})]})]})]})]})]})})}},17972:(e,t,s)=>{"use strict";s.d(t,{QB:()=>o});var r=s(48324),a=s(94464),i=s(59341),n=s(29771);let d={all:["health"],status:()=>[...d.all,"status"]},o=()=>{let e=(0,r.a)({queryKey:d.status(),queryFn:async()=>{try{let e=await i.x1.get("/ready");return function(e){let t=e.data;return t?.success&&t.data?t.data:t?.error?.message?{status:"degraded",healthy:!1,services:[],failed_services:[],timestamp:new Date().toISOString(),apiErrorMessage:t.error.message}:t?.services?t:{status:"unknown",healthy:!1,services:[],failed_services:[],timestamp:new Date().toISOString()}}(e)}catch(t){let e=a.default.isAxiosError(t)?t.response?.status:void 0;return n.k.error("Failed to fetch health data",t instanceof Error?t:Error(String(t))),{status:403===e?"forbidden":"degraded",healthy:!1,services:[],failed_services:[],timestamp:new Date().toISOString()}}},staleTime:1e4,refetchInterval:3e4,refetchOnWindowFocus:!0,retry:2}),t=e.data?.apiErrorMessage||(e.data?.status==="forbidden"?"You do not have permission to view service health.":e.data?.status==="degraded"?"Service health is temporarily unavailable.":null);return{...e,loading:e.isLoading,health:e.data??null,error:t,refreshHealth:e.refetch}}},41007:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n,u:()=>d});var r=s(48324),a=s(59341),i=s(16704);function n({enabled:e=!0,queryOptions:t}={}){return(0,r.a)({queryKey:["netbox","health"],queryFn:async()=>{let e=await a.x1.get("/netbox/health",{timeout:8e3});return(0,i.uN)(e)},enabled:e,staleTime:6e4,retry:1,...t})}function d({limit:e=20,offset:t=0,enabled:s=!0,queryOptions:n}={}){return(0,r.a)({queryKey:["netbox","sites",{limit:e,offset:t}],queryFn:async()=>{let s=await a.x1.get("/netbox/dcim/sites",{params:{limit:e,offset:t},timeout:8e3});return(0,i.uN)(s)},enabled:s,staleTime:6e4,retry:1,...n})}},65037:(e,t,s)=>{"use strict";s.d(t,{l_:()=>n});var r=s(48324),a=s(59341),i=s(16704);function n(e){return(0,r.a)({queryKey:["system","health"],queryFn:async()=>{let e=await a.x1.get("/health");return(0,i.uN)(e,"Failed to load system health")},refetchInterval:15e3,...e})}},7151:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/infrastructure/status/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[2793,1009,6226,657,6032,4218],()=>s(71577));module.exports=r})();