(()=>{var e={};e.id=9681,e.ids=[9681],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},10073:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>p,pages:()=>o,routeModule:()=>h,tree:()=>c}),r(95143),r(13321),r(46366),r(96560);var a=r(23191),t=r(88716),l=r(37922),i=r.n(l),d=r(95231),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);r.d(s,n);let c=["",{children:["dashboard",{children:["infrastructure",{children:["imports",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,95143)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/infrastructure/imports/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/infrastructure/imports/page.tsx"],p="/dashboard/infrastructure/imports/page",x={require:r,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/dashboard/infrastructure/imports/page",pathname:"/dashboard/infrastructure/imports",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},66642:(e,s,r)=>{Promise.resolve().then(r.bind(r,80514))},80514:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>m});var a=r(10326),t=r(17577),l=r(48723),i=r(48998),d=r(21405),n=r(30361),c=r(69669),o=r(41291),p=r(63685),x=r(12714),h=r(31540),u=r(34041);function m(){let{toast:e}=(0,l.useToast)(),[s,r]=(0,t.useState)([]),[m,j]=(0,t.useState)(!1),[g,b]=(0,t.useState)(null),[v,f]=(0,t.useState)([]),[y,C]=(0,t.useState)(!1),[_,N]=(0,t.useState)(null),[T,w]=(0,t.useState)({entity_type:"customers",batch_size:100,dry_run:!1,use_async:!1}),[P,k]=(0,t.useState)("all"),[S,D]=(0,t.useState)("all"),H=(0,t.useCallback)(async()=>{try{let e=new URLSearchParams;"all"!==P&&e.append("status",P),"all"!==S&&e.append("job_type",S),e.append("limit","50");let s=await fetch(`/api/v1/import/jobs?${e}`);if(s.ok){let e=await s.json();r(e.jobs)}}catch(e){console.error("Failed to fetch import jobs:",e)}},[P,S]),q=async e=>{try{let s=await fetch(`/api/v1/import/jobs/${e}/failures`);if(s.ok){let e=await s.json();f(e)}}catch(e){console.error("Failed to fetch failures:",e)}},F=async()=>{if(!_){e({title:"Error",description:"Please select a file to upload",variant:"destructive"});return}let s=new FormData;s.append("file",_),s.append("batch_size",String(T.batch_size)),s.append("dry_run",String(T.dry_run)),s.append("use_async",String(T.use_async));try{j(!0);let r=await fetch(`/api/v1/import/upload/${T.entity_type}`,{method:"POST",body:s});if(r.ok)e({title:"Success",description:"Import job created successfully"}),C(!1),N(null),H();else{let s=await r.json();e({title:"Error",description:s.detail||"Failed to create import job",variant:"destructive"})}}catch(s){e({title:"Error",description:"Failed to upload file",variant:"destructive"})}finally{j(!1)}},L=async(s,r)=>{try{let e=await fetch(`/api/v1/import/jobs/${s}/export-failures?format=${r}`);if(e.ok){let a=await e.blob(),t=window.URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=`import_failures_${s}.${r}`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(t)}}catch(s){e({title:"Error",description:"Failed to export failures",variant:"destructive"})}},B=e=>{let s={pending:{label:"Pending",variant:"secondary",icon:i.Z},validating:{label:"Validating",variant:"secondary",icon:d.Z},in_progress:{label:"In Progress",variant:"default",icon:d.Z},completed:{label:"Completed",variant:"success",icon:n.Z},failed:{label:"Failed",variant:"destructive",icon:c.Z},partially_completed:{label:"Partial",variant:"secondary",icon:o.Z},cancelled:{label:"Cancelled",variant:"secondary",icon:c.Z}},r=s[e]||s.pending,t=r.icon;return(0,a.jsxs)(l.Badge,{variant:r.variant,className:"flex items-center gap-1",children:[(0,a.jsx)(t,{className:"h-3 w-3"}),r.label]})},U=e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["Bytes","KB","MB","GB"][s]};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Data Imports"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage bulk data imports and migrations"})]}),(0,a.jsxs)(l.Button,{onClick:()=>C(!0),children:[(0,a.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"New Import"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{className:"pb-2",children:(0,a.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Total Jobs"})}),(0,a.jsx)(l.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:s.length})})]}),(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{className:"pb-2",children:(0,a.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"In Progress"})}),(0,a.jsx)(l.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:s.filter(e=>"in_progress"===e.status).length})})]}),(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{className:"pb-2",children:(0,a.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Completed"})}),(0,a.jsx)(l.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:s.filter(e=>"completed"===e.status).length})})]}),(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{className:"pb-2",children:(0,a.jsx)(l.CardTitle,{className:"text-sm font-medium",children:"Failed"})}),(0,a.jsx)(l.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:s.filter(e=>"failed"===e.status).length})})]})]}),(0,a.jsxs)(l.Card,{children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsx)(l.CardTitle,{children:"Import Jobs"}),(0,a.jsxs)("div",{className:"flex gap-4 mt-4",children:[(0,a.jsxs)("select",{value:P,onChange:e=>k(e.target.value),className:"h-10 w-[180px] rounded-md border border-border bg-card px-3 text-sm text-foreground",children:[(0,a.jsx)("option",{value:"all",children:"All Statuses"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,a.jsx)("option",{value:"completed",children:"Completed"}),(0,a.jsx)("option",{value:"failed",children:"Failed"}),(0,a.jsx)("option",{value:"partially_completed",children:"Partial"})]}),(0,a.jsxs)("select",{value:S,onChange:e=>D(e.target.value),className:"h-10 w-[180px] rounded-md border border-border bg-card px-3 text-sm text-foreground",children:[(0,a.jsx)("option",{value:"all",children:"All Types"}),(0,a.jsx)("option",{value:"customers",children:"Customers"}),(0,a.jsx)("option",{value:"invoices",children:"Invoices"}),(0,a.jsx)("option",{value:"subscriptions",children:"Subscriptions"}),(0,a.jsx)("option",{value:"payments",children:"Payments"})]}),(0,a.jsx)(l.Button,{variant:"outline",onClick:H,children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsx)(l.CardContent,{children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHeader,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableHead,{children:"File"}),(0,a.jsx)(l.TableHead,{children:"Type"}),(0,a.jsx)(l.TableHead,{children:"Status"}),(0,a.jsx)(l.TableHead,{children:"Progress"}),(0,a.jsx)(l.TableHead,{children:"Records"}),(0,a.jsx)(l.TableHead,{children:"Success Rate"}),(0,a.jsx)(l.TableHead,{children:"Created"}),(0,a.jsx)(l.TableHead,{children:"Actions"})]})}),(0,a.jsx)(l.TableBody,{children:s.map(e=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.file_name}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[U(e.file_size)," • ",e.file_format.toUpperCase()]})]})}),(0,a.jsx)(l.TableCell,{className:"capitalize",children:e.job_type}),(0,a.jsx)(l.TableCell,{children:B(e.status)}),(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)("div",{className:"w-[100px]",children:[(0,a.jsx)(l.Progress,{value:e.progress_percentage,className:"h-2"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.processed_records,"/",e.total_records]})]})}),(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"text-green-600 dark:text-green-400",children:["✓ ",e.successful_records]}),e.failed_records>0&&(0,a.jsxs)("div",{className:"text-red-600 dark:text-red-400",children:["✗ ",e.failed_records]})]})}),(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)("div",{className:"text-sm",children:[e.success_rate.toFixed(1),"%"]})}),(0,a.jsx)(l.TableCell,{children:(0,a.jsx)("div",{className:"text-sm",children:(0,u.WU)(new Date(e.created_at),"MMM d, h:mm a")})}),(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>{b(e),q(e.id)},children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})}),e.failed_records>0&&(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>L(e.id,"csv"),children:(0,a.jsx)(h.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})})]}),(0,a.jsx)(l.Dialog,{open:y,onOpenChange:C,children:(0,a.jsxs)(l.DialogContent,{className:"sm:max-w-[525px]",children:[(0,a.jsxs)(l.DialogHeader,{children:[(0,a.jsx)(l.DialogTitle,{children:"Import Data"}),(0,a.jsx)(l.DialogDescription,{children:"Upload a CSV or JSON file to import data in bulk"})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(l.Label,{htmlFor:"entity-type",className:"text-right",children:"Type"}),(0,a.jsxs)("select",{id:"entity-type",value:T.entity_type,onChange:e=>w({...T,entity_type:e.target.value}),className:"col-span-3 h-10 rounded-md border border-border bg-card px-3 text-sm text-foreground",children:[(0,a.jsx)("option",{value:"customers",children:"Customers"}),(0,a.jsx)("option",{value:"invoices",children:"Invoices"}),(0,a.jsx)("option",{value:"subscriptions",children:"Subscriptions"}),(0,a.jsx)("option",{value:"payments",children:"Payments"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(l.Label,{htmlFor:"file",className:"text-right",children:"File"}),(0,a.jsx)(l.Input,{id:"file",type:"file",accept:".csv,.json",className:"col-span-3",onChange:e=>N(e.target.files?.[0]||null)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(l.Label,{htmlFor:"batch-size",className:"text-right",children:"Batch Size"}),(0,a.jsx)(l.Input,{id:"batch-size",type:"number",className:"col-span-3",value:T.batch_size,onChange:e=>w({...T,batch_size:parseInt(e.target.value)||100})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(l.Label,{htmlFor:"dry-run",className:"text-right",children:"Options"}),(0,a.jsxs)("div",{className:"col-span-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"dry-run",checked:T.dry_run,onChange:e=>w({...T,dry_run:e.target.checked})}),(0,a.jsx)(l.Label,{htmlFor:"dry-run",children:"Dry run (validate without saving)"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"use-async",checked:T.use_async,onChange:e=>w({...T,use_async:e.target.checked})}),(0,a.jsx)(l.Label,{htmlFor:"use-async",children:"Process in background"})]})]})]})]}),(0,a.jsxs)(l.DialogFooter,{children:[(0,a.jsx)(l.Button,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),(0,a.jsx)(l.Button,{onClick:F,disabled:m||!_,children:m?"Uploading...":"Upload"})]})]})}),g&&(0,a.jsx)(l.Dialog,{open:!!g,onOpenChange:()=>b(null),children:(0,a.jsxs)(l.DialogContent,{className:"max-w-4xl max-h-[80vh] overflow-auto",children:[(0,a.jsxs)(l.DialogHeader,{children:[(0,a.jsx)(l.DialogTitle,{children:"Import Job Details"}),(0,a.jsxs)(l.DialogDescription,{children:[g.file_name," • ",g.job_type]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(l.Card,{children:[(0,a.jsx)(l.CardHeader,{children:(0,a.jsx)(l.CardTitle,{children:"Summary"})}),(0,a.jsxs)(l.CardContent,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{children:"Status"}),(0,a.jsx)("div",{children:B(g.status)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{children:"Progress"}),(0,a.jsx)(l.Progress,{value:g.progress_percentage})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{children:"Total Records"}),(0,a.jsx)("div",{children:g.total_records})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{children:"Processed"}),(0,a.jsx)("div",{children:g.processed_records})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{children:"Successful"}),(0,a.jsx)("div",{className:"text-green-600 dark:text-green-400",children:g.successful_records})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Label,{children:"Failed"}),(0,a.jsx)("div",{className:"text-red-600 dark:text-red-400",children:g.failed_records})]})]}),g.error_message&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-red-100 dark:bg-red-950/20 text-red-600 dark:text-red-400 rounded",children:[(0,a.jsx)(l.Label,{children:"Error"}),(0,a.jsx)("div",{children:g.error_message})]})]})]}),v.length>0&&(0,a.jsxs)(l.Card,{children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsx)(l.CardTitle,{children:"Failed Records"}),(0,a.jsxs)(l.CardDescription,{children:["Showing ",v.length," failed records"]})]}),(0,a.jsx)(l.CardContent,{children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHeader,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableHead,{children:"Row"}),(0,a.jsx)(l.TableHead,{children:"Error Type"}),(0,a.jsx)(l.TableHead,{children:"Error Message"}),(0,a.jsx)(l.TableHead,{children:"Data"})]})}),(0,a.jsx)(l.TableBody,{children:v.slice(0,20).map((e,s)=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:e.row_number}),(0,a.jsx)(l.TableCell,{children:(0,a.jsx)(l.Badge,{variant:"outline",children:e.error_type})}),(0,a.jsx)(l.TableCell,{className:"max-w-xs truncate",children:e.error_message}),(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{className:"cursor-pointer text-sm text-blue-600 dark:text-blue-400",children:"View data"}),(0,a.jsx)("pre",{className:"mt-2 text-xs overflow-auto",children:JSON.stringify(e.row_data,null,2)})]})})]},s))})]})})]})]})]})})]})}},95143:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>a});let a=(0,r(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/infrastructure/imports/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>r(10073));module.exports=a})();