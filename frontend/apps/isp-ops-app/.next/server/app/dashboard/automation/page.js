(()=>{var e={};e.id=5245,e.ids=[5245],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},6171:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>r.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>o,routeModule:()=>x,tree:()=>c}),t(25426),t(13321),t(46366),t(96560);var a=t(23191),i=t(88716),n=t(37922),r=t.n(n),l=t(95231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);t.d(s,d);let c=["",{children:["dashboard",{children:["automation",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,25426)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],o=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/page.tsx"],u="/dashboard/automation/page",h={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/dashboard/automation/page",pathname:"/dashboard/automation",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},74696:(e,s,t)=>{Promise.resolve().then(t.bind(t,25841))},25841:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>y});var a=t(10326),i=t(17577),n=t(48723),r=t(21720),l=t(48324),d=t(44976),c=t(17010),o=t(59341),u=t(16704);let h=t(36607).LM.api.baseUrl;class x{constructor(){this.baseUrl=h}getAuthHeaders(){return{"Content-Type":"application/json",credentials:"include"}}async handleResponse(e){if(!e.ok)throw Error(await e.text()||`HTTP ${e.status}: ${e.statusText}`);return e.json()}async listCampaigns(e={}){let s=new URLSearchParams;void 0!==e.activeOnly&&s.append("active_only",e.activeOnly.toString()),void 0!==e.skip&&s.append("skip",e.skip.toString()),void 0!==e.limit&&s.append("limit",e.limit.toString());let t=s.toString(),a=`${this.baseUrl}/api/isp/v1/admin/billing/dunning/campaigns${t?`?${t}`:""}`,i=await fetch(a,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(i)}async getCampaign(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/campaigns/${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(s)}async createCampaign(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/campaigns`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(e)});return this.handleResponse(s)}async updateCampaign(e,s){let t=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/campaigns/${e}`,{method:"PATCH",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(s)});return this.handleResponse(t)}async deleteCampaign(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/campaigns/${e}`,{method:"DELETE",headers:this.getAuthHeaders(),credentials:"include"});if(!s.ok&&204!==s.status)throw Error(await s.text()||`HTTP ${s.status}: ${s.statusText}`)}async pauseCampaign(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/campaigns/${e}/pause`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(s)}async resumeCampaign(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/campaigns/${e}/resume`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(s)}async listExecutions(e={}){let s=new URLSearchParams;e.campaignId&&s.append("campaign_id",e.campaignId),e.status&&s.append("status",e.status),e.subscriptionId&&s.append("subscription_id",e.subscriptionId),e.customerId&&s.append("customer_id",e.customerId),void 0!==e.skip&&s.append("skip",e.skip.toString()),void 0!==e.limit&&s.append("limit",e.limit.toString());let t=s.toString(),a=`${this.baseUrl}/api/isp/v1/admin/billing/dunning/executions${t?`?${t}`:""}`,i=await fetch(a,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(i)}async getExecution(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/executions/${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(s)}async startExecution(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/executions`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify(e)});return this.handleResponse(s)}async cancelExecution(e,s){let t=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/executions/${e}/cancel`,{method:"POST",headers:this.getAuthHeaders(),credentials:"include",body:JSON.stringify({reason:s})});return this.handleResponse(t)}async getStatistics(){let e=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/stats`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(e)}async getCampaignStatistics(e){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/stats/campaigns/${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(s)}async getRecoveryChartData(e=30){let s=await fetch(`${this.baseUrl}/api/isp/v1/admin/billing/dunning/analytics/recovery?days=${e}`,{method:"GET",headers:this.getAuthHeaders(),credentials:"include"});return this.handleResponse(s)}calculateRecoveryRate(e,s){return 0===s?100:e/s*100}calculateSuccessRate(e,s){return 0===s?0:e/s*100}formatCurrency(e,s="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:s}).format(e)}}let m=new x;var p=t(47101);function g(){let e=(0,d.NL)(),[s,t]=(0,i.useState)({data:void 0,error:null,isPending:!1,isSuccess:!1}),a=(0,i.useCallback)(async({campaignId:s,data:a})=>{t(e=>({...e,isPending:!0,error:null}));try{let i=await m.updateCampaign(s,a);return t({data:i,error:null,isPending:!1,isSuccess:!0}),e.invalidateQueries({queryKey:["campaigns"]}),i}catch(s){let e=s instanceof Error?s:Error("Failed to update campaign");throw t(s=>({...s,error:e,isPending:!1,isSuccess:!1})),e}},[e]);return{mutate:(0,i.useCallback)((e,s)=>{a(e).then(e=>{s?.onSuccess?.(e)}).catch(e=>{s?.onError?.(e)})},[a]),mutateAsync:a,reset:(0,i.useCallback)(()=>{t({data:void 0,error:null,isPending:!1,isSuccess:!1})},[]),data:s.data,error:s.error,isPending:s.isPending,isSuccess:s.isSuccess}}var j=t(50949);function f({campaign:e,open:s,onOpenChange:t,useCampaignWebSocket:r,useUpdateCampaign:l}){let{toast:d}=(0,n.useToast)(),[c,o]=(0,i.useState)(""),u=l(),{pause:h,resume:x,cancel:m,isConnected:p}=r(e?.id??null);if(!e)return null;let g=async()=>{try{h(),await u.mutateAsync({campaignId:e.id,data:{is_active:!1}}),d({title:"Campaign paused",description:`${e.name} is paused.`})}catch(e){d({title:"Pause failed",description:e instanceof Error?e.message:"Unable to pause campaign",variant:"destructive"})}},f=async()=>{try{x(),await u.mutateAsync({campaignId:e.id,data:{is_active:!0}}),d({title:"Campaign resumed",description:`${e.name} has been resumed.`})}catch(e){d({title:"Resume failed",description:e instanceof Error?e.message:"Unable to resume campaign",variant:"destructive"})}},b=async()=>{try{m(),await u.mutateAsync({campaignId:e.id,data:{is_active:!1}}),d({title:"Campaign cancelled",description:c||`${e.name} has been cancelled.`}),t(!1)}catch(e){d({title:"Cancel failed",description:e instanceof Error?e.message:"Unable to cancel campaign",variant:"destructive"})}};return(0,a.jsx)(n.Dialog,{open:s,onOpenChange:t,children:(0,a.jsxs)(n.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(n.DialogHeader,{children:[(0,a.jsx)(n.DialogTitle,{children:"Campaign Control"}),(0,a.jsx)(n.DialogDescription,{children:"Pause, resume, or cancel the campaign in real time."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:e.name}),(0,a.jsx)(n.Badge,{variant:e.is_active?"outline":"secondary",children:e.is_active?"ACTIVE":"INACTIVE"})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]}),(0,a.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Trigger after"}),(0,a.jsxs)("span",{className:"ml-2 font-medium",children:[e.trigger_after_days," days"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Retry interval"}),(0,a.jsxs)("span",{className:"ml-2 font-medium",children:[e.retry_interval_days," days"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Max retries"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:e.max_retries})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Priority"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:e.priority})]})]}),(0,a.jsxs)("div",{className:"grid gap-3 sm:grid-cols-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Executions"}),(0,a.jsx)("div",{className:"text-2xl font-semibold",children:e.total_executions})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Recoveries"}),(0,a.jsx)("div",{className:"text-2xl font-semibold",children:e.successful_executions})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Recovered amount"}),(0,a.jsxs)("div",{className:"text-2xl font-semibold",children:["$",(e.total_recovered_amount/100).toLocaleString(void 0,{style:"currency",currency:"USD"})]})]})]}),(0,a.jsx)("div",{className:"rounded-md border border-border/60 bg-card/40 p-3 text-xs text-muted-foreground",children:(0,a.jsxs)("p",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),"WebSocket status: ",p?"Connected":"Disconnected"]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-foreground",children:"Cancellation reason (optional)"}),(0,a.jsx)(n.Textarea,{placeholder:"Add context for cancelling this campaign",value:c,onChange:e=>o(e.target.value)})]})]}),(0,a.jsxs)(n.DialogFooter,{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Actions are executed immediately via the campaign control worker."}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.Button,{variant:"outline",onClick:g,disabled:!e.is_active,children:"Pause"}),(0,a.jsx)(n.Button,{variant:"outline",onClick:f,disabled:e.is_active,children:"Resume"}),(0,a.jsx)(n.Button,{variant:"destructive",onClick:b,children:"Cancel campaign"})]})]})]})})}function b(e){return(0,a.jsx)(f,{...e,useCampaignWebSocket:p.iO,useUpdateCampaign:g})}var v=t(29771);function y(){let[e,s]=(0,i.useState)(!1),[t,h]=(0,i.useState)(null),[x,p]=(0,i.useState)(!1),[g,j]=(0,i.useState)(null),[f,y]=(0,i.useState)(!1),[T,N]=(0,i.useState)(null),{data:C}=(0,r.sE)({status:"provisioning",limit:10}),{data:w}=(0,r.sE)({status:"provisioning_failed",limit:10}),{toast:S}=(0,n.useToast)(),{data:_,isLoading:H}=(0,l.a)({queryKey:["scheduler","scheduled-jobs"],queryFn:async()=>{let e=await o.x1.get("/jobs/scheduler/scheduled-jobs");return(0,u.uN)(e)},staleTime:6e4}),{data:P,isLoading:k}=(0,l.a)({queryKey:["scheduler","job-chains"],queryFn:async()=>{try{let e=await o.x1.get("/jobs/scheduler/chains");return(0,u.uN)(e)}catch(e){if(e?.response?.status===404)return[];throw e}},staleTime:6e4}),{data:D,isLoading:R}=(0,r.Ts)(t),E=(0,r.Yf)(),$=(0,r.nq)(),U=function(){let e=(0,d.NL)();return(0,c.D)({mutationFn:async({chainId:e})=>{let s=await o.x1.post(`/jobs/scheduler/chains/${e}/execute`);return(0,u.uN)(s)},onSuccess:async()=>{await Promise.all([e.invalidateQueries({queryKey:["scheduler","job-chains"]}),e.invalidateQueries({queryKey:["services","instances"]})])}})}(),{data:A,isLoading:q}=function({active:e}={}){return(0,l.a)({queryKey:["campaigns",{active:e??null}],queryFn:async()=>{let s=void 0===e?{}:{activeOnly:e};return m.listCampaigns(s)},staleTime:3e4})}(),L=T?A?.find(e=>e.id===T)??null:null;return(0,a.jsxs)("main",{className:"max-w-5xl mx-auto px-6 py-12 space-y-8",children:[(0,a.jsxs)("header",{className:"space-y-1",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Automation"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Monitor orchestration workflows powered by Celery, the job scheduler, and service lifecycle automation."})]}),(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsx)(n.CardTitle,{children:"Provisioning workflows"}),(0,a.jsxs)(n.CardDescription,{children:["Live jobs pulled from ",(0,a.jsx)("code",{children:"/api/v1/services/lifecycle/services"}),"."]})]}),(0,a.jsx)(n.CardContent,{className:"overflow-x-auto",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableHead,{children:"Service"}),(0,a.jsx)(n.TableHead,{children:"Type"}),(0,a.jsx)(n.TableHead,{children:"Status"}),(0,a.jsx)(n.TableHead,{children:"Started"})]})}),(0,a.jsxs)(n.TableBody,{children:[(C??[]).map(e=>(0,a.jsxs)(n.TableRow,{className:"cursor-pointer hover:bg-accent/30",onClick:()=>{h(e.id),s(!0)},children:[(0,a.jsx)(n.TableCell,{className:"font-medium text-foreground",children:e.service_name}),(0,a.jsx)(n.TableCell,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:e.service_type.replace(/_/g," ")}),(0,a.jsx)(n.TableCell,{children:(0,a.jsx)(n.Badge,{variant:"outline",children:e.provisioning_status??e.status})}),(0,a.jsx)(n.TableCell,{className:"text-sm text-muted-foreground",children:new Date(e.created_at).toLocaleString()})]},e.id)),!C?.length&&(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:4,className:"text-center text-muted-foreground",children:"No provisioning workflows currently running."})})]})]})})]}),(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsx)(n.CardTitle,{children:"Failed workflows"}),(0,a.jsx)(n.CardDescription,{children:"Service lifecycle jobs that require operator intervention before retrying."})]}),(0,a.jsx)(n.CardContent,{className:"overflow-x-auto",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableHead,{children:"Service"}),(0,a.jsx)(n.TableHead,{children:"Type"}),(0,a.jsx)(n.TableHead,{children:"Status"}),(0,a.jsx)(n.TableHead,{children:"Created"})]})}),(0,a.jsxs)(n.TableBody,{children:[(w??[]).map(e=>(0,a.jsxs)(n.TableRow,{className:"cursor-pointer hover:bg-accent/30",onClick:()=>{h(e.id),s(!0)},children:[(0,a.jsx)(n.TableCell,{className:"font-medium text-foreground",children:e.service_name}),(0,a.jsx)(n.TableCell,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:e.service_type.replace(/_/g," ")}),(0,a.jsx)(n.TableCell,{children:(0,a.jsx)(n.Badge,{variant:"destructive",children:e.status})}),(0,a.jsx)(n.TableCell,{className:"text-sm text-muted-foreground",children:new Date(e.created_at).toLocaleString()})]},e.id)),!w?.length&&(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:4,className:"text-center text-muted-foreground",children:"No failed workflows detected."})})]})]})})]}),(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsx)(n.CardTitle,{children:"Scheduled jobs"}),(0,a.jsxs)(n.CardDescription,{children:["Recurring automation configured via ",(0,a.jsx)("code",{children:"/api/v1/jobs/scheduler"}),"."]})]}),(0,a.jsx)(n.CardContent,{className:"overflow-x-auto",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableHead,{children:"Name"}),(0,a.jsx)(n.TableHead,{children:"Type"}),(0,a.jsx)(n.TableHead,{children:"Schedule"}),(0,a.jsx)(n.TableHead,{children:"Status"}),(0,a.jsx)(n.TableHead,{children:"Next run"})]})}),(0,a.jsxs)(n.TableBody,{children:[H&&(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:5,className:"text-center text-muted-foreground",children:"Loading scheduled jobs…"})}),!H&&(_?.length??0)===0&&(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:5,className:"text-center text-muted-foreground",children:"No recurring jobs configured."})}),_?.map(e=>a.jsxs(n.TableRow,{children:[a.jsx(n.TableCell,{className:"font-medium text-foreground",children:e.name}),a.jsx(n.TableCell,{className:"uppercase text-xs tracking-wide text-muted-foreground",children:e.job_type.replace(/_/g," ")}),a.jsx(n.TableCell,{children:e.cron_expression??(e.interval_seconds?`${e.interval_seconds}s`:"Manual")}),a.jsx(n.TableCell,{children:a.jsx(n.Badge,{variant:e.is_active?"outline":"secondary",children:e.is_active?"Active":"Paused"})}),a.jsx(n.TableCell,{className:"text-sm text-muted-foreground",children:e.next_run_at?new Date(e.next_run_at).toLocaleString():"—"})]},e.id))]})]})})]}),(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsx)(n.CardTitle,{children:"Job chains"}),(0,a.jsx)(n.CardDescription,{children:"Multi-step workflows (sequential or parallel) registered with the scheduler."})]}),(0,a.jsx)(n.CardContent,{className:"overflow-x-auto",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableHead,{children:"Name"}),(0,a.jsx)(n.TableHead,{children:"Execution mode"}),(0,a.jsx)(n.TableHead,{children:"Status"}),(0,a.jsx)(n.TableHead,{children:"Steps"}),(0,a.jsx)(n.TableHead,{children:"Created"}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"Action"})]})}),(0,a.jsxs)(n.TableBody,{children:[k&&(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:5,className:"text-center text-muted-foreground",children:"Loading job chains…"})}),!k&&(P?.length??0)===0&&(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:5,className:"text-center text-muted-foreground",children:"No job chains configured."})}),P?.map(e=>a.jsxs(n.TableRow,{className:"hover:bg-accent/30 cursor-pointer",onClick:()=>{j(e.id),p(!0)},children:[a.jsx(n.TableCell,{className:"font-medium text-foreground",children:e.name}),a.jsx(n.TableCell,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:e.execution_mode}),a.jsx(n.TableCell,{children:a.jsx(n.Badge,{variant:"active"===e.status?"outline":"secondary",children:e.status})}),a.jsxs(n.TableCell,{children:[e.current_step,"/",e.total_steps]}),a.jsx(n.TableCell,{className:"text-sm text-muted-foreground",children:new Date(e.created_at).toLocaleString()}),a.jsx(n.TableCell,{className:"text-right",children:a.jsx(n.Button,{variant:"outline",size:"sm",disabled:U.isPending,onClick:async s=>{s.stopPropagation();try{await U.mutateAsync({chainId:e.id}),S({title:"Job chain started",description:`${e.name} execution queued.`})}catch(e){v.k.error("Failed to execute job chain",e instanceof Error?e:Error(String(e))),S({title:"Execution failed",description:"Unable to start job chain. Check logs for details.",variant:"destructive"})}},children:"Run now"})})]},e.id))]})]})})]}),(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsx)(n.CardTitle,{children:"Dunning campaigns"}),(0,a.jsx)(n.CardDescription,{children:"Monitor and control dunning automation campaigns."})]}),(0,a.jsx)(n.CardContent,{className:"overflow-x-auto",children:(0,a.jsxs)(n.Table,{children:[(0,a.jsx)(n.TableHeader,{children:(0,a.jsxs)(n.TableRow,{children:[(0,a.jsx)(n.TableHead,{children:"Campaign"}),(0,a.jsx)(n.TableHead,{children:"Status"}),(0,a.jsx)(n.TableHead,{children:"Trigger"}),(0,a.jsx)(n.TableHead,{children:"Executions"}),(0,a.jsx)(n.TableHead,{children:"Recovered"}),(0,a.jsx)(n.TableHead,{className:"text-right",children:"Controls"})]})}),(0,a.jsxs)(n.TableBody,{children:[q&&(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:6,className:"text-center text-muted-foreground",children:"Loading campaigns…"})}),!q&&(A?.length??0)===0&&(0,a.jsx)(n.TableRow,{children:(0,a.jsx)(n.TableCell,{colSpan:6,className:"text-center text-muted-foreground",children:"No campaigns configured."})}),A?.map(e=>a.jsxs(n.TableRow,{children:[a.jsx(n.TableCell,{className:"font-medium text-foreground",children:e.name}),a.jsx(n.TableCell,{children:a.jsx(n.Badge,{variant:e.is_active?"outline":"secondary",children:e.is_active?"ACTIVE":"INACTIVE"})}),a.jsxs(n.TableCell,{children:[e.trigger_after_days," days"]}),a.jsx(n.TableCell,{children:e.total_executions}),a.jsxs(n.TableCell,{children:["$",(e.total_recovered_amount/100).toLocaleString(void 0,{style:"currency",currency:"USD"})]}),a.jsx(n.TableCell,{className:"text-right",children:a.jsx(n.Button,{variant:"outline",size:"sm",onClick:()=>{N(e.id),y(!0)},children:"Control"})})]},e.id))]})]})})]}),(0,a.jsx)(n.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(n.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(n.DialogHeader,{children:[(0,a.jsx)(n.DialogTitle,{children:"Service instance"}),(0,a.jsx)(n.DialogDescription,{children:t?(0,a.jsxs)(a.Fragment,{children:["Details for ",(0,a.jsx)("code",{children:t})]}):"Select a service to view details."})]}),R?(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading service details…"}):D?(0,a.jsxs)("div",{className:"grid gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Service name"}),(0,a.jsx)("span",{className:"font-medium text-foreground",children:D.service_name})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Identifier"}),(0,a.jsx)("span",{className:"font-mono text-xs text-foreground",children:D.service_identifier})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Type"}),(0,a.jsx)(n.Badge,{variant:"outline",children:D.service_type.replace(/_/g," ")})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Status"}),(0,a.jsx)(n.Badge,{variant:"active"===D.status?"outline":"secondary",children:D.status})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Provisioned"}),(0,a.jsx)("span",{children:D.provisioned_at?new Date(D.provisioned_at).toLocaleString():"—"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Activated"}),(0,a.jsx)("span",{children:D.activated_at?new Date(D.activated_at).toLocaleString():"—"})]})]}),D.service_config&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Configuration"}),(0,a.jsx)("pre",{className:"max-h-48 overflow-y-auto rounded border border-border/60 bg-muted p-3 text-xs",children:JSON.stringify(D.service_config,null,2)})]})]}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a service row to load details."}),(0,a.jsxs)(n.DialogFooter,{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Manage lifecycle status for the selected service."}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.Button,{variant:"outline",disabled:!D||E.isPending||$.isPending,onClick:async()=>{if(D)try{await E.mutateAsync({serviceId:D.id}),S({title:"Service suspended",description:`${D.service_name} marked suspended.`})}catch(e){v.k.error("Failed to suspend service",e instanceof Error?e:Error(String(e))),S({title:"Suspend failed",description:"Unable to suspend service. Check logs for details.",variant:"destructive"})}},children:"Suspend"}),(0,a.jsx)(n.Button,{variant:"outline",disabled:!D||E.isPending||$.isPending,onClick:async()=>{if(D)try{await $.mutateAsync({serviceId:D.id}),S({title:"Service resumed",description:`${D.service_name} restored.`})}catch(e){v.k.error("Failed to resume service",e instanceof Error?e:Error(String(e))),S({title:"Resume failed",description:"Unable to resume service. Check logs for details.",variant:"destructive"})}},children:"Resume"}),(0,a.jsx)(n.Button,{variant:"outline",onClick:()=>s(!1),children:"Close"})]})]})]})}),(0,a.jsx)(n.Dialog,{open:x,onOpenChange:p,children:(0,a.jsxs)(n.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(n.DialogHeader,{children:[(0,a.jsx)(n.DialogTitle,{children:"Job chain"}),(0,a.jsx)(n.DialogDescription,{children:g?(0,a.jsxs)(a.Fragment,{children:["Execution details for ",(0,a.jsx)("code",{children:g})]}):"Select a job chain to view details."})]}),k?(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading job chain…"}):g?(()=>{let e=P?.find(e=>e.id===g);return e?(0,a.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Name"}),(0,a.jsx)("span",{className:"font-medium text-foreground",children:e.name})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Execution mode"}),(0,a.jsx)(n.Badge,{variant:"outline",children:e.execution_mode})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Status"}),(0,a.jsx)(n.Badge,{variant:"active"===e.status?"outline":"secondary",children:e.status})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Steps completed"}),(0,a.jsxs)("span",{children:[e.current_step,"/",e.total_steps]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Last error"}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:e.error_message??"—"})]})]}),e.chain_definition&&e.chain_definition.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Chain definition"}),(0,a.jsx)("pre",{className:"max-h-48 overflow-y-auto rounded border border-border/60 bg-muted p-3 text-xs",children:JSON.stringify(e.chain_definition,null,2)})]})]}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Job chain not found."})})():(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a job chain to view details."}),(0,a.jsx)(n.DialogFooter,{children:(0,a.jsx)(n.Button,{variant:"outline",onClick:()=>p(!1),children:"Close"})})]})}),(0,a.jsx)(b,{campaign:L,open:f,onOpenChange:y})]})}},21720:()=>{"use strict";!function(){var e=Error("Cannot find module '../../../shared/hooks/useServiceLifecycle'");throw e.code="MODULE_NOT_FOUND",e}()},25426:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(6171));module.exports=a})();