(()=>{var e={};e.id=4032,e.ids=[4032],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},45324:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d}),s(93824),s(13321),s(46366),s(96560);var a=s(23191),n=s(88716),r=s(37922),l=s.n(r),i=s(95231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let d=["",{children:["dashboard",{children:["automation",{children:["instances",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,93824)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/instances/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/instances/page.tsx"],u="/dashboard/automation/instances/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/dashboard/automation/instances/page",pathname:"/dashboard/automation/instances",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},55416:(e,t,s)=>{Promise.resolve().then(s.bind(s,65795))},65795:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(10326),n=s(17577),r=s(44976),l=s(48324),i=s(17010),o=s(48723),d=s(30361),c=s(69669),u=s(48998),m=s(50949),x=s(71059),p=s(21405),h=s(93892),g=s(88307),j=s(94893),f=s(66697),N=s(98091),y=s(36607),b=s(20892),v=s(90434);function S(){let[e,t]=(0,n.useState)(""),[s,b]=(0,n.useState)("all"),[S,C]=(0,n.useState)("all"),[w,D]=(0,n.useState)("all"),P=(0,r.NL)(),{toast:E}=(0,o.useToast)(),I=(0,o.useConfirmDialog)(),{data:_=[],isLoading:T,refetch:U}=(0,l.a)({queryKey:["deployment-instances"],queryFn:async()=>{let e=await fetch(`${y.LM.api.baseUrl}/api/v1/deployment/instances`,{credentials:"include"});if(!e.ok)throw Error("Failed to fetch instances");return e.json()},refetchInterval:3e4}),q=(0,i.D)({mutationFn:async e=>{if(!(await fetch(`${y.LM.api.baseUrl}/api/v1/deployment/suspend`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({instance_id:e})})).ok)throw Error("Failed to suspend instance")},onSuccess:()=>{P.invalidateQueries({queryKey:["deployment-instances"]}),E({title:"Instance suspended successfully"})},onError:e=>{E({title:"Failed to suspend instance",description:e.message,variant:"destructive"})}}),L=(0,i.D)({mutationFn:async e=>{if(!(await fetch(`${y.LM.api.baseUrl}/api/v1/deployment/resume`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({instance_id:e})})).ok)throw Error("Failed to resume instance")},onSuccess:()=>{P.invalidateQueries({queryKey:["deployment-instances"]}),E({title:"Instance resumed successfully"})},onError:e=>{E({title:"Failed to resume instance",description:e.message,variant:"destructive"})}}),A=(0,i.D)({mutationFn:async e=>{if(!(await fetch(`${y.LM.api.baseUrl}/api/v1/deployment/destroy`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({instance_id:e})})).ok)throw Error("Failed to destroy instance")},onSuccess:()=>{P.invalidateQueries({queryKey:["deployment-instances"]}),E({title:"Instance destroyed successfully"})},onError:e=>{E({title:"Failed to destroy instance",description:e.message,variant:"destructive"})}}),H=_.filter(t=>{let a=!e||t.name.toLowerCase().includes(e.toLowerCase())||t.template_name.toLowerCase().includes(e.toLowerCase())||t.environment.toLowerCase().includes(e.toLowerCase()),n="all"===s||t.state===s,r="all"===S||t.health_status===S,l="all"===w||t.environment===w;return a&&n&&r&&l}),O={total:_.length,running:_.filter(e=>"RUNNING"===e.state).length,stopped:_.filter(e=>"STOPPED"===e.state).length,failed:_.filter(e=>"UNHEALTHY"===e.health_status).length,byEnv:_.reduce((e,t)=>(e[t.environment]=(e[t.environment]||0)+1,e),{})},Z=e=>{let t={RUNNING:{icon:d.Z,color:"bg-green-100 text-green-800",label:"Running"},STOPPED:{icon:c.Z,color:"bg-gray-100 text-gray-800",label:"Stopped"},DEPLOYING:{icon:u.Z,color:"bg-blue-100 text-blue-800",label:"Deploying"},FAILED:{icon:m.Z,color:"bg-red-100 text-red-800",label:"Failed"},SUSPENDED:{icon:x.Z,color:"bg-amber-100 text-amber-800",label:"Suspended"}}[e]||{icon:c.Z,color:"bg-gray-100 text-gray-800",label:e},s=t.icon;return(0,a.jsxs)(o.Badge,{className:t.color,children:[(0,a.jsx)(s,{className:`h-3 w-3 mr-1 ${"DEPLOYING"===e?"animate-spin":""}`}),t.label]})},F=e=>{let t={HEALTHY:{color:"bg-green-100 text-green-800",label:"Healthy"},DEGRADED:{color:"bg-amber-100 text-amber-800",label:"Degraded"},UNHEALTHY:{color:"bg-red-100 text-red-800",label:"Unhealthy"},UNKNOWN:{color:"bg-gray-100 text-gray-800",label:"Unknown"}},s=t[e]||t.UNKNOWN;return(0,a.jsx)(o.Badge,{className:s.color,children:s.label})},B=e=>{let t={AWX_ANSIBLE:{label:"Ansible",color:"bg-red-100 text-red-800"},KUBERNETES:{label:"Kubernetes",color:"bg-blue-100 text-blue-800"},DOCKER_COMPOSE:{label:"Docker",color:"bg-cyan-100 text-cyan-800"}}[e]||{label:e,color:"bg-gray-100 text-gray-800"};return(0,a.jsx)(o.Badge,{className:t.color,children:t.label})},k=e=>{let t={production:{color:"bg-purple-100 text-purple-800"},staging:{color:"bg-blue-100 text-blue-800"},development:{color:"bg-green-100 text-green-800"},testing:{color:"bg-amber-100 text-amber-800"}}[e.toLowerCase()]||{color:"bg-gray-100 text-gray-800"};return(0,a.jsx)(o.Badge,{className:t.color,children:e})};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Deployment Instances"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Monitor and manage active deployment instances"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(o.Button,{variant:"outline",onClick:()=>U(),children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,a.jsx)(o.Button,{asChild:!0,children:(0,a.jsx)(v.default,{href:"/dashboard/automation/deploy",children:"Deploy New Instance"})})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)(o.Card,{children:[(0,a.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Instances"}),(0,a.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(o.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:O.total}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"All deployments"})]})]}),(0,a.jsxs)(o.Card,{children:[(0,a.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Running"}),(0,a.jsx)(d.Z,{className:"h-4 w-4 text-green-600"})]}),(0,a.jsxs)(o.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:O.running}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[O.total>0?Math.round(O.running/O.total*100):0,"% of total"]})]})]}),(0,a.jsxs)(o.Card,{children:[(0,a.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Stopped"}),(0,a.jsx)(c.Z,{className:"h-4 w-4 text-gray-600"})]}),(0,a.jsxs)(o.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:O.stopped}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Not running"})]})]}),(0,a.jsxs)(o.Card,{children:[(0,a.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Failed/Unhealthy"}),(0,a.jsx)(m.Z,{className:"h-4 w-4 text-red-600"})]}),(0,a.jsxs)(o.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:O.failed}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Needs attention"})]})]})]}),(0,a.jsx)(o.Card,{children:(0,a.jsx)(o.CardContent,{className:"pt-6",children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(g.Z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(o.Input,{placeholder:"Search instances...",value:e,onChange:e=>t(e.target.value),className:"pl-10"})]}),(0,a.jsxs)(o.Select,{value:s,onValueChange:b,children:[(0,a.jsx)(o.SelectTrigger,{children:(0,a.jsx)(o.SelectValue,{placeholder:"All States"})}),(0,a.jsxs)(o.SelectContent,{children:[(0,a.jsx)(o.SelectItem,{value:"all",children:"All States"}),(0,a.jsx)(o.SelectItem,{value:"RUNNING",children:"Running"}),(0,a.jsx)(o.SelectItem,{value:"STOPPED",children:"Stopped"}),(0,a.jsx)(o.SelectItem,{value:"DEPLOYING",children:"Deploying"}),(0,a.jsx)(o.SelectItem,{value:"SUSPENDED",children:"Suspended"}),(0,a.jsx)(o.SelectItem,{value:"FAILED",children:"Failed"})]})]}),(0,a.jsxs)(o.Select,{value:S,onValueChange:C,children:[(0,a.jsx)(o.SelectTrigger,{children:(0,a.jsx)(o.SelectValue,{placeholder:"All Health"})}),(0,a.jsxs)(o.SelectContent,{children:[(0,a.jsx)(o.SelectItem,{value:"all",children:"All Health"}),(0,a.jsx)(o.SelectItem,{value:"HEALTHY",children:"Healthy"}),(0,a.jsx)(o.SelectItem,{value:"DEGRADED",children:"Degraded"}),(0,a.jsx)(o.SelectItem,{value:"UNHEALTHY",children:"Unhealthy"})]})]}),(0,a.jsxs)(o.Select,{value:w,onValueChange:D,children:[(0,a.jsx)(o.SelectTrigger,{children:(0,a.jsx)(o.SelectValue,{placeholder:"All Environments"})}),(0,a.jsxs)(o.SelectContent,{children:[(0,a.jsx)(o.SelectItem,{value:"all",children:"All Environments"}),(0,a.jsx)(o.SelectItem,{value:"production",children:"Production"}),(0,a.jsx)(o.SelectItem,{value:"staging",children:"Staging"}),(0,a.jsx)(o.SelectItem,{value:"development",children:"Development"}),(0,a.jsx)(o.SelectItem,{value:"testing",children:"Testing"})]})]})]})})}),(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:T?(0,a.jsx)(o.Card,{className:"col-span-full",children:(0,a.jsx)(o.CardContent,{className:"py-8 text-center text-muted-foreground",children:"Loading instances..."})}):0===H.length?(0,a.jsx)(o.Card,{className:"col-span-full",children:(0,a.jsx)(o.CardContent,{className:"py-8 text-center text-muted-foreground",children:e?"No instances match your search":"No deployment instances found"})}):H.map(e=>(0,a.jsxs)(o.Card,{className:"hover:border-primary transition-colors",children:[(0,a.jsxs)(o.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsx)(h.Z,{className:"h-8 w-8 text-primary"}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 items-end",children:[Z(e.state),F(e.health_status)]})]}),(0,a.jsx)(o.CardTitle,{className:"mt-2",children:(0,a.jsx)(v.default,{href:`/dashboard/automation/instances/${e.id}`,className:"hover:underline",children:e.name})}),(0,a.jsxs)(o.CardDescription,{className:"line-clamp-1",children:["Template: ",e.template_name]})]}),(0,a.jsxs)(o.CardContent,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[B(e.backend),k(e.environment),(0,a.jsx)(o.Badge,{variant:"outline",children:e.region})]}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[void 0!==e.resources.cpu_usage&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"CPU:"}),(0,a.jsxs)("span",{className:"font-medium",children:[e.resources.cpu_usage,"%"]})]}),void 0!==e.resources.memory_usage&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Memory:"}),(0,a.jsxs)("span",{className:"font-medium",children:[e.resources.memory_usage,"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Deployed:"}),(0,a.jsx)("span",{className:"text-xs",children:e.last_deployed_at?new Date(e.last_deployed_at).toLocaleDateString():"N/A"})]})]}),(0,a.jsxs)("div",{className:"pt-3 border-t flex gap-2",children:["SUSPENDED"===e.state||"STOPPED"===e.state?(0,a.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>L.mutate(e.id),disabled:L.isPending,className:"flex-1",children:[(0,a.jsx)(j.Z,{className:"h-3 w-3 mr-1"}),"Resume"]}):"RUNNING"===e.state?(0,a.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>q.mutate(e.id),disabled:q.isPending,className:"flex-1",children:[(0,a.jsx)(x.Z,{className:"h-3 w-3 mr-1"}),"Suspend"]}):(0,a.jsxs)(o.Button,{variant:"outline",size:"sm",disabled:!0,className:"flex-1",children:[(0,a.jsx)(u.Z,{className:"h-3 w-3 mr-1"}),"Busy"]}),(0,a.jsx)(o.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsx)(v.default,{href:`/dashboard/automation/instances/${e.id}`,children:(0,a.jsx)(f.Z,{className:"h-3 w-3"})})}),(0,a.jsx)(o.Button,{variant:"outline",size:"sm",onClick:async()=>{await I({title:"Destroy instance",description:`Destroy instance "${e.name}"? This cannot be undone.`,confirmText:"Destroy",variant:"destructive"})&&A.mutate(e.id)},disabled:A.isPending,className:"text-destructive hover:text-destructive",children:(0,a.jsx)(N.Z,{className:"h-3 w-3"})})]})]})]},e.id))})]})}function C(){return(0,a.jsx)(b.eu,{permission:"deployment.instance.read",children:(0,a.jsx)(S,{})})}},93824:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/instances/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[2793,1009,6226,657,6032,4218],()=>s(45324));module.exports=a})();