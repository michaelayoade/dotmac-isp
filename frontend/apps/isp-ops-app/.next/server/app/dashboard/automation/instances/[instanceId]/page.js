(()=>{var e={};e.id=8661,e.ids=[8661],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},61146:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>l}),t(71714),t(13321),t(46366),t(96560);var a=t(23191),r=t(88716),n=t(37922),i=t.n(n),d=t(95231),o={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>d[e]);t.d(s,o);let l=["",{children:["dashboard",{children:["automation",{children:["instances",{children:["[instanceId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,71714)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/instances/[instanceId]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/instances/[instanceId]/page.tsx"],u="/dashboard/automation/instances/[instanceId]/page",m={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/automation/instances/[instanceId]/page",pathname:"/dashboard/automation/instances/[instanceId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},37762:(e,s,t)=>{Promise.resolve().then(t.bind(t,71305))},71305:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>P});var a=t(10326),r=t(44976),n=t(48324),i=t(17010),d=t(48723),o=t(21405),l=t(30361),c=t(69669),u=t(48998),m=t(50949),x=t(71059),p=t(86333),h=t(94893),j=t(97601),g=t(98091),y=t(93892),f=t(76464),N=t(88378),v=t(36283),b=t(66697),C=t(36607),w=t(20892),_=t(90434),T=t(35047);function D(){let e=(0,T.useParams)(),s=(0,T.useRouter)(),t=e.instanceId,w=(0,r.NL)(),{toast:D}=(0,d.useToast)(),P=(0,d.useConfirmDialog)(),{data:k,isLoading:S,refetch:q}=(0,n.a)({queryKey:["deployment-instance",t],queryFn:async()=>{let e=await fetch(`${C.LM.api.baseUrl}/api/v1/deployment/instances/${t}`,{credentials:"include"});if(!e.ok)throw Error("Failed to fetch instance");return e.json()},refetchInterval:3e4}),{data:I}=(0,n.a)({queryKey:["deployment-instance-status",t],queryFn:async()=>{let e=await fetch(`${C.LM.api.baseUrl}/api/v1/deployment/instances/${t}/status`,{credentials:"include"});if(!e.ok)throw Error("Failed to fetch status");return e.json()},refetchInterval:1e4}),U=(0,i.D)({mutationFn:async()=>{let e=await fetch(`${C.LM.api.baseUrl}/api/v1/deployment/suspend`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({instance_id:parseInt(t)})});if(!e.ok)throw Error("Failed to suspend");return e.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["deployment-instance",t]}),D({title:"Instance suspended"})}}),E=(0,i.D)({mutationFn:async()=>{let e=await fetch(`${C.LM.api.baseUrl}/api/v1/deployment/resume`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({instance_id:parseInt(t)})});if(!e.ok)throw Error("Failed to resume");return e.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["deployment-instance",t]}),D({title:"Instance resumed"})}}),L=(0,i.D)({mutationFn:async()=>{let e=await fetch(`${C.LM.api.baseUrl}/api/v1/deployment/upgrade`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({instance_id:parseInt(t)})});if(!e.ok)throw Error("Failed to upgrade");return e.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["deployment-instance",t]}),D({title:"Upgrade initiated"})}});(0,i.D)({mutationFn:async e=>{let s=await fetch(`${C.LM.api.baseUrl}/api/v1/deployment/scale`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({instance_id:parseInt(t),replicas:e})});if(!s.ok)throw Error("Failed to scale");return s.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["deployment-instance",t]}),D({title:"Scaling initiated"})}});let O=(0,i.D)({mutationFn:async()=>{if(!(await fetch(`${C.LM.api.baseUrl}/api/v1/deployment/destroy`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({instance_id:parseInt(t)})})).ok)throw Error("Failed to destroy")},onSuccess:()=>{D({title:"Instance destroyed"}),s.push("/dashboard/automation/instances")}});if(S||!k)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)(o.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})});let Z=e=>{let s={HEALTHY:{color:"bg-green-100 text-green-800"},DEGRADED:{color:"bg-amber-100 text-amber-800"},UNHEALTHY:{color:"bg-red-100 text-red-800"},UNKNOWN:{color:"bg-gray-100 text-gray-800"}},t=s[e]||s.UNKNOWN;return(0,a.jsx)(d.Badge,{className:t.color,children:e})};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d.Button,{variant:"ghost",size:"icon",asChild:!0,children:(0,a.jsx)(_.default,{href:"/dashboard/automation/instances",children:(0,a.jsx)(p.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:k.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Template: ",k.template_name]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d.Button,{variant:"outline",onClick:()=>q(),children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})}),"SUSPENDED"===k.state||"STOPPED"===k.state?(0,a.jsxs)(d.Button,{onClick:()=>E.mutate(),children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Resume"]}):"RUNNING"===k.state?(0,a.jsxs)(d.Button,{variant:"outline",onClick:()=>U.mutate(),children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Suspend"]}):null,(0,a.jsxs)(d.Button,{variant:"outline",onClick:()=>L.mutate(),disabled:"RUNNING"!==k.state,children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Upgrade"]}),(0,a.jsxs)(d.Button,{variant:"destructive",onClick:async()=>{await P({title:"Destroy instance",description:`Destroy instance "${k.name}"?`,confirmText:"Destroy",variant:"destructive"})&&O.mutate()},children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"Destroy"]})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-sm",children:"State"})}),(0,a.jsx)(d.CardContent,{children:(e=>{let s={RUNNING:{icon:l.Z,color:"bg-green-100 text-green-800"},STOPPED:{icon:c.Z,color:"bg-gray-100 text-gray-800"},DEPLOYING:{icon:u.Z,color:"bg-blue-100 text-blue-800"},FAILED:{icon:m.Z,color:"bg-red-100 text-red-800"},SUSPENDED:{icon:x.Z,color:"bg-amber-100 text-amber-800"}}[e]||{icon:c.Z,color:"bg-gray-100 text-gray-800"},t=s.icon;return(0,a.jsxs)(d.Badge,{className:s.color,children:[(0,a.jsx)(t,{className:`h-3 w-3 mr-1 ${"DEPLOYING"===e?"animate-spin":""}`}),e]})})(k.state)})]}),(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-sm",children:"Health"})}),(0,a.jsx)(d.CardContent,{children:Z(k.health_status)})]}),(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-sm",children:"Environment"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)(d.Badge,{children:k.environment})})]}),(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-sm",children:"Region"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)(d.Badge,{variant:"outline",children:k.region})})]})]}),(0,a.jsxs)(d.Tabs,{defaultValue:"overview",className:"space-y-4",children:[(0,a.jsxs)(d.TabsList,{children:[(0,a.jsxs)(d.TabsTrigger,{value:"overview",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),"Overview"]}),(0,a.jsxs)(d.TabsTrigger,{value:"resources",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Resources"]}),(0,a.jsxs)(d.TabsTrigger,{value:"configuration",children:[(0,a.jsx)(N.Z,{className:"h-4 w-4 mr-2"}),"Configuration"]}),(0,a.jsxs)(d.TabsTrigger,{value:"logs",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"Logs"]})]}),(0,a.jsxs)(d.TabsContent,{value:"overview",className:"space-y-4",children:[(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{children:"Instance Information"})}),(0,a.jsxs)(d.CardContent,{className:"grid gap-3 md:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Instance ID"}),(0,a.jsx)("p",{className:"font-mono text-sm",children:k.id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Template"}),(0,a.jsx)("p",{className:"font-medium",children:k.template_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Backend"}),(0,a.jsx)("p",{className:"font-medium",children:k.backend})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Created"}),(0,a.jsx)("p",{className:"text-sm",children:new Date(k.created_at).toLocaleString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Last Updated"}),(0,a.jsx)("p",{className:"text-sm",children:new Date(k.updated_at).toLocaleString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Last Deployed"}),(0,a.jsx)("p",{className:"text-sm",children:k.last_deployed_at?new Date(k.last_deployed_at).toLocaleString():"N/A"})]})]})]}),I?.services&&I.services.length>0&&(0,a.jsxs)(d.Card,{children:[(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsx)(d.CardTitle,{children:"Services"}),(0,a.jsx)(d.CardDescription,{children:"Running services in this deployment"})]}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("div",{className:"space-y-2",children:I.services.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-medium",children:e.name})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d.Badge,{className:"running"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:e.status}),Z(e.health)]})]},s))})})]})]}),(0,a.jsx)(d.TabsContent,{value:"resources",className:"space-y-4",children:(0,a.jsxs)(d.Card,{children:[(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsx)(d.CardTitle,{children:"Resource Usage"}),(0,a.jsxs)(d.CardDescription,{children:["Last updated: ",I?new Date(I.last_check).toLocaleString():"N/A"]})]}),(0,a.jsxs)(d.CardContent,{className:"space-y-4",children:[void 0!==k.resources.cpu_usage&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"CPU"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[k.resources.cpu_usage,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${k.resources.cpu_usage}%`}})})]}),void 0!==k.resources.memory_usage&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Memory"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[k.resources.memory_usage,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${k.resources.memory_usage}%`}})})]}),void 0!==k.resources.disk_usage&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Disk"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[k.resources.disk_usage,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-amber-600 h-2 rounded-full",style:{width:`${k.resources.disk_usage}%`}})})]}),(void 0!==k.resources.network_in||void 0!==k.resources.network_out)&&(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-2 pt-4 border-t",children:[void 0!==k.resources.network_in&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Network In"}),(0,a.jsxs)("p",{className:"text-lg font-bold",children:[(k.resources.network_in/1024/1024).toFixed(2)," MB/s"]})]}),void 0!==k.resources.network_out&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Network Out"}),(0,a.jsxs)("p",{className:"text-lg font-bold",children:[(k.resources.network_out/1024/1024).toFixed(2)," MB/s"]})]})]})]})]})}),(0,a.jsxs)(d.TabsContent,{value:"configuration",className:"space-y-4",children:[(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{children:"Configuration"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("pre",{className:"text-xs bg-muted p-4 rounded-lg overflow-auto max-h-96",children:JSON.stringify(k.configuration,null,2)})})]}),k.metadata&&Object.keys(k.metadata).length>0&&(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{children:"Metadata"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("pre",{className:"text-xs bg-muted p-4 rounded-lg overflow-auto max-h-96",children:JSON.stringify(k.metadata,null,2)})})]})]}),(0,a.jsx)(d.TabsContent,{value:"logs",className:"space-y-4",children:(0,a.jsxs)(d.Card,{children:[(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsx)(d.CardTitle,{children:"Deployment Logs"}),(0,a.jsx)(d.CardDescription,{children:"Recent deployment activity"})]}),(0,a.jsx)(d.CardContent,{children:k.deployment_logs&&k.deployment_logs.length>0?(0,a.jsx)("pre",{className:"text-xs font-mono bg-black text-green-400 p-4 rounded-lg overflow-auto max-h-96",children:k.deployment_logs.join("\n")}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No logs available"})})]})})]})]})}function P(){return(0,a.jsx)(w.eu,{permission:"deployment.instance.read",children:(0,a.jsx)(D,{})})}},71714:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/automation/instances/[instanceId]/page.tsx#default`)}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[2793,1009,6226,657,6032,4218],()=>t(61146));module.exports=a})();