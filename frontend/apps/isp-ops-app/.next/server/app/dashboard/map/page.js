(()=>{var e={};e.id=9882,e.ids=[9882],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},19704:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),s(68806),s(13321),s(46366),s(96560);var a=s(23191),r=s(88716),n=s(37922),l=s.n(n),i=s(95231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let d=["",{children:["dashboard",{children:["map",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,68806)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/map/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/map/page.tsx"],u="/dashboard/map/page",x={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/map/page",pathname:"/dashboard/map",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},61859:(e,t,s)=>{Promise.resolve().then(s.bind(s,42020))},42020:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(10326),r=s(17577),n=s(43353),l=s.n(n),i=s(48723),o=s(48998),d=s(77636),c=s(87650),u=s(87075),x=s(34041),p=s(94629),m=s(21918);let h=l()(async()=>{},{loadableGenerated:{modules:["app/dashboard/map/page.tsx -> @/components/map/TechnicianMap"]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"h-full w-full flex items-center justify-center bg-gray-100",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading map..."})]})})});function f({technicians:e,selectedTechnicianId:t,onSelectTechnician:s,filters:r,onFilterChange:n}){let l={total:e.length,active:e.filter(e=>"active"===e.status).length,available:e.filter(e=>e.isAvailable).length,onTask:e.filter(e=>e.currentAssignment).length};return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Field Technicians"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:l.total}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Total"})]})}),(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:l.available}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Available"})]})}),(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:l.onTask}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"On Task"})]})}),(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:l.active}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Active"})]})})]})]}),(0,a.jsxs)("div",{className:"p-4 border-b space-y-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)("label",{className:"text-sm font-medium",children:"Filters"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:r.showAvailableOnly,onChange:e=>n({...r,showAvailableOnly:e.target.checked}),className:"rounded"}),"Available only"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:r.showWithAssignments,onChange:e=>n({...r,showWithAssignments:e.target.checked}),className:"rounded"}),"With assignments"]})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[e.map(e=>(0,a.jsx)("div",{className:`p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors ${t===e.id?"bg-blue-50 border-l-4 border-l-blue-600":""}`,onClick:()=>s(e.id),children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.fullName}),e.isAvailable?(0,a.jsx)(i.Badge,{className:"bg-green-100 text-green-800 text-xs",children:"Available"}):(0,a.jsx)(i.Badge,{className:"bg-gray-100 text-gray-800 text-xs",children:"Busy"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 mb-2",children:[e.skillLevel.charAt(0).toUpperCase()+e.skillLevel.slice(1)," â€¢"," ",e.employeeId]}),e.currentAssignment&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-yellow-50 rounded text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 font-medium text-yellow-900",children:[(0,a.jsx)(o.Z,{className:"h-3 w-3"}),"Current Task"]}),(0,a.jsxs)("div",{className:"text-yellow-700 mt-1",children:[(0,x.WU)((0,p.D)(e.currentAssignment.scheduledStart),"h:mm a")," -"," ",(0,x.WU)((0,p.D)(e.currentAssignment.scheduledEnd),"h:mm a")]}),e.distanceToTask&&(0,a.jsxs)("div",{className:"text-yellow-700 mt-1",children:[e.distanceToTask.toFixed(1)," km away"]})]}),e.currentLocationLat&&e.currentLocationLng&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500 flex items-center gap-1",children:[(0,a.jsx)(d.Z,{className:"h-3 w-3"}),"Last seen:"," ",e.lastLocationUpdate?(0,x.WU)((0,p.D)(e.lastLocationUpdate),"h:mm a"):"Unknown"]})]}),(0,a.jsx)(i.Button,{size:"sm",variant:"outline",onClick:t=>{t.stopPropagation(),s(e.id)},children:(0,a.jsx)(c.Z,{className:"h-3 w-3"})})]})},e.id)),0===e.length&&(0,a.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,a.jsx)(d.Z,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No technicians found"})]})]})]})}function g(){let[e,t]=(0,r.useState)(),[s,n]=(0,r.useState)({status:["active"],showAvailableOnly:!1,showWithAssignments:!1}),l=(0,r.useMemo)(()=>{let e={status:s.status};return s.showAvailableOnly&&(e.isAvailable=!0),e},[s]),{data:o,refetch:d}=(0,u.JB)(l),c=(0,x.WU)(new Date,"yyyy-MM-dd"),{data:g,refetch:b}=(0,u.wS)({dateFrom:c,dateTo:c}),v=(o?.technicians||[]).map(e=>{let t;let s=g?.assignments.find(t=>t.technicianId===e.id&&("in_progress"===t.status||"scheduled"===t.status)&&m.z(p.D(t.scheduledStart)));s&&e.currentLocationLat&&e.currentLocationLng&&s.taskLocationLat&&s.taskLocationLng&&(t=function(e,t,s,a){let r=j(s-e),n=j(a-t),l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(j(e))*Math.cos(j(s))*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371}(e.currentLocationLat,e.currentLocationLng,s.taskLocationLat,s.taskLocationLng));let a={...e};return s&&(a.currentAssignment=s),void 0!==t&&(a.distanceToTask=t),a}).filter(e=>!s.showWithAssignments||!!e.currentAssignment);return(0,a.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,a.jsx)("div",{className:"bg-white border-b p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Live Map"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Real-time technician tracking and assignments"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(i.Badge,{className:"bg-green-100 text-green-800",children:[(0,a.jsx)("div",{className:"h-2 w-2 bg-green-600 rounded-full mr-2 animate-pulse"}),"Live"]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Last updated: ",(0,x.WU)(new Date,"h:mm:ss a")]})]})]})}),(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsx)("div",{className:"w-80 bg-white border-r overflow-hidden",children:(0,a.jsx)(f,{technicians:v,selectedTechnicianId:e,onSelectTechnician:t,filters:s,onFilterChange:n})}),(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)(h,{technicians:v,selectedTechnicianId:e,onSelectTechnician:t})})]})]})}function j(e){return Math.PI/180*e}},43353:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let a=s(22017);s(10326),s(17577);let r=a._(s(77028));function n(e,t){var s;let a={loading:e=>{let{error:t,isLoading:s,pastDelay:a}=e;return null}};"function"==typeof e&&(a.loader=e);let n={...a,...t};return(0,r.default)({...n,modules:null==(s=n.loadableGenerated)?void 0:s.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},933:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let a=s(94129);function r(e){let{reason:t,children:s}=e;throw new a.BailoutToCSRError(t)}},77028:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let a=s(10326),r=s(17577),n=s(933),l=s(46618);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},s=(0,r.lazy)(()=>t.loader().then(i)),d=t.loading;function c(e){let i=d?(0,a.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=t.ssr?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.PreloadCss,{moduleIds:t.modules}),(0,a.jsx)(s,{...e})]}):(0,a.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(s,{...e})});return(0,a.jsx)(r.Suspense,{fallback:i,children:o})}return c.displayName="LoadableComponent",c}},46618:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return n}});let a=s(10326),r=s(54580);function n(e){let{moduleIds:t}=e,s=(0,r.getExpectedRequestStore)("next/dynamic css"),n=[];if(s.reactLoadableManifest&&t){let e=s.reactLoadableManifest;for(let s of t){if(!e[s])continue;let t=e[s].files.filter(e=>e.endsWith(".css"));n.push(...t)}}return 0===n.length?null:(0,a.jsx)(a.Fragment,{children:n.map(e=>(0,a.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:s.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},68806:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/map/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[2793,1009,6226,657,6032,4218,7075],()=>s(19704));module.exports=a})();