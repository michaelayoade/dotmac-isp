(()=>{var e={};e.id=4172,e.ids=[4172],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},67853:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>r.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d}),a(37263),a(67486),a(13321),a(46366),a(96560);var s=a(23191),i=a(88716),l=a(37922),r=a.n(l),n=a(95231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);a.d(t,o);let d=["",{children:["dashboard",{children:["crm",{children:["leads",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,37263)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/crm/leads/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,67486)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/crm/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/crm/leads/page.tsx"],u="/dashboard/crm/leads/page",p={require:a,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/dashboard/crm/leads/page",pathname:"/dashboard/crm/leads",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9194:(e,t,a)=>{Promise.resolve().then(a.bind(a,28506))},28506:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>P,dynamic:()=>L,dynamicParams:()=>N});var s=a(10326),i=a(17577),l=a(35047),r=a(15919),n=a(12714),o=a(69508),d=a(71383),c=a(64747),u=a(59819),p=a(30361),m=a(98091),h=a(31540),x=a(74975),g=a(24061),v=a(69436),j=a(17069),f=a(41137),y=a(90960),S=a(48723),b=a(97505),w=a(9512),C=a(5839);function _({isOpen:e,onClose:t,onSuccess:a,onCreate:l}){let{toast:r}=(0,S.useToast)(),[n,o]=(0,i.useState)(!1),d=async e=>{o(!0);try{let t={...e};await l(t),r({title:"Lead Created",description:`${e.first_name} ${e.last_name} has been added to the pipeline.`})}catch(e){throw console.error("Failed to create lead:",e),r({title:"Error",description:"Failed to create lead. Please try again.",variant:"destructive"}),e}finally{o(!1)}};return(0,s.jsx)(C.CreateLeadModal,{isOpen:e,onClose:t,onSuccess:a,onCreate:d,isSubmitting:n})}function q({isOpen:e,onClose:t,lead:a,onUpdate:l}){let{toast:r}=(0,S.useToast)(),[n,o]=(0,i.useState)(!1),{updateLead:d,qualifyLead:c,disqualifyLead:u,convertToCustomer:p}=(0,b.vD)(),m=a?.id?{leadId:a.id}:void 0,h=a?.id?{leadId:a.id}:void 0,{quotes:x}=(0,b.vR)(m),{surveys:g}=(0,b.Dv)(h),v=async(e,t)=>{o(!0);try{await d(e,t),r({title:"Lead Updated",description:"Lead details have been successfully updated."})}catch(e){console.error("Failed to update lead:",e),r({title:"Error",description:"Failed to update lead. Please try again.",variant:"destructive"})}finally{o(!1)}},j=async e=>{try{await c(e),r({title:"Lead Qualified",description:a?`${a.first_name} ${a.last_name} is now qualified.`:"Lead qualified successfully."})}catch(e){console.error("Failed to qualify lead:",e),r({title:"Error",description:"Failed to qualify lead. Please try again.",variant:"destructive"})}},f=async(e,t)=>{try{await u(e,t),r({title:"Lead Disqualified",description:a?`${a.first_name} ${a.last_name} has been disqualified.`:"Lead disqualified successfully."})}catch(e){console.error("Failed to disqualify lead:",e),r({title:"Error",description:"Failed to disqualify lead. Please try again.",variant:"destructive"})}},y=async e=>{try{await p(e),r({title:"Lead Converted",description:a?`${a.first_name} ${a.last_name} is now a customer!`:"Lead converted successfully!"})}catch(e){console.error("Failed to convert lead:",e),r({title:"Error",description:"Failed to convert lead. Please try again.",variant:"destructive"})}};return(0,s.jsx)(C.LeadDetailModal,{isOpen:e,onClose:t,lead:a,quotes:x,surveys:g,onSave:v,onQualify:j,onDisqualify:f,onConvert:y,isSaving:n,onUpdate:l||(()=>{})})}let L="force-dynamic",N=!0;function P(){(0,l.useRouter)();let{toast:e}=(0,S.useToast)(),[t,a]=(0,i.useState)(""),[C,L]=(0,i.useState)(""),[N,P]=(0,i.useState)(""),[I,D]=(0,i.useState)(""),[M,k]=(0,i.useState)(!1),[E,U]=(0,i.useState)(null),[Z,$]=(0,i.useState)(!1),A={autoRefresh:!0,refreshInterval:6e4,...t?{status:t}:{},...C?{source:C}:{}},{leads:F,isLoading:R,error:Q,refetch:T,createLead:V,updateLeadStatus:B,qualifyLead:O,disqualifyLead:W}=(0,b.vD)(A),G=(0,i.useMemo)(()=>{let e=[...F];if(I){let t=I.toLowerCase();e=e.filter(e=>e.first_name.toLowerCase().includes(t)||e.last_name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t)||(e.phone??"").toLowerCase().includes(t)||e.lead_number.toLowerCase().includes(t))}if(N){let t=parseInt(N);e=e.filter(e=>e.priority===t)}return e},[F,I,N]),z=(0,i.useMemo)(()=>{let e=F.length,t=F.filter(e=>"new"===e.status).length,a=F.filter(e=>"qualified"===e.status).length,s=F.filter(e=>"quote_sent"===e.status).length,i=F.filter(e=>"won"===e.status).length,l=e>0?Number((i/e*100).toFixed(1)):0;return{total:e,newLeads:t,qualified:a,quoteSent:s,won:i,conversionRate:l}},[F]),K=(0,i.useCallback)(e=>{U(e),$(!0)},[U,$]),H=(0,i.useCallback)(e=>{U(e),k(!0)},[U,k]),X=(0,i.useCallback)(async t=>{await O(t)&&(e({title:"Lead Qualified",description:"Lead has been marked as qualified."}),T())},[O,T,e]),J=(0,i.useCallback)(async t=>{let a=prompt("Reason for disqualification:");a&&await W(t,a)&&(e({title:"Lead Disqualified",description:"Lead has been disqualified."}),T())},[W,T,e]),Y=(0,i.useMemo)(()=>[{id:"lead_number",header:"Lead #",accessorKey:"lead_number",cell:({row:e})=>(0,s.jsx)("span",{className:"font-mono text-sm",children:e.original.lead_number})},{id:"contact",header:"Contact",cell:({row:e})=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("span",{className:"font-medium",children:[e.original.first_name," ",e.original.last_name]}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.original.email}),e.original.phone&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.original.phone})]})},{id:"status",header:"Status",cell:({row:e})=>(0,s.jsx)(w.PW,{status:e.original.status})},{id:"source",header:"Source",cell:({row:e})=>(0,s.jsx)(w.FV,{source:e.original.source})},{id:"priority",header:"Priority",cell:({row:e})=>(0,s.jsx)(w.Uy,{priority:e.original.priority})},{id:"serviceability",header:"Serviceability",cell:({row:e})=>{if(!e.original.is_serviceable)return(0,s.jsx)("span",{className:"text-muted-foreground",children:"—"});let{label:t,className:a}={serviceable:{label:"✅ Serviceable",className:"text-green-500"},not_serviceable:{label:"❌ Not Serviceable",className:"text-red-500"},pending_expansion:{label:"⏳ Pending",className:"text-yellow-500"},requires_construction:{label:"\uD83D\uDD27 Construction",className:"text-orange-500"}}[e.original.is_serviceable]||{label:"Unknown",className:"text-gray-500"};return(0,s.jsx)("span",{className:`text-xs ${a}`,children:t})}},{id:"created",header:"Created",accessorKey:"created_at",cell:({row:e})=>(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:function(e){if(!e)return"—";try{return(0,y.Q)(new Date(e),{addSuffix:!0})}catch{return e}}(e.original.created_at)})},{id:"actions",header:"Actions",cell:({row:e})=>(0,s.jsxs)(S.DropdownMenu,{children:[(0,s.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(S.Button,{variant:"ghost",size:"sm",children:(0,s.jsx)(r.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(S.DropdownMenuContent,{align:"end",children:[(0,s.jsxs)(S.DropdownMenuItem,{onClick:()=>K(e.original),children:[(0,s.jsx)(n.Z,{className:"mr-2 h-4 w-4"}),"View Details"]}),(0,s.jsxs)(S.DropdownMenuItem,{onClick:()=>H(e.original),children:[(0,s.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Edit Lead"]}),"contacted"===e.original.status&&(0,s.jsxs)(S.DropdownMenuItem,{onClick:()=>X(e.original.id),children:[(0,s.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"Qualify"]}),"disqualified"!==e.original.status&&(0,s.jsxs)(S.DropdownMenuItem,{onClick:()=>J(e.original.id),children:[(0,s.jsx)(c.Z,{className:"mr-2 h-4 w-4"}),"Disqualify"]})]})]})}],[J,H,X,K]),ee=(0,i.useMemo)(()=>[{label:"Mark as Contacted",icon:({className:e})=>(0,s.jsx)(u.Z,{className:e}),action:async t=>{for(let e of t)"new"===e.status&&await B(e.id,"contacted");e({title:"Leads Updated",description:`${t.length} lead(s) marked as contacted.`}),T()}},{label:"Qualify Leads",icon:({className:e})=>(0,s.jsx)(p.Z,{className:e}),action:async t=>{for(let e of t)("contacted"===e.status||"site_survey_completed"===e.status)&&await O(e.id);e({title:"Leads Qualified",description:`${t.length} lead(s) qualified.`}),T()}},{label:"Delete Leads",icon:({className:e})=>(0,s.jsx)(m.Z,{className:e}),action:async t=>{e({title:"Leads Deleted",description:`${t.length} lead(s) deleted.`,variant:"destructive"}),T()},variant:"destructive"}],[B,O,T,e]);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold text-foreground",children:"Leads Management"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage your sales pipeline from initial contact to customer conversion."})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(S.Button,{variant:"outline",onClick:()=>{(function(e,t){let a=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=t,i.click(),window.URL.revokeObjectURL(s)})([["Lead Number","First Name","Last Name","Email","Phone","Status","Source","Priority","Serviceability","Created At"],...G.map(e=>[e.lead_number,e.first_name,e.last_name,e.email,e.phone||"",e.status,e.source,e.priority.toString(),e.is_serviceable||"",e.created_at])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),`leads-${new Date().toISOString().split("T")[0]}.csv`),e({title:"Export Complete",description:`${G.length} leads exported to CSV.`})},children:[(0,s.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Export"]}),(0,s.jsxs)(S.Button,{onClick:()=>k(!0),children:[(0,s.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"Create Lead"]})]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-6",children:[(0,s.jsx)(S.MetricCardEnhanced,{title:"Total Leads",value:z.total,icon:g.Z,loading:R,...Q?.message?{error:Q.message}:{}}),(0,s.jsx)(S.MetricCardEnhanced,{title:"New Leads",value:z.newLeads,subtitle:"Uncontacted",icon:x.Z,loading:R}),(0,s.jsx)(S.MetricCardEnhanced,{title:"Qualified",value:z.qualified,subtitle:"Ready for quotes",icon:p.Z,loading:R}),(0,s.jsx)(S.MetricCardEnhanced,{title:"Quotes Sent",value:z.quoteSent,subtitle:"Pending response",icon:v.Z,loading:R}),(0,s.jsx)(S.MetricCardEnhanced,{title:"Won",value:z.won,subtitle:"Converted",icon:j.Z,loading:R}),(0,s.jsx)(S.MetricCardEnhanced,{title:"Conversion Rate",value:`${z.conversionRate}%`,subtitle:"Won / Total",icon:j.Z,loading:R})]}),(0,s.jsx)(S.Card,{children:(0,s.jsx)(S.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(f.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("h3",{className:"font-semibold",children:"Filters"}),(t||C||N||I)&&(0,s.jsx)(S.Button,{variant:"ghost",size:"sm",onClick:()=>{a(""),L(""),P(""),D("")},children:"Clear All"})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(S.Label,{children:"Search"}),(0,s.jsx)(S.Input,{placeholder:"Name, email, phone, lead #...",value:I,onChange:e=>D(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(S.Label,{children:"Status"}),(0,s.jsxs)(S.Select,{value:t,onValueChange:e=>a(e),children:[(0,s.jsx)(S.SelectTrigger,{children:(0,s.jsx)(S.SelectValue,{placeholder:"All Statuses"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"",children:"All Statuses"}),(0,s.jsx)(S.SelectItem,{value:"new",children:"New"}),(0,s.jsx)(S.SelectItem,{value:"contacted",children:"Contacted"}),(0,s.jsx)(S.SelectItem,{value:"qualified",children:"Qualified"}),(0,s.jsx)(S.SelectItem,{value:"site_survey_scheduled",children:"Survey Scheduled"}),(0,s.jsx)(S.SelectItem,{value:"site_survey_completed",children:"Survey Completed"}),(0,s.jsx)(S.SelectItem,{value:"quote_sent",children:"Quote Sent"}),(0,s.jsx)(S.SelectItem,{value:"negotiating",children:"Negotiating"}),(0,s.jsx)(S.SelectItem,{value:"won",children:"Won"}),(0,s.jsx)(S.SelectItem,{value:"lost",children:"Lost"}),(0,s.jsx)(S.SelectItem,{value:"disqualified",children:"Disqualified"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(S.Label,{children:"Source"}),(0,s.jsxs)(S.Select,{value:C,onValueChange:e=>L(e),children:[(0,s.jsx)(S.SelectTrigger,{children:(0,s.jsx)(S.SelectValue,{placeholder:"All Sources"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"",children:"All Sources"}),(0,s.jsx)(S.SelectItem,{value:"website",children:"Website"}),(0,s.jsx)(S.SelectItem,{value:"referral",children:"Referral"}),(0,s.jsx)(S.SelectItem,{value:"partner",children:"Partner"}),(0,s.jsx)(S.SelectItem,{value:"cold_call",children:"Cold Call"}),(0,s.jsx)(S.SelectItem,{value:"social_media",children:"Social Media"}),(0,s.jsx)(S.SelectItem,{value:"event",children:"Event"}),(0,s.jsx)(S.SelectItem,{value:"advertisement",children:"Advertisement"}),(0,s.jsx)(S.SelectItem,{value:"walk_in",children:"Walk-In"}),(0,s.jsx)(S.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(S.Label,{children:"Priority"}),(0,s.jsxs)(S.Select,{value:N,onValueChange:P,children:[(0,s.jsx)(S.SelectTrigger,{children:(0,s.jsx)(S.SelectValue,{placeholder:"All Priorities"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"",children:"All Priorities"}),(0,s.jsx)(S.SelectItem,{value:"1",children:"High"}),(0,s.jsx)(S.SelectItem,{value:"2",children:"Medium"}),(0,s.jsx)(S.SelectItem,{value:"3",children:"Low"})]})]})]})]})]})})}),(0,s.jsx)(S.EnhancedDataTable,{data:G,columns:Y,isLoading:R,bulkActions:ee,onRowClick:e=>K(e),searchable:!0,exportable:!0}),(0,s.jsx)(_,{isOpen:M,onClose:()=>k(!1),onSuccess:()=>T(),onCreate:V}),(0,s.jsx)(q,{isOpen:Z,onClose:()=>$(!1),lead:E,onUpdate:()=>T()})]})}},9512:(e,t,a)=>{"use strict";a.d(t,{FV:()=>s.LeadSourceBadge,PW:()=>s.LeadStatusBadge,Uy:()=>s.LeadPriorityBadge,t4:()=>s.QuoteStatusBadge});var s=a(5839)},37263:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r,dynamic:()=>i,dynamicParams:()=>l});var s=a(68570);let i=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/crm/leads/page.tsx#dynamic`),l=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/crm/leads/page.tsx#dynamicParams`),r=(0,s.createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/crm/leads/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[2793,1009,6226,657,5839,6032,4218,7558],()=>a(67853));module.exports=s})();