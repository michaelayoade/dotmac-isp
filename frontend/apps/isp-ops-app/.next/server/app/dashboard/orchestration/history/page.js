(()=>{var e={};e.id=418,e.ids=[418],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},52220:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d}),r(56178),r(13321),r(46366),r(96560);var s=r(23191),a=r(88716),o=r(37922),n=r.n(o),l=r(95231),i={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);r.d(t,i);let d=["",{children:["dashboard",{children:["orchestration",{children:["history",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,56178)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/orchestration/history/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,13321)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,46366)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,96560)),"/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/not-found.tsx"]}],c=["/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/orchestration/history/page.tsx"],u="/dashboard/orchestration/history/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/orchestration/history/page",pathname:"/dashboard/orchestration/history",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},14721:(e,t,r)=>{Promise.resolve().then(r.bind(r,8577))},8577:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>_});var s=r(10326),a=r(17577),o=r(66307),n=r(77506),l=r(69669),i=r(21405),d=r(48998),c=r(41137),u=r(88307),p=r(66697),m=r(12714),x=r(98091),h=r(31540),f=r(11890),g=r(39183),b=r(57252),w=r(59341),y=r(48723);function j(e,t){if(!e)return"N/A";let r=new Date(e).getTime(),s=Math.floor(((t?new Date(t).getTime():Date.now())-r)/1e3);return s<60?`${s}s`:s<3600?`${Math.floor(s/60)}m ${s%60}s`:`${Math.floor(s/3600)}h ${Math.floor(s%3600/60)}m`}function k(e){return e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function v({statusFilter:e,typeFilter:t,searchQuery:r,dateFrom:o,dateTo:n,onStatusChange:l,onTypeChange:i,onSearchChange:d,onDateFromChange:p,onDateToChange:m,onClearFilters:x}){let[h,f]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"border border-border rounded-lg p-4 bg-card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("button",{onClick:()=>f(!h),className:"flex items-center gap-2 text-foreground font-medium",children:[(0,s.jsx)(c.Z,{className:"h-5 w-5"}),"Filters",("all"!==e||"all"!==t||r||o||n)&&(0,s.jsx)("span",{className:"ml-2 px-2 py-0.5 bg-primary text-primary-foreground text-xs rounded-full",children:"Active"})]}),(0,s.jsx)("button",{onClick:x,className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Clear all"})]}),h&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Search Workflow ID"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)("input",{type:"text",value:r,onChange:e=>d(e.target.value),placeholder:"Search by workflow ID...",className:"w-full pl-9 pr-3 py-2 border border-border rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Status"}),(0,s.jsx)("select",{value:e,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary",children:["all","completed","failed","running","pending","rolled_back"].map(e=>(0,s.jsx)("option",{value:e,children:"all"===e?"All Statuses":e.replace("_"," ").toUpperCase()},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Workflow Type"}),(0,s.jsx)("select",{value:t,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary",children:["all","provision_subscriber","deprovision_subscriber","activate_service","suspend_service","terminate_service","change_service_plan"].map(e=>(0,s.jsx)("option",{value:e,children:"all"===e?"All Types":k(e)},e))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"From Date"}),(0,s.jsx)("input",{type:"date",value:o,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"To Date"}),(0,s.jsx)("input",{type:"date",value:n,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]})]})]})]})}function N({workflows:e,loading:t,selectedIds:r,onSelectAll:a,onSelectOne:c,onViewDetails:u}){if(t)return(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)(n.Z,{className:"h-8 w-8 animate-spin text-primary"})});if(0===e.length)return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,s.jsx)(p.Z,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-lg font-medium text-foreground",children:"No workflows found"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Try adjusting your filters"})]});let x=e.length>0&&e.every(e=>r.has(e.id));return(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"border-b border-border",children:(0,s.jsxs)("tr",{className:"text-left",children:[(0,s.jsx)("th",{className:"pb-3 pr-4",children:(0,s.jsx)("input",{type:"checkbox",checked:x,onChange:e=>a(e.target.checked),className:"rounded border-border"})}),(0,s.jsx)("th",{className:"pb-3 pr-4 text-sm font-medium text-muted-foreground",children:"Workflow ID"}),(0,s.jsx)("th",{className:"pb-3 pr-4 text-sm font-medium text-muted-foreground",children:"Type"}),(0,s.jsx)("th",{className:"pb-3 pr-4 text-sm font-medium text-muted-foreground",children:"Status"}),(0,s.jsx)("th",{className:"pb-3 pr-4 text-sm font-medium text-muted-foreground",children:"Duration"}),(0,s.jsx)("th",{className:"pb-3 pr-4 text-sm font-medium text-muted-foreground",children:"Started"}),(0,s.jsx)("th",{className:"pb-3 text-sm font-medium text-muted-foreground",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:e.map(e=>{let t=function(e){switch(e){case"completed":return o.Z;case"running":return n.Z;case"failed":return l.Z;case"rolling_back":case"rolled_back":return i.Z;default:return d.Z}}(e.status);return(0,s.jsxs)("tr",{className:"border-b border-border last:border-0 hover:bg-muted/50",children:[(0,s.jsx)("td",{className:"py-4 pr-4",children:(0,s.jsx)("input",{type:"checkbox",checked:r.has(e.id),onChange:t=>c(e.id,t.target.checked),className:"rounded border-border"})}),(0,s.jsx)("td",{className:"py-4 pr-4",children:(0,s.jsxs)("span",{className:"font-mono text-sm text-foreground",children:[e.workflow_id.slice(0,12),"..."]})}),(0,s.jsx)("td",{className:"py-4 pr-4",children:(0,s.jsx)("span",{className:"text-sm text-foreground",children:k(e.workflow_type)})}),(0,s.jsx)("td",{className:"py-4 pr-4",children:(0,s.jsxs)("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${function(e){switch(e){case"completed":return"text-green-600 bg-green-50 dark:text-green-400 dark:bg-green-950";case"running":return"text-blue-600 bg-blue-50 dark:text-blue-400 dark:bg-blue-950";case"failed":return"text-red-600 bg-red-50 dark:text-red-400 dark:bg-red-950";case"rolling_back":case"rolled_back":return"text-orange-600 bg-orange-50 dark:text-orange-400 dark:bg-orange-950";default:return"text-gray-600 bg-gray-50 dark:text-gray-400 dark:bg-gray-950"}}(e.status)}`,children:[(0,s.jsx)(t,{className:`h-3.5 w-3.5 ${"running"===e.status?"animate-spin":""}`}),e.status.toUpperCase()]})}),(0,s.jsx)("td",{className:"py-4 pr-4 text-sm text-muted-foreground",children:j(e.started_at,e.completed_at||e.failed_at)}),(0,s.jsx)("td",{className:"py-4 pr-4 text-sm text-muted-foreground",children:e.started_at?new Date(e.started_at).toLocaleString():"Not started"}),(0,s.jsx)("td",{className:"py-4",children:(0,s.jsx)("button",{onClick:()=>u(e.workflow_id),className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"View details",children:(0,s.jsx)(m.Z,{className:"h-4 w-4"})})})]},e.id)})})]})})}function _(){let[e,t]=(0,a.useState)(1),[r]=(0,a.useState)(20),[o,n]=(0,a.useState)("all"),[l,d]=(0,a.useState)("all"),[c,u]=(0,a.useState)(""),[p,m]=(0,a.useState)(""),[k,_]=(0,a.useState)(""),[S,D]=(0,a.useState)(new Set),[q,C]=(0,a.useState)(null),P=(0,y.useConfirmDialog)(),{data:F,isLoading:T,refetch:A}=(0,b.D)({status:"all"!==o?o:void 0,workflowType:"all"!==l?l:void 0,page:e,pageSize:r}),$=F?.workflows,Z=(0,a.useMemo)(()=>$??[],[$]),U=F?.total??0,E=F?.total_pages??0,M=(0,a.useMemo)(()=>Z.filter(e=>!(c&&!e.workflow_id.toLowerCase().includes(c.toLowerCase())||p&&e.started_at&&new Date(e.started_at)<new Date(p)||k&&e.started_at&&new Date(e.started_at)>new Date(k))),[Z,c,p,k]),W=async()=>{let e=Array.from(S);if(0!==e.length&&await P({title:"Delete workflows",description:`Are you sure you want to delete ${e.length} workflow(s)? This action cannot be undone?`,confirmText:"Delete workflows",variant:"destructive"}))try{await Promise.all(e.map(async e=>{await w.x1.delete(`/orchestration/workflows/${e}`)})),D(new Set),alert(`Successfully deleted ${e.length} workflow(s)`),window.location.reload()}catch(e){console.error("Bulk delete failed:",e),alert(`Failed to delete workflows: ${e.message||"Unknown error"}`)}};return(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Workflow History"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:"Browse and search historical workflow executions"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[S.size>0&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("button",{onClick:()=>{W()},className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:[(0,s.jsx)(x.Z,{className:"h-4 w-4"}),"Delete (",S.size,")"]})}),(0,s.jsxs)("button",{onClick:()=>{let e=M.filter(e=>S.has(e.id)),t=new Blob([["Workflow ID,Type,Status,Started,Duration,Error",...(e.length>0?e:M).map(e=>[e.workflow_id,e.workflow_type,e.status,e.started_at||"",j(e.started_at,e.completed_at||e.failed_at),e.error_message||""].join(","))].join("\n")],{type:"text/csv"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=`workflows-${new Date().toISOString().split("T")[0]}.csv`,s.click(),URL.revokeObjectURL(r)},className:"flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg transition-colors",children:[(0,s.jsx)(h.Z,{className:"h-4 w-4"}),"Export ",S.size>0?`(${S.size})`:"All"]}),(0,s.jsxs)("button",{onClick:()=>A(),className:"flex items-center gap-2 px-4 py-2 bg-muted hover:bg-muted/80 text-foreground rounded-lg transition-colors",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),"Refresh"]})]})]}),(0,s.jsx)(v,{statusFilter:o,typeFilter:l,searchQuery:c,dateFrom:p,dateTo:k,onStatusChange:n,onTypeChange:d,onSearchChange:u,onDateFromChange:m,onDateToChange:_,onClearFilters:()=>{n("all"),d("all"),u(""),m(""),_("")}}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,s.jsxs)("span",{children:["Showing ",M.length," of ",U," workflows"]}),(0,s.jsxs)("span",{children:["Page ",e," of ",E]})]}),(0,s.jsx)("div",{className:"border border-border rounded-lg bg-card",children:(0,s.jsx)(N,{workflows:M,loading:T,selectedIds:S,onSelectAll:e=>{e?D(new Set(M.map(e=>e.id))):D(new Set)},onSelectOne:(e,t)=>{let r=new Set(S);t?r.add(e):r.delete(e),D(r)},onViewDetails:C})}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("button",{onClick:()=>t(e=>Math.max(1,e-1)),disabled:1===e,className:"flex items-center gap-2 px-4 py-2 border border-border rounded-lg bg-background text-foreground disabled:opacity-50 disabled:cursor-not-allowed hover:bg-muted transition-colors",children:[(0,s.jsx)(f.Z,{className:"h-4 w-4"}),"Previous"]}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",e," of ",E]}),(0,s.jsxs)("button",{onClick:()=>t(e=>Math.min(E,e+1)),disabled:e===E,className:"flex items-center gap-2 px-4 py-2 border border-border rounded-lg bg-background text-foreground disabled:opacity-50 disabled:cursor-not-allowed hover:bg-muted transition-colors",children:["Next",(0,s.jsx)(g.Z,{className:"h-4 w-4"})]})]})]})}},57252:(e,t,r)=>{"use strict";r.d(t,{D:()=>u,DW:()=>p,el:()=>x,lv:()=>c,zE:()=>m});var s=r(48324),a=r(44976),o=r(17010),n=r(59341),l=r(29771);let i={all:["orchestration"],stats:()=>[...i.all,"stats"],workflows:e=>[...i.all,"workflows",e],workflow:e=>[...i.all,"workflow",e]};function d(e){e.invalidateQueries({predicate:e=>{let t=e.queryKey;return t?.[0]==="orchestration"&&t?.[1]==="workflows"}})}function c(){return(0,s.a)({queryKey:i.stats(),queryFn:async()=>{try{return(await n.x1.get("orchestration/statistics")).data}catch(e){throw l.k.error("Failed to fetch orchestration stats",e),Error(e.response?.data?.detail||"Failed to fetch statistics")}},staleTime:3e4,refetchOnWindowFocus:!0})}function u(e={}){let{status:t,workflowType:r,page:a=1,pageSize:o=20,autoRefresh:d=!1,refreshInterval:c=5e3}=e;return(0,s.a)({queryKey:i.workflows({status:t,workflowType:r,page:a,pageSize:o}),queryFn:async()=>{try{let e={page:a,page_size:o};return t&&(e.status=t),r&&(e.workflow_type=r),(await n.x1.get("orchestration/workflows",{params:e})).data}catch(e){throw l.k.error("Failed to fetch workflows",e),Error(e.response?.data?.detail||"Failed to fetch workflows")}},staleTime:1e4,refetchInterval:!!d&&c,refetchOnWindowFocus:!0})}function p(e,t=!1){return(0,s.a)({queryKey:i.workflow(e??""),queryFn:async()=>{if(!e)return null;try{return(await n.x1.get(`/orchestration/workflows/${e}`)).data}catch(e){throw l.k.error("Failed to fetch workflow",e),Error(e.response?.data?.detail||"Failed to fetch workflow")}},enabled:!!e,staleTime:2e3,refetchInterval:e=>!!t&&!!e.state.data&&!["completed","failed","rolled_back","rollback_failed","timeout","compensated"].includes(e.state.data.status)&&2e3,refetchOnWindowFocus:!0})}function m(){let e=(0,a.NL)(),t=(0,o.D)({mutationFn:async e=>(await n.x1.post(`/orchestration/workflows/${e}/retry`),e),onSuccess:t=>{e.invalidateQueries({queryKey:i.workflow(t)}),d(e),e.invalidateQueries({queryKey:i.stats()})},onError:e=>{l.k.error("Failed to retry workflow",e)}});return{retryWorkflow:t.mutateAsync,loading:t.isPending,error:t.error?String(t.error):null}}function x(){let e=(0,a.NL)(),t=(0,o.D)({mutationFn:async e=>(await n.x1.post(`/orchestration/workflows/${e}/cancel`),e),onSuccess:t=>{e.invalidateQueries({queryKey:i.workflow(t)}),d(e),e.invalidateQueries({queryKey:i.stats()})},onError:e=>{l.k.error("Failed to cancel workflow",e)}});return{cancelWorkflow:t.mutateAsync,loading:t.isPending,error:t.error?String(t.error):null}}},56178:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`/Users/michaelayoade/Downloads/Projects/dotmac-ftth-ops/split-staging/dotmac-isp/frontend/apps/isp-ops-app/app/dashboard/orchestration/history/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[2793,1009,6226,657,6032,4218],()=>r(52220));module.exports=s})();